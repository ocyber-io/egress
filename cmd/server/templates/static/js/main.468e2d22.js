/*! For license information please see main.468e2d22.js.LICENSE.txt */
(()=>{var e={278:(e,t,n)=>{"use strict";const i=n(357),r={getLiveKitURL(){const e=u("url");if(!e)throw new Error("url is not found in query string");return e},getAccessToken(){const e=u("token");if(!e)throw new Error("token is not found in query string");return e},getLayout(){if(a.layout)return a.layout;const e=u("layout");return null!==e&&void 0!==e?e:""},setRoom(e,t){s&&(s.off(i.RoomEvent.ParticipantDisconnected,l),s.off(i.RoomEvent.Disconnected,r.endRecording)),s=e,s.localParticipant.on(i.ParticipantEvent.ParticipantMetadataChanged,c),(null===t||void 0===t?void 0:t.autoEnd)&&s.on(i.RoomEvent.ParticipantDisconnected,l),s.on(i.RoomEvent.Disconnected,r.endRecording),c()},startRecording(){console.log("START_RECORDING")},endRecording(){s=void 0,console.log("END_RECORDING")},onLayoutChanged(e){o=e}};let s,o,a={layout:""};function c(){const e=null===s||void 0===s?void 0:s.localParticipant.metadata;if(e){const t=JSON.parse(e);t&&t.layout!==a.layout&&(a=t,o(a.layout))}}function l(){s&&0===s.participants.size&&r.endRecording()}function u(e){return new URLSearchParams(window.location.search).get(e)}t.A=r},357:function(e,t,n){!function(e){"use strict";function t(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s={exports:{}};!function(e){var t,n;t=i,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(t,n){for(var r=0;r<i.length;r++){var s=i[r];this[s]=r<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function a(e,n,i){return function(){typeof console!==t&&(o.call(this,n,i),this[e].apply(this,arguments))}}function c(i,o,c){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}(i)||a.apply(this,arguments)}function l(e,n,r){var s,a=this;n=null==n?"WARN":n;var l="loglevel";function u(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(l)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=r||c,a.getLevel=function(){return s},a.setLevel=function(n,r){if("string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==r&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+n+";"}catch(e){}}}(n),o.call(a,n,e),typeof console===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){n=e,u()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(n,!1),function(){if(typeof window!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var d=u();null==d&&(d=n),a.setLevel(d,!1)}var u=new l,d={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new l(e,u.getLevel(),u.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=h),u},u.getLoggers=function(){return d},u.default=u,u},e.exports?e.exports=n():t.log=n()}(s);var o,a,c=s.exports;e.LogLevel=void 0,(o=e.LogLevel||(e.LogLevel={}))[o.trace=0]="trace",o[o.debug=1]="debug",o[o.info=2]="info",o[o.warn=3]="warn",o[o.error=4]="error",o[o.silent=5]="silent",function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(a||(a={}));let l=c.getLogger("livekit");function u(e){const t=c.getLogger(e);return t.setDefaultLevel(l.getLevel()),t}function d(e,t){if(!e)throw new Error(t)}l.setDefaultLevel(e.LogLevel.info),c.getLogger("lk-e2ee");const h=34028234663852886e22,p=-34028234663852886e22,m=4294967295,f=2147483647,g=-2147483648;function v(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>f||e<g)throw new Error("invalid int 32: "+e)}function y(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>m||e<0)throw new Error("invalid uint 32: "+e)}function b(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>h||e<p))throw new Error("invalid float 32: "+e)}const k=Symbol("@bufbuild/protobuf/enum-type");function S(e){const t=e[k];return d(t,"missing enum type on enum object"),t}function C(e,t,n,i){e[k]=T(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function T(e,t,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of t){const e=E(o);s.push(e),i[o.name]=e,r[o.no]=e}return{typeName:e,values:s,findName:e=>i[e],findNumber:e=>r[e]}}function w(e,t,n){const i={};for(const r of t){const e=E(r);i[e.localName]=e.no,i[e.no]=e.localName}return C(i,e,t),i}function E(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class P{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}var R,x;function O(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function I(e,t,n){for(let s=0;s<28;s+=7){const i=e>>>s,r=!(i>>>7==0&&0==t),o=255&(r?128|i:i);if(n.push(o),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),s=255&(r?128|i:i);if(n.push(s),!r)return}n.push(t>>>31&1)}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(R||(R={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(x||(x={}));const N=4294967296;function _(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function s(t,s){const o=Number(e.slice(t,s));r*=n,i=i*n+o,i>=N&&(r+=i/N|0,i%=N)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),t?L(i,r):M(i,r)}function D(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(N*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,s=n+8147497*i,o=2*i;const a=1e7;return r>=a&&(s+=Math.floor(r/a),r%=a),s>=a&&(o+=Math.floor(s/a),s%=a),o.toString()+A(s)+A(r)}function M(e,t){return{lo:0|e,hi:0|t}}function L(e,t){return t=~t,e?e=1+~e:t+=1,M(e,t)}const A=e=>{const t=String(e);return"0000000".slice(t.length)+t};function U(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function j(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!=(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const F=function(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>d(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>d(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),_(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),_(e)),dec:(e,t)=>function(e,t){let n=M(e,t);const i=2147483648&n.hi;i&&(n=L(n.lo,n.hi));const r=D(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>D(e,t)}}();var B;!function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(B||(B={}));class J{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(y(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return v(e),U(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){b(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){y(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){v(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return v(e),U(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=F.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=F.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=F.enc(e);return I(t.lo,t.hi,this.buf),this}sint64(e){let t=F.enc(e),n=t.hi>>31;return I(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=F.uEnc(e);return I(t.lo,t.hi,this.buf),this}}class V{constructor(e,t){this.varint64=O,this.uint32=j,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e){let t=this.pos;switch(e){case B.Varint:for(;128&this.buf[this.pos++];);break;case B.Bit64:this.pos+=4;case B.Bit32:this.pos+=4;break;case B.LengthDelimited:let t=this.uint32();this.pos+=t;break;case B.StartGroup:let n;for(;(n=this.tag()[1])!==B.EndGroup;)this.skip(n);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return F.dec(...this.varint64())}uint64(){return F.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,F.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return F.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return F.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function q(e,t){return t instanceof P||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}function z(e,t,n){if(t===n)return!0;if(e==R.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return t==n}return!1}function W(e,t){switch(e){case R.BOOL:return!1;case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return 0==t?F.zero:"0";case R.DOUBLE:case R.FLOAT:return 0;case R.BYTES:return new Uint8Array(0);case R.STRING:return"";default:return 0}}function K(e,t){const n=void 0===t;let i=B.Varint,r=0===t;switch(e){case R.STRING:r=n||!t.length,i=B.LengthDelimited;break;case R.BOOL:r=!1===t;break;case R.DOUBLE:i=B.Bit64;break;case R.FLOAT:i=B.Bit32;break;case R.INT64:case R.UINT64:r=n||0==t;break;case R.FIXED64:r=n||0==t,i=B.Bit64;break;case R.BYTES:r=n||!t.byteLength,i=B.LengthDelimited;break;case R.FIXED32:case R.SFIXED32:i=B.Bit32;break;case R.SFIXED64:r=n||0==t,i=B.Bit64;break;case R.SINT64:r=n||0==t}return[i,R[e].toLowerCase(),n||r]}R.DOUBLE,R.FLOAT,R.INT64,R.UINT64,R.INT32,R.UINT32,R.BOOL,R.STRING,R.BYTES;const H=Symbol("@bufbuild/protobuf/unknown-fields"),G={readUnknownFields:!0,readerFactory:e=>new V(e)},Q={writeUnknownFields:!0,writerFactory:()=>new J};function Y(e){return e?Object.assign(Object.assign({},G),e):G}function $(e){return e?Object.assign(Object.assign({},Q),e):Q}function X(e,t,n){return t.getType().runtime.bin.readMessage(t,e,e.uint32(),n),t}function Z(e,t,n){const i=t.uint32(),r=t.pos+i;let s,o;for(;t.pos<r;){let[i]=t.tag();switch(i){case 1:s=te(t,e.K);break;case 2:switch(e.V.kind){case"scalar":o=te(t,e.V.T);break;case"enum":o=t.int32();break;case"message":o=X(t,new e.V.T,n)}}}if(void 0===s){let t=W(e.K,x.BIGINT);s=e.K==R.BOOL?t.toString():t}if("string"!=typeof s&&"number"!=typeof s&&(s=s.toString()),void 0===o)switch(e.V.kind){case"scalar":o=W(e.V.T,x.BIGINT);break;case"enum":o=0;break;case"message":o=new e.V.T}return[s,o]}function ee(e,t){const n=te(e,t);return"bigint"==typeof n?n.toString():n}function te(e,t){switch(t){case R.STRING:return e.string();case R.BOOL:return e.bool();case R.DOUBLE:return e.double();case R.FLOAT:return e.float();case R.INT32:return e.int32();case R.INT64:return e.int64();case R.UINT64:return e.uint64();case R.FIXED64:return e.fixed64();case R.BYTES:return e.bytes();case R.FIXED32:return e.fixed32();case R.SFIXED32:return e.sfixed32();case R.SFIXED64:return e.sfixed64();case R.SINT64:return e.sint64();case R.UINT32:return e.uint32();case R.SINT32:return e.sint32()}}function ne(e,t,n,i,r){e.tag(n.no,B.LengthDelimited),e.fork();let s=i;switch(n.K){case R.INT32:case R.FIXED32:case R.UINT32:case R.SFIXED32:case R.SINT32:s=Number.parseInt(i);break;case R.BOOL:d("true"==i||"false"==i),s="true"==i}switch(re(e,n.K,1,s,!0),n.V.kind){case"scalar":re(e,n.V.T,2,r,!0);break;case"enum":re(e,R.INT32,2,r,!0);break;case"message":ie(e,t,n.V.T,2,r)}e.join()}function ie(e,t,n,i,r){if(void 0!==r){const s=q(n,r);e.tag(i,B.LengthDelimited).bytes(s.toBinary(t))}}function re(e,t,n,i,r){let[s,o,a]=K(t,i);a&&!r||e.tag(n,s)[o](i)}function se(e,t,n,i){if(!i.length)return;e.tag(n,B.LengthDelimited).fork();let[,r]=K(t);for(let s=0;s<i.length;s++)e[r](i[s]);e.join()}let oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ae=[];for(let n=0;n<oe.length;n++)ae[oe[n].charCodeAt(0)]=n;ae["-".charCodeAt(0)]=oe.indexOf("+"),ae["_".charCodeAt(0)]=oe.indexOf("/");const ce={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,s=0,o=0;for(let a=0;a<e.length;a++){if(n=ae[e.charCodeAt(a)],void 0===n)switch(e[a]){case"=":s=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=n,s=1;break;case 1:i[r++]=o<<2|(48&n)>>4,o=n,s=2;break;case 2:i[r++]=(15&o)<<4|(60&n)>>2,o=n,s=3;break;case 3:i[r++]=(3&o)<<6|n,s=0}}if(1==s)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let s=0;s<e.length;s++)switch(t=e[s],i){case 0:n+=oe[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=oe[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=oe[r|t>>6],n+=oe[63&t],i=0}return i&&(n+=oe[r],n+="=",1==i&&(n+="=")),n}},le={ignoreUnknownFields:!1},ue={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function de(e){return e?Object.assign(Object.assign({},le),e):le}function he(e){return e?Object.assign(Object.assign({},ue),e):ue}function pe(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function me(e,t,n){switch(e){case R.DOUBLE:case R.FLOAT:if(null===t)return 0;if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==R.FLOAT&&b(i),i;case R.INT32:case R.FIXED32:case R.SFIXED32:case R.SINT32:case R.UINT32:if(null===t)return 0;let r;if("number"==typeof t?r=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),void 0===r)break;return e==R.UINT32?y(r):v(r),r;case R.INT64:case R.SFIXED64:case R.SINT64:if(null===t)return F.zero;if("number"!=typeof t&&"string"!=typeof t)break;const s=F.parse(t);return n?s.toString():s;case R.FIXED64:case R.UINT64:if(null===t)return F.zero;if("number"!=typeof t&&"string"!=typeof t)break;const o=F.uParse(t);return n?o.toString():o;case R.BOOL:if(null===t)return!1;if("boolean"!=typeof t)break;return t;case R.STRING:if(null===t)return"";if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(e){throw new Error("invalid UTF8")}return t;case R.BYTES:if(null===t||""===t)return new Uint8Array(0);if("string"!=typeof t)break;return ce.dec(t)}throw new Error}function fe(e,t,n){if(null===t)return 0;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(i||n)return null==i?void 0:i.no}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(pe(t)))}function ge(e,t,n,i){var r;if(void 0===t)return t;if(0===t&&!n)return;if(i)return t;if("google.protobuf.NullValue"==e.typeName)return null;const s=e.findNumber(t);return null!==(r=null==s?void 0:s.name)&&void 0!==r?r:t}function ve(e,t,n){if(void 0!==t)switch(e){case R.INT32:case R.SFIXED32:case R.SINT32:case R.FIXED32:case R.UINT32:return d("number"==typeof t),0!=t||n?t:void 0;case R.FLOAT:case R.DOUBLE:return d("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":0!==t||n?t:void 0;case R.STRING:return d("string"==typeof t),t.length>0||n?t:void 0;case R.BOOL:return d("boolean"==typeof t),t||n?t:void 0;case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return d("bigint"==typeof t||"string"==typeof t||"number"==typeof t),n||0!=t?t.toString(10):void 0;case R.BYTES:return d(t instanceof Uint8Array),n||t.byteLength>0?ce.enc(t):void 0}}function ye(e){if(void 0===e)return e;if(e instanceof P)return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function be(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class ke{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function Se(e,t){const n=Te(e);return t?n:xe(Re(n))}const Ce=Te;function Te(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const we=new Set(["constructor","toString","toJSON","valueOf"]),Ee=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Pe=e=>"".concat(e,"$"),Re=e=>Ee.has(e)?Pe(e):e,xe=e=>we.has(e)?Pe(e):e;class Oe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Se(e,!1)}addField(e){d(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const Ie=(Ne="proto3",_e=function(e){const t=e(ge,ve);return{makeReadOptions:de,makeWriteOptions:he,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(this.debug(t)));i=null!=i?i:new e;const r={};for(const[s,o]of Object.entries(t)){const t=e.fields.findJsonName(s);if(!t){if(!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(s,'" is unknown'));continue}let a=t.localName,c=i;if(t.oneof){if(null===o&&"scalar"==t.kind)continue;const n=r[t.oneof.localName];if(n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(s,'"'));r[t.oneof.localName]=s,c=c[t.oneof.localName]={case:a},a="value"}if(t.repeated){if(null===o)continue;if(!Array.isArray(o))throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(o)));const i=c[a];for(const r of o){if(null===r)throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(r)));let s;switch(t.kind){case"message":s=t.T.fromJson(r,n);break;case"enum":if(s=fe(t.T,r,n.ignoreUnknownFields),void 0===s)continue;break;case"scalar":try{s=me(t.T,r,t.L)}catch(n){let i="cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(r));throw n instanceof Error&&n.message.length>0&&(i+=": ".concat(n.message)),new Error(i)}}i.push(s)}}else if("map"==t.kind){if(null===o)continue;if(Array.isArray(o)||"object"!=typeof o)throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(o)));const i=c[a];for(const[r,s]of Object.entries(o)){if(null===s)throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: map value null"));let a;switch(t.V.kind){case"message":a=t.V.T.fromJson(s,n);break;case"enum":if(a=fe(t.V.T,s,n.ignoreUnknownFields),void 0===a)continue;break;case"scalar":try{a=me(t.V.T,s,x.BIGINT)}catch(n){let i="cannot decode map value for field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(o));throw n instanceof Error&&n.message.length>0&&(i+=": ".concat(n.message)),new Error(i)}}try{i[me(t.K,t.K==R.BOOL?"true"==r||"false"!=r&&r:r,x.BIGINT).toString()]=a}catch(n){let i="cannot decode map key for field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(o));throw n instanceof Error&&n.message.length>0&&(i+=": ".concat(n.message)),new Error(i)}}}else switch(t.kind){case"message":const i=t.T;if(null===o&&"google.protobuf.Value"!=i.typeName){if(t.oneof)throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name,' from JSON: null is invalid for oneof field "').concat(s,'"'));continue}c[a]instanceof P?c[a].fromJson(o,n):(c[a]=i.fromJson(o,n),i.fieldWrapper&&!t.oneof&&(c[a]=i.fieldWrapper.unwrapField(c[a])));break;case"enum":const r=fe(t.T,o,n.ignoreUnknownFields);void 0!==r&&(c[a]=r);break;case"scalar":try{c[a]=me(t.T,o,t.L)}catch(n){let i="cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(o));throw n instanceof Error&&n.message.length>0&&(i+=": ".concat(n.message)),new Error(i)}}}return i},writeMessage(e,n){const i=e.getType(),r={};let s;try{for(const o of i.fields.byMember()){let i;if("oneof"==o.kind){const r=e[o.localName];if(void 0===r.value)continue;if(s=o.findField(r.case),!s)throw"oneof case not found: "+r.case;i=t(s,r.value,n)}else s=o,i=t(s,e[s.localName],n);void 0!==i&&(r[n.useProtoFieldName?s.name:s.jsonName]=i)}}catch(e){const t=s?"cannot encode field ".concat(i.typeName,".").concat(s.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),n=e instanceof Error?e.message:String(e);throw new Error(t+(n.length>0?": ".concat(n):""))}return r},readScalar:me,writeScalar:ve,debug:pe}}(((e,t)=>function(n,i,r){if("map"==n.kind){const s={};switch(n.V.kind){case"scalar":for(const[e,r]of Object.entries(i)){const i=t(n.V.T,r,!0);d(void 0!==i),s[e.toString()]=i}break;case"message":for(const[e,t]of Object.entries(i))s[e.toString()]=t.toJson(r);break;case"enum":const o=n.V.T;for(const[t,n]of Object.entries(i)){d(void 0===n||"number"==typeof n);const i=e(o,n,!0,r.enumAsInteger);d(void 0!==i),s[t.toString()]=i}}return r.emitDefaultValues||Object.keys(s).length>0?s:void 0}if(n.repeated){const s=[];switch(n.kind){case"scalar":for(let e=0;e<i.length;e++)s.push(t(n.T,i[e],!0));break;case"enum":for(let t=0;t<i.length;t++)s.push(e(n.T,i[t],!0,r.enumAsInteger));break;case"message":for(let e=0;e<i.length;e++)s.push(q(n.T,i[e]).toJson(r))}return r.emitDefaultValues||s.length>0?s:void 0}switch(n.kind){case"scalar":return t(n.T,i,!!n.oneof||n.opt||r.emitDefaultValues);case"enum":return e(n.T,i,!!n.oneof||n.opt||r.emitDefaultValues,r.enumAsInteger);case"message":return void 0!==i?q(n.T,i).toJson(r):void 0}})),De=Object.assign(Object.assign({},{makeReadOptions:Y,makeWriteOptions:$,listUnknownFields(e){var t;return null!==(t=e[H])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[H]},writeUnknownFields(e,t){const n=e[H];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[H])||(r[H]=[]),r[H].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i){const r=e.getType(),s=void 0===n?t.len:t.pos+n;for(;t.pos<s;){const[n,s]=t.tag(),o=r.fields.find(n);if(!o){const r=t.skip(s);i.readUnknownFields&&this.onUnknownField(e,n,s,r);continue}let a=e,c=o.repeated,l=o.localName;switch(o.oneof&&(a=a[o.oneof.localName],a.case!=l&&delete a.value,a.case=l,l="value"),o.kind){case"scalar":case"enum":const e="enum"==o.kind?R.INT32:o.T;let n=te;if("scalar"==o.kind&&o.L>0&&(n=ee),c){let i=a[l];if(s==B.LengthDelimited&&e!=R.STRING&&e!=R.BYTES){let r=t.uint32()+t.pos;for(;t.pos<r;)i.push(n(t,e))}else i.push(n(t,e))}else a[l]=n(t,e);break;case"message":const r=o.T;c?a[l].push(X(t,new r,i)):a[l]instanceof P?X(t,a[l],i):(a[l]=X(t,new r,i),!r.fieldWrapper||o.oneof||o.repeated||(a[l]=r.fieldWrapper.unwrapField(a[l])));break;case"map":let[u,d]=Z(o,t,i);a[l][u]=d}}}}),{writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber()){let i,s=r.repeated,o=r.localName;if(r.oneof){const t=e[r.oneof.localName];if(t.case!==o)continue;i=t.value}else i=e[o];switch(r.kind){case"scalar":case"enum":let e="enum"==r.kind?R.INT32:r.T;if(s)if(r.packed)se(t,e,r.no,i);else for(const n of i)re(t,e,r.no,n,!0);else void 0!==i&&re(t,e,r.no,i,!!r.oneof||r.opt);break;case"message":if(s)for(const s of i)ie(t,n,r.T,r.no,s);else ie(t,n,r.T,r.no,i);break;case"map":for(const[s,o]of Object.entries(i))ne(t,n,r,s,o)}}return n.writeUnknownFields&&this.writeUnknownFields(e,t),t}}),Me=Object.assign(Object.assign({},{setEnumType:C,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,s=e;if(void 0!==s[n])switch(i.kind){case"oneof":const e=s[n].case;if(void 0===e)continue;const t=i.findField(e);let o=s[n].value;!t||"message"!=t.kind||o instanceof t.T?t&&"scalar"===t.kind&&t.T===R.BYTES&&(o=be(o)):o=new t.T(o),r[n]={case:e,value:o};break;case"scalar":case"enum":let a=s[n];i.T===R.BYTES&&(a=i.repeated?a.map(be):be(a)),r[n]=a;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===R.BYTES)for(const[t,i]of Object.entries(s[n]))r[n][t]=be(i);else Object.assign(r[n],s[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(s[n])){let i=s[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=s[n].map((e=>e instanceof c?e:new c(e)));else if(void 0!==s[n]){const e=s[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=be(e):r[n]=e:r[n]=e instanceof c?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every(((t,n)=>e.T.equals(t,r[n])));case"scalar":return i.every(((t,n)=>z(e.T,t,r[n])));case"enum":return i.every(((e,t)=>z(R.INT32,e,r[t])))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(i,r);case"enum":return z(R.INT32,i,r);case"scalar":return z(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const t=e.findField(i.case);if(void 0===t)return!0;switch(t.kind){case"message":return t.T.equals(i.value,r.value);case"enum":return z(R.INT32,i.value,r.value);case"scalar":return z(t.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(t.kind));case"map":const n=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return n.every((e=>t.equals(i[e],r[e])));case"enum":return n.every((e=>z(R.INT32,i[e],r[e])));case"scalar":const s=e.V.T;return n.every((e=>z(s,i[e],r[e])))}}})),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(ye);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=ye(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:ye(t.value)}:{case:void 0}:ye(t);i[r.localName]=n}return n}}),{newFieldList:e=>new ke(e,Ke),initFields(e){for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=W(t.T,t.L)}}}}),{syntax:Ne,json:_e,bin:De,util:Me,makeMessageType(e,t,n){return function(e,t,n,i){var r;const s=null!==(r=null==i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),o={[s]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[s];return Object.setPrototypeOf(o.prototype,new P),Object.assign(o,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new o).fromBinary(e,t),fromJson:(e,t)=>(new o).fromJson(e,t),fromJsonString:(e,t)=>(new o).fromJsonString(e,t),equals:(t,n)=>e.util.equals(o,t,n)}),o}(this,e,t,n)},makeEnum:w,makeEnumType:T,getEnumType:S});var Ne,_e,De,Me,Le,Ae,Ue,je,Fe,Be,Je,Ve,qe,ze,We;function Ke(e){var t,n,i,r;const s=[];let o;for(const a of"function"==typeof e?e():e){const e=a;if(e.localName=Se(a.name,void 0!==a.oneof),e.jsonName=null!==(t=a.jsonName)&&void 0!==t?t:Ce(a.name),e.repeated=null!==(n=a.repeated)&&void 0!==n&&n,"scalar"==a.kind&&(e.L=null!==(i=a.L)&&void 0!==i?i:x.BIGINT),e.packed=null!==(r=a.packed)&&void 0!==r?r:"enum"==a.kind||"scalar"==a.kind&&a.T!=R.BYTES&&a.T!=R.STRING,void 0!==a.oneof){const t="string"==typeof a.oneof?a.oneof:a.oneof.name;o&&o.name==t||(o=new Oe(t)),e.oneof=o,o.addField(e)}s.push(e)}return s}class He extends P{constructor(e){super(),this.seconds=F.zero,this.nanos=0,Ie.util.initPartial(e,this)}fromJson(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(Ie.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=F.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return He.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new He({seconds:F.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new He).fromBinary(e,t)}static fromJson(e,t){return(new He).fromJson(e,t)}static fromJsonString(e,t){return(new He).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(He,e,t)}}He.runtime=Ie,He.typeName="google.protobuf.Timestamp",He.fields=Ie.util.newFieldList((()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}])),function(e){e[e.DEFAULT_AC=0]="DEFAULT_AC",e[e.OPUS=1]="OPUS",e[e.AAC=2]="AAC"}(Le||(Le={})),Ie.util.setEnumType(Le,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),function(e){e[e.DEFAULT_VC=0]="DEFAULT_VC",e[e.H264_BASELINE=1]="H264_BASELINE",e[e.H264_MAIN=2]="H264_MAIN",e[e.H264_HIGH=3]="H264_HIGH",e[e.VP8=4]="VP8"}(Ae||(Ae={})),Ie.util.setEnumType(Ae,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),function(e){e[e.IC_DEFAULT=0]="IC_DEFAULT",e[e.IC_JPEG=1]="IC_JPEG"}(Ue||(Ue={})),Ie.util.setEnumType(Ue,"livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.DATA=2]="DATA"}(je||(je={})),Ie.util.setEnumType(je,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CAMERA=1]="CAMERA",e[e.MICROPHONE=2]="MICROPHONE",e[e.SCREEN_SHARE=3]="SCREEN_SHARE",e[e.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"}(Fe||(Fe={})),Ie.util.setEnumType(Fe,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),e.VideoQuality=void 0,(Be=e.VideoQuality||(e.VideoQuality={}))[Be.LOW=0]="LOW",Be[Be.MEDIUM=1]="MEDIUM",Be[Be.HIGH=2]="HIGH",Be[Be.OFF=3]="OFF",Ie.util.setEnumType(e.VideoQuality,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),function(e){e[e.POOR=0]="POOR",e[e.GOOD=1]="GOOD",e[e.EXCELLENT=2]="EXCELLENT",e[e.LOST=3]="LOST"}(Je||(Je={})),Ie.util.setEnumType(Je,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),function(e){e[e.UNSET=0]="UNSET",e[e.DISABLED=1]="DISABLED",e[e.ENABLED=2]="ENABLED"}(Ve||(Ve={})),Ie.util.setEnumType(Ve,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),e.DisconnectReason=void 0,(qe=e.DisconnectReason||(e.DisconnectReason={}))[qe.UNKNOWN_REASON=0]="UNKNOWN_REASON",qe[qe.CLIENT_INITIATED=1]="CLIENT_INITIATED",qe[qe.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",qe[qe.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",qe[qe.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",qe[qe.ROOM_DELETED=5]="ROOM_DELETED",qe[qe.STATE_MISMATCH=6]="STATE_MISMATCH",qe[qe.JOIN_FAILURE=7]="JOIN_FAILURE",Ie.util.setEnumType(e.DisconnectReason,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"}]),function(e){e[e.RR_UNKNOWN=0]="RR_UNKNOWN",e[e.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",e[e.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",e[e.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",e[e.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"}(ze||(ze={})),Ie.util.setEnumType(ze,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),function(e){e[e.SE_UNKNOWN=0]="SE_UNKNOWN",e[e.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",e[e.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND"}(We||(We={})),Ie.util.setEnumType(We,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]);let Ge=class e extends P{constructor(e){super(),this.sid="",this.name="",this.emptyTimeout=0,this.maxParticipants=0,this.creationTime=F.zero,this.turnPassword="",this.enabledCodecs=[],this.metadata="",this.numParticipants=0,this.numPublishers=0,this.activeRecording=!1,Ie.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return Ie.util.equals(e,t,n)}};Ge.runtime=Ie,Ge.typeName="livekit.Room",Ge.fields=Ie.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Qe,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8}]));class Qe extends P{constructor(e){super(),this.mime="",this.fmtpLine="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Qe).fromBinary(e,t)}static fromJson(e,t){return(new Qe).fromJson(e,t)}static fromJsonString(e,t){return(new Qe).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Qe,e,t)}}Qe.runtime=Ie,Qe.typeName="livekit.Codec",Qe.fields=Ie.util.newFieldList((()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]));class Ye extends P{constructor(e){super(),this.enabled=!1,this.min=0,this.max=0,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Ye).fromBinary(e,t)}static fromJson(e,t){return(new Ye).fromJson(e,t)}static fromJsonString(e,t){return(new Ye).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Ye,e,t)}}Ye.runtime=Ie,Ye.typeName="livekit.PlayoutDelay",Ye.fields=Ie.util.newFieldList((()=>[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]));class $e extends P{constructor(e){super(),this.canSubscribe=!1,this.canPublish=!1,this.canPublishData=!1,this.canPublishSources=[],this.hidden=!1,this.recorder=!1,this.canUpdateMetadata=!1,this.agent=!1,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new $e).fromBinary(e,t)}static fromJson(e,t){return(new $e).fromJson(e,t)}static fromJsonString(e,t){return(new $e).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals($e,e,t)}}$e.runtime=Ie,$e.typeName="livekit.ParticipantPermission",$e.fields=Ie.util.newFieldList((()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:Ie.getEnumType(Fe),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8}]));class Xe extends P{constructor(e){super(),this.sid="",this.identity="",this.state=Ze.JOINING,this.tracks=[],this.metadata="",this.joinedAt=F.zero,this.name="",this.version=0,this.region="",this.isPublisher=!1,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Xe).fromBinary(e,t)}static fromJson(e,t){return(new Xe).fromJson(e,t)}static fromJsonString(e,t){return(new Xe).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Xe,e,t)}}var Ze,et,tt,nt,it;Xe.runtime=Ie,Xe.typeName="livekit.ParticipantInfo",Xe.fields=Ie.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Ie.getEnumType(Ze)},{no:4,name:"tracks",kind:"message",T:ot,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:$e},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8}])),function(e){e[e.JOINING=0]="JOINING",e[e.JOINED=1]="JOINED",e[e.ACTIVE=2]="ACTIVE",e[e.DISCONNECTED=3]="DISCONNECTED"}(Ze||(Ze={})),Ie.util.setEnumType(Ze,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]);class rt extends P{constructor(e){super(),Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new rt).fromBinary(e,t)}static fromJson(e,t){return(new rt).fromJson(e,t)}static fromJsonString(e,t){return(new rt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(rt,e,t)}}rt.runtime=Ie,rt.typeName="livekit.Encryption",rt.fields=Ie.util.newFieldList((()=>[])),function(e){e[e.NONE=0]="NONE",e[e.GCM=1]="GCM",e[e.CUSTOM=2]="CUSTOM"}(et||(et={})),Ie.util.setEnumType(et,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);class st extends P{constructor(e){super(),this.mimeType="",this.mid="",this.cid="",this.layers=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new st).fromBinary(e,t)}static fromJson(e,t){return(new st).fromJson(e,t)}static fromJsonString(e,t){return(new st).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(st,e,t)}}st.runtime=Ie,st.typeName="livekit.SimulcastCodecInfo",st.fields=Ie.util.newFieldList((()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:at,repeated:!0}]));class ot extends P{constructor(e){super(),this.sid="",this.type=je.AUDIO,this.name="",this.muted=!1,this.width=0,this.height=0,this.simulcast=!1,this.disableDtx=!1,this.source=Fe.UNKNOWN,this.layers=[],this.mimeType="",this.mid="",this.codecs=[],this.stereo=!1,this.disableRed=!1,this.encryption=et.NONE,this.stream="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new ot).fromBinary(e,t)}static fromJson(e,t){return(new ot).fromJson(e,t)}static fromJsonString(e,t){return(new ot).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(ot,e,t)}}ot.runtime=Ie,ot.typeName="livekit.TrackInfo",ot.fields=Ie.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:Ie.getEnumType(je)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:Ie.getEnumType(Fe)},{no:10,name:"layers",kind:"message",T:at,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:st,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:Ie.getEnumType(et)},{no:17,name:"stream",kind:"scalar",T:9}]));class at extends P{constructor(t){super(),this.quality=e.VideoQuality.LOW,this.width=0,this.height=0,this.bitrate=0,this.ssrc=0,Ie.util.initPartial(t,this)}static fromBinary(e,t){return(new at).fromBinary(e,t)}static fromJson(e,t){return(new at).fromJson(e,t)}static fromJsonString(e,t){return(new at).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(at,e,t)}}at.runtime=Ie,at.typeName="livekit.VideoLayer",at.fields=Ie.util.newFieldList((()=>[{no:1,name:"quality",kind:"enum",T:Ie.getEnumType(e.VideoQuality)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]));class ct extends P{constructor(t){super(),this.kind=e.DataPacket_Kind.RELIABLE,this.value={case:void 0},Ie.util.initPartial(t,this)}static fromBinary(e,t){return(new ct).fromBinary(e,t)}static fromJson(e,t){return(new ct).fromJson(e,t)}static fromJsonString(e,t){return(new ct).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(ct,e,t)}}ct.runtime=Ie,ct.typeName="livekit.DataPacket",ct.fields=Ie.util.newFieldList((()=>[{no:1,name:"kind",kind:"enum",T:Ie.getEnumType(e.DataPacket_Kind)},{no:2,name:"user",kind:"message",T:dt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:lt,oneof:"value"}])),e.DataPacket_Kind=void 0,(tt=e.DataPacket_Kind||(e.DataPacket_Kind={}))[tt.RELIABLE=0]="RELIABLE",tt[tt.LOSSY=1]="LOSSY",Ie.util.setEnumType(e.DataPacket_Kind,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);class lt extends P{constructor(e){super(),this.speakers=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new lt).fromBinary(e,t)}static fromJson(e,t){return(new lt).fromJson(e,t)}static fromJsonString(e,t){return(new lt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(lt,e,t)}}lt.runtime=Ie,lt.typeName="livekit.ActiveSpeakerUpdate",lt.fields=Ie.util.newFieldList((()=>[{no:1,name:"speakers",kind:"message",T:ut,repeated:!0}]));class ut extends P{constructor(e){super(),this.sid="",this.level=0,this.active=!1,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new ut).fromBinary(e,t)}static fromJson(e,t){return(new ut).fromJson(e,t)}static fromJsonString(e,t){return(new ut).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(ut,e,t)}}ut.runtime=Ie,ut.typeName="livekit.SpeakerInfo",ut.fields=Ie.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]));class dt extends P{constructor(e){super(),this.participantSid="",this.participantIdentity="",this.payload=new Uint8Array(0),this.destinationSids=[],this.destinationIdentities=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new dt).fromBinary(e,t)}static fromJson(e,t){return(new dt).fromJson(e,t)}static fromJsonString(e,t){return(new dt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(dt,e,t)}}dt.runtime=Ie,dt.typeName="livekit.UserPacket",dt.fields=Ie.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0}]));class ht extends P{constructor(e){super(),this.participantSid="",this.trackSids=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new ht).fromBinary(e,t)}static fromJson(e,t){return(new ht).fromJson(e,t)}static fromJsonString(e,t){return(new ht).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(ht,e,t)}}ht.runtime=Ie,ht.typeName="livekit.ParticipantTracks",ht.fields=Ie.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]));class pt extends P{constructor(e){super(),this.edition=nt.Standard,this.version="",this.protocol=0,this.region="",this.nodeId="",this.debugInfo="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new pt).fromBinary(e,t)}static fromJson(e,t){return(new pt).fromJson(e,t)}static fromJsonString(e,t){return(new pt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(pt,e,t)}}pt.runtime=Ie,pt.typeName="livekit.ServerInfo",pt.fields=Ie.util.newFieldList((()=>[{no:1,name:"edition",kind:"enum",T:Ie.getEnumType(nt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9}])),function(e){e[e.Standard=0]="Standard",e[e.Cloud=1]="Cloud"}(nt||(nt={})),Ie.util.setEnumType(nt,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);class mt extends P{constructor(e){super(),this.sdk=it.UNKNOWN,this.version="",this.protocol=0,this.os="",this.osVersion="",this.deviceModel="",this.browser="",this.browserVersion="",this.address="",this.network="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new mt).fromBinary(e,t)}static fromJson(e,t){return(new mt).fromJson(e,t)}static fromJsonString(e,t){return(new mt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(mt,e,t)}}mt.runtime=Ie,mt.typeName="livekit.ClientInfo",mt.fields=Ie.util.newFieldList((()=>[{no:1,name:"sdk",kind:"enum",T:Ie.getEnumType(it)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}])),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JS=1]="JS",e[e.SWIFT=2]="SWIFT",e[e.ANDROID=3]="ANDROID",e[e.FLUTTER=4]="FLUTTER",e[e.GO=5]="GO",e[e.UNITY=6]="UNITY",e[e.REACT_NATIVE=7]="REACT_NATIVE",e[e.RUST=8]="RUST",e[e.PYTHON=9]="PYTHON",e[e.CPP=10]="CPP"}(it||(it={})),Ie.util.setEnumType(it,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"}]);class ft extends P{constructor(e){super(),this.resumeConnection=Ve.UNSET,this.forceRelay=Ve.UNSET,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new ft).fromBinary(e,t)}static fromJson(e,t){return(new ft).fromJson(e,t)}static fromJsonString(e,t){return(new ft).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(ft,e,t)}}ft.runtime=Ie,ft.typeName="livekit.ClientConfiguration",ft.fields=Ie.util.newFieldList((()=>[{no:1,name:"video",kind:"message",T:gt},{no:2,name:"screen",kind:"message",T:gt},{no:3,name:"resume_connection",kind:"enum",T:Ie.getEnumType(Ve)},{no:4,name:"disabled_codecs",kind:"message",T:vt},{no:5,name:"force_relay",kind:"enum",T:Ie.getEnumType(Ve)}]));class gt extends P{constructor(e){super(),this.hardwareEncoder=Ve.UNSET,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new gt).fromBinary(e,t)}static fromJson(e,t){return(new gt).fromJson(e,t)}static fromJsonString(e,t){return(new gt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(gt,e,t)}}gt.runtime=Ie,gt.typeName="livekit.VideoConfiguration",gt.fields=Ie.util.newFieldList((()=>[{no:1,name:"hardware_encoder",kind:"enum",T:Ie.getEnumType(Ve)}]));class vt extends P{constructor(e){super(),this.codecs=[],this.publish=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new vt).fromBinary(e,t)}static fromJson(e,t){return(new vt).fromJson(e,t)}static fromJsonString(e,t){return(new vt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(vt,e,t)}}vt.runtime=Ie,vt.typeName="livekit.DisabledCodecs",vt.fields=Ie.util.newFieldList((()=>[{no:1,name:"codecs",kind:"message",T:Qe,repeated:!0},{no:2,name:"publish",kind:"message",T:Qe,repeated:!0}]));class yt extends P{constructor(e){super(),this.duration=0,this.startTimestamp=F.zero,this.endTimestamp=F.zero,this.rtpClockTicks=F.zero,this.driftSamples=F.zero,this.driftMs=0,this.clockRate=0,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new yt).fromBinary(e,t)}static fromJson(e,t){return(new yt).fromJson(e,t)}static fromJsonString(e,t){return(new yt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(yt,e,t)}}yt.runtime=Ie,yt.typeName="livekit.RTPDrift",yt.fields=Ie.util.newFieldList((()=>[{no:1,name:"start_time",kind:"message",T:He},{no:2,name:"end_time",kind:"message",T:He},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"start_timestamp",kind:"scalar",T:4},{no:5,name:"end_timestamp",kind:"scalar",T:4},{no:6,name:"rtp_clock_ticks",kind:"scalar",T:4},{no:7,name:"drift_samples",kind:"scalar",T:3},{no:8,name:"drift_ms",kind:"scalar",T:1},{no:9,name:"clock_rate",kind:"scalar",T:1}]));class bt extends P{constructor(e){super(),this.duration=0,this.packets=0,this.packetRate=0,this.bytes=F.zero,this.headerBytes=F.zero,this.bitrate=0,this.packetsLost=0,this.packetLossRate=0,this.packetLossPercentage=0,this.packetsDuplicate=0,this.packetDuplicateRate=0,this.bytesDuplicate=F.zero,this.headerBytesDuplicate=F.zero,this.bitrateDuplicate=0,this.packetsPadding=0,this.packetPaddingRate=0,this.bytesPadding=F.zero,this.headerBytesPadding=F.zero,this.bitratePadding=0,this.packetsOutOfOrder=0,this.frames=0,this.frameRate=0,this.jitterCurrent=0,this.jitterMax=0,this.gapHistogram={},this.nacks=0,this.nackAcks=0,this.nackMisses=0,this.nackRepeated=0,this.plis=0,this.firs=0,this.rttCurrent=0,this.rttMax=0,this.keyFrames=0,this.layerLockPlis=0,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new bt).fromBinary(e,t)}static fromJson(e,t){return(new bt).fromJson(e,t)}static fromJsonString(e,t){return(new bt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(bt,e,t)}}bt.runtime=Ie,bt.typeName="livekit.RTPStats",bt.fields=Ie.util.newFieldList((()=>[{no:1,name:"start_time",kind:"message",T:He},{no:2,name:"end_time",kind:"message",T:He},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:He},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:He},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:He},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:He},{no:44,name:"packet_drift",kind:"message",T:yt},{no:45,name:"report_drift",kind:"message",T:yt}]));class kt extends P{constructor(e){super(),this.unixMicro=F.zero,this.ticks=0,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new kt).fromBinary(e,t)}static fromJson(e,t){return(new kt).fromJson(e,t)}static fromJsonString(e,t){return(new kt).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(kt,e,t)}}kt.runtime=Ie,kt.typeName="livekit.TimedVersion",kt.fields=Ie.util.newFieldList((()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]));const St=7e3,Ct=[0,300,1200,2700,4800,St,St,St,St,St];class Tt{constructor(e){this._retryDelays=void 0!==e?[...e]:Ct}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}}function wt(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function Et(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pt(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Et(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){!function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)}(i,r,(t=e[n](t)).done,t.value)}))}}}"function"==typeof SuppressedError&&SuppressedError;var Rt,xt={exports:{}},Ot="object"==typeof Reflect?Reflect:null,It=Ot&&"function"==typeof Ot.apply?Ot.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};Rt=Ot&&"function"==typeof Ot.ownKeys?Ot.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var Nt=Number.isNaN||function(e){return e!=e};function _t(){_t.init.call(this)}xt.exports=_t,xt.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,s),i(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}Vt(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&Vt(e,"error",t,n)}(e,r,{once:!0})}))},_t.EventEmitter=_t,_t.prototype._events=void 0,_t.prototype._eventsCount=0,_t.prototype._maxListeners=void 0;var Dt=10;function Mt(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function Lt(e){return void 0===e._maxListeners?_t.defaultMaxListeners:e._maxListeners}function At(e,t,n,i){var r,s,o,a;if(Mt(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=Lt(e))>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function Ut(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function jt(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=Ut.bind(i);return r.listener=n,i.wrapFn=r,r}function Ft(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):Jt(r,r.length)}function Bt(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function Jt(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function Vt(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){i.once&&e.removeEventListener(t,r),n(s)}))}}Object.defineProperty(_t,"defaultMaxListeners",{enumerable:!0,get:function(){return Dt},set:function(e){if("number"!=typeof e||e<0||Nt(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Dt=e}}),_t.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},_t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||Nt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},_t.prototype.getMaxListeners=function(){return Lt(this)},_t.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=r[e];if(void 0===a)return!1;if("function"==typeof a)It(a,this,t);else{var c=a.length,l=Jt(a,c);for(n=0;n<c;++n)It(l[n],this,t)}return!0},_t.prototype.addListener=function(e,t){return At(this,e,t,!1)},_t.prototype.on=_t.prototype.addListener,_t.prototype.prependListener=function(e,t){return At(this,e,t,!0)},_t.prototype.once=function(e,t){return Mt(t),this.on(e,jt(this,e,t)),this},_t.prototype.prependOnceListener=function(e,t){return Mt(t),this.prependListener(e,jt(this,e,t)),this},_t.prototype.removeListener=function(e,t){var n,i,r,s,o;if(Mt(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},_t.prototype.off=_t.prototype.removeListener,_t.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},_t.prototype.listeners=function(e){return Ft(this,e,!0)},_t.prototype.rawListeners=function(e){return Ft(this,e,!1)},_t.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Bt.call(e,t)},_t.prototype.listenerCount=Bt,_t.prototype.eventNames=function(){return this._eventsCount>0?Rt(this._events):[]};var qt=xt.exports;let zt=!0,Wt=!0;function Kt(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function Ht(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const s=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,s),r.apply(this,[e,s])};const s=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(n))return s.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Gt(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(zt=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Qt(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Wt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Yt(){if("object"==typeof window){if(zt)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function $t(e,t){Wt&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Xt(e){return"[object Object]"===Object.prototype.toString.call(e)}function Zt(e){return Xt(e)?Object.keys(e).reduce((function(t,n){const i=Xt(e[n]),r=i?Zt(e[n]):e[n],s=i&&!Object.keys(r).length;return void 0===r||s?t:Object.assign(t,{[n]:r})}),{}):e}function en(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?en(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{en(e,e.get(t),n)}))})))}function tn(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&en(e,n,r)}))})),r}const nn=Yt;function rn(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const o=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let o=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!o&&n.length&&t.includes("back")&&(o=n[n.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=i(e.video),nn("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return nn("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(s(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function sn(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function on(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ht(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function an(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function cn(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){n(s(r(e)))};return t.apply(this,[i,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(s(r(t)))},n])})).then(n,i)}}function ln(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>tn(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Ht(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>tn(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function un(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function dn(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return un(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=s(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function hn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function pn(e,t){Ht(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var mn=Object.freeze({__proto__:null,fixNegotiationNeeded:pn,shimAddTrackRemoveTrack:dn,shimAddTrackRemoveTrackWithNative:un,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:an,shimGetStats:cn,shimGetUserMedia:rn,shimMediaStream:sn,shimOnTrack:on,shimPeerConnection:hn,shimSenderReceiverGetStats:ln});function fn(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){$t("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function gn(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function vn(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,s]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,s)}}function yn(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function bn(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Ht(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function kn(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){$t("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function Sn(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Cn(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function Tn(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function wn(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function En(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Pn=Object.freeze({__proto__:null,shimAddTransceiver:Cn,shimCreateAnswer:En,shimCreateOffer:wn,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Tn,shimGetUserMedia:fn,shimOnTrack:gn,shimPeerConnection:vn,shimRTCDataChannel:Sn,shimReceiverGetStats:bn,shimRemoveStream:kn,shimSenderGetStats:yn});function Rn(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function xn(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function On(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let a=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=a,a=function(e,t,n){const i=s.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=a,a=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=a}function In(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Nn(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Nn(e){return e&&void 0!==e.video?Object.assign({},e,{video:Zt(e.video)}):e}function _n(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?($t("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Dn(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Mn(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Ln(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var An=Object.freeze({__proto__:null,shimAudioContext:Ln,shimCallbacksAPI:On,shimConstraints:Nn,shimCreateOfferLegacy:Mn,shimGetUserMedia:In,shimLocalStreamsAPI:Rn,shimRTCIceServerUrls:_n,shimRemoteStreamsAPI:xn,shimTrackEventTransceiver:Dn}),Un={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<i.length;r++)n=i[r].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let s=3;s<i.length;s++){const r=i[s],o=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){const i=t.parseRtpMap(o),s=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=s.length?t.parseFmtp(s[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{r.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=o.length>0&&o[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(c=l[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const s=t.matchPrefix(e,"a=rtcp-mux");return n.mux=s.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const s=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Un);var jn=Un.exports,Fn=r(jn),Bn=t({__proto__:null,default:Fn},[jn]);function Jn(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=Fn.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Ht(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Vn(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ht(e,"icecandidate",(e=>{if(e.candidate){const t=Fn.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function qn(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Fn.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Fn.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=Fn.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>r}),this._sctp=s}return n.apply(this,arguments)}}function zn(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Ht(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Wn(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Kn(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Hn(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Gn(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var Qn=Object.freeze({__proto__:null,removeExtmapAllowMixed:Kn,shimAddIceCandidateNullOrEmpty:Hn,shimConnectionState:Wn,shimMaxMessageSize:qn,shimParameterlessSetLocalDescription:Gn,shimRTCIceCandidate:Jn,shimRTCIceCandidateRelayProtocol:Vn,shimSendThrowTypeError:zn});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Yt,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Kt(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Kt(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Kt(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:i,commonShim:Qn,extractVersion:Kt,disableLog:Gt,disableWarnings:Qt,sdp:Bn};switch(i.browser){case"chrome":if(!mn||!hn||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=mn,Hn(e,i),Gn(e),rn(e,i),sn(e),hn(e,i),on(e),dn(e,i),an(e),cn(e),ln(e),pn(e,i),Jn(e),Vn(e),Wn(e),qn(e,i),zn(e),Kn(e,i);break;case"firefox":if(!Pn||!vn||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Pn,Hn(e,i),Gn(e),fn(e,i),vn(e,i),gn(e),kn(e),yn(e),bn(e),Sn(e),Cn(e),Tn(e),wn(e),En(e),Jn(e),Wn(e),qn(e,i),zn(e);break;case"safari":if(!An||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=An,Hn(e,i),Gn(e),_n(e),Mn(e),On(e),Rn(e),xn(e),Dn(e),In(e),Ln(e),Jn(e),Vn(e),qn(e,i),zn(e),Kn(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});const Yn="AES-GCM",$n="lk_e2ee",Xn={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:10};var Zn,ei,ti,ni,ii,ri,si;function oi(){return ci()||ai()}function ai(){return void 0!==window.RTCRtpScriptTransform}function ci(){return void 0!==window.RTCRtpSender&&void 0!==window.RTCRtpSender.prototype.createEncodedStreams}function li(e){return wt(this,void 0,void 0,(function*(){let t=new TextEncoder;return yield crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}))}function ui(e){return wt(this,void 0,void 0,(function*(){return yield crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"])}))}function di(e,t){const n=(new TextEncoder).encode(t);switch(e){case"HKDF":return{name:"HKDF",salt:n,hash:"SHA-256",info:new ArrayBuffer(128)};case"PBKDF2":return{name:"PBKDF2",salt:n,hash:"SHA-256",iterations:1e5};default:throw new Error("algorithm ".concat(e," is currently unsupported"))}}e.KeyProviderEvent=void 0,(Zn=e.KeyProviderEvent||(e.KeyProviderEvent={})).SetKey="setKey",Zn.RatchetRequest="ratchetRequest",Zn.KeyRatcheted="keyRatcheted",e.KeyHandlerEvent=void 0,(e.KeyHandlerEvent||(e.KeyHandlerEvent={})).KeyRatcheted="keyRatcheted",e.EncryptionEvent=void 0,(ei=e.EncryptionEvent||(e.EncryptionEvent={})).ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",ei.EncryptionError="encryptionError",e.CryptorEvent=void 0,(e.CryptorEvent||(e.CryptorEvent={})).Error="cryptorError";class hi extends qt.EventEmitter{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.onKeyRatcheted=(e,t)=>{l.debug("key ratcheted event received",{material:e,keyIndex:t})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Xn),t),this.on(e.KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,n,i){const r={key:t,participantIdentity:n,keyIndex:i};this.keyInfoMap.set("".concat(null!=n?n:"shared","-").concat(null!=i?i:0),r),this.emit(e.KeyProviderEvent.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,n){this.emit(e.KeyProviderEvent.RatchetRequest,t,n)}}class pi extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}class mi extends pi{constructor(e,t,n){super(1,e),this.status=n,this.reason=t}}class fi extends pi{constructor(e){super(21,null!=e?e:"device is unsupported")}}class gi extends pi{constructor(e){super(20,null!=e?e:"track is invalid")}}class vi extends pi{constructor(e){super(10,null!=e?e:"unsupported server")}}class yi extends pi{constructor(e){super(12,null!=e?e:"unexpected connection state")}}class bi extends pi{constructor(e){super(13,null!=e?e:"unable to negotiate")}}function ki(e,t,n){var i,r,s;void 0===t&&(t=50),void 0===n&&(n={});var o=null!=(i=n.isImmediate)&&i,a=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise((function(i,r){var c=o&&void 0===s;if(void 0!==s&&clearTimeout(s),s=setTimeout((function(){if(s=void 0,l=Date.now(),!o){var i=e.apply(n,t);a&&a(i),u.forEach((function(e){return(0,e.resolve)(i)})),u=[]}}),d()),c){var h=e.apply(n,t);return a&&a(h),i(h)}u.push({resolve:i,reject:r})}))};return h.cancel=function(e){void 0!==s&&clearTimeout(s),u.forEach((function(t){return(0,t.reject)(e)})),u=[]},h}e.MediaDeviceFailure=void 0,(ti=e.MediaDeviceFailure||(e.MediaDeviceFailure={})).PermissionDenied="PermissionDenied",ti.NotFound="NotFound",ti.DeviceInUse="DeviceInUse",ti.Other="Other",function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(e.MediaDeviceFailure||(e.MediaDeviceFailure={})),e.RoomEvent=void 0,(ni=e.RoomEvent||(e.RoomEvent={})).Connected="connected",ni.Reconnecting="reconnecting",ni.Reconnected="reconnected",ni.Disconnected="disconnected",ni.ConnectionStateChanged="connectionStateChanged",ni.StateChanged="connectionStateChanged",ni.MediaDevicesChanged="mediaDevicesChanged",ni.ParticipantConnected="participantConnected",ni.ParticipantDisconnected="participantDisconnected",ni.TrackPublished="trackPublished",ni.TrackSubscribed="trackSubscribed",ni.TrackSubscriptionFailed="trackSubscriptionFailed",ni.TrackUnpublished="trackUnpublished",ni.TrackUnsubscribed="trackUnsubscribed",ni.TrackMuted="trackMuted",ni.TrackUnmuted="trackUnmuted",ni.LocalTrackPublished="localTrackPublished",ni.LocalTrackUnpublished="localTrackUnpublished",ni.LocalAudioSilenceDetected="localAudioSilenceDetected",ni.ActiveSpeakersChanged="activeSpeakersChanged",ni.ParticipantMetadataChanged="participantMetadataChanged",ni.ParticipantNameChanged="participantNameChanged",ni.RoomMetadataChanged="roomMetadataChanged",ni.DataReceived="dataReceived",ni.ConnectionQualityChanged="connectionQualityChanged",ni.TrackStreamStateChanged="trackStreamStateChanged",ni.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",ni.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",ni.AudioPlaybackStatusChanged="audioPlaybackChanged",ni.VideoPlaybackStatusChanged="videoPlaybackChanged",ni.MediaDevicesError="mediaDevicesError",ni.ParticipantPermissionsChanged="participantPermissionsChanged",ni.SignalConnected="signalConnected",ni.RecordingStatusChanged="recordingStatusChanged",ni.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",ni.EncryptionError="encryptionError",ni.DCBufferStatusChanged="dcBufferStatusChanged",ni.ActiveDeviceChanged="activeDeviceChanged",e.ParticipantEvent=void 0,(ii=e.ParticipantEvent||(e.ParticipantEvent={})).TrackPublished="trackPublished",ii.TrackSubscribed="trackSubscribed",ii.TrackSubscriptionFailed="trackSubscriptionFailed",ii.TrackUnpublished="trackUnpublished",ii.TrackUnsubscribed="trackUnsubscribed",ii.TrackMuted="trackMuted",ii.TrackUnmuted="trackUnmuted",ii.LocalTrackPublished="localTrackPublished",ii.LocalTrackUnpublished="localTrackUnpublished",ii.ParticipantMetadataChanged="participantMetadataChanged",ii.ParticipantNameChanged="participantNameChanged",ii.DataReceived="dataReceived",ii.IsSpeakingChanged="isSpeakingChanged",ii.ConnectionQualityChanged="connectionQualityChanged",ii.TrackStreamStateChanged="trackStreamStateChanged",ii.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",ii.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",ii.MediaDevicesError="mediaDevicesError",ii.AudioStreamAcquired="audioStreamAcquired",ii.ParticipantPermissionsChanged="participantPermissionsChanged",ii.PCTrackAdded="pcTrackAdded",e.EngineEvent=void 0,(ri=e.EngineEvent||(e.EngineEvent={})).TransportsCreated="transportsCreated",ri.Connected="connected",ri.Disconnected="disconnected",ri.Resuming="resuming",ri.Resumed="resumed",ri.Restarting="restarting",ri.Restarted="restarted",ri.SignalResumed="signalResumed",ri.SignalRestarted="signalRestarted",ri.Closing="closing",ri.MediaTrackAdded="mediaTrackAdded",ri.ActiveSpeakersUpdate="activeSpeakersUpdate",ri.DataPacketReceived="dataPacketReceived",ri.RTPVideoMapUpdate="rtpVideoMapUpdate",ri.DCBufferStatusChanged="dcBufferStatusChanged",ri.ParticipantUpdate="participantUpdate",ri.RoomUpdate="roomUpdate",ri.SpeakersChanged="speakersChanged",ri.StreamStateChanged="streamStateChanged",ri.ConnectionQualityUpdate="connectionQualityUpdate",ri.SubscriptionError="subscriptionError",ri.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",ri.RemoteMute="remoteMute",ri.SubscribedQualityUpdate="subscribedQualityUpdate",ri.LocalTrackUnpublished="localTrackUnpublished",e.TrackEvent=void 0,(si=e.TrackEvent||(e.TrackEvent={})).Message="message",si.Muted="muted",si.Unmuted="unmuted",si.Restarted="restarted",si.Ended="ended",si.Subscribed="subscribed",si.Unsubscribed="unsubscribed",si.UpdateSettings="updateSettings",si.UpdateSubscription="updateSubscription",si.AudioPlaybackStarted="audioPlaybackStarted",si.AudioPlaybackFailed="audioPlaybackFailed",si.AudioSilenceDetected="audioSilenceDetected",si.VisibilityChanged="visibilityChanged",si.VideoDimensionsChanged="videoDimensionsChanged",si.VideoPlaybackStarted="videoPlaybackStarted",si.VideoPlaybackFailed="videoPlaybackFailed",si.ElementAttached="elementAttached",si.ElementDetached="elementDetached",si.UpstreamPaused="upstreamPaused",si.UpstreamResumed="upstreamResumed",si.SubscriptionPermissionChanged="subscriptionPermissionChanged",si.SubscriptionStatusChanged="subscriptionStatusChanged",si.SubscriptionFailed="subscriptionFailed";const Si=/version\/(\d+(\.?_?\d+)+)/i;let Ci;function Ti(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===e&&"undefined"==typeof navigator)return;const n=(null!=e?e:navigator.userAgent).toLowerCase();if(void 0===Ci||t){const e=wi.find((e=>{let{test:t}=e;return t.test(n)}));Ci=null==e?void 0:e.describe(n)}return Ci}const wi=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:Ei(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:Ei(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:Ei(Si,e),os:e.includes("mobile/")?"iOS":"macOS"})}];function Ei(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}const Pi="1.15.12";class Ri{}Ri.setTimeout=function(){return setTimeout(...arguments)},Ri.setInterval=function(){return setInterval(...arguments)},Ri.clearTimeout=function(){return clearTimeout(...arguments)},Ri.clearInterval=function(){return clearInterval(...arguments)};class xi{constructor(e,t,n,i,r){this.width=e,this.height=t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}const Oi=["vp8","h264"],Ii=["vp8","h264","vp9","av1"];function Ni(e){return!!Oi.find((t=>t===e))}var _i;e.AudioPresets=void 0,(_i=e.AudioPresets||(e.AudioPresets={})).telephone={maxBitrate:12e3},_i.speech={maxBitrate:2e4},_i.music={maxBitrate:32e3},_i.musicStereo={maxBitrate:48e3},_i.musicHighQuality={maxBitrate:64e3},_i.musicHighQualityStereo={maxBitrate:96e3};const Di={h90:new xi(160,90,9e4,20),h180:new xi(320,180,16e4,20),h216:new xi(384,216,18e4,20),h360:new xi(640,360,45e4,20),h540:new xi(960,540,8e5,25),h720:new xi(1280,720,17e5,30),h1080:new xi(1920,1080,3e6,30),h1440:new xi(2560,1440,5e6,30),h2160:new xi(3840,2160,8e6,30)},Mi={h120:new xi(160,120,7e4,20),h180:new xi(240,180,125e3,20),h240:new xi(320,240,14e4,20),h360:new xi(480,360,33e4,20),h480:new xi(640,480,5e5,20),h540:new xi(720,540,6e5,25),h720:new xi(960,720,13e5,30),h1080:new xi(1440,1080,23e5,30),h1440:new xi(1920,1440,38e5,30)},Li={h360fps3:new xi(640,360,2e5,3,"medium"),h360fps15:new xi(640,360,4e5,15,"medium"),h720fps5:new xi(1280,720,8e5,5,"medium"),h720fps15:new xi(1280,720,15e5,15,"medium"),h720fps30:new xi(1280,720,2e6,30,"medium"),h1080fps15:new xi(1920,1080,25e5,15,"medium"),h1080fps30:new xi(1920,1080,5e6,30,"medium"),original:new xi(0,0,7e6,30,"medium")};var Ai,Ui,ji;!function(e){e[e.PUBLISHER=0]="PUBLISHER",e[e.SUBSCRIBER=1]="SUBSCRIBER"}(Ai||(Ai={})),Ie.util.setEnumType(Ai,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),function(e){e[e.ACTIVE=0]="ACTIVE",e[e.PAUSED=1]="PAUSED"}(Ui||(Ui={})),Ie.util.setEnumType(Ui,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.TLS=2]="TLS"}(ji||(ji={})),Ie.util.setEnumType(ji,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]);class Fi extends P{constructor(e){super(),this.message={case:void 0},Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Fi).fromBinary(e,t)}static fromJson(e,t){return(new Fi).fromJson(e,t)}static fromJsonString(e,t){return(new Fi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Fi,e,t)}}Fi.runtime=Ie,Fi.typeName="livekit.SignalRequest",Fi.fields=Ie.util.newFieldList((()=>[{no:1,name:"offer",kind:"message",T:Qi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Qi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:qi,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Vi,oneof:"message"},{no:5,name:"mute",kind:"message",T:zi,oneof:"message"},{no:6,name:"subscription",kind:"message",T:$i,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Xi,oneof:"message"},{no:8,name:"leave",kind:"message",T:Zi,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:er,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:pr,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:fr,oneof:"message"},{no:13,name:"simulate",kind:"message",T:vr,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:tr,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:yr,oneof:"message"}]));class Bi extends P{constructor(e){super(),this.message={case:void 0},Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Bi).fromBinary(e,t)}static fromJson(e,t){return(new Bi).fromJson(e,t)}static fromJsonString(e,t){return(new Bi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Bi,e,t)}}Bi.runtime=Ie,Bi.typeName="livekit.SignalResponse",Bi.fields=Ie.util.newFieldList((()=>[{no:1,name:"join",kind:"message",T:Wi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Qi,oneof:"message"},{no:3,name:"offer",kind:"message",T:Qi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:qi,oneof:"message"},{no:5,name:"update",kind:"message",T:Yi,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Hi,oneof:"message"},{no:8,name:"leave",kind:"message",T:Zi,oneof:"message"},{no:9,name:"mute",kind:"message",T:zi,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:ir,oneof:"message"},{no:11,name:"room_update",kind:"message",T:rr,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:or,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:cr,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:dr,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:mr,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Gi,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Ki,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:br,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Cr,oneof:"message"}]));class Ji extends P{constructor(e){super(),this.codec="",this.cid="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Ji).fromBinary(e,t)}static fromJson(e,t){return(new Ji).fromJson(e,t)}static fromJsonString(e,t){return(new Ji).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Ji,e,t)}}Ji.runtime=Ie,Ji.typeName="livekit.SimulcastCodec",Ji.fields=Ie.util.newFieldList((()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]));class Vi extends P{constructor(e){super(),this.cid="",this.name="",this.type=je.AUDIO,this.width=0,this.height=0,this.muted=!1,this.disableDtx=!1,this.source=Fe.UNKNOWN,this.layers=[],this.simulcastCodecs=[],this.sid="",this.stereo=!1,this.disableRed=!1,this.encryption=et.NONE,this.stream="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Vi).fromBinary(e,t)}static fromJson(e,t){return(new Vi).fromJson(e,t)}static fromJsonString(e,t){return(new Vi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Vi,e,t)}}Vi.runtime=Ie,Vi.typeName="livekit.AddTrackRequest",Vi.fields=Ie.util.newFieldList((()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:Ie.getEnumType(je)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:Ie.getEnumType(Fe)},{no:9,name:"layers",kind:"message",T:at,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Ji,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:Ie.getEnumType(et)},{no:15,name:"stream",kind:"scalar",T:9}]));class qi extends P{constructor(e){super(),this.candidateInit="",this.target=Ai.PUBLISHER,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new qi).fromBinary(e,t)}static fromJson(e,t){return(new qi).fromJson(e,t)}static fromJsonString(e,t){return(new qi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(qi,e,t)}}qi.runtime=Ie,qi.typeName="livekit.TrickleRequest",qi.fields=Ie.util.newFieldList((()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:Ie.getEnumType(Ai)}]));class zi extends P{constructor(e){super(),this.sid="",this.muted=!1,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new zi).fromBinary(e,t)}static fromJson(e,t){return(new zi).fromJson(e,t)}static fromJsonString(e,t){return(new zi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(zi,e,t)}}zi.runtime=Ie,zi.typeName="livekit.MuteTrackRequest",zi.fields=Ie.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]));class Wi extends P{constructor(e){super(),this.otherParticipants=[],this.serverVersion="",this.iceServers=[],this.subscriberPrimary=!1,this.alternativeUrl="",this.serverRegion="",this.pingTimeout=0,this.pingInterval=0,this.sifTrailer=new Uint8Array(0),Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Wi).fromBinary(e,t)}static fromJson(e,t){return(new Wi).fromJson(e,t)}static fromJsonString(e,t){return(new Wi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Wi,e,t)}}Wi.runtime=Ie,Wi.typeName="livekit.JoinResponse",Wi.fields=Ie.util.newFieldList((()=>[{no:1,name:"room",kind:"message",T:Ge},{no:2,name:"participant",kind:"message",T:Xe},{no:3,name:"other_participants",kind:"message",T:Xe,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:nr,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ft},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:pt},{no:13,name:"sif_trailer",kind:"scalar",T:12}]));class Ki extends P{constructor(e){super(),this.iceServers=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Ki).fromBinary(e,t)}static fromJson(e,t){return(new Ki).fromJson(e,t)}static fromJsonString(e,t){return(new Ki).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Ki,e,t)}}Ki.runtime=Ie,Ki.typeName="livekit.ReconnectResponse",Ki.fields=Ie.util.newFieldList((()=>[{no:1,name:"ice_servers",kind:"message",T:nr,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ft}]));class Hi extends P{constructor(e){super(),this.cid="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Hi).fromBinary(e,t)}static fromJson(e,t){return(new Hi).fromJson(e,t)}static fromJsonString(e,t){return(new Hi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Hi,e,t)}}Hi.runtime=Ie,Hi.typeName="livekit.TrackPublishedResponse",Hi.fields=Ie.util.newFieldList((()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ot}]));class Gi extends P{constructor(e){super(),this.trackSid="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Gi).fromBinary(e,t)}static fromJson(e,t){return(new Gi).fromJson(e,t)}static fromJsonString(e,t){return(new Gi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Gi,e,t)}}Gi.runtime=Ie,Gi.typeName="livekit.TrackUnpublishedResponse",Gi.fields=Ie.util.newFieldList((()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]));class Qi extends P{constructor(e){super(),this.type="",this.sdp="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Qi).fromBinary(e,t)}static fromJson(e,t){return(new Qi).fromJson(e,t)}static fromJsonString(e,t){return(new Qi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Qi,e,t)}}Qi.runtime=Ie,Qi.typeName="livekit.SessionDescription",Qi.fields=Ie.util.newFieldList((()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]));class Yi extends P{constructor(e){super(),this.participants=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Yi).fromBinary(e,t)}static fromJson(e,t){return(new Yi).fromJson(e,t)}static fromJsonString(e,t){return(new Yi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Yi,e,t)}}Yi.runtime=Ie,Yi.typeName="livekit.ParticipantUpdate",Yi.fields=Ie.util.newFieldList((()=>[{no:1,name:"participants",kind:"message",T:Xe,repeated:!0}]));class $i extends P{constructor(e){super(),this.trackSids=[],this.subscribe=!1,this.participantTracks=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new $i).fromBinary(e,t)}static fromJson(e,t){return(new $i).fromJson(e,t)}static fromJsonString(e,t){return(new $i).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals($i,e,t)}}$i.runtime=Ie,$i.typeName="livekit.UpdateSubscription",$i.fields=Ie.util.newFieldList((()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ht,repeated:!0}]));class Xi extends P{constructor(t){super(),this.trackSids=[],this.disabled=!1,this.quality=e.VideoQuality.LOW,this.width=0,this.height=0,this.fps=0,this.priority=0,Ie.util.initPartial(t,this)}static fromBinary(e,t){return(new Xi).fromBinary(e,t)}static fromJson(e,t){return(new Xi).fromJson(e,t)}static fromJsonString(e,t){return(new Xi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Xi,e,t)}}Xi.runtime=Ie,Xi.typeName="livekit.UpdateTrackSettings",Xi.fields=Ie.util.newFieldList((()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:Ie.getEnumType(e.VideoQuality)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]));class Zi extends P{constructor(t){super(),this.canReconnect=!1,this.reason=e.DisconnectReason.UNKNOWN_REASON,Ie.util.initPartial(t,this)}static fromBinary(e,t){return(new Zi).fromBinary(e,t)}static fromJson(e,t){return(new Zi).fromJson(e,t)}static fromJsonString(e,t){return(new Zi).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Zi,e,t)}}Zi.runtime=Ie,Zi.typeName="livekit.LeaveRequest",Zi.fields=Ie.util.newFieldList((()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:Ie.getEnumType(e.DisconnectReason)}]));class er extends P{constructor(e){super(),this.trackSid="",this.layers=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new er).fromBinary(e,t)}static fromJson(e,t){return(new er).fromJson(e,t)}static fromJsonString(e,t){return(new er).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(er,e,t)}}er.runtime=Ie,er.typeName="livekit.UpdateVideoLayers",er.fields=Ie.util.newFieldList((()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:at,repeated:!0}]));class tr extends P{constructor(e){super(),this.metadata="",this.name="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new tr).fromBinary(e,t)}static fromJson(e,t){return(new tr).fromJson(e,t)}static fromJsonString(e,t){return(new tr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(tr,e,t)}}tr.runtime=Ie,tr.typeName="livekit.UpdateParticipantMetadata",tr.fields=Ie.util.newFieldList((()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}]));class nr extends P{constructor(e){super(),this.urls=[],this.username="",this.credential="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new nr).fromBinary(e,t)}static fromJson(e,t){return(new nr).fromJson(e,t)}static fromJsonString(e,t){return(new nr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(nr,e,t)}}nr.runtime=Ie,nr.typeName="livekit.ICEServer",nr.fields=Ie.util.newFieldList((()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]));class ir extends P{constructor(e){super(),this.speakers=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new ir).fromBinary(e,t)}static fromJson(e,t){return(new ir).fromJson(e,t)}static fromJsonString(e,t){return(new ir).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(ir,e,t)}}ir.runtime=Ie,ir.typeName="livekit.SpeakersChanged",ir.fields=Ie.util.newFieldList((()=>[{no:1,name:"speakers",kind:"message",T:ut,repeated:!0}]));class rr extends P{constructor(e){super(),Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new rr).fromBinary(e,t)}static fromJson(e,t){return(new rr).fromJson(e,t)}static fromJsonString(e,t){return(new rr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(rr,e,t)}}rr.runtime=Ie,rr.typeName="livekit.RoomUpdate",rr.fields=Ie.util.newFieldList((()=>[{no:1,name:"room",kind:"message",T:Ge}]));class sr extends P{constructor(e){super(),this.participantSid="",this.quality=Je.POOR,this.score=0,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new sr).fromBinary(e,t)}static fromJson(e,t){return(new sr).fromJson(e,t)}static fromJsonString(e,t){return(new sr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(sr,e,t)}}sr.runtime=Ie,sr.typeName="livekit.ConnectionQualityInfo",sr.fields=Ie.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:Ie.getEnumType(Je)},{no:3,name:"score",kind:"scalar",T:2}]));class or extends P{constructor(e){super(),this.updates=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new or).fromBinary(e,t)}static fromJson(e,t){return(new or).fromJson(e,t)}static fromJsonString(e,t){return(new or).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(or,e,t)}}or.runtime=Ie,or.typeName="livekit.ConnectionQualityUpdate",or.fields=Ie.util.newFieldList((()=>[{no:1,name:"updates",kind:"message",T:sr,repeated:!0}]));class ar extends P{constructor(e){super(),this.participantSid="",this.trackSid="",this.state=Ui.ACTIVE,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new ar).fromBinary(e,t)}static fromJson(e,t){return(new ar).fromJson(e,t)}static fromJsonString(e,t){return(new ar).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(ar,e,t)}}ar.runtime=Ie,ar.typeName="livekit.StreamStateInfo",ar.fields=Ie.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Ie.getEnumType(Ui)}]));class cr extends P{constructor(e){super(),this.streamStates=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new cr).fromBinary(e,t)}static fromJson(e,t){return(new cr).fromJson(e,t)}static fromJsonString(e,t){return(new cr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(cr,e,t)}}cr.runtime=Ie,cr.typeName="livekit.StreamStateUpdate",cr.fields=Ie.util.newFieldList((()=>[{no:1,name:"stream_states",kind:"message",T:ar,repeated:!0}]));class lr extends P{constructor(t){super(),this.quality=e.VideoQuality.LOW,this.enabled=!1,Ie.util.initPartial(t,this)}static fromBinary(e,t){return(new lr).fromBinary(e,t)}static fromJson(e,t){return(new lr).fromJson(e,t)}static fromJsonString(e,t){return(new lr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(lr,e,t)}}lr.runtime=Ie,lr.typeName="livekit.SubscribedQuality",lr.fields=Ie.util.newFieldList((()=>[{no:1,name:"quality",kind:"enum",T:Ie.getEnumType(e.VideoQuality)},{no:2,name:"enabled",kind:"scalar",T:8}]));class ur extends P{constructor(e){super(),this.codec="",this.qualities=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new ur).fromBinary(e,t)}static fromJson(e,t){return(new ur).fromJson(e,t)}static fromJsonString(e,t){return(new ur).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(ur,e,t)}}ur.runtime=Ie,ur.typeName="livekit.SubscribedCodec",ur.fields=Ie.util.newFieldList((()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:lr,repeated:!0}]));class dr extends P{constructor(e){super(),this.trackSid="",this.subscribedQualities=[],this.subscribedCodecs=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new dr).fromBinary(e,t)}static fromJson(e,t){return(new dr).fromJson(e,t)}static fromJsonString(e,t){return(new dr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(dr,e,t)}}dr.runtime=Ie,dr.typeName="livekit.SubscribedQualityUpdate",dr.fields=Ie.util.newFieldList((()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:lr,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:ur,repeated:!0}]));class hr extends P{constructor(e){super(),this.participantSid="",this.allTracks=!1,this.trackSids=[],this.participantIdentity="",Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new hr).fromBinary(e,t)}static fromJson(e,t){return(new hr).fromJson(e,t)}static fromJsonString(e,t){return(new hr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(hr,e,t)}}hr.runtime=Ie,hr.typeName="livekit.TrackPermission",hr.fields=Ie.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]));class pr extends P{constructor(e){super(),this.allParticipants=!1,this.trackPermissions=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new pr).fromBinary(e,t)}static fromJson(e,t){return(new pr).fromJson(e,t)}static fromJsonString(e,t){return(new pr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(pr,e,t)}}pr.runtime=Ie,pr.typeName="livekit.SubscriptionPermission",pr.fields=Ie.util.newFieldList((()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:hr,repeated:!0}]));class mr extends P{constructor(e){super(),this.participantSid="",this.trackSid="",this.allowed=!1,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new mr).fromBinary(e,t)}static fromJson(e,t){return(new mr).fromJson(e,t)}static fromJsonString(e,t){return(new mr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(mr,e,t)}}mr.runtime=Ie,mr.typeName="livekit.SubscriptionPermissionUpdate",mr.fields=Ie.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]));class fr extends P{constructor(e){super(),this.publishTracks=[],this.dataChannels=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new fr).fromBinary(e,t)}static fromJson(e,t){return(new fr).fromJson(e,t)}static fromJsonString(e,t){return(new fr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(fr,e,t)}}fr.runtime=Ie,fr.typeName="livekit.SyncState",fr.fields=Ie.util.newFieldList((()=>[{no:1,name:"answer",kind:"message",T:Qi},{no:2,name:"subscription",kind:"message",T:$i},{no:3,name:"publish_tracks",kind:"message",T:Hi,repeated:!0},{no:4,name:"data_channels",kind:"message",T:gr,repeated:!0},{no:5,name:"offer",kind:"message",T:Qi}]));class gr extends P{constructor(e){super(),this.label="",this.id=0,this.target=Ai.PUBLISHER,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new gr).fromBinary(e,t)}static fromJson(e,t){return(new gr).fromJson(e,t)}static fromJsonString(e,t){return(new gr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(gr,e,t)}}gr.runtime=Ie,gr.typeName="livekit.DataChannelInfo",gr.fields=Ie.util.newFieldList((()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:Ie.getEnumType(Ai)}]));class vr extends P{constructor(e){super(),this.scenario={case:void 0},Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new vr).fromBinary(e,t)}static fromJson(e,t){return(new vr).fromJson(e,t)}static fromJsonString(e,t){return(new vr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(vr,e,t)}}vr.runtime=Ie,vr.typeName="livekit.SimulateScenario",vr.fields=Ie.util.newFieldList((()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:Ie.getEnumType(ji),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"}]));class yr extends P{constructor(e){super(),this.timestamp=F.zero,this.rtt=F.zero,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new yr).fromBinary(e,t)}static fromJson(e,t){return(new yr).fromJson(e,t)}static fromJsonString(e,t){return(new yr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(yr,e,t)}}yr.runtime=Ie,yr.typeName="livekit.Ping",yr.fields=Ie.util.newFieldList((()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]));class br extends P{constructor(e){super(),this.lastPingTimestamp=F.zero,this.timestamp=F.zero,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new br).fromBinary(e,t)}static fromJson(e,t){return(new br).fromJson(e,t)}static fromJsonString(e,t){return(new br).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(br,e,t)}}br.runtime=Ie,br.typeName="livekit.Pong",br.fields=Ie.util.newFieldList((()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]));class kr extends P{constructor(e){super(),this.regions=[],Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new kr).fromBinary(e,t)}static fromJson(e,t){return(new kr).fromJson(e,t)}static fromJsonString(e,t){return(new kr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(kr,e,t)}}kr.runtime=Ie,kr.typeName="livekit.RegionSettings",kr.fields=Ie.util.newFieldList((()=>[{no:1,name:"regions",kind:"message",T:Sr,repeated:!0}]));class Sr extends P{constructor(e){super(),this.region="",this.url="",this.distance=F.zero,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Sr).fromBinary(e,t)}static fromJson(e,t){return(new Sr).fromJson(e,t)}static fromJsonString(e,t){return(new Sr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Sr,e,t)}}Sr.runtime=Ie,Sr.typeName="livekit.RegionInfo",Sr.fields=Ie.util.newFieldList((()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]));class Cr extends P{constructor(e){super(),this.trackSid="",this.err=We.SE_UNKNOWN,Ie.util.initPartial(e,this)}static fromBinary(e,t){return(new Cr).fromBinary(e,t)}static fromJson(e,t){return(new Cr).fromJson(e,t)}static fromJsonString(e,t){return(new Cr).fromJsonString(e,t)}static equals(e,t){return Ie.util.equals(Cr,e,t)}}Cr.runtime=Ie,Cr.typeName="livekit.SubscriptionResponse",Cr.fields=Ie.util.newFieldList((()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:Ie.getEnumType(We)}]));const Tr=[];class wr extends qt.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=wr.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=l,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout((()=>this.handleAppVisibilityChanged()),5e3):this.handleAppVisibilityChanged()},this.log=u(null!==(i=n.loggerName)&&void 0!==i?i:a.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=wr.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Mr(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===wr.Kind.Video&&(n="video"),0===this.attachedElements.length&&wr.Kind.Video&&this.addAppVisibilityListener(),t||("audio"===n&&(Tr.forEach((e=>{null!==e.parentElement||t||(t=e)})),t&&Tr.splice(Tr.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),Er(this.mediaStreamTrack,t);const i=t.srcObject.getTracks(),r=i.some((e=>"audio"===e.kind));return t.play().then((()=>{this.emit(r?e.TrackEvent.AudioPlaybackStarted:e.TrackEvent.VideoPlaybackStarted)})).catch((n=>{"NotAllowedError"===n.name?this.emit(r?e.TrackEvent.AudioPlaybackFailed:e.TrackEvent.VideoPlaybackFailed,n):"AbortError"===n.name?l.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):l.warn("could not playback ".concat(r?"audio":"video"),n),r&&t&&i.some((e=>"video"===e.kind))&&"NotAllowedError"===n.name&&(t.muted=!0,t.play().catch((()=>{})))})),this.emit(e.TrackEvent.ElementAttached,t),t}detach(t){try{if(t){Pr(this.mediaStreamTrack,t);const n=this.attachedElements.indexOf(t);return n>=0&&(this.attachedElements.splice(n,1),this.recycleElement(t),this.emit(e.TrackEvent.ElementDetached,t)),t}const n=[];return this.attachedElements.forEach((t=>{Pr(this.mediaStreamTrack,t),n.push(t),this.recycleElement(t),this.emit(e.TrackEvent.ElementDetached,t)})),this.attachedElements=[],n}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval)}updateLoggerOptions(e){e.loggerName&&(this.log=u(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Tr.forEach((e=>{e.parentElement||(t=!1)})),t&&Tr.push(e)}}handleAppVisibilityChanged(){return wt(this,void 0,void 0,(function*(){this.isInBackground="hidden"===document.visibilityState}))}addAppVisibilityListener(){Gr()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Gr()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Er(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach((e=>{n.removeTrack(e)})),n.addTrack(e)),Wr()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(Wr()||zr())&&t instanceof HTMLVideoElement&&setTimeout((()=>{t.srcObject=n,t.play().catch((()=>{}))}),0))}function Pr(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}function Rr(e,t,n){var i;const r=null!==(i=function(e){if(void 0!==e)return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(e))&&void 0!==i?i:{};return!0===r.audio&&(r.audio={}),!0===r.video&&(r.video={}),r.audio&&xr(r.audio,t),r.video&&xr(r.video,n),r}function xr(e,t){return Object.keys(t).forEach((n=>{void 0===e[n]&&(e[n]=t[n])})),e}function Or(e){const t={};if(e.video)if("object"==typeof e.video){const n={},i=n,r=e.video;Object.keys(r).forEach((e=>{"resolution"===e?xr(i,r.resolution):i[e]=r[e]})),t.video=n}else t.video=e.video;else t.video=!1;return e.audio?"object"==typeof e.audio?t.audio=e.audio:t.audio=!0:t.audio=!1,t}function Ir(){const e="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);if(e)return new e({latencyHint:"interactive"})}function Nr(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"==typeof i?{}:i,i=Wr()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio}}function _r(e){const t=e.split("/")[1].toLowerCase();if(!Ii.includes(t))throw Error("Video codec not supported: ".concat(t));return t}function Dr(e){const t=[];return e.forEach((e=>{void 0!==e.track&&t.push(new Hi({cid:e.track.mediaStreamID,track:e.trackInfo}))})),t}function Mr(e){return e instanceof wr?{trackSid:e.sid,trackSource:e.source,trackMuted:e.isMuted,trackEnabled:e.mediaStreamTrack.enabled,trackKind:e.kind}:{trackSid:e.trackSid,trackName:e.trackName,track:e.track?Mr(e.track):void 0,trackEnabled:e.isEnabled,trackEncrypted:e.isEncrypted,trackMimeType:e.mimeType}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return je.AUDIO;case t.Video:return je.VIDEO;default:return je.DATA}},e.kindFromProto=function(e){switch(e){case je.AUDIO:return t.Audio;case je.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return Fe.CAMERA;case n.Microphone:return Fe.MICROPHONE;case n.ScreenShare:return Fe.SCREEN_SHARE;case n.ScreenShareAudio:return Fe.SCREEN_SHARE_AUDIO;default:return Fe.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case Fe.CAMERA:return n.Camera;case Fe.MICROPHONE:return n.Microphone;case Fe.SCREEN_SHARE:return n.ScreenShare;case Fe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case Ui.ACTIVE:return i.Active;case Ui.PAUSED:return i.Paused;default:return i.Unknown}}}(wr||(wr={}));const Lr="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Ar(e){return wt(this,void 0,void 0,(function*(){return new Promise((t=>Ri.setTimeout(t,e)))}))}function Ur(){return"addTransceiver"in RTCPeerConnection.prototype}function jr(){return"addTrack"in RTCPeerConnection.prototype}function Fr(){if(!("getCapabilities"in RTCRtpSender))return!1;if(Wr())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}function Br(){if(!("getCapabilities"in RTCRtpSender))return!1;if(zr())return!1;if(Wr()){const e=Ti();if((null==e?void 0:e.version)&&es(e.version,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}function Jr(e){return"av1"===e||"vp9"===e}function Vr(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}const qr={Chrome:"100",Safari:"15",Firefox:"100"};function zr(){var e;return"Firefox"===(null===(e=Ti())||void 0===e?void 0:e.name)}function Wr(){var e;return"Safari"===(null===(e=Ti())||void 0===e?void 0:e.name)}function Kr(){const e=Ti();return"Safari"===(null==e?void 0:e.name)&&e.version.startsWith("17.")}function Hr(){return!!Gr()&&/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent)}function Gr(){return"undefined"!=typeof document}function Qr(){return"ReactNative"==navigator.product}function Yr(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function $r(){if(n.g&&n.g.LiveKitReactNativeGlobal)return n.g.LiveKitReactNativeGlobal}function Xr(){if(!Qr())return;let e=$r();return e?e.platform:void 0}function Zr(){if(Gr())return window.devicePixelRatio;if(Qr()){let e=$r();if(e)return e.devicePixelRatio}return 1}function es(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const e=parseInt(n[s],10),t=parseInt(i[s],10);if(e>t)return 1;if(e<t)return-1;if(s===r-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function ts(e){for(const t of e)t.target.handleResize(t)}function ns(e){for(const t of e)t.target.handleVisibilityChanged(t)}let is=null;const rs=()=>(is||(is=new ResizeObserver(ts)),is);let ss=null;const os=()=>(ss||(ss=new IntersectionObserver(ns,{root:null,rootMargin:"0px"})),ss);let as,cs;function ls(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const s=r.getContext("2d");null==s||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(e/2,t/2,50,0,2*Math.PI,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}function us(){if(!cs){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[cs]=i.stream.getAudioTracks(),!cs)throw Error("Could not get empty media stream audio track");cs.enabled=!1}return cs.clone()}class ds{constructor(e,t){this.onFinally=t,this.promise=new Promise(((t,n)=>wt(this,void 0,void 0,(function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})))).finally((()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)}))}}class hs{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise((t=>e=()=>{this._locks-=1,t()})),n=this._locking.then((()=>e));return this._locking=this._locking.then((()=>t)),n}}function ps(e){if("string"==typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function ms(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}const fs="default";class gs{static getInstance(){return void 0===this.instance&&(this.instance=new gs),this.instance}getDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var n;return wt(this,void 0,void 0,(function*(){if((null===(n=gs.userMediaPromiseMap)||void 0===n?void 0:n.size)>0){l.debug("awaiting getUserMedia promise");try{e?yield gs.userMediaPromiseMap.get(e):yield Promise.all(gs.userMediaPromiseMap.values())}catch(e){l.warn("error waiting for media permissons")}}let i=yield navigator.mediaDevices.enumerateDevices();if(t&&(!Wr()||!this.hasDeviceInUse(e))&&(0===i.length||i.some((t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i})))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e},n=yield navigator.mediaDevices.getUserMedia(t);i=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach((e=>{e.stop()}))}return e&&(i=i.filter((t=>t.kind===e))),i}))}normalizeDeviceId(e,t,n){return wt(this,void 0,void 0,(function*(){if(t!==fs)return t;const i=(yield this.getDevices(e)).find((e=>e.groupId===n&&e.deviceId!==fs));return null==i?void 0:i.deviceId}))}hasDeviceInUse(e){return e?gs.userMediaPromiseMap.has(e):gs.userMediaPromiseMap.size>0}}gs.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],gs.userMediaPromiseMap=new Map;class vs extends wr{get constraints(){return this._constraints}constructor(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(t,n,arguments.length>4?arguments[4]:void 0),this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch((()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext))),this.debouncedTrackMuteHandler=ki((()=>wt(this,void 0,void 0,(function*(){yield this.pauseUpstream()}))),5e3),this.handleTrackUnmuteEvent=()=>wt(this,void 0,void 0,(function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()})),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(e.TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new hs,this.pauseUpstreamLock=new hs,this.processorLock=new hs,this.setMediaStreamTrack(t,!0),this._constraints=t.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==wr.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}setMediaStreamTrack(e,t){return wt(this,void 0,void 0,(function*(){if(e===this._mediaStreamTrack&&!t)return;let n;if(this._mediaStreamTrack&&(this.attachedElements.forEach((e=>{Pr(this._mediaStreamTrack,e)})),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e&&this.processorElement){if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");Er(e,this.processorElement),this.processorElement.muted=!0,yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),n=this.processor.processedTrack}this.sender&&(yield this.sender.replaceTrack(null!=n?n:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach((t=>{Er(null!=n?n:e,t)})))}))}waitForDimensions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;var t;return wt(this,void 0,void 0,(function*(){if(this.kind===wr.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(t=Ti())||void 0===t?void 0:t.os)&&(yield Ar(10));const n=Date.now();for(;Date.now()-n<e;){const e=this.dimensions;if(e)return e;yield Ar(50)}throw new gi("unable to get track dimensions after timeout")}))}getDeviceId(){return wt(this,void 0,void 0,(function*(){if(this.source===wr.Source.ScreenShare)return;const{deviceId:e,groupId:t}=this._mediaStreamTrack.getSettings(),n=this.kind===wr.Kind.Audio?"audioinput":"videoinput";return gs.getInstance().normalizeDeviceId(n,e,t)}))}mute(){return wt(this,void 0,void 0,(function*(){return this.setTrackMuted(!0),this}))}unmute(){return wt(this,void 0,void 0,(function*(){return this.setTrackMuted(!1),this}))}replaceTrack(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return wt(this,void 0,void 0,(function*(){if(!this.sender)throw new gi("unable to replace an unpublished track");return this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),this.providedByUser=t,this.processor&&(yield this.stopProcessor()),this}))}restart(t){return wt(this,void 0,void 0,(function*(){t||(t=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const n={audio:!1,video:!1};this.kind===wr.Kind.Video?n.video=t:n.audio=t,this.attachedElements.forEach((e=>{Pr(this.mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const i=(yield navigator.mediaDevices.getUserMedia(n)).getTracks()[0];return i.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(i),this._constraints=t,this.emit(e.TrackEvent.Restarted,this),this}))}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),this.isMuted===t&&this._mediaStreamTrack.enabled!==t||(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return wt(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),Hr()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))}))}stop(){var e;super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return wt(this,void 0,void 0,(function*(){const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(e.TrackEvent.UpstreamPaused,this);const t=Ti();if("Safari"===(null==t?void 0:t.name)&&es(t.version,"12.0")<0)throw new fi("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{t()}}))}resumeUpstream(){return wt(this,void 0,void 0,(function*(){const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(e.TrackEvent.UpstreamResumed,this),yield this.sender.replaceTrack(this._mediaStreamTrack)}finally{t()}}))}getRTCStatsReport(){var e;return wt(this,void 0,void 0,(function*(){if(null===(e=this.sender)||void 0===e?void 0:e.getStats)return yield this.sender.getStats()}))}setProcessor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var n,i;return wt(this,void 0,void 0,(function*(){const r=yield this.processorLock.lock();try{if(this.log.debug("setting up processor",this.logContext),this.processor&&(yield this.stopProcessor()),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement=null!==(n=this.processorElement)&&void 0!==n?n:document.createElement(this.kind),Er(this._mediaStreamTrack,this.processorElement),this.processorElement.muted=!0,this.processorElement.play().catch((e=>this.log.error("failed to play processor element",Object.assign(Object.assign({},this.logContext),{error:e}))));const r={kind:this.kind,track:this._mediaStreamTrack,element:this.processorElement};if(yield e.init(r),this.processor=e,this.processor.processedTrack){for(const e of this.attachedElements)e!==this.processorElement&&t&&(Pr(this._mediaStreamTrack,e),Er(this.processor.processedTrack,e));yield null===(i=this.sender)||void 0===i?void 0:i.replaceTrack(this.processor.processedTrack)}}finally{r()}}))}getProcessor(){return this.processor}stopProcessor(){var e,t;return wt(this,void 0,void 0,(function*(){this.processor&&(this.log.debug("stopping processor",this.logContext),null===(e=this.processor.processedTrack)||void 0===e||e.stop(),yield this.processor.destroy(),this.processor=void 0,null===(t=this.processorElement)||void 0===t||t.remove(),this.processorElement=void 0,yield this.restart())}))}}class ys extends qt.EventEmitter{constructor(t){super(),this.onWorkerMessage=t=>{var n,i;const{kind:r,data:s}=t.data;switch(r){case"error":l.error(s.error.message),this.emit(e.EncryptionEvent.EncryptionError,s.error);break;case"initAck":s.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"enable":if(this.encryptionEnabled!==s.enabled&&s.participantIdentity===(null===(n=this.room)||void 0===n?void 0:n.localParticipant.identity))this.emit(e.EncryptionEvent.ParticipantEncryptionStatusChanged,s.enabled,this.room.localParticipant),this.encryptionEnabled=s.enabled;else if(s.participantIdentity){const t=null===(i=this.room)||void 0===i?void 0:i.getParticipantByIdentity(s.participantIdentity);if(!t)throw TypeError("couldn't set encryption status, participant not found".concat(s.participantIdentity));this.emit(e.EncryptionEvent.ParticipantEncryptionStatusChanged,s.enabled,t)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"ratchetKey":this.keyProvider.emit(e.KeyProviderEvent.KeyRatcheted,s.material,s.keyIndex)}},this.onWorkerError=t=>{l.error("e2ee worker encountered an error:",{error:t.error}),this.emit(e.EncryptionEvent.EncryptionError,t.error)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1}setup(e){if(!oi())throw new fi("tried to setup end-to-end encryption on an unsupported browser");if(l.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions()}};this.worker&&(l.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){l.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):l.warn("ignoring server sent trailer as it's empty")}setupEngine(t){t.on(e.EngineEvent.RTPVideoMapUpdate,(e=>{this.postRTPMap(e)}))}setupEventListeners(t,n){t.on(e.RoomEvent.TrackPublished,((e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==et.NONE,t.identity))),t.on(e.RoomEvent.ConnectionStateChanged,(n=>{n===e.ConnectionState.Connected&&t.participants.forEach((e=>{e.tracks.forEach((t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==et.NONE,e.identity)}))}))})).on(e.RoomEvent.TrackUnsubscribed,((e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)})).on(e.RoomEvent.TrackSubscribed,((e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)})).on(e.RoomEvent.SignalConnected,(()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),n.getKeys().forEach((e=>{this.postKey(e)}))})),t.localParticipant.on(e.ParticipantEvent.LocalTrackPublished,(e=>wt(this,void 0,void 0,(function*(){this.setupE2EESender(e.track,e.track.sender)})))),n.on(e.KeyProviderEvent.SetKey,(e=>this.postKey(e))).on(e.KeyProviderEvent.RatchetRequest,((e,t)=>this.postRatchetRequest(e,t)))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const s={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(s)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null==n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?_r(n.mimeType):void 0)}}setupE2EESender(e,t){e instanceof vs&&t?this.handleSender(t,e.mediaStreamID,void 0):t||l.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return wt(this,void 0,void 0,(function*(){if(this.worker){if(ai()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if($n in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,s=e.readableStream;if(!r||!s){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,s=t.readable}const o={kind:"decode",data:{readableStream:s,writableStream:r,trackId:t,codec:i,participantIdentity:n}};this.worker.postMessage(o,[s,r])}e[$n]=!0}}))}handleSender(e,t,n){var i;if(!($n in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(ai()){l.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{l.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r,[i.readable,i.writable])}e[$n]=!0}}}var bs;!function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(bs||(bs={}));class ks{constructor(){this.pendingTasks=new Map,this.taskMutex=new hs,this.nextTaskIndex=0}run(e){return wt(this,void 0,void 0,(function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:bs.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=bs.RUNNING,yield e()}finally{t.status=bs.COMPLETED,this.pendingTasks.delete(t.id),n()}}))}flush(){return wt(this,void 0,void 0,(function*(){return this.run((()=>wt(this,void 0,void 0,(function*(){}))))}))}snapshot(){return Array.from(this.pendingTasks.values())}}const Ss=["syncState","trickle","offer","answer","simulate","leave"];var Cs;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(Cs||(Cs={}));class Ts{get currentState(){return this.state}get isDisconnected(){return this.state===Cs.DISCONNECTING||this.state===Cs.DISCONNECTED}get isEstablishingConnection(){return this.state===Cs.CONNECTING||this.state===Cs.RECONNECTING}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=Cs.DISCONNECTED,this.log=l,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=u(null!==(n=t.loggerName)&&void 0!==n?n:a.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new ks,this.queuedRequests=[],this.closingLock=new hs,this.connectionLock=new hs,this.state=Cs.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return wt(this,void 0,void 0,(function*(){return this.state=Cs.CONNECTING,this.options=n,yield this.connect(e,t,n,i)}))}reconnect(e,t,n,i){return wt(this,void 0,void 0,(function*(){if(this.options)return this.state=Cs.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}));this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext)}))}connect(e,t,n,i){this.connectOptions=n,e=(e=function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e)).replace(/\/$/,""),e+="/rtc";const r=function(e,t,n){var i;const r=new URLSearchParams;return r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Qr()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel),t.os&&r.set("os",t.os),t.osVersion&&r.set("os_version",t.osVersion),t.browser&&r.set("browser",t.browser),t.browserVersion&&r.set("browser_version",t.browserVersion),void 0!==n.publishOnly&&r.set("publish",n.publishOnly),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type),"?".concat(r.toString())}(t,function(){var e;const t=new mt({sdk:it.JS,protocol:11,version:Pi});return Qr()&&(t.os=null!==(e=Xr())&&void 0!==e?e:""),t}(),n);return new Promise(((t,s)=>wt(this,void 0,void 0,(function*(){const o=yield this.connectionLock.lock();try{const o=()=>wt(this,void 0,void 0,(function*(){this.close(),clearTimeout(a),s(new mi("room connection has been cancelled (signal)"))})),a=setTimeout((()=>{this.close(),s(new mi("room connection has timed out (signal)"))}),n.websocketTimeout);(null==i?void 0:i.aborted)&&o(),null==i||i.addEventListener("abort",o),this.log.debug("connecting to ".concat(e+r),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(e+r),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(a)},this.ws.onerror=t=>wt(this,void 0,void 0,(function*(){if(this.state===Cs.CONNECTED)this.handleWSError(t);else{clearTimeout(a);try{const t=yield fetch("http".concat(e.substring(2),"/validate").concat(r));if(t.status.toFixed(0).startsWith("4")){const e=yield t.text();s(new mi(e,0,t.status))}else s(new mi("Internal error",2,t.status))}catch(e){s(new mi("server was not reachable",1))}}})),this.ws.onmessage=e=>wt(this,void 0,void 0,(function*(){var r,a,c,l;let u;if("string"==typeof e.data){const t=JSON.parse(e.data);u=Bi.fromJson(t)}else{if(!(e.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof e.data),this.logContext);u=Bi.fromBinary(new Uint8Array(e.data))}if(this.state!==Cs.CONNECTED){let e=!1;if("join"===(null===(r=u.message)||void 0===r?void 0:r.case)?(this.state=Cs.CONNECTED,null==i||i.removeEventListener("abort",o),this.pingTimeoutDuration=u.message.value.pingTimeout,this.pingIntervalDuration=u.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),t(u.message.value)):this.state===Cs.RECONNECTING&&"leave"!==u.message.case?(this.state=Cs.CONNECTED,null==i||i.removeEventListener("abort",o),this.startPingInterval(),"reconnect"===(null===(a=u.message)||void 0===a?void 0:a.case)?t(null===(c=u.message)||void 0===c?void 0:c.value):(t(),e=!0)):this.isEstablishingConnection&&"leave"===u.message.case?s(new mi("Received leave request while trying to (re)connect",4)):n.reconnect||s(new mi("did not receive join response, got ".concat(null===(l=u.message)||void 0===l?void 0:l.case," instead"))),!e)return}this.signalLatency&&(yield Ar(this.signalLatency)),this.handleSignalResponse(u)})),this.ws.onclose=e=>{this.isEstablishingConnection&&s(new mi("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,state:this.state})),this.handleOnClose(e.reason)}}finally{o()}}))))}close(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return wt(this,void 0,void 0,(function*(){const t=yield this.closingLock.lock();try{if(e&&(this.state=Cs.DISCONNECTING),this.ws){this.ws.onmessage=null,this.ws.onopen=null,this.ws.onclose=null;const e=new Promise((e=>{this.ws?this.ws.onclose=()=>{e()}:e()}));this.ws.readyState<this.ws.CLOSING&&(this.ws.close(),yield Promise.race([e,Ar(250)])),this.ws=void 0}}finally{e&&(this.state=Cs.DISCONNECTED),this.clearPingInterval(),t()}}))}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Es(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Es(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new qi({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new zi({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return this.sendRequest({case:"updateMetadata",value:new tr({metadata:e,name:t})})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new er({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new pr({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:F.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new yr({timestamp:F.parse(Date.now()),rtt:F.parse(this.rtt)})})])}sendLeave(){return this.sendRequest({case:"leave",value:new Zi({canReconnect:!1,reason:e.DisconnectReason.CLIENT_INITIATED})})}sendRequest(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return wt(this,void 0,void 0,(function*(){const n=!t&&!function(e){const t=Ss.indexOf(e.case)>=0;return l.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(n&&this.state===Cs.RECONNECTING)return void this.queuedRequests.push((()=>wt(this,void 0,void 0,(function*(){yield this.sendRequest(e,!0)}))));if(t||(yield this.requestQueue.flush()),this.signalLatency&&(yield Ar(this.signalLatency)),!this.ws||this.ws.readyState!==this.ws.OPEN)return void this.log.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.case),this.logContext);const i=new Fi({message:e});try{this.useJSON?this.ws.send(i.toJsonString()):this.ws.send(i.toBinary())}catch(e){this.log.error("error sending signal message",Object.assign(Object.assign({},this.logContext),{error:e}))}}))}handleSignalResponse(e){var t,n;const i=e.message;if(null==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=ws(i.value);this.onAnswer&&this.onAnswer(e)}else if("offer"===i.case){const e=ws(i.value);this.onOffer&&this.onOffer(e)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return wt(this,void 0,void 0,(function*(){if(this.state===Cs.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)}))}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Ri.setTimeout((()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")}),1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Ri.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Ri.setInterval((()=>{this.sendPing()}),1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ri.clearInterval(this.pingInterval)}}function ws(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function Es(e){return new Qi({sdp:e.sdp,type:e.type})}var Ps={},Rs={exports:{}},xs=Rs.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(xs).forEach((function(e){xs[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}));var Os=Rs.exports;!function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var s=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var s=0;s<i.length;s+=1)null!=e[s+1]&&(n[i[s]]=t(e[s+1]))}(i.match(e.reg),s,e.names,e.name),e.push&&n[e.push].push(s)},i=Os,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},s=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(s.push({rtp:[],fmtp:[]}),o=s[s.length-1]);for(var a=0;a<(i[t]||[]).length;a+=1){var c=i[t][a];if(c.reg.test(r))return n(c,o,r)}})),t.media=s,t};var s=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(Ps);var Is=Os,Ns=/%[sdv%]/g,_s=function(e){var t=1,n=arguments,i=n.length;return e.replace(Ns,(function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},Ds=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var s=t.names[r];t.name?i.push(n[t.name][s]):i.push(n[t.names[r]])}else i.push(n[t.name]);return _s.apply(null,i)},Ms=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Ls=["i","c","b","a"],As=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||Ms,i=t.innerOrder||Ls,r=[];return n.forEach((function(t){Is[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(Ds(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(Ds(t,n,e))}))}))})),e.media.forEach((function(e){r.push(Ds("m",Is.m[0],e)),i.forEach((function(t){Is[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(Ds(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(Ds(t,n,e))}))}))}))})),r.join("\r\n")+"\r\n"},Us=As,js=Ps.parse;const Fs="negotiationStarted",Bs="negotiationComplete",Js="rtpVideoPayloadTypes";class Vs extends qt.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.log=l,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=ki((e=>wt(this,void 0,void 0,(function*(){this.emit(Fs);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}))),100),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=u(null!==(i=n.loggerName)&&void 0!==i?i:a.PCTransport),this.loggerOptions=n,this.config=e,this.mediaConstraints=t,this._pc=this.createPC()}createPC(){const e="Chrome"===(null===(t=Ti())||void 0===t?void 0:t.name)?new RTCPeerConnection(this.config,this.mediaConstraints):new RTCPeerConnection(this.config);var t;return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return wt(this,void 0,void 0,(function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)}))}setRemoteDescription(e){var t;return wt(this,void 0,void 0,(function*(){let n;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=js(null!==(t=e.sdp)&&void 0!==t?t:"");let s=0;return r.media.forEach((e=>{var t;"audio"===e.type&&(e.rtp.some((e=>"opus"===e.codec&&(s=e.payload,!0))),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some((e=>e.payload===s&&"nack"===e.type)))&&i.push(e.mid),e.fmtp.some((t=>t.payload===s&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0))))})),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const i=js(null!==(t=e.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type&&this.trackBitrates.some((t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter((e=>!e.includes("maxaveragebitrate"))).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0}))})),n=Us(i)}yield this.setMungedSDP(e,n,!0),this.pendingCandidates.forEach((e=>{this.pc.addIceCandidate(e)})),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):"answer"===e.type&&(this.emit(Bs),e.sdp)&&js(e.sdp).media.forEach((e=>{"video"===e.type&&this.emit(Js,e.rtp)}))}))}createAndSendOffer(e){var t;return wt(this,void 0,void 0,(function*(){if(void 0===this.onOffer)return;if((null==e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null==e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=yield this.pc.createOffer(e),i=js(null!==(t=n.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type?qs(e,[],[]):"video"===e.type&&(function(e){var t,n,i,r;if(!Jr(null===(n=null===(t=e.rtp[0])||void 0===t?void 0:t.codec)||void 0===n?void 0:n.toLowerCase()))return;let s=0;const o=null===(i=e.ext)||void 0===i?void 0:i.some((e=>e.uri===Lr||(e.value>s&&(s=e.value),!1)));o||null===(r=e.ext)||void 0===r||r.push({value:s+1,uri:Lr})}(e),this.trackBitrates.some((t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config.includes("x-google-start-bitrate")||(r.config+=";x-google-start-bitrate=".concat(Math.round(.7*t.maxbr))),r.config.includes("x-google-max-bitrate")||(r.config+=";x-google-max-bitrate=".concat(t.maxbr)),i=!0;break}return i||e.fmtp.push({payload:n,config:"x-google-start-bitrate=".concat(Math.round(.7*t.maxbr),";x-google-max-bitrate=").concat(t.maxbr)}),!0})))})),yield this.setMungedSDP(n,Us(i)),this.onOffer(n)}))}createAndSetAnswer(){var e;return wt(this,void 0,void 0,(function*(){const t=yield this.pc.createAnswer(),n=js(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach((e=>{"audio"===e.type&&qs(e,this.remoteStereoMids,this.remoteNackMids)})),yield this.setMungedSDP(t,Us(n)),t}))}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new yi("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new yi("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){var e;return wt(this,void 0,void 0,(function*(){if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach((e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}})),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0}))}setMungedSDP(e,t,n){return wt(this,void 0,void 0,(function*(){if(t){const i=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(n){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:n,sdp:t})),e.sdp=i}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(t){let r="unknown error";t instanceof Error?r=t.message:"string"==typeof t&&(r=t);const s={error:r,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(s.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:s})),new bi(r)}}))}}function qs(e,t,n){let i=0;e.rtp.some((e=>"opus"===e.codec&&(i=e.payload,!0))),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some((e=>e.payload===i&&"nack"===e.type))&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some((e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0))))}const zs="vp8",Ws={audioBitrate:e.AudioPresets.music.maxBitrate,audioPreset:e.AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Li.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:zs,backupCodec:!0},Ks={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},Hs={resolution:Di.h720.resolution},Gs={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Tt,disconnectOnPageLeave:!0,expWebAudioMix:!1},Qs={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Ys;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Ys||(Ys={}));class $s{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=Qs.peerConnectionTimeout,this.log=l,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map((e=>e.getConnectionState()));n.every((e=>"connected"===e))?this.state=Ys.CONNECTED:n.some((e=>"failed"===e))?this.state=Ys.FAILED:n.some((e=>"connecting"===e))?this.state=Ys.CONNECTING:n.every((e=>"closed"===e))?this.state=Ys.CLOSED:n.some((e=>"closed"===e))?this.state=Ys.CLOSING:n.every((e=>"new"===e))&&(this.state=Ys.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Ys[t]," to ").concat(Ys[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=u(null!==(i=n.loggerName)&&void 0!==i?i:a.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new Vs(e,{optional:[{googDscp:!0}]},n),this.subscriber=new Vs(e,void 0,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Ai.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Ai.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=e=>{var t;null===(t=this.onPublisherOffer)||void 0===t||t.call(this,e)},this.state=Ys.NEW,this.connectionLock=new hs}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return wt(this,void 0,void 0,(function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const t=this.publisher;for(const n of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(n)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()}))}triggerIceRestart(){return wt(this,void 0,void 0,(function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))}))}addIceCandidate(e,t){return wt(this,void 0,void 0,(function*(){t===Ai.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)}))}createSubscriberAnswerFromOffer(e){return wt(this,void 0,void 0,(function*(){return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()})),yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}))}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){var n;return wt(this,void 0,void 0,(function*(){const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map((n=>this.ensureTransportConnected(n,e,t))))}finally{i()}}))}negotiate(e){return wt(this,void 0,void 0,(function*(){return new Promise(((t,n)=>wt(this,void 0,void 0,(function*(){const i=setTimeout((()=>{n("negotiation timed out")}),this.peerConnectionTimeout);e.signal.addEventListener("abort",(()=>{clearTimeout(i),n("negotiation aborted")})),this.publisher.once(Fs,(()=>{e.signal.aborted||this.publisher.once(Bs,(()=>{clearTimeout(i),t()}))})),yield this.publisher.negotiate((e=>{clearTimeout(i),n(e)}))}))))}))}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Ai.PUBLISHER||e===Ai.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return wt(this,void 0,void 0,(function*(){if("connected"!==e.getConnectionState())return new Promise(((e,i)=>wt(this,void 0,void 0,(function*(){const r=()=>{this.log.warn("abort transport connection",this.logContext),Ri.clearTimeout(s),i(new mi("room connection has been cancelled",3))};(null==t?void 0:t.signal.aborted)&&r(),null==t||t.signal.addEventListener("abort",r);const s=Ri.setTimeout((()=>{null==t||t.signal.removeEventListener("abort",r),i(new mi("could not establish pc connection"))}),n);for(;this.state!==Ys.CONNECTED;)if(yield Ar(50),null==t?void 0:t.signal.aborted)return void i(new mi("room connection has been cancelled",3));Ri.clearTimeout(s),null==t||t.signal.removeEventListener("abort",r),e()}))))}))}}const Xs="_lossy",Zs="_reliable",eo="leave-reconnect";var to;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(to||(to={}));class no extends qt.EventEmitter{get isClosed(){return this._isClosed}constructor(t){var n;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=Qs.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=to.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=l,this.handleDataChannel=e=>{let{channel:t}=e;return wt(this,void 0,void 0,(function*(){if(t){if(t.label===Zs)this.reliableDCSub=t;else{if(t.label!==Xs)return;this.lossyDCSub=t}this.log.debug("on data channel ".concat(t.id,", ").concat(t.label),this.logContext),t.onmessage=this.handleDataMessage}}))},this.handleDataMessage=t=>wt(this,void 0,void 0,(function*(){var n,i;const r=yield this.dataProcessLock.lock();try{let r;if(t.data instanceof ArrayBuffer)r=t.data;else{if(!(t.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:t.data}));r=yield t.data.arrayBuffer()}const s=ct.fromBinary(new Uint8Array(r));"speaker"===(null===(n=s.value)||void 0===n?void 0:n.case)?this.emit(e.EngineEvent.ActiveSpeakersUpdate,s.value.value.speakers):"user"===(null===(i=s.value)||void 0===i?void 0:i.case)&&this.emit(e.EngineEvent.DataPacketReceived,s.value.value,s.kind)}finally{r()}})),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=t=>{const n=0===t.currentTarget.maxRetransmits?e.DataPacket_Kind.LOSSY:e.DataPacket_Kind.RELIABLE;this.updateAndEmitDCBufferStatus(n)},this.handleDisconnect=(t,n)=>{if(this._isClosed)return;this.log.warn("".concat(t," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const i=t=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(t,"ms. giving up"),this.logContext),this.emit(e.EngineEvent.Disconnected),this.close()},r=Date.now()-this.reconnectStart;let s=this.getNextRetryDelay({elapsedMs:r,retryCount:this.reconnectAttempts});null!==s?(t===eo&&(s=0),this.log.debug("reconnecting in ".concat(s,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ri.setTimeout((()=>this.attemptReconnect(n)),s)):i(r)},this.waitForRestarted=()=>new Promise(((t,n)=>{this.pcState===to.Connected&&t();const i=()=>{this.off(e.EngineEvent.Disconnected,r),t()},r=()=>{this.off(e.EngineEvent.Restarted,i),n()};this.once(e.EngineEvent.Restarted,i),this.once(e.EngineEvent.Disconnected,r)})),this.updateAndEmitDCBufferStatus=t=>{const n=this.isBufferStatusLow(t);void 0!==n&&n!==this.dcBufferStatus.get(t)&&(this.dcBufferStatus.set(t,n),this.emit(e.EngineEvent.DCBufferStatusChanged,n,t))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===Cs.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ze.RR_SIGNAL_DISCONNECTED))},this.log=u(null!==(n=t.loggerName)&&void 0!==n?n:a.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new Ts(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new hs,this.dataProcessLock=new hs,this.dcBufferStatus=new Map([[e.DataPacket_Kind.LOSSY,!0],[e.DataPacket_Kind.RELIABLE,!0]]),this.client.onParticipantUpdate=t=>this.emit(e.EngineEvent.ParticipantUpdate,t),this.client.onConnectionQuality=t=>this.emit(e.EngineEvent.ConnectionQualityUpdate,t),this.client.onRoomUpdate=t=>this.emit(e.EngineEvent.RoomUpdate,t),this.client.onSubscriptionError=t=>this.emit(e.EngineEvent.SubscriptionError,t),this.client.onSubscriptionPermissionUpdate=t=>this.emit(e.EngineEvent.SubscriptionPermissionUpdate,t),this.client.onSpeakersChanged=t=>this.emit(e.EngineEvent.SpeakersChanged,t),this.client.onStreamStateUpdate=t=>this.emit(e.EngineEvent.StreamStateChanged,t)}get logContext(){var e,t,n,i,r,s;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomSid:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,identity:null===(s=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===s?void 0:s.identity}}join(e,t,n,i){return wt(this,void 0,void 0,(function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=r.clientConfiguration,r}catch(s){if(s instanceof mi&&1===s.reason&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw s}}))}close(){return wt(this,void 0,void 0,(function*(){const t=yield this.closingLock.lock();if(this.isClosed)t();else try{this._isClosed=!0,this.emit(e.EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}}))}cleanupPeerConnections(){var e;return wt(this,void 0,void 0,(function*(){yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0}))}cleanupClient(){return wt(this,void 0,void 0,(function*(){yield this.client.close(),this.client.resetCallbacks()}))}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new gi("a track with the same ID has already been published");return new Promise(((t,n)=>{const i=setTimeout((()=>{delete this.pendingTrackResolvers[e.cid],n(new mi("publication of local track timed out, no response from server"))}),1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)}))}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(e){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:e}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){var e;return wt(this,void 0,void 0,(function*(){return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()}))}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(t){var n;return wt(this,void 0,void 0,(function*(){if(this.pcManager&&this.pcManager.currentState!==Ys.NEW)return;this.participantSid=null===(n=t.participant)||void 0===n?void 0:n.sid;const i=this.makeRTCConfiguration(t);this.pcManager=new $s(i,t.subscriberPrimary,this.loggerOptions),this.emit(e.EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=e=>{this.client.sendOffer(e)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(n,i,r)=>wt(this,void 0,void 0,(function*(){if(this.log.debug("primary PC state changed ".concat(n),this.logContext),n===Ys.CONNECTED){const n=this.pcState===to.New;this.pcState=to.Connected,n&&this.emit(e.EngineEvent.Connected,t)}else n===Ys.FAILED&&this.pcState===to.Connected&&(this.pcState=to.Disconnected,this.handleDisconnect("peerconnection failed","failed"===r?ze.RR_SUBSCRIBER_FAILED:ze.RR_PUBLISHER_FAILED))})),this.pcManager.onTrack=t=>{this.emit(e.EngineEvent.MediaTrackAdded,t.track,t.streams[0],t.receiver)},this.createDataChannels()}))}setupSignalClientCallbacks(){this.client.onAnswer=e=>wt(this,void 0,void 0,(function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))})),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>wt(this,void 0,void 0,(function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)})),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(e.EngineEvent.LocalTrackUnpublished,t)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(t,n)=>{this.emit(e.EngineEvent.RemoteMute,t,n)},this.client.onSubscribedQualityUpdate=t=>{this.emit(e.EngineEvent.SubscribedQualityUpdate,t)},this.client.onClose=()=>{this.handleDisconnect("signal",ze.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{(null==t?void 0:t.canReconnect)?(this.fullReconnectOnNext=!0,this.handleDisconnect(eo)):(this.emit(e.EngineEvent.Disconnected,null==t?void 0:t.reason),this.close()),this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null==t?void 0:t.reason}))}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach((e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)})),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Ve.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Xs,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Zs,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}setPreferredCodec(e,t,n){if(!("getCapabilities"in RTCRtpSender))return;const i=RTCRtpSender.getCapabilities(t);if(!i)return;this.log.debug("get sender capabilities",Object.assign(Object.assign({},this.logContext),{cap:i}));const r=[],s=[],o=[];i.codecs.forEach((e=>{const t=e.mimeType.toLowerCase();"audio/opus"!==t?t==="video/".concat(n)?"h264"!==n||e.sdpFmtpLine&&e.sdpFmtpLine.includes("profile-level-id=42e01f")?r.push(e):s.push(e):o.push(e):r.push(e)})),function(e){if(!Gr())return!1;if(!("setCodecPreferences"in e))return!1;const t=Ti();if(!(null==t?void 0:t.name)||!t.version)return!1;const n=qr[t.name];return!!n&&es(t.version,n)>=0}(e)&&e.setCodecPreferences(r.concat(s,o))}createSender(e,t,n){return wt(this,void 0,void 0,(function*(){if(Ur())return yield this.createTransceiverRTCRtpSender(e,t,n);if(jr())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new yi("Required webRTC APIs not supported on this device")}))}createSimulcastSender(e,t,n,i){return wt(this,void 0,void 0,(function*(){if(Ur())return this.createSimulcastTransceiverSender(e,t,n,i);if(jr())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new yi("Cannot stream on this device")}))}createTransceiverRTCRtpSender(e,t,n){return wt(this,void 0,void 0,(function*(){if(!this.pcManager)throw new yi("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream);const r={direction:"sendonly",streams:i};n&&(r.sendEncodings=n);const s=yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r);return e.kind===wr.Kind.Video&&t.videoCodec&&(this.setPreferredCodec(s,e.kind,t.videoCodec),e.codec=t.videoCodec),s.sender}))}createSimulcastTransceiverSender(e,t,n,i){return wt(this,void 0,void 0,(function*(){if(!this.pcManager)throw new yi("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const s=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return this.setPreferredCodec(s,e.kind,n.videoCodec),e.setSimulcastTrackSender(n.videoCodec,s.sender),s.sender}))}createRTCRtpSender(e){return wt(this,void 0,void 0,(function*(){if(!this.pcManager)throw new yi("publisher is closed");return this.pcManager.addPublisherTrack(e)}))}attemptReconnect(t){var n,i,r;return wt(this,void 0,void 0,(function*(){if(!this._isClosed)if(this.attemptingReconnect)l.warn("already attempting reconnect, returning early",this.logContext);else{(null===(n=this.clientConfiguration)||void 0===n?void 0:n.resumeConnection)!==Ve.DISABLED&&(null!==(r=null===(i=this.pcManager)||void 0===i?void 0:i.currentState)&&void 0!==r?r:Ys.NEW)!==Ys.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(t){this.reconnectAttempts+=1;let i=!0;t instanceof yi?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:t})),i=!1):t instanceof io||(this.fullReconnectOnNext=!0),i?this.handleDisconnect("reconnect",ze.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(e.EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}}))}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:e}))}return null}restartConnection(t){var n,i,r;return wt(this,void 0,void 0,(function*(){try{if(!this.url||!this.token)throw new yi("could not reconnect, url or token not saved");let i;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(e.EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new io;i=yield this.join(null!=t?t:this.url,this.token,this.signalOpts)}catch(e){if(e instanceof mi&&0===e.reason)throw new yi("could not reconnect, token might be expired");throw new io}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(e.EngineEvent.SignalRestarted,i),yield this.waitForPCReconnected(),this.client.currentState!==Cs.CONNECTED)throw new io("Signal connection got severed during reconnect");null===(n=this.regionUrlProvider)||void 0===n||n.resetAttempts(),this.emit(e.EngineEvent.Restarted)}catch(e){const n=yield null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getNextBestRegionUrl();if(n)return void(yield this.restartConnection(n));throw null===(r=this.regionUrlProvider)||void 0===r||r.resetAttempts(),e}}))}resumeConnection(t){var n;return wt(this,void 0,void 0,(function*(){if(!this.url||!this.token)throw new yi("could not reconnect, url or token not saved");if(!this.pcManager)throw new yi("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(e.EngineEvent.Resuming);try{this.setupSignalClientCallbacks();const e=yield this.client.reconnect(this.url,this.token,this.participantSid,t);if(e){const t=this.makeRTCConfiguration(e);this.pcManager.updateConfiguration(t)}}catch(e){let n="";if(e instanceof Error&&(n=e.message,this.log.error(e.message,Object.assign(Object.assign({},this.logContext),{error:e}))),e instanceof mi&&0===e.reason)throw new yi("could not reconnect, token might be expired");if(e instanceof mi&&4===e.reason)throw e;throw new io(n)}if(this.emit(e.EngineEvent.SignalResumed),this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Cs.CONNECTED)throw new io("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(n=this.reliableDC)||void 0===n?void 0:n.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),this.emit(e.EngineEvent.Resumed)}))}waitForPCInitialConnection(e,t){return wt(this,void 0,void 0,(function*(){if(!this.pcManager)throw new yi("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)}))}waitForPCReconnected(){return wt(this,void 0,void 0,(function*(){this.pcState=to.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ar(2e3),!this.pcManager)throw new yi("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=to.Connected}catch(e){throw this.pcState=to.Disconnected,new mi("could not establish PC connection, ".concat(e.message))}}))}sendDataPacket(e,t){return wt(this,void 0,void 0,(function*(){const n=e.toBinary();yield this.ensurePublisherConnected(t);const i=this.dataChannelForKind(t);i&&i.send(n),this.updateAndEmitDCBufferStatus(t)}))}ensureDataTransportConnected(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;var n;return wt(this,void 0,void 0,(function*(){if(!this.pcManager)throw new yi("PC manager is closed");const i=t?this.pcManager.subscriber:this.pcManager.publisher,r=t?"Subscriber":"Publisher";if(!i)throw new mi("".concat(r," connection not set"));t||this.pcManager.publisher.isICEConnected||"checking"===this.pcManager.publisher.getICEConnectionState()||this.negotiate();const s=this.dataChannelForKind(e,t);if("open"===(null==s?void 0:s.readyState))return;const o=(new Date).getTime()+this.peerConnectionTimeout;for(;(new Date).getTime()<o;){if(i.isICEConnected&&"open"===(null===(n=this.dataChannelForKind(e,t))||void 0===n?void 0:n.readyState))return;yield Ar(50)}throw new mi("could not establish ".concat(r," connection, state: ").concat(i.getICEConnectionState()))}))}ensurePublisherConnected(e){return wt(this,void 0,void 0,(function*(){yield this.ensureDataTransportConnected(e,!1)}))}verifyTransport(){return!!this.pcManager&&this.pcManager.currentState===Ys.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return wt(this,void 0,void 0,(function*(){return new Promise(((t,n)=>wt(this,void 0,void 0,(function*(){if(!this.pcManager)return void n(new bi("PC manager is closed"));this.pcManager.requirePublisher();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(e.EngineEvent.Closing,r),this.pcManager.publisher.once(Js,(t=>{const n=new Map;t.forEach((e=>{const t=e.codec.toLowerCase();var i;i=t,Ii.includes(i)&&n.set(e.payload,t)})),this.emit(e.EngineEvent.RTPVideoMapUpdate,n)}));try{yield this.pcManager.negotiate(i),t()}catch(e){e instanceof bi&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ze.RR_UNKNOWN),n(e)}finally{this.off(e.EngineEvent.Closing,r)}}))))}))}dataChannelForKind(t,n){if(n){if(t===e.DataPacket_Kind.LOSSY)return this.lossyDCSub;if(t===e.DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(t===e.DataPacket_Kind.LOSSY)return this.lossyDC;if(t===e.DataPacket_Kind.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),s=this.pcManager.subscriber.getRemoteDescription(),o=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,a=new Array;e.forEach((e=>{e.isDesired!==o&&a.push(e.trackSid)})),this.client.sendSyncState(new fr({answer:r?Es({sdp:r.sdp,type:r.type}):void 0,offer:s?Es({sdp:s.sdp,type:s.type}):void 0,subscription:new $i({trackSids:a,subscribe:!o,participantTracks:[]}),publishTracks:Dr(t),dataChannels:this.dataChannelsInfo()}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],n=(e,n)=>{void 0!==(null==e?void 0:e.id)&&null!==e.id&&t.push(new gr({label:e.label,id:e.id,target:n}))};return n(this.dataChannelForKind(e.DataPacket_Kind.LOSSY),Ai.PUBLISHER),n(this.dataChannelForKind(e.DataPacket_Kind.RELIABLE),Ai.PUBLISHER),n(this.dataChannelForKind(e.DataPacket_Kind.LOSSY,!0),Ai.SUBSCRIBER),n(this.dataChannelForKind(e.DataPacket_Kind.RELIABLE,!0),Ai.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&Ri.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Gr()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Gr()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class io extends Error{}class ro{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Yr(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return wt(this,void 0,void 0,(function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter((e=>!this.attemptedRegions.find((t=>t.url===e.url))));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),l.debug("next region: ".concat(e.region)),e.url}return null}))}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return wt(this,void 0,void 0,(function*(){const t=yield fetch("".concat((n=this.serverUrl,"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});var n;if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new mi("Could not fetch region settings: ".concat(t.statusText),401===t.status?0:void 0,t.status)}))}}const so=2e3;function oo(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}class ao extends vs{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,wr.Kind.Audio,t,n,r),this.stopOnMute=!1,this.monitorSender=()=>wt(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}e&&this.prevStats&&(this._currentBitrate=oo(e,this.prevStats)),this.prevStats=e})),this.audioContext=i,this.checkForSilence()}setDeviceId(e){return wt(this,void 0,void 0,(function*(){return this._constraints.deviceId===e||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||ps(e)===this.mediaStreamTrack.getSettings().deviceId)}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return wt(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.source===wr.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return wt(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ps(this._constraints.deviceId);return this.source!==wr.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}restartTrack(e){return wt(this,void 0,void 0,(function*(){let t;if(e){const n=Or({audio:e});"boolean"!=typeof n.audio&&(t=n.audio)}yield this.restart(t)}))}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return wt(this,void 0,void 0,(function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n}))}startMonitor(){Gr()&&(this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),so)))}setProcessor(e){var t;return wt(this,void 0,void 0,(function*(){const n=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");if(this.processor&&(yield this.stopProcessor()),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack))}finally{n()}}))}setAudioContext(e){this.audioContext=e}getSenderStats(){var e;return wt(this,void 0,void 0,(function*(){if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach((e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})})),t}))}checkForSilence(){return wt(this,void 0,void 0,(function*(){const t=yield function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return wt(this,void 0,void 0,(function*(){const n=Ir();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,s=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield Ar(t),i.getByteTimeDomainData(s);const o=s.some((e=>128!==e&&0!==e));return n.close(),!o}return!1}))}(this);return t&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(e.TrackEvent.AudioSilenceDetected)),t}))}}function co(e,t,n){switch(e.kind){case"audio":return new ao(e,t,!1,void 0,n);case"video":return new Co(e,t,!1,n);default:throw new gi("unsupported track type: ".concat(e.kind))}}const lo=Object.values(Di),uo=Object.values(Mi),ho=Object.values(Li),po=[Di.h180,Di.h360],mo=[Mi.h180,Mi.h360],fo=e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map((t=>{var n,i;return new xi(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(n=e.encoding.maxFramerate)&&void 0!==n?n:30)/(null!==(i=t.fps)&&void 0!==i?i:30))))),t.fps,e.encoding.priority)})),go=["q","h","f"];function vo(e,t,n,i){var r,s;let o=null==i?void 0:i.videoEncoding;e&&(o=null==i?void 0:i.screenShareEncoding);const a=null==i?void 0:i.simulcast,c=null==i?void 0:i.scalabilityMode,u=null==i?void 0:i.videoCodec;if(!o&&!a&&!c||!t||!n)return[{}];o||(o=function(e,t,n,i){const r=function(e,t,n){if(e)return ho;const i=t>n?t/n:n/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?lo:uo}(e,t,n);let{encoding:s}=r[0];const o=Math.max(t,n);for(let a=0;a<r.length;a+=1){const e=r[a];if(s=e.encoding,e.width>=o)break}if(i)switch(i){case"av1":s=Object.assign({},s),s.maxBitrate=.7*s.maxBitrate;break;case"vp9":s=Object.assign({},s),s.maxBitrate=.85*s.maxBitrate}return s}(e,t,n,u),l.debug("using video encoding",o));const d=new xi(t,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Jr(u)){l.debug("using svc with scalabilityMode ".concat(c));const e=new So(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));for(let n=0;n<e.spatial;n+=1)t.push({rid:go[2-n],maxBitrate:o.maxBitrate/Math.pow(3,n),maxFramerate:d.encoding.maxFramerate});return t[0].scalabilityMode=c,l.debug("encodings",t),t}if(!a)return[o];let h,p=[];if(p=e?null!==(r=ko(null==i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:yo(e,d):null!==(s=ko(null==i?void 0:i.videoSimulcastLayers))&&void 0!==s?s:yo(e,d),p.length>0){const e=p[0];p.length>1&&([,h]=p);const i=Math.max(t,n);if(i>=960&&h)return bo(t,n,[e,h,d]);if(i>=480)return bo(t,n,[e,d])}return bo(t,n,[d])}function yo(e,t){if(e)return fo(t);const{width:n,height:i}=t,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?po:mo}function bo(e,t,n){const i=[];if(n.forEach(((n,r)=>{if(r>=go.length)return;const s=Math.min(e,t),o={rid:go[r],scaleResolutionDownBy:Math.max(1,s/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(o.maxFramerate=n.encoding.maxFramerate);const a=zr()||0===r;n.encoding.priority&&a&&(o.priority=n.encoding.priority,o.networkPriority=n.encoding.priority),i.push(o)})),Qr()&&"ios"===Xr()){let e;i.forEach((t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate}));let t=!0;i.forEach((n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,l.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),l.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)}))}return i}function ko(e){if(e)return e.sort(((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0}))}class So{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class Co extends vs{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,wr.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.monitorSender=()=>wt(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}const t=new Map(e.map((e=>[e.rid,e])));if(this.prevStats){let e=0;t.forEach(((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=oo(t,r)})),this._currentBitrate=e}this.prevStats=t})),this.senderLock=new hs}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Gr())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),so))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach((e=>{e.mediaStreamTrack.stop()})),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});var t,n,i,r,s;return wt(this,void 0,void 0,(function*(){yield e.pauseUpstream.call(this);try{for(var o,a=!0,c=Pt(this.simulcastCodecs.values());o=yield c.next(),!(t=o.done);a=!0){r=o.value,a=!1;const e=r;yield null===(s=e.sender)||void 0===s?void 0:s.replaceTrack(null)}}catch(e){n={error:e}}finally{try{a||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});var t,n,i,r,s;return wt(this,void 0,void 0,(function*(){yield e.resumeUpstream.call(this);try{for(var o,a=!0,c=Pt(this.simulcastCodecs.values());o=yield c.next(),!(t=o.done);a=!0){r=o.value,a=!1;const e=r;yield null===(s=e.sender)||void 0===s?void 0:s.replaceTrack(e.mediaStreamTrack)}}catch(e){n={error:e}}finally{try{a||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return wt(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.source!==wr.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return wt(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.source!==wr.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){var e;return wt(this,void 0,void 0,(function*(){if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach((e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,framesSent:e.framesSent,timestamp:e.timestamp,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges},s=n.get(e.remoteId);s&&(r.jitter=s.jitter,r.packetsLost=s.packetsLost,r.roundTripTime=s.roundTripTime),t.push(r)}})),t}))}setPublishingQuality(t){const n=[];for(let i=e.VideoQuality.LOW;i<=e.VideoQuality.HIGH;i+=1)n.push(new lr({quality:i,enabled:i<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(n)}setDeviceId(e){return wt(this,void 0,void 0,(function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ps(e)||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||ps(e)===this._mediaStreamTrack.getSettings().deviceId)}))}restartTrack(e){var t,n,i,r;return wt(this,void 0,void 0,(function*(){let s;if(e){const t=Or({video:e});"boolean"!=typeof t.video&&(s=t.video)}yield this.restart(s);try{for(var o,a=!0,c=Pt(this.simulcastCodecs.values());o=yield c.next(),!(t=o.done);a=!0){r=o.value,a=!1;const e=r;e.sender&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(e){n={error:e}}finally{try{a||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}setProcessor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});var i,r,s,o,a,c;return wt(this,void 0,void 0,(function*(){if(yield n.setProcessor.call(this,e,t),null===(a=this.processor)||void 0===a?void 0:a.processedTrack)try{for(var l,u=!0,d=Pt(this.simulcastCodecs.values());l=yield d.next(),!(i=l.done);u=!0){o=l.value,u=!1;const e=o;yield null===(c=e.sender)||void 0===c?void 0:c.replaceTrack(this.processor.processedTrack)}}catch(e){r={error:e}}finally{try{u||i||!(s=d.return)||(yield s.call(d))}finally{if(r)throw r.error}}}))}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))throw new Error("".concat(e," already added"));const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout((()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)}),5e3))}setPublishingCodecs(e){var t,n,i,r,s,o,a;return wt(this,void 0,void 0,(function*(){if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=Pt(e);i=yield n.next(),!(r=i.done);t=!0){a=i.value,t=!1;const e=a;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield To(t.sender,t.encodings,e.qualities,this.senderLock,this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(e.qualities)}}catch(e){s={error:e}}finally{try{t||r||!(o=n.return)||(yield o.call(n))}finally{if(s)throw s.error}}return c}))}setPublishingLayers(e){return wt(this,void 0,void 0,(function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),this.sender&&this.encodings&&(yield To(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))}))}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return wt(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),Hr()&&this.isInBackground&&this.source===wr.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}))}}function To(e,t,n,i,r,s){return wt(this,void 0,void 0,(function*(){const o=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:o}=i;if(!o)return;if(o.length!==t.length)return void r.warn("cannot set publishing layers, encodings mismatch");let a=!1;o.forEach(((e,i)=>{var o;let c=null!==(o=e.rid)&&void 0!==o?o:"";""===c&&(c="q");const l=wo(c),u=n.find((e=>e.quality===l));u&&e.active!==u.enabled&&(a=!0,e.active=u.enabled,r.debug("setting layer ".concat(u.quality," to ").concat(e.active?"enabled":"disabled"),s),zr()&&(u.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})),a&&(i.encodings=o,r.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:i.encodings})),yield e.setParameters(i))}finally{o()}}))}function wo(t){switch(t){case"f":default:return e.VideoQuality.HIGH;case"h":return e.VideoQuality.MEDIUM;case"q":return e.VideoQuality.LOW}}function Eo(t,n,i,r){if(!i)return[new at({quality:e.VideoQuality.HIGH,width:t,height:n,bitrate:0,ssrc:0})];if(r){const r=i[0].scalabilityMode,s=new So(r),o=[];for(let a=0;a<s.spatial;a+=1)o.push(new at({quality:e.VideoQuality.HIGH-a,width:Math.ceil(t/Math.pow(2,a)),height:Math.ceil(n/Math.pow(2,a)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(3,a)):0,ssrc:0}));return o}return i.map((e=>{var i,r,s;const o=null!==(i=e.scaleResolutionDownBy)&&void 0!==i?i:1;let a=wo(null!==(r=e.rid)&&void 0!==r?r:"");return new at({quality:a,width:Math.ceil(t/o),height:Math.ceil(n/o),bitrate:null!==(s=e.maxBitrate)&&void 0!==s?s:0,ssrc:0})}))}class Po extends wr{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const n=i=>{i.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",n),this.receiver=void 0,this._currentBitrate=0,this.emit(e.TrackEvent.Ended,this))};t.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){var e;return wt(this,void 0,void 0,(function*(){if(null===(e=this.receiver)||void 0===e?void 0:e.getStats)return yield this.receiver.getStats()}))}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval((()=>this.monitorReceiver()),so))}}class Ro extends Po{constructor(e,t,n,i,r,s){super(e,t,wr.Kind.Audio,n,s),this.monitorReceiver=()=>wt(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=oo(e,this.prevStats)),this.prevStats=e})),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;Qr()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Qr())return 1;let e=0;return this.attachedElements.forEach((t=>{t.volume>e&&(e=t.volume)})),e}setSinkId(e){return wt(this,void 0,void 0,(function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map((t=>{if(Vr(t))return t.setSinkId(e)})))}))}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&Vr(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,n){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach((e=>{i.connect(e),i=e})),this.gainNode=t.createGain(),i.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==t.state&&t.resume().then((()=>{"running"!==t.state&&this.emit(e.TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))})).catch((t=>{this.emit(e.TrackEvent.AudioPlaybackFailed,t)}))}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return wt(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach((t=>{"inbound-rtp"===t.type&&(e={type:"audio",timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})})),e}))}}class xo extends Po{constructor(e,t,n,i,r){super(e,t,wr.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>wt(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=oo(e,this.prevStats)),this.prevStats=e})),this.debouncedHandleResize=ki((()=>{this.updateDimensions()}),100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach((t=>{e?Pr(this._mediaStreamTrack,t):Er(this._mediaStreamTrack,t)}))}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t.element===e))){const t=new Oo(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t===e))?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter((t=>t===e));for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter((t=>t!==e)),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return wt(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach((e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)})),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t}))}stopObservingElement(e){const t=this.elementInfos.filter((t=>t.element===e));for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return wt(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()}))}updateVisibility(){var t,n;const i=this.elementInfos.reduce(((e,t)=>Math.max(e,t.visibilityChangedAt||0)),0),r=!(null!==(n=null===(t=this.adaptiveStreamSettings)||void 0===t?void 0:t.pauseVideoInBackground)&&void 0!==n&&!n)&&this.isInBackground,s=this.elementInfos.some((e=>e.pictureInPicture)),o=this.elementInfos.some((e=>e.visible))&&!r||s;this.lastVisible!==o&&(!o&&Date.now()-i<100?Ri.setTimeout((()=>{this.updateVisibility()}),100):(this.lastVisible=o,this.emit(e.TrackEvent.VisibilityChanged,o,this)))}updateDimensions(){var t,n;let i=0,r=0;const s=this.getPixelDensity();for(const e of this.elementInfos){const t=e.width()*s,n=e.height()*s;t+n>i+r&&(i=t,r=n)}(null===(t=this.lastDimensions)||void 0===t?void 0:t.width)===i&&(null===(n=this.lastDimensions)||void 0===n?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(e.TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;return"screen"===t?Zr():t||(Zr()>2?2:1)}}class Oo{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e;this.isPiP=!0,null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=!1,null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!=t?t:Io(e),this.isPiP=Gr()&&document.pictureInPictureElement===e,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=Io(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,os().observe(this.element),rs().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var e,t;null===(e=os())||void 0===e||e.unobserve(this.element),null===(t=rs())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function Io(e){let t=e.offsetTop,n=e.offsetLeft;const i=e.offsetWidth,r=e.offsetHeight,{hidden:s}=e,{opacity:o,display:a}=getComputedStyle(e);for(;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,n+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&n<window.pageXOffset+window.innerWidth&&t+r>window.pageYOffset&&n+i>window.pageXOffset&&!s&&(""===o||parseFloat(o)>0)&&"none"!==a}class No extends qt.EventEmitter{constructor(t,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=et.NONE,this.log=l,this.handleMuted=()=>{this.emit(e.TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(e.TrackEvent.Unmuted)},this.log=u(null!==(s=null==r?void 0:r.loggerName)&&void 0!==s?s:a.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=n,this.trackName=i,this.source=wr.Source.Unknown}setTrack(t){this.track&&(this.track.off(e.TrackEvent.Muted,this.handleMuted),this.track.off(e.TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(e.TrackEvent.Muted,this.handleMuted),t.on(e.TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Mr(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==et.NONE}get audioTrack(){if(this.track instanceof ao||this.track instanceof Ro)return this.track}get videoTrack(){if(this.track instanceof Co||this.track instanceof xo)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=wr.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===wr.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(No||(No={}));class _o extends No{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(t,n,i,r){super(t,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(e.TrackEvent.Ended)},this.updateInfo(n),this.setTrack(i)}setTrack(t){this.track&&this.track.off(e.TrackEvent.Ended,this.handleTrackEnded),super.setTrack(t),t&&t.on(e.TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){var e;return wt(this,void 0,void 0,(function*(){return null===(e=this.track)||void 0===e?void 0:e.mute()}))}unmute(){var e;return wt(this,void 0,void 0,(function*(){return null===(e=this.track)||void 0===e?void 0:e.unmute()}))}pauseUpstream(){var e;return wt(this,void 0,void 0,(function*(){yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()}))}resumeUpstream(){var e;return wt(this,void 0,void 0,(function*(){yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()}))}}e.ConnectionQuality=void 0,function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(e.ConnectionQuality||(e.ConnectionQuality={}));class Do extends qt.EventEmitter{get logContext(){var e,t;return Object.assign(Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e)),{participantSid:this.sid,participantId:this.identity})}get isEncrypted(){return this.tracks.size>0&&Array.from(this.tracks.values()).every((e=>e.isEncrypted))}get isAgent(){var e,t;return null!==(t=null===(e=this.permissions)||void 0===e?void 0:e.agent)&&void 0!==t&&t}constructor(t,n,i,r,s){var o;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=e.ConnectionQuality.Unknown,this.log=l,this.log=u(null!==(o=null==s?void 0:s.loggerName)&&void 0!==o?o:a.Participant),this.loggerOptions=s,this.setMaxListeners(100),this.sid=t,this.identity=n,this.name=i,this.metadata=r,this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map}getTracks(){return Array.from(this.tracks.values())}getTrack(e){for(const[,t]of this.tracks)if(t.source===e)return t}getTrackByName(e){for(const[,t]of this.tracks)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrack(wr.Source.Camera);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrack(wr.Source.Microphone);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrack(wr.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(t){const n=this.metadata!==t,i=this.metadata;this.metadata=t,n&&this.emit(e.ParticipantEvent.ParticipantMetadataChanged,i)}_setName(t){const n=this.name!==t;this.name=t,n&&this.emit(e.ParticipantEvent.ParticipantNameChanged,t)}setPermissions(t){var n,i,r,s,o;const a=this.permissions,c=t.canPublish!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublish)||t.canSubscribe!==(null===(i=this.permissions)||void 0===i?void 0:i.canSubscribe)||t.canPublishData!==(null===(r=this.permissions)||void 0===r?void 0:r.canPublishData)||t.hidden!==(null===(s=this.permissions)||void 0===s?void 0:s.hidden)||t.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some(((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])}));return this.permissions=t,c&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,a),c}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(e.ParticipantEvent.IsSpeakingChanged,t))}setConnectionQuality(t){const n=this._connectionQuality;this._connectionQuality=function(t){switch(t){case Je.EXCELLENT:return e.ConnectionQuality.Excellent;case Je.GOOD:return e.ConnectionQuality.Good;case Je.POOR:return e.ConnectionQuality.Poor;case Je.LOST:return e.ConnectionQuality.Lost;default:return e.ConnectionQuality.Unknown}}(t),n!==this._connectionQuality&&this.emit(e.ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTracks.forEach((t=>(t.track instanceof Ro||t.track instanceof ao)&&t.track.setAudioContext(e)))}addTrackPublication(t){t.on(e.TrackEvent.Muted,(()=>{this.emit(e.ParticipantEvent.TrackMuted,t)})),t.on(e.TrackEvent.Unmuted,(()=>{this.emit(e.ParticipantEvent.TrackUnmuted,t)}));const n=t;switch(n.track&&(n.track.sid=t.trackSid),this.tracks.set(t.trackSid,t),t.kind){case wr.Kind.Audio:this.audioTracks.set(t.trackSid,t);break;case wr.Kind.Video:this.videoTracks.set(t.trackSid,t)}}}class Mo extends No{constructor(t,n,i,r){super(t,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=e.VideoQuality.HIGH,this.handleEnded=t=>{this.setTrack(void 0),this.emit(e.TrackEvent.Ended,t)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.disabled=!e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensions=e,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const r=new $i({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ht({participantSid:"",trackSids:[this.trackSid]})]});this.emit(e.TrackEvent.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return!1===this.subscribed?No.SubscriptionStatus.Unsubscribed:super.isSubscribed?No.SubscriptionStatus.Subscribed:No.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?No.PermissionStatus.Allowed:No.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return!this.disabled}setEnabled(e){this.isManualOperationAllowed()&&this.disabled!==!e&&(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.currentVideoQuality!==e&&(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(this.track instanceof xo&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof xo&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(t){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==t&&(r&&(r.off(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),r.off(e.TrackEvent.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(e.TrackEvent.Unsubscribed,r)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(e.TrackEvent.Ended,this.handleEnded),this.emit(e.TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(t){this.emit(e.TrackEvent.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const n=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):n!==t.muted&&this.emit(t.muted?e.TrackEvent.Muted:e.TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(t){const n=this.subscriptionStatus;t!==n&&this.emit(e.TrackEvent.SubscriptionStatusChanged,n,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(e.TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.kind===wr.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof xo&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new Xi({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=Math.ceil(this.videoDimensions.width),t.height=Math.ceil(this.videoDimensions.height)):void 0!==this.currentVideoQuality?t.quality=this.currentVideoQuality:t.quality=e.VideoQuality.HIGH,this.emit(e.TrackEvent.UpdateSettings,t)}}class Lo extends Do{static fromParticipantInfo(e,t){return new Lo(e,t.sid,t.identity,t.name,t.metadata)}constructor(e,t,n,i,r,s){super(t,n||"",i,r,s),this.signalClient=e,this.tracks=new Map,this.audioTracks=new Map,this.videoTracks=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(e.TrackEvent.UpdateSettings,(e=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),Mr(t))),this.signalClient.sendUpdateTrackSettings(e)})),t.on(e.TrackEvent.UpdateSubscription,(e=>{e.participantTracks.forEach((e=>{e.participantSid=this.sid})),this.signalClient.sendUpdateSubscription(e)})),t.on(e.TrackEvent.SubscriptionPermissionChanged,(n=>{this.emit(e.ParticipantEvent.TrackSubscriptionPermissionChanged,t,n)})),t.on(e.TrackEvent.SubscriptionStatusChanged,(n=>{this.emit(e.ParticipantEvent.TrackSubscriptionStatusChanged,t,n)})),t.on(e.TrackEvent.Subscribed,(n=>{this.emit(e.ParticipantEvent.TrackSubscribed,n,t)})),t.on(e.TrackEvent.Unsubscribed,(n=>{this.emit(e.ParticipantEvent.TrackUnsubscribed,n,t)})),t.on(e.TrackEvent.SubscriptionFailed,(n=>{this.emit(e.ParticipantEvent.TrackSubscriptionFailed,t.trackSid,n)}))}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wr.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrack(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wr.Source.Microphone;const t=this.getTrack(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(t,n,i,r,s,o){let a,c=this.getTrackPublication(n);return c||n.startsWith("TR")||this.tracks.forEach((e=>{c||t.kind!==e.kind.toString()||(c=e)})),c?"ended"===t.readyState?(this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Mr(c))),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):(a="video"===t.kind?new xo(t,n,r,s):new Ro(t,n,r,this.audioContext,this.audioOutput),a.source=c.source,a.isMuted=c.isMuted,a.setMediaStream(i),a.start(),c.setTrack(a),this.volumeMap.has(c.source)&&a instanceof Ro&&a.setVolume(this.volumeMap.get(c.source)),c):0===o?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):(void 0===o&&(o=20),void setTimeout((()=>{this.addSubscribedMediaTrack(t,n,i,r,s,o-1)}),150))}get hasMetadata(){return!!this.participantInfo}getTrackPublication(e){return this.tracks.get(e)}updateInfo(t){if(!super.updateInfo(t))return!1;const n=new Map,i=new Map;return t.tracks.forEach((e=>{var t,r;let s=this.getTrackPublication(e.sid);if(s)s.updateInfo(e);else{const n=wr.kindFromProto(e.type);if(!n)return;s=new Mo(n,e,null===(t=this.signalClient.connectOptions)||void 0===t?void 0:t.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),s.updateInfo(e),i.set(e.sid,s);const o=Array.from(this.tracks.values()).find((e=>e.source===(null==s?void 0:s.source)));o&&s.source!==wr.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(s.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Mr(o),newTrack:Mr(s)})),this.addTrackPublication(s)}n.set(e.sid,s)})),this.tracks.forEach((e=>{n.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Mr(e))),this.unpublishTrack(e.trackSid,!0))})),i.forEach((t=>{this.emit(e.ParticipantEvent.TrackPublished,t)})),!0}unpublishTrack(t,n){const i=this.tracks.get(t);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.tracks.delete(t),i.kind){case wr.Kind.Audio:this.audioTracks.delete(t);break;case wr.Kind.Video:this.videoTracks.delete(t)}n&&this.emit(e.ParticipantEvent.TrackUnpublished,i)}setAudioOutput(e){return wt(this,void 0,void 0,(function*(){this.audioOutput=e;const t=[];this.audioTracks.forEach((n=>{var i;n.track instanceof Ro&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))})),yield Promise.all(t)}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}class Ao extends Do{constructor(e,t,n,i){super(e,t,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=et.NONE,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new ds)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t;this.reconnectFuture&&(this.reconnectFuture.promise.catch((e=>this.log.warn(e.message,this.logContext))),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map((e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new hr({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e))))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Mr(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Mr(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Mr(e))),this.onTrackMuted(e,e.isMuted)},this.handleSubscribedQualityUpdate=e=>wt(this,void 0,void 0,(function*(){var t,n,i,r,s,o;if(!(null===(s=this.roomOptions)||void 0===s?void 0:s.dynacast))return;const a=this.videoTracks.get(e.trackSid);if(a)if(e.subscribedCodecs.length>0){if(!a.videoTrack)return;const s=yield a.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,u=Pt(s);!(t=(c=yield u.next()).done);l=!0){r=c.value,l=!1;const e=r;Ni(e)&&(this.log.debug("publish ".concat(e," for ").concat(a.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Mr(a))),yield this.publishAdditionalCodecForTrack(a.videoTrack,e,a.options))}}catch(e){n={error:e}}finally{try{l||t||!(i=u.return)||(yield i.call(u))}finally{if(n)throw n.error}}}else e.subscribedQualities.length>0&&(yield null===(o=a.videoTrack)||void 0===o?void 0:o.setPublishingLayers(e.subscribedQualities));else this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))})),this.handleLocalTrackUnpublished=e=>{const t=this.tracks.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>wt(this,void 0,void 0,(function*(){if(e.source===wr.Source.ScreenShare||e.source===wr.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Mr(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(e instanceof ao||e instanceof Co)try{if(Gr())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===wr.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),Mr(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(e){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Mr(e))),yield e.restartTrack())}catch(t){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Mr(e))),yield e.mute()}})),this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==et.NONE}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setupEngine(t){this.engine=t,this.engine.on(e.EngineEvent.RemoteMute,((e,t)=>{const n=this.tracks.get(e);n&&n.track&&(t?n.mute():n.unmute())})),this.engine.on(e.EngineEvent.Connected,this.handleReconnected).on(e.EngineEvent.SignalRestarted,this.handleReconnected).on(e.EngineEvent.SignalResumed,this.handleReconnected).on(e.EngineEvent.Restarting,this.handleReconnecting).on(e.EngineEvent.Resuming,this.handleReconnecting).on(e.EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(e.EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(e.EngineEvent.Disconnected,this.handleDisconnected)}setMetadata(e){var t;this.engine.client.sendUpdateLocalMetadata(e,null!==(t=this.name)&&void 0!==t?t:"")}setName(e){var t;this.engine.client.sendUpdateLocalMetadata(null!==(t=this.metadata)&&void 0!==t?t:"",e)}setCameraEnabled(e,t,n){return this.setTrackEnabled(wr.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(wr.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(wr.Source.ScreenShare,e,t,n)}setPermissions(t){const n=this.permissions,i=super.setPermissions(t);return i&&n&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return wt(this,void 0,void 0,(function*(){this.encryptionType=e?et.GCM:et.NONE,yield this.republishAllTracks(void 0,!1)}))}setTrackEnabled(t,n,i,r){var s,o;return wt(this,void 0,void 0,(function*(){this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:n}));let a=this.getTrack(t);if(n)if(a)yield a.unmute();else{let n;if(this.pendingPublishing.has(t))return void this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:t}));this.pendingPublishing.add(t);try{switch(t){case wr.Source.Camera:n=yield this.createTracks({video:null===(s=i)||void 0===s||s});break;case wr.Source.Microphone:n=yield this.createTracks({audio:null===(o=i)||void 0===o||o});break;case wr.Source.ScreenShare:n=yield this.createScreenTracks(Object.assign({},i));break;default:throw new gi(t)}const e=[];for(const t of n)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Mr(t))),e.push(this.publishTrack(t,r));const c=yield Promise.all(e);[a]=c}catch(t){throw null==n||n.forEach((e=>{e.stop()})),t instanceof Error&&!(t instanceof gi)&&this.emit(e.ParticipantEvent.MediaDevicesError,t),t}finally{this.pendingPublishing.delete(t)}}else if(a&&a.track)if(t===wr.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const e=this.getTrack(wr.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield a.mute();return a}))}enableCameraAndMicrophone(){return wt(this,void 0,void 0,(function*(){if(!this.pendingPublishing.has(wr.Source.Camera)&&!this.pendingPublishing.has(wr.Source.Microphone)){this.pendingPublishing.add(wr.Source.Camera),this.pendingPublishing.add(wr.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map((e=>this.publishTrack(e))))}finally{this.pendingPublishing.delete(wr.Source.Camera),this.pendingPublishing.delete(wr.Source.Microphone)}}}))}createTracks(t){var n,i;return wt(this,void 0,void 0,(function*(){const r=Or(Rr(t,null===(n=this.roomOptions)||void 0===n?void 0:n.audioCaptureDefaults,null===(i=this.roomOptions)||void 0===i?void 0:i.videoCaptureDefaults));let s;try{s=yield navigator.mediaDevices.getUserMedia(r)}catch(e){throw e instanceof Error&&(r.audio&&(this.microphoneError=e),r.video&&(this.cameraError=e)),e}return r.audio&&(this.microphoneError=void 0,this.emit(e.ParticipantEvent.AudioStreamAcquired)),r.video&&(this.cameraError=void 0),s.getTracks().map((e=>{const n="audio"===e.kind;let i;n?t.audio:t.video;const o=n?r.audio:r.video;"boolean"!=typeof o&&(i=o);const a=co(e,i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return a.kind===wr.Kind.Video?a.source=wr.Source.Camera:a.kind===wr.Kind.Audio&&(a.source=wr.Source.Microphone),a.mediaStream=s,a}))}))}createScreenTracks(t){return wt(this,void 0,void 0,(function*(){if(void 0===t&&(t={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new fi("getDisplayMedia not supported");void 0!==t.resolution||Kr()||(t.resolution=Li.h1080fps30.resolution);const n=Nr(t),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(0===r.length)throw new gi("no video track found");const s=new Co(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=wr.Source.ScreenShare,t.contentHint&&(s.mediaStreamTrack.contentHint=t.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(e.ParticipantEvent.AudioStreamAcquired);const t=new ao(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});t.source=wr.Source.ScreenShareAudio,o.push(t)}return o}))}publishTrack(e,t){var n,i,r,s;return wt(this,void 0,void 0,(function*(){let o,a;if(yield null===(n=this.reconnectFuture)||void 0===n?void 0:n.promise,e instanceof vs&&this.pendingPublishPromises.has(e)&&(yield this.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)o=e.getConstraints();else{let t;switch(o=e.constraints,e.source){case wr.Source.Microphone:t="audioinput";break;case wr.Source.Camera:t="videoinput"}t&&this.activeDeviceMap.has(t)&&(o=Object.assign(Object.assign({},o),{deviceId:this.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new ao(e,o,!0,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;case"video":e=new Co(e,o,!0,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;default:throw new gi("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(e instanceof ao&&e.setAudioContext(this.audioContext),this.tracks.forEach((t=>{t.track&&t.track===e&&(a=t)})),a)return this.log.warn("track has already been published, skipping",Object.assign(Object.assign({},this.logContext),Mr(a))),a;const c="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,l=null!==(i=null==t?void 0:t.forceStereo)&&void 0!==i?i:c;l&&(t||(t={}),void 0===t.dtx&&this.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},this.logContext),Mr(e))),void 0===t.red&&this.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(r=t.dtx)&&void 0!==r||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),t);Wr()&&this.roomOptions.e2ee&&(this.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari",Object.assign({},this.logContext)),u.simulcast=!1),u.source&&(e.source=u.source);const d=this.publish(e,u,l);this.pendingPublishPromises.set(e,d);try{return yield d}catch(e){throw e}finally{this.pendingPublishPromises.delete(e)}}))}publish(t,n,i){var r,s,o,a,c,l,u,d,h,p,m,f,g;return wt(this,void 0,void 0,(function*(){Array.from(this.tracks.values()).find((e=>t instanceof vs&&e.source===t.source))&&t.source!==wr.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),Mr(t))),n.stopMicTrackOnMute&&t instanceof ao&&(t.stopOnMute=!0),t.source===wr.Source.ScreenShare&&zr()&&(n.simulcast=!1),"av1"!==n.videoCodec||Fr()||(n.videoCodec=void 0),"vp9"!==n.videoCodec||Br()||(n.videoCodec=void 0),void 0===n.videoCodec&&(n.videoCodec=zs);const v=n.videoCodec;t.on(e.TrackEvent.Muted,this.onTrackMuted),t.on(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.on(e.TrackEvent.Ended,this.handleTrackEnded),t.on(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed);const y=new Vi({cid:t.mediaStreamTrack.id,name:n.name,type:wr.kindToProto(t.kind),muted:t.isMuted,source:wr.sourceToProto(t.source),disableDtx:!(null===(r=n.dtx)||void 0===r||r),encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(null===(s=n.red)||void 0===s||s),stream:null==n?void 0:n.stream});let b;if(t.kind===wr.Kind.Video){let e={width:0,height:0};try{e=yield t.waitForDimensions()}catch(n){const r=null!==(a=null===(o=this.roomOptions.videoCaptureDefaults)||void 0===o?void 0:o.resolution)&&void 0!==a?a:Di.h720.resolution;e={width:r.width,height:r.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Mr(t)),{dims:e}))}y.width=e.width,y.height=e.height,t instanceof Co&&(Jr(v)&&(t.source===wr.Source.ScreenShare&&"vp9"===v&&(n.scalabilityMode="L1T3"),n.scalabilityMode=null!==(c=n.scalabilityMode)&&void 0!==c?c:"L3T3_KEY"),y.simulcastCodecs=[new Ji({codec:v,cid:t.mediaStreamTrack.id})],!0===n.backupCodec&&(n.backupCodec={codec:zs}),n.backupCodec&&v!==n.backupCodec.codec&&y.encryption===et.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),y.simulcastCodecs.push(new Ji({codec:n.backupCodec.codec,cid:""})))),b=vo(t.source===wr.Source.ScreenShare,y.width,y.height,n),y.layers=Eo(y.width,y.height,b,Jr(n.videoCodec))}else t.kind===wr.Kind.Audio&&(b=[{maxBitrate:null!==(u=null===(l=n.audioPreset)||void 0===l?void 0:l.maxBitrate)&&void 0!==u?u:n.audioBitrate,priority:null!==(h=null===(d=n.audioPreset)||void 0===d?void 0:d.priority)&&void 0!==h?h:"high",networkPriority:null!==(m=null===(p=n.audioPreset)||void 0===p?void 0:p.priority)&&void 0!==m?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new yi("cannot publish track when not connected");const k=yield this.engine.addTrack(y);let S;if(k.codecs.forEach((e=>{void 0===S&&(S=e.mimeType)})),S&&t.kind===wr.Kind.Video){const e=_r(S);e!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Mr(t)),{codec:e})),n.videoCodec=e,b=vo(t.source===wr.Source.ScreenShare,y.width,y.height,n))}const C=new _o(t.kind,k,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(C.options=n,t.sid=k.sid,!this.engine.pcManager)throw new yi("pcManager is not ready");if(this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:k})),t.sender=yield this.engine.createSender(t,n,b),b)if(zr()&&t.kind===wr.Kind.Audio){let e;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===t.sender){e=n;break}e&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:e,codec:"opus",maxbr:(null===(f=b[0])||void 0===f?void 0:f.maxBitrate)?b[0].maxBitrate/1e3:0})}else t.codec&&Jr(t.codec)&&(null===(g=b[0])||void 0===g?void 0:g.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:y.cid,codec:t.codec,maxbr:b[0].maxBitrate/1e3});return yield this.engine.negotiate(),t instanceof Co?t.startMonitor(this.engine.client):t instanceof ao&&t.startMonitor(),this.addTrackPublication(C),this.emit(e.ParticipantEvent.LocalTrackPublished,C),C}))}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){var i;return wt(this,void 0,void 0,(function*(){if(this.encryptionType!==et.NONE)return;let r;if(this.tracks.forEach((t=>{t.track&&t.track===e&&(r=t)})),!r)throw new gi("track is not published");if(!(e instanceof Co))throw new gi("track is not a video track");const s=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),o=function(e,t,n){var i,r,s,o;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&l.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const a=e.mediaStreamTrack.getSettings(),c=null!==(i=a.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,u=null!==(s=a.height)&&void 0!==s?s:null===(o=e.dimensions)||void 0===o?void 0:o.height;return vo(e.source===wr.Source.ScreenShare,c,u,n)}(e,t,s);if(!o)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Mr(e)));const a=e.addSimulcastTrack(t,o),c=new Vi({cid:a.mediaStreamTrack.id,type:wr.kindToProto(e.kind),muted:e.isMuted,source:wr.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:s.videoCodec,cid:a.mediaStreamTrack.id}]});if(c.layers=Eo(c.width,c.height,o),!this.engine||this.engine.isClosed)throw new yi("cannot publish track when not connected");const u=yield this.engine.addTrack(c);yield this.engine.createSimulcastSender(e,a,s,o),yield this.engine.negotiate(),this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:o,trackInfo:u}))}))}unpublishTrack(t,n){var i,r;return wt(this,void 0,void 0,(function*(){const s=this.getPublicationForTrack(t),o=s?Mr(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));(t=s.track).off(e.TrackEvent.Muted,this.onTrackMuted),t.off(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.off(e.TrackEvent.Ended,this.handleTrackEnded),t.off(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),void 0===n&&(n=null===(r=null===(i=this.roomOptions)||void 0===i?void 0:i.stopLocalTrackOnUnpublish)||void 0===r||r),n&&t.stop();let a=!1;const c=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Ys.FAILED&&c)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===c&&(e.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),t instanceof Co){for(const[,e]of t.simulcastCodecs)e.sender&&(this.engine.removeTrack(e.sender)&&(a=!0),e.sender=void 0);t.simulcastCodecs.clear()}}catch(e){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:e}))}switch(this.tracks.delete(s.trackSid),s.kind){case wr.Kind.Audio:this.audioTracks.delete(s.trackSid);break;case wr.Kind.Video:this.videoTracks.delete(s.trackSid)}return this.emit(e.ParticipantEvent.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s}))}unpublishTracks(e){return wt(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>this.unpublishTrack(e))))).filter((e=>e instanceof _o))}))}republishAllTracks(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return wt(this,void 0,void 0,(function*(){const n=[];this.tracks.forEach((t=>{t.track&&(e&&(t.options=Object.assign(Object.assign({},t.options),e)),n.push(t))})),yield Promise.all(n.map((e=>wt(this,void 0,void 0,(function*(){const n=e.track;yield this.unpublishTrack(n,!1),t&&!n.isMuted&&n.source!==wr.Source.ScreenShare&&n.source!==wr.Source.ScreenShareAudio&&(n instanceof ao||n instanceof Co)&&!n.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield n.restartTrack()),yield this.publishTrack(n,e.options)})))))}))}publishData(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return wt(this,void 0,void 0,(function*(){const i=Array.isArray(n)?n:null==n?void 0:n.destination,r=[],s=Array.isArray(n)?void 0:n.topic;void 0!==i&&i.forEach((e=>{e instanceof Lo?r.push(e.sid):r.push(e)}));const o=new ct({kind:t,value:{case:"user",value:new dt({participantSid:this.sid,payload:e,destinationSids:r,topic:s})}});yield this.engine.sendDataPacket(o,t)}))}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}updateInfo(e){return e.sid===this.sid&&!!super.updateInfo(e)&&(e.tracks.forEach((e=>{var t,n;const i=this.tracks.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Mr(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}})),!0)}getPublicationForTrack(e){let t;return this.tracks.forEach((n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(i instanceof ao||i instanceof Co)&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))})),t}}var Uo;e.ConnectionState=void 0,(Uo=e.ConnectionState||(e.ConnectionState={})).Disconnected="disconnected",Uo.Connecting="connecting",Uo.Connected="connected",Uo.Reconnecting="reconnecting";const jo=e.ConnectionState;class Fo extends qt.EventEmitter{constructor(t){var n,i,r;super(),n=this,this.state=e.ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=l,this.bufferedEvents=[],this.connect=(t,n,i)=>wt(this,void 0,void 0,(function*(){var r;const s=yield this.disconnectLock.lock();if(this.state===e.ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),s(),Promise.resolve();if(this.connectFuture)return s(),this.connectFuture.promise;this.setAndEmitConnectionState(e.ConnectionState.Connecting),(null===(r=this.regionUrlProvider)||void 0===r?void 0:r.getServerUrl().toString())!==t&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Yr(new URL(t))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new ro(t,n):this.regionUrlProvider.updateToken(n),this.regionUrlProvider.fetchRegionSettings().catch((e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))})));const o=(e,r,a)=>wt(this,void 0,void 0,(function*(){var c;this.abortController&&this.abortController.abort();const l=new AbortController;this.abortController=l,null==s||s();try{yield this.attemptConnection(null!=a?a:t,n,i,l),this.abortController=void 0,e()}catch(t){if(this.regionUrlProvider&&t instanceof mi&&3!==t.reason&&0!==t.reason){let i=null;try{i=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(e){if(e instanceof mi&&(401===e.status||3===e.reason))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void r(e)}i?(this.log.info("Initial connection failed with ConnectionError: ".concat(t.message,". Retrying with another region: ").concat(i),this.logContext),yield o(e,r,i)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),r(t))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),r(t)}})),a=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new ds(((e,t)=>{o(e,t,a)}),(()=>{this.clearConnectionFutures()})),this.connectFuture.promise})),this.connectSignal=(e,t,n,i,r,s)=>wt(this,void 0,void 0,(function*(){var o,a,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,publishOnly:i.publishOnly,adaptiveStream:"object"==typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},s.signal);let u=l.serverInfo;if(u||(u={version:l.serverVersion,region:l.serverRegion}),this.log.debug("connected to Livekit Server ".concat(Object.entries(u).map((e=>{let[t,n]=e;return"".concat(t,": ").concat(n)})).join(", ")),{room:null===(o=l.room)||void 0===o?void 0:o.name,roomSid:null===(a=l.room)||void 0===a?void 0:a.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!l.serverVersion)throw new vi("unknown server version");return"0.15.1"===l.serverVersion&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l})),this.applyJoinResponse=e=>{const t=e.participant;this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room),this.options.e2ee&&this.e2eeManager&&this.e2eeManager.setSifTrailer(e.sifTrailer)},this.attemptConnection=(t,n,i,r)=>wt(this,void 0,void 0,(function*(){var s,o;this.state===e.ConnectionState.Reconnecting?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(s=this.regionUrlProvider)||void 0===s?void 0:s.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Qs),i),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const i=yield this.connectSignal(t,n,this.engine,this.connOptions,this.options,r);this.applyJoinResponse(i),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected)}catch(e){yield this.engine.close(),this.recreateEngine();const n=new mi("could not establish signal connection");throw e instanceof Error&&(n.message="".concat(n.message,": ").concat(e.message)),e instanceof mi&&(n.reason=e.reason,n.status=e.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:e})),n}if(r.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new mi("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,r)}catch(e){throw yield this.engine.close(),this.recreateEngine(),e}Gr()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Gr()&&(document.addEventListener("freeze",this.onPageLeave),null===(o=navigator.mediaDevices)||void 0===o||o.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Connected),this.registerConnectionReconcile()})),this.disconnect=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return wt(n,void 0,void 0,(function*(){var n,i,r,s;const o=yield this.disconnectLock.lock();try{if(this.state===e.ConnectionState.Disconnected)return void this.log.debug("already disconnected",this.logContext);this.log.info("disconnect from room",Object.assign({},this.logContext)),this.state!==e.ConnectionState.Connecting&&this.state!==e.ConnectionState.Reconnecting||(this.log.warn("abort connection attempt",this.logContext),null===(n=this.abortController)||void 0===n||n.abort(),null===(r=null===(i=this.connectFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,new mi("Client initiated disconnect")),this.connectFuture=void 0),(null===(s=this.engine)||void 0===s?void 0:s.client.isDisconnected)||(yield this.engine.client.sendLeave()),this.engine&&(yield this.engine.close()),this.handleDisconnect(t,e.DisconnectReason.CLIENT_INITIATED),this.engine=void 0}finally{o()}}))},this.onPageLeave=()=>wt(this,void 0,void 0,(function*(){yield this.disconnect()})),this.startAudio=()=>wt(this,void 0,void 0,(function*(){const t=[],n=Ti();if(n&&"iOS"===n.os){const n="livekit-dummy-audio-el";let i=document.getElementById(n);if(!i){i=document.createElement("audio"),i.id=n,i.autoplay=!0,i.hidden=!0;const t=us();t.enabled=!0;const r=new MediaStream([t]);i.srcObject=r,document.addEventListener("visibilitychange",(()=>{i&&(i.srcObject=document.hidden?null:r,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))})),document.body.append(i),this.once(e.RoomEvent.Disconnected,(()=>{null==i||i.remove(),i=null}))}t.push(i)}this.participants.forEach((e=>{e.audioTracks.forEach((e=>{e.track&&e.track.attachedElements.forEach((e=>{t.push(e)}))}))}));try{yield Promise.all([this.acquireAudioContext(),...t.map((e=>(e.muted=!1,e.play())))]),this.handleAudioPlaybackStarted()}catch(e){throw this.handleAudioPlaybackFailed(e),e}})),this.startVideo=()=>wt(this,void 0,void 0,(function*(){const e=[];for(const t of this.participants.values())t.videoTracks.forEach((t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach((t=>{e.includes(t)||e.push(t)}))}));yield Promise.all(e.map((e=>e.play()))).then((()=>{this.handleVideoPlaybackStarted()})).catch((e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)}))})),this.handleRestarting=()=>{this.clearConnectionReconcile();for(const e of this.participants.values())this.handleParticipantDisconnected(e.sid,e);this.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&this.emit(e.RoomEvent.Reconnecting)},this.handleSignalRestarted=t=>wt(this,void 0,void 0,(function*(){this.log.debug("signal reconnected to server, region ".concat(t.serverRegion),Object.assign(Object.assign({},this.logContext),{region:t.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(t);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(e){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:e}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:t.serverRegion}))}catch(e){return}this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()})),this.handleParticipantUpdates=e=>{e.forEach((e=>{if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);const t=this.identityToSid.get(e.identity);t&&t!==e.sid&&this.handleParticipantDisconnected(t,this.participants.get(t));let n=this.participants.get(e.sid);const i=!n;e.state===Ze.DISCONNECTED?this.handleParticipantDisconnected(e.sid,n):(n=this.getOrCreateParticipant(e.sid,e),i||n.updateInfo(e))}))},this.handleActiveSpeakersUpdate=t=>{const n=[],i={};t.forEach((e=>{if(i[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),n.push(this.localParticipant);else{const t=this.participants.get(e.sid);t&&(t.audioLevel=e.level,t.setIsSpeaking(!0),n.push(t))}})),i[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.participants.forEach((e=>{i[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))})),this.activeSpeakers=n,this.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,n)},this.handleSpeakersChanged=t=>{const n=new Map;this.activeSpeakers.forEach((e=>{n.set(e.sid,e)})),t.forEach((e=>{let t=this.participants.get(e.sid);e.sid===this.localParticipant.sid&&(t=this.localParticipant),t&&(t.audioLevel=e.level,t.setIsSpeaking(e.active),e.active?n.set(e.sid,t):n.delete(e.sid))}));const i=Array.from(n.values());i.sort(((e,t)=>t.audioLevel-e.audioLevel)),this.activeSpeakers=i,this.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,i)},this.handleStreamStateUpdate=t=>{t.streamStates.forEach((t=>{const n=this.participants.get(t.participantSid);if(!n)return;const i=n.getTrackPublication(t.trackSid);i&&i.track&&(i.track.streamState=wr.streamStateFromProto(t.state),n.emit(e.ParticipantEvent.TrackStreamStateChanged,i,i.track.streamState),this.emitWhenConnected(e.RoomEvent.TrackStreamStateChanged,i,i.track.streamState,n))}))},this.handleSubscriptionPermissionUpdate=e=>{const t=this.participants.get(e.participantSid);if(!t)return;const n=t.getTrackPublication(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.participants.values()).find((t=>t.tracks.has(e.trackSid)));if(!t)return;const n=t.getTrackPublication(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=(t,n)=>{const i=this.participants.get(t.participantSid);this.emit(e.RoomEvent.DataReceived,t.payload,i,n,t.topic),null==i||i.emit(e.ParticipantEvent.DataReceived,t.payload,n)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=t=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:t})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(e.RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(e.RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>wt(this,void 0,void 0,(function*(){this.emit(e.RoomEvent.MediaDevicesChanged)})),this.handleRoomUpdate=t=>{const n=this.roomInfo;this.roomInfo=t,n&&n.metadata!==t.metadata&&this.emitWhenConnected(e.RoomEvent.RoomMetadataChanged,t.metadata),(null==n?void 0:n.activeRecording)!==t.activeRecording&&this.emitWhenConnected(e.RoomEvent.RecordingStatusChanged,t.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach((e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.participants.get(e.participantSid);t&&t.setConnectionQuality(e.quality)}))},this.onLocalParticipantMetadataChanged=t=>{this.emit(e.RoomEvent.ParticipantMetadataChanged,t,this.localParticipant)},this.onLocalParticipantNameChanged=t=>{this.emit(e.RoomEvent.ParticipantNameChanged,t,this.localParticipant)},this.onLocalTrackMuted=t=>{this.emit(e.RoomEvent.TrackMuted,t,this.localParticipant)},this.onLocalTrackUnmuted=t=>{this.emit(e.RoomEvent.TrackUnmuted,t,this.localParticipant)},this.onLocalTrackPublished=t=>wt(this,void 0,void 0,(function*(){var n;this.emit(e.RoomEvent.LocalTrackPublished,t,this.localParticipant),t.track instanceof ao&&(yield t.track.checkForSilence())&&this.emit(e.RoomEvent.LocalAudioSilenceDetected,t);const i=yield null===(n=t.track)||void 0===n?void 0:n.getDeviceId(),r=(s=t.source)===wr.Source.Microphone?"audioinput":s===wr.Source.Camera?"videoinput":void 0;var s;r&&i&&i!==this.localParticipant.activeDeviceMap.get(r)&&(this.localParticipant.activeDeviceMap.set(r,i),this.emit(e.RoomEvent.ActiveDeviceChanged,r,i))})),this.onLocalTrackUnpublished=t=>{this.emit(e.RoomEvent.LocalTrackUnpublished,t,this.localParticipant)},this.onLocalConnectionQualityChanged=t=>{this.emit(e.RoomEvent.ConnectionQualityChanged,t,this.localParticipant)},this.onMediaDevicesError=t=>{this.emit(e.RoomEvent.MediaDevicesError,t)},this.onLocalParticipantPermissionsChanged=t=>{this.emit(e.RoomEvent.ParticipantPermissionsChanged,t,this.localParticipant)},this.setMaxListeners(100),this.participants=new Map,this.identityToSid=new Map,this.options=Object.assign(Object.assign({},Gs),t),this.log=u(null!==(i=this.options.loggerName)&&void 0!==i?i:a.Room),this.options.audioCaptureDefaults=Object.assign(Object.assign({},Ks),null==t?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Hs),null==t?void 0:t.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Ws),null==t?void 0:t.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new hs,this.localParticipant=new Ao("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ps(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ps(this.options.audioCaptureDefaults.deviceId)),(null===(r=this.options.audioOutput)||void 0===r?void 0:r.deviceId)&&this.switchActiveDevice("audiooutput",ps(this.options.audioOutput.deviceId)).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return wt(this,void 0,void 0,(function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)}))}setupE2EE(){var t;this.options.e2ee&&(this.e2eeManager=new ys(this.options.e2ee),this.e2eeManager.on(e.EncryptionEvent.ParticipantEncryptionStatusChanged,((t,n)=>{n instanceof Ao&&(this.isE2EEEnabled=t),this.emit(e.RoomEvent.ParticipantEncryptionStatusChanged,t,n)})),this.e2eeManager.on(e.EncryptionEvent.EncryptionError,(t=>this.emit(e.RoomEvent.EncryptionError,t))),null===(t=this.e2eeManager)||void 0===t||t.setup(this))}get logContext(){return{room:this.name,roomSid:this.sid,identity:this.localParticipant.identity}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}get sid(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.sid)&&void 0!==t?t:""}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new no(this.options),this.engine.on(e.EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(e.EngineEvent.RoomUpdate,this.handleRoomUpdate).on(e.EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(e.EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(e.EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(e.EngineEvent.SubscriptionError,this.handleSubscriptionError).on(e.EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(e.EngineEvent.MediaTrackAdded,((e,t,n)=>{this.onTrackAdded(e,t,n)})).on(e.EngineEvent.Disconnected,(e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)})).on(e.EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(e.EngineEvent.DataPacketReceived,this.handleDataPacket).on(e.EngineEvent.Resuming,(()=>{this.clearConnectionReconcile(),this.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&this.emit(e.RoomEvent.Reconnecting)})).on(e.EngineEvent.Resumed,(()=>{this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Reconnected),this.registerConnectionReconcile(),this.updateSubscriptions(),this.emitBufferedEvents()})).on(e.EngineEvent.SignalResumed,(()=>{this.bufferedEvents=[],this.state===e.ConnectionState.Reconnecting&&this.sendSyncState()})).on(e.EngineEvent.Restarting,this.handleRestarting).on(e.EngineEvent.SignalRestarted,this.handleSignalRestarted).on(e.EngineEvent.DCBufferStatusChanged,((t,n)=>{this.emit(e.RoomEvent.DCBufferStatusChanged,t,n)})),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return gs.getInstance().getDevices(e,t)}prepareConnection(t,n){return wt(this,void 0,void 0,(function*(){if(this.state===e.ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(Yr(new URL(t))&&n){this.regionUrlProvider=new ro(t,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===e.ConnectionState.Disconnected&&(this.regionUrl=i,yield fetch(ms(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(ms(t),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}}))}getParticipantByIdentity(e){if(this.localParticipant.identity===e)return this.localParticipant;const t=this.identityToSid.get(e);return t?this.participants.get(t):void 0}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,n){return wt(this,void 0,void 0,(function*(){let i,r=()=>{};switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new vr({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new vr({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new vr({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new vr({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>wt(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),i=new vr({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>wt(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),i=new vr({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new vr({scenario:{case:"switchCandidateProtocol",value:"force-tls"===t?2:1}}),r=()=>wt(this,void 0,void 0,(function*(){const t=this.engine.client.onLeave;t&&t(new Zi({reason:e.DisconnectReason.CLIENT_INITIATED,canReconnect:!0}))}));break;case"subscriber-bandwidth":if(void 0===n||"number"!=typeof n)throw new Error("subscriber-bandwidth requires a number as argument");i=new vr({scenario:{case:"subscriberBandwidth",value:BigInt(n)}})}i&&(yield this.engine.client.sendSimulateScenario(i),yield r())}))}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveAudioOutputDevice(){var e,t;return null!==(t=null===(e=this.options.audioOutput)||void 0===e?void 0:e.deviceId)&&void 0!==t?t:""}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var r,s,o;return wt(this,void 0,void 0,(function*(){let a=!1,c=!0;const l=i?{exact:n}:n;if("audioinput"===t){const e=this.options.audioCaptureDefaults.deviceId;this.options.audioCaptureDefaults.deviceId=l,a=e!==l;const n=Array.from(this.localParticipant.audioTracks.values()).filter((e=>e.source===wr.Source.Microphone));try{c=(yield Promise.all(n.map((e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(l)})))).every((e=>!0===e))}catch(t){throw this.options.audioCaptureDefaults.deviceId=e,t}}else if("videoinput"===t){const e=this.options.videoCaptureDefaults.deviceId;this.options.videoCaptureDefaults.deviceId=l,a=e!==l;const n=Array.from(this.localParticipant.videoTracks.values()).filter((e=>e.source===wr.Source.Camera));try{c=(yield Promise.all(n.map((e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(l)})))).every((e=>!0===e))}catch(t){throw this.options.videoCaptureDefaults.deviceId=e,t}}else if("audiooutput"===t){if(!Vr()&&!this.options.expWebAudioMix||this.options.expWebAudioMix&&this.audioContext&&!("setSinkId"in this.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");null!==(r=(o=this.options).audioOutput)&&void 0!==r||(o.audioOutput={});const e=this.options.audioOutput.deviceId;this.options.audioOutput.deviceId=n,a=e!==l;try{this.options.expWebAudioMix?null===(s=this.audioContext)||void 0===s||s.setSinkId(n):yield Promise.all(Array.from(this.participants.values()).map((e=>e.setAudioOutput({deviceId:n}))))}catch(t){throw this.options.audioOutput.deviceId=e,t}}return a&&c&&(this.localParticipant.activeDeviceMap.set(t,n),this.emit(e.RoomEvent.ActiveDeviceChanged,t,n)),c}))}setupLocalParticipantEvents(){this.localParticipant.on(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(e.ParticipantEvent.AudioStreamAcquired,this.startAudio).on(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.participants.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,n,i){if(this.state===e.ConnectionState.Connecting||this.state===e.ConnectionState.Reconnecting){const r=()=>{this.onTrackAdded(t,n,i),s()},s=()=>{this.off(e.RoomEvent.Reconnected,r),this.off(e.RoomEvent.Connected,r),this.off(e.RoomEvent.Disconnected,s)};return this.once(e.RoomEvent.Reconnected,r),this.once(e.RoomEvent.Connected,r),void this.once(e.RoomEvent.Disconnected,s)}if(this.state===e.ConnectionState.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);const r=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(n.id),s=r[0];let o=r[1],a=t.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const c=this.participants.get(s);if(!c)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);let l;this.options.adaptiveStream&&(l="object"==typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),c.addSubscribedMediaTrack(t,a,n,i,l)}handleDisconnect(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.bufferedEvents=[],this.state!==e.ConnectionState.Disconnected){this.regionUrl=void 0;try{this.participants.forEach((e=>{e.tracks.forEach((t=>{e.unpublishTrack(t.trackSid)}))})),this.localParticipant.tracks.forEach((e=>{var n,i;e.track&&this.localParticipant.unpublishTrack(e.track,t),t&&(null===(n=e.track)||void 0===n||n.detach(),null===(i=e.track)||void 0===i||i.stop())})),this.localParticipant.off(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(e.ParticipantEvent.AudioStreamAcquired,this.startAudio).off(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.expWebAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Gr()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(i=navigator.mediaDevices)||void 0===i||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(e.ConnectionState.Disconnected),this.emit(e.RoomEvent.Disconnected,n)}}}handleParticipantDisconnected(t,n){this.participants.delete(t),n&&(this.identityToSid.delete(n.identity),n.tracks.forEach((e=>{n.unpublishTrack(e.trackSid,!0)})),this.emit(e.RoomEvent.ParticipantDisconnected,n))}acquireAudioContext(){var t,n;return wt(this,void 0,void 0,(function*(){if("boolean"!=typeof this.options.expWebAudioMix&&this.options.expWebAudioMix.audioContext?this.audioContext=this.options.expWebAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(t=Ir())&&void 0!==t?t:void 0),this.audioContext&&"suspended"===this.audioContext.state)try{yield this.audioContext.resume()}catch(e){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:e}))}this.options.expWebAudioMix&&this.participants.forEach((e=>e.setAudioContext(this.audioContext))),this.localParticipant.setAudioContext(this.audioContext);const i="running"===(null===(n=this.audioContext)||void 0===n?void 0:n.state);i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,i))}))}createParticipant(e,t){var n;let i;return i=t?Lo.fromParticipantInfo(this.engine.client,t):new Lo(this.engine.client,e,"",void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.expWebAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),i}getOrCreateParticipant(t,n){if(this.participants.has(t))return this.participants.get(t);const i=this.createParticipant(t,n);return this.participants.set(t,i),this.identityToSid.set(n.identity,n.sid),this.emitWhenConnected(e.RoomEvent.ParticipantConnected,i),i.on(e.ParticipantEvent.TrackPublished,(t=>{this.emitWhenConnected(e.RoomEvent.TrackPublished,t,i)})).on(e.ParticipantEvent.TrackSubscribed,((t,n)=>{t.kind===wr.Kind.Audio?(t.on(e.TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),t.on(e.TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):t.kind===wr.Kind.Video&&(t.on(e.TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),t.on(e.TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(e.RoomEvent.TrackSubscribed,t,n,i)})).on(e.ParticipantEvent.TrackUnpublished,(t=>{this.emit(e.RoomEvent.TrackUnpublished,t,i)})).on(e.ParticipantEvent.TrackUnsubscribed,((t,n)=>{this.emit(e.RoomEvent.TrackUnsubscribed,t,n,i)})).on(e.ParticipantEvent.TrackSubscriptionFailed,(t=>{this.emit(e.RoomEvent.TrackSubscriptionFailed,t,i)})).on(e.ParticipantEvent.TrackMuted,(t=>{this.emitWhenConnected(e.RoomEvent.TrackMuted,t,i)})).on(e.ParticipantEvent.TrackUnmuted,(t=>{this.emitWhenConnected(e.RoomEvent.TrackUnmuted,t,i)})).on(e.ParticipantEvent.ParticipantMetadataChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ParticipantMetadataChanged,t,i)})).on(e.ParticipantEvent.ParticipantNameChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ParticipantNameChanged,t,i)})).on(e.ParticipantEvent.ConnectionQualityChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ConnectionQualityChanged,t,i)})).on(e.ParticipantEvent.ParticipantPermissionsChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ParticipantPermissionsChanged,t,i)})).on(e.ParticipantEvent.TrackSubscriptionStatusChanged,((t,n)=>{this.emitWhenConnected(e.RoomEvent.TrackSubscriptionStatusChanged,t,n,i)})).on(e.ParticipantEvent.TrackSubscriptionFailed,((t,n)=>{this.emit(e.RoomEvent.TrackSubscriptionFailed,t,i,n)})).on(e.ParticipantEvent.TrackSubscriptionPermissionChanged,((t,n)=>{this.emitWhenConnected(e.RoomEvent.TrackSubscriptionPermissionChanged,t,n,i)})),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.participants.values()).reduce(((e,t)=>(e.push(...t.getTracks()),e)),[]),t=this.localParticipant.getTracks();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.participants.values())for(const t of e.videoTracks.values())t.isSubscribed&&t instanceof Mo&&t.emitTrackUpdate()}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=Ri.setInterval((()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?t=0:(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e.DisconnectReason.STATE_MISMATCH)))}),2e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ri.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t!==this.state&&(this.state=t,this.emit(e.RoomEvent.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach((e=>{let[t,n]=e;this.emit(t,...n)})),this.bufferedEvents=[]}emitWhenConnected(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.state===e.ConnectionState.Connected?this.emit(t,...i):(this.state===e.ConnectionState.Reconnecting&&this.bufferedEvents.push([t,i]),!1)}simulateParticipants(t){var n,i;return wt(this,void 0,void 0,(function*(){const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Ge({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:F.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Xe({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected),this.emit(e.RoomEvent.Connected),this.setAndEmitConnectionState(e.ConnectionState.Connected),r.video){const t=new _o(wr.Kind.Video,new ot({source:Fe.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:je.AUDIO,name:"video-dummy"}),new Co(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:ls(160*(null!==(n=s.aspectRatios[0])&&void 0!==n?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(t),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,t)}if(r.audio){const t=new _o(wr.Kind.Audio,new ot({source:Fe.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:je.AUDIO}),new ao(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:us(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(t),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,t)}for(let e=0;e<s.count-1;e+=1){let t=new Xe({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:Ze.ACTIVE,tracks:[],joinedAt:F.parse(Date.now())});const n=this.getOrCreateParticipant(t.identity,t);if(s.video){const r=ls(160*(null!==(i=s.aspectRatios[e%s.aspectRatios.length])&&void 0!==i?i:1),160,!1,!0),o=new ot({source:Fe.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:je.AUDIO});n.addSubscribedMediaTrack(r,o.sid,new MediaStream([r])),t.tracks=[...t.tracks,o]}if(s.audio){const e=us(),i=new ot({source:Fe.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:je.AUDIO});n.addSubscribedMediaTrack(e,i.sid,new MediaStream([e])),t.tracks=[...t.tracks,i]}n.updateInfo(t)}}))}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(t!==e.RoomEvent.ActiveSpeakersChanged){const e=Bo(i).filter((e=>void 0!==e));this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:e}))}return super.emit(t,...i)}}function Bo(e){return e.map((e=>{if(e)return Array.isArray(e)?Bo(e):"object"==typeof e?"logContext"in e&&e.logContext:e}))}var Jo;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(Jo||(Jo={}));class Vo extends qt.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.status=Jo.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Fo(n.roomOptions),this.connectOptions=n.connectOptions,n.errorsAsWarnings&&(this.errorsAsWarnings=n.errorsAsWarnings)}run(e){return wt(this,void 0,void 0,(function*(){if(this.status!==Jo.IDLE)throw Error("check is running already");this.setStatus(Jo.RUNNING);try{yield this.perform()}catch(e){e instanceof Error&&(this.errorsAsWarnings?this.appendWarning(e.message):this.appendError(e.message))}return yield this.disconnect(),yield new Promise((e=>setTimeout(e,500))),this.status!==Jo.SKIPPED&&this.setStatus(this.isSuccess()?Jo.SUCCESS:Jo.FAILED),e&&e(),this.getInfo()}))}isSuccess(){return!this.logs.some((e=>"error"===e.level))}connect(){return wt(this,void 0,void 0,(function*(){return this.room.state===e.ConnectionState.Connected||(yield this.room.connect(this.url,this.token)),this.room}))}disconnect(){return wt(this,void 0,void 0,(function*(){this.room&&this.room.state!==e.ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise((e=>setTimeout(e,500))))}))}skip(){this.setStatus(Jo.SKIPPED)}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return null===(e=this.room)||void 0===e?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function qo(e){var t,n;return wt(this,void 0,void 0,(function*(){null!=e||(e={}),null!==(t=e.audio)&&void 0!==t||(e.audio=!0),null!==(n=e.video)&&void 0!==n||(e.video=!0);const i=Or(Rr(e,Ks,Hs)),r=navigator.mediaDevices.getUserMedia(i);e.audio&&(gs.userMediaPromiseMap.set("audioinput",r),r.catch((()=>gs.userMediaPromiseMap.delete("audioinput")))),e.video&&(gs.userMediaPromiseMap.set("videoinput",r),r.catch((()=>gs.userMediaPromiseMap.delete("videoinput"))));const s=yield r;return s.getTracks().map((t=>{const n="audio"===t.kind;let r;n?e.audio:e.video;const o=n?i.audio:i.video;"boolean"!=typeof o&&(r=o),r?r.deviceId=t.getSettings().deviceId:r={deviceId:t.getSettings().deviceId};const a=co(t,r);return a.kind===wr.Kind.Video?a.source=wr.Source.Camera:a.kind===wr.Kind.Audio&&(a.source=wr.Source.Microphone),a.mediaStream=s,a}))}))}function zo(e){return wt(this,void 0,void 0,(function*(){return(yield qo({audio:!1,video:e}))[0]}))}function Wo(e){return wt(this,void 0,void 0,(function*(){return(yield qo({audio:e,video:!1}))[0]}))}class Ko extends Vo{get description(){return"Can publish audio"}perform(){var e;return wt(this,void 0,void 0,(function*(){const t=yield this.connect(),n=yield Wo();t.localParticipant.publishTrack(n),yield new Promise((e=>setTimeout(e,3e3)));const i=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let r=0;if(i.forEach((e=>{"outbound-rtp"===e.type&&"audio"===e.mediaType&&(r=e.packetsSent)})),0===r)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," audio packets"))}))}}class Ho extends Vo{get description(){return"Can publish video"}perform(){var e;return wt(this,void 0,void 0,(function*(){const t=yield this.connect(),n=yield zo();t.localParticipant.publishTrack(n),yield new Promise((e=>setTimeout(e,3e3)));const i=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let r=0;if(i.forEach((e=>{"outbound-rtp"===e.type&&"video"===e.mediaType&&(r=e.packetsSent)})),0===r)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," video packets"))}))}}class Go extends Vo{get description(){return"Resuming connection after interruption"}perform(){var t;return wt(this,void 0,void 0,(function*(){const n=yield this.connect();let i,r=!1,s=!1;const o=new Promise((e=>{setTimeout(e,5e3),i=e}));n.on(e.RoomEvent.Reconnecting,(()=>{r=!0})).on(e.RoomEvent.Reconnected,(()=>{s=!0,i(!0)})),null===(t=n.engine.client.ws)||void 0===t||t.close();const a=n.engine.client.onClose;if(a&&a(""),yield o,!r)throw new Error("Did not attempt to reconnect");if(!s||n.state!==e.ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}))}}class Qo extends Vo{get description(){return"Can connect via TURN"}perform(){var e,t;return wt(this,void 0,void 0,(function*(){const n=new Ts,i=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let r=!1,s=!1,o=!1;for(let e of i.iceServers)for(let t of e.urls)t.startsWith("turn:")?(s=!0,o=!0):t.startsWith("turns:")&&(s=!0,o=!0,r=!0),t.startsWith("stun:")&&(o=!0);o?s&&!r&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield n.close(),(null===(t=null===(e=this.connectOptions)||void 0===e?void 0:e.rtcConfig)||void 0===t?void 0:t.iceServers)||s?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise((e=>setTimeout(e,0))))}))}}class Yo extends Vo{get description(){return"Establishing WebRTC connection"}perform(){return wt(this,void 0,void 0,(function*(){let t=!1,n=!1;this.room.on(e.RoomEvent.SignalConnected,(()=>{const e=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(i,r)=>{if(i.candidate){const e=new RTCIceCandidate(i);let r="".concat(e.protocol," ").concat(e.address,":").concat(e.port," ").concat(e.type);e.address&&(function(e){const t=e.split(".");if(4===t.length){if("10"===t[0])return!0;if("192"===t[0]&&"168"===t[1])return!0;if("172"===t[0]){const e=parseInt(t[1],10);if(e>=16&&e<=31)return!0}}return!1}(e.address)?r+=" (private)":"tcp"===e.protocol&&"passive"===e.tcpType?(t=!0,r+=" (passive)"):"udp"===e.protocol&&(n=!0)),this.appendMessage(r)}e&&e(i,r)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=e=>{e instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(e.errorCode," ").concat(e.errorText," ").concat(e.url))})}));try{yield this.connect(),l.info("now the room is connected")}catch(e){throw this.appendWarning("ports need to be open on firewall in order to connect."),e}t||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")}))}}class $o extends Vo{get description(){return"Connecting to signal connection via WebSocket"}perform(){var e,t,n;return wt(this,void 0,void 0,(function*(){(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new Ts;const r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(r.serverVersion,".")),(null===(e=r.serverInfo)||void 0===e?void 0:e.edition)===nt.Cloud&&(null===(t=r.serverInfo)||void 0===t?void 0:t.region)&&this.appendMessage("LiveKit Cloud: ".concat(null===(n=r.serverInfo)||void 0===n?void 0:n.region)),yield i.close()}))}}class Xo extends qt.EventEmitter{constructor(e,t){super(),this.checkResults=new Map,this.url=e,this.token=t}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Jo.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every((e=>e.status!==Jo.FAILED))}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return wt(this,void 0,void 0,(function*(){const t=this.getNextCheckId(),n=new e(this.url,this.token),i=e=>{this.updateCheck(t,e)};n.on("update",i);const r=yield n.run();return n.off("update",i),r}))}checkWebsocket(){return wt(this,void 0,void 0,(function*(){return this.createAndRunCheck($o)}))}checkWebRTC(){return wt(this,void 0,void 0,(function*(){return this.createAndRunCheck(Yo)}))}checkTURN(){return wt(this,void 0,void 0,(function*(){return this.createAndRunCheck(Qo)}))}checkReconnect(){return wt(this,void 0,void 0,(function*(){return this.createAndRunCheck(Go)}))}checkPublishAudio(){return wt(this,void 0,void 0,(function*(){return this.createAndRunCheck(Ko)}))}checkPublishVideo(){return wt(this,void 0,void 0,(function*(){return this.createAndRunCheck(Ho)}))}}const Zo=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),ea=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function ta(e){var t;const n=e.trim().toLowerCase();if(""!==n)return Zo.has(n)?Zo.get(n):null===(t=Array.from(ea.entries()).find((e=>{let[t]=e;return n.includes(t)})))||void 0===t?void 0:t[1]}e.BaseKeyProvider=hi,e.ConnectionCheck=Xo,e.ConnectionError=mi,e.CriticalTimers=Ri,e.DefaultReconnectPolicy=Tt,e.DeviceUnsupportedError=fi,e.ExternalE2EEKeyProvider=class extends hi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1}))}setKey(e){return wt(this,void 0,void 0,(function*(){const t="string"==typeof e?yield li(e):yield ui(e);this.onSetEncryptionKey(t)}))}},e.LivekitError=pi,e.LocalAudioTrack=ao,e.LocalParticipant=Ao,e.LocalTrack=vs,e.LocalTrackPublication=_o,e.LocalVideoTrack=Co,e.NegotiationError=bi,e.Participant=Do,e.PublishDataError=class extends pi{constructor(e){super(13,null!=e?e:"unable to publish data")}},e.RemoteAudioTrack=Ro,e.RemoteParticipant=Lo,e.RemoteTrack=Po,e.RemoteTrackPublication=Mo,e.RemoteVideoTrack=xo,e.Room=Fo,e.RoomState=jo,e.ScreenSharePresets=Li,e.Track=wr,e.TrackInvalidError=gi,e.TrackPublication=No,e.UnexpectedConnectionState=yi,e.UnsupportedServer=vi,e.VideoPreset=xi,e.VideoPresets=Di,e.VideoPresets43=Mi,e.attachToElement=Er,e.createAudioAnalyser=function(e,t){const n=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},t),i=Ir();if(!i)throw new Error("Audio Context not supported on this browser");const r=n.cloneTrack?e.mediaStreamTrack.clone():e.mediaStreamTrack,s=i.createMediaStreamSource(new MediaStream([r])),o=i.createAnalyser();o.minDecibels=n.minDecibels,o.maxDecibels=n.maxDecibels,o.fftSize=n.fftSize,o.smoothingTimeConstant=n.smoothingTimeConstant,s.connect(o);const a=new Uint8Array(o.frequencyBinCount);return{calculateVolume:()=>{o.getByteFrequencyData(a);let e=0;for(const t of a)e+=Math.pow(t/255,2);return Math.sqrt(e/a.length)},analyser:o,cleanup:()=>wt(this,void 0,void 0,(function*(){yield i.close(),n.cloneTrack&&r.stop()}))}},e.createE2EEKey=function(){return window.crypto.getRandomValues(new Uint8Array(32))},e.createKeyMaterialFromBuffer=ui,e.createKeyMaterialFromString=li,e.createLocalAudioTrack=Wo,e.createLocalScreenTracks=function(e){return wt(this,void 0,void 0,(function*(){if(void 0===e&&(e={}),void 0!==e.resolution||Kr()||(e.resolution=Li.h1080fps30.resolution),void 0===navigator.mediaDevices.getDisplayMedia)throw new fi("getDisplayMedia not supported");const t=Nr(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new gi("no video track found");const r=new Co(i[0],void 0,!1);r.source=wr.Source.ScreenShare;const s=[r];if(n.getAudioTracks().length>0){const e=new ao(n.getAudioTracks()[0],void 0,!1);e.source=wr.Source.ScreenShareAudio,s.push(e)}return s}))},e.createLocalTracks=qo,e.createLocalVideoTrack=zo,e.deriveKeys=function(e,t){return wt(this,void 0,void 0,(function*(){const n=di(e.algorithm.name,t),i=yield crypto.subtle.deriveKey(n,e,{name:Yn,length:128},!1,["encrypt","decrypt"]);return{material:e,encryptionKey:i}}))},e.detachTrack=Pr,e.facingModeFromDeviceLabel=ta,e.facingModeFromLocalTrack=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const i=e instanceof vs?e.mediaStreamTrack:e,r=i.getSettings();let s={facingMode:null!==(n=t.defaultFacingMode)&&void 0!==n?n:"user",confidence:"low"};if("facingMode"in r){const e=r.facingMode;l.debug("rawFacingMode",{rawFacingMode:e}),e&&"string"==typeof e&&function(e){return void 0===e||["user","environment","left","right"].includes(e)}(e)&&(s={facingMode:e,confidence:"high"})}if(["low","medium"].includes(s.confidence)){l.debug("Try to get facing mode from device label: (".concat(i.label,")"));const e=ta(i.label);void 0!==e&&(s=e)}return s},e.getEmptyAudioStreamTrack=us,e.getEmptyVideoStreamTrack=function(){return as||(as=ls()),as.clone()},e.getLogger=u,e.importKey=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{name:Yn},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"encrypt";return wt(this,void 0,void 0,(function*(){return crypto.subtle.importKey("raw",e,t,!1,"derive"===n?["deriveBits","deriveKey"]:["encrypt","decrypt"])}))},e.isBackupCodec=Ni,e.isBrowserSupported=function(){return Ur()||jr()},e.isE2EESupported=oi,e.isInsertableStreamSupported=ci,e.isScriptTransformSupported=ai,e.isVideoFrame=function(e){return"type"in e},e.needsRbspUnescaping=function(e){for(var t=0;t<e.length-3;t++)if(0==e[t]&&0==e[t+1]&&3==e[t+2])return!0;return!1},e.parseRbsp=function(e){const t=[];for(var n=e.length,i=0;i<e.length;)n-i>=3&&!e[i]&&!e[i+1]&&3==e[i+2]?(t.push(e[i++]),t.push(e[i++]),i++):t.push(e[i++]);return new Uint8Array(t)},e.protocolVersion=11,e.ratchet=function(e,t){return wt(this,void 0,void 0,(function*(){const n=di(e.algorithm.name,t);return crypto.subtle.deriveBits(n,e,256)}))},e.setLogExtension=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;const i=n.methodFactory;n.methodFactory=(n,r,s)=>{const o=i(n,r,s),a=e.LogLevel[n],c=a>=r&&a<e.LogLevel.silent;return(e,n)=>{n?o(e,n):o(e),c&&t(a,e,n)}},n.setLevel(n.getLevel())},e.setLogLevel=function(e,t){t&&c.getLogger(t).setLevel(e);for(const n of Object.entries(c.getLoggers()).filter((e=>{let[t]=e;return t.startsWith("livekit")})).map((e=>{let[,t]=e;return t})))n.setLevel(e)},e.supportsAV1=Fr,e.supportsAdaptiveStream=function(){return void 0!==typeof ResizeObserver&&void 0!==typeof IntersectionObserver},e.supportsDynacast=function(){return Ur()},e.supportsVP9=Br,e.version=Pi,e.videoCodecs=Ii,e.writeRbsp=function(e){const t=[];for(var n=0,i=0;i<e.length;++i){var r=e[i];r<=3&&n>=2&&(t.push(3),n=0),t.push(r),0==r?++n:n=0}return new Uint8Array(t)}}(t)},318:function(e,t,n){var i,r;!function(s,o){"use strict";i=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}function a(t,n){for(var r=0;r<i.length;r++){var s=i[r];this[s]=r<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function c(e,n,i){return function(){typeof console!==t&&(a.call(this,n,i),this[e].apply(this,arguments))}}function l(e,t,n){return o(e)||c.apply(this,arguments)}function u(e,n,r){var s,o=this;n=null==n?"WARN":n;var c="loglevel";function u(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(c)+"="+n+";"}catch(r){}}}function d(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(r){}if(typeof e===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(c)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(r){}return void 0===o.levels[e]&&(e=void 0),e}}function h(){if(typeof window!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}"string"===typeof e?c+=":"+e:"symbol"===typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=r||l,o.getLevel=function(){return s},o.setLevel=function(n,i){if("string"===typeof n&&void 0!==o.levels[n.toUpperCase()]&&(n=o.levels[n.toUpperCase()]),!("number"===typeof n&&n>=0&&n<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==i&&u(n),a.call(o,n,e),typeof console===t&&n<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){n=e,d()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(n,!1),h()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var p=d();null==p&&(p=n),o.setLevel(p,!1)}var d=new u,h={};d.getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new u(e,d.getLevel(),d.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=p),d},d.getLoggers=function(){return h},d.default=d,d},void 0===(r="function"===typeof i?i.call(t,n,t,e):i)||(e.exports=r)}()},730:(e,t,n)=>{"use strict";var i=n(43),r=n(853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(a[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,i,r,s,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new f(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new f(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new f(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new f(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new f(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!d.call(m,e)||!d.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)}));var k=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),C=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),R=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var M=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=M&&e[M]||e["@@iterator"])?e:null}var A,U=Object.assign;function j(e){if(void 0===A)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);A=t&&t[1]||""}return"\n"+A+e}var F=!1;function B(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),s=i.stack.split("\n"),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||r[o]!==s[a]){var c="\n"+r[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=a);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?j(e):""}function J(e){switch(e.tag){case 5:return j(e.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case C:return"Portal";case E:return"Profiler";case w:return"StrictMode";case O:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case P:return(e._context.displayName||"Context")+".Provider";case x:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===w?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function z(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function H(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=W(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function G(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=z(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function X(e,t){$(e,t);var n=z(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&G(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+z(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:z(n)}}function se(e,t){var n=z(t.value),i=z(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=fe(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach((function(e){me.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ve=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ke=null;function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,Te=null,we=null;function Ee(e){if(e=br(e)){if("function"!==typeof Ce)throw Error(s(280));var t=e.stateNode;t&&(t=Sr(t),Ce(e.stateNode,e.type,t))}}function Pe(e){Te?we?we.push(e):we=[e]:Te=e}function Re(){if(Te){var e=Te,t=we;if(we=Te=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function xe(e,t){return e(t)}function Oe(){}var Ie=!1;function Ne(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return xe(e,t,n)}finally{Ie=!1,(null!==Te||null!==we)&&(Oe(),Re())}}function _e(e,t){var n=e.stateNode;if(null===n)return null;var i=Sr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var De=!1;if(u)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){De=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch(ue){De=!1}function Le(e,t,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Ae=!1,Ue=null,je=!1,Fe=null,Be={onError:function(e){Ae=!0,Ue=e}};function Je(e,t,n,i,r,s,o,a,c){Ae=!1,Ue=null,Le.apply(Be,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function ze(e){if(Ve(e)!==e)throw Error(s(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return ze(r),e;if(o===i)return ze(r),t;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,c=r.child;c;){if(c===n){a=!0,n=r,i=o;break}if(c===i){a=!0,i=r,n=o;break}c=c.sibling}if(!a){for(c=o.child;c;){if(c===n){a=!0,n=o,i=r;break}if(c===i){a=!0,i=o,n=r;break}c=c.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?Ke(e):null}function Ke(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ke(e);if(null!==t)return t;e=e.sibling}return null}var He=r.unstable_scheduleCallback,Ge=r.unstable_cancelCallback,Qe=r.unstable_shouldYield,Ye=r.unstable_requestPaint,$e=r.unstable_now,Xe=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,st=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/ct|0)|0},at=Math.log,ct=Math.LN2;var lt=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,s=e.pingedLanes,o=268435455&n;if(0!==o){var a=o&~r;0!==a?i=dt(a):0!==(s&=o)&&(i=dt(s))}else 0!==(o=n&~r)?i=dt(o):0!==s&&(i=dt(s));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-ot(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ot(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var bt=0;function kt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var St,Ct,Tt,wt,Et,Pt=!1,Rt=[],xt=null,Ot=null,It=null,Nt=new Map,_t=new Map,Dt=[],Mt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":xt=null;break;case"dragenter":case"dragleave":Ot=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":_t.delete(t.pointerId)}}function At(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&Ct(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ut(e){var t=yr(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=qe(n)))return e.blockedOn=t,void Et(e.priority,(function(){Tt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function jt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=br(n))&&Ct(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);ke=i,n.target.dispatchEvent(i),ke=null,t.shift()}return!0}function Ft(e,t,n){jt(e)&&n.delete(t)}function Bt(){Pt=!1,null!==xt&&jt(xt)&&(xt=null),null!==Ot&&jt(Ot)&&(Ot=null),null!==It&&jt(It)&&(It=null),Nt.forEach(Ft),_t.forEach(Ft)}function Jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Pt||(Pt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Bt)))}function Vt(e){function t(t){return Jt(t,e)}if(0<Rt.length){Jt(Rt[0],e);for(var n=1;n<Rt.length;n++){var i=Rt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==xt&&Jt(xt,e),null!==Ot&&Jt(Ot,e),null!==It&&Jt(It,e),Nt.forEach(t),_t.forEach(t),n=0;n<Dt.length;n++)(i=Dt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ut(n),null===n.blockedOn&&Dt.shift()}var qt=k.ReactCurrentBatchConfig,zt=!0;function Wt(e,t,n,i){var r=bt,s=qt.transition;qt.transition=null;try{bt=1,Ht(e,t,n,i)}finally{bt=r,qt.transition=s}}function Kt(e,t,n,i){var r=bt,s=qt.transition;qt.transition=null;try{bt=4,Ht(e,t,n,i)}finally{bt=r,qt.transition=s}}function Ht(e,t,n,i){if(zt){var r=Qt(e,t,n,i);if(null===r)zi(e,t,i,Gt,n),Lt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return xt=At(xt,e,t,n,i,r),!0;case"dragenter":return Ot=At(Ot,e,t,n,i,r),!0;case"mouseover":return It=At(It,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return Nt.set(s,At(Nt.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,_t.set(s,At(_t.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Lt(e,i),4&t&&-1<Mt.indexOf(e)){for(;null!==r;){var s=br(r);if(null!==s&&St(s),null===(s=Qt(e,t,n,i))&&zi(e,t,i,Gt,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else zi(e,t,i,null,n)}}var Gt=null;function Qt(e,t,n,i){if(Gt=null,null!==(e=yr(e=Se(i))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Gt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var $t=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,i=n.length,r="value"in $t?$t.value:$t.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[s-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,i,r,s){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,an,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(ln),dn=U({},ln,{view:0,detail:0}),hn=sn(dn),pn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(on=e.screenX-cn.screenX,an=e.screenY-cn.screenY):an=on=0,cn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:an}}),mn=sn(pn),fn=sn(U({},pn,{dataTransfer:0})),gn=sn(U({},dn,{relatedTarget:0})),vn=sn(U({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=U({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=sn(yn),kn=sn(U({},ln,{data:0})),Sn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function En(){return wn}var Pn=U({},dn,{key:function(e){if(e.key){var t=Sn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Cn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=sn(Pn),xn=sn(U({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),On=sn(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),In=sn(U({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=U({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_n=sn(Nn),Dn=[9,13,27,32],Mn=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var An=u&&"TextEvent"in window&&!Ln,Un=u&&(!Mn||Ln&&8<Ln&&11>=Ln),jn=String.fromCharCode(32),Fn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qn[e.type]:"textarea"===t}function Wn(e,t,n,i){Pe(i),0<(t=Ki(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Kn=null,Hn=null;function Gn(e){ji(e,0)}function Qn(e){if(H(kr(e)))return e}function Yn(e,t){if("change"===e)return t}var $n=!1;if(u){var Xn;if(u){var Zn="oninput"in document;if(!Zn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Zn="function"===typeof ei.oninput}Xn=Zn}else Xn=!1;$n=Xn&&(!document.documentMode||9<document.documentMode)}function ti(){Kn&&(Kn.detachEvent("onpropertychange",ni),Hn=Kn=null)}function ni(e){if("value"===e.propertyName&&Qn(Hn)){var t=[];Wn(t,Hn,e,Se(e)),Ne(Gn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Hn=n,(Kn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Hn)}function si(e,t){if("click"===e)return Qn(t)}function oi(e,t){if("input"===e||"change"===e)return Qn(t)}var ai="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ci(e,t){if(ai(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!d.call(t,r)||!ai(e[r],t[r]))return!1}return!0}function li(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=li(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=li(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=G();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=G((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!e.extend&&s>i&&(r=i,i=s,s=r),r=ui(n,s);var o=ui(n,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,vi=null,yi=null,bi=!1;function ki(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==gi||gi!==G(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&ci(yi,i)||(yi=i,0<(i=Ki(vi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function Si(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ci={animationend:Si("Animation","AnimationEnd"),animationiteration:Si("Animation","AnimationIteration"),animationstart:Si("Animation","AnimationStart"),transitionend:Si("Transition","TransitionEnd")},Ti={},wi={};function Ei(e){if(Ti[e])return Ti[e];if(!Ci[e])return e;var t,n=Ci[e];for(t in n)if(n.hasOwnProperty(t)&&t in wi)return Ti[e]=n[t];return e}u&&(wi=document.createElement("div").style,"AnimationEvent"in window||(delete Ci.animationend.animation,delete Ci.animationiteration.animation,delete Ci.animationstart.animation),"TransitionEvent"in window||delete Ci.transitionend.transition);var Pi=Ei("animationend"),Ri=Ei("animationiteration"),xi=Ei("animationstart"),Oi=Ei("transitionend"),Ii=new Map,Ni="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _i(e,t){Ii.set(e,t),c(t,[e])}for(var Di=0;Di<Ni.length;Di++){var Mi=Ni[Di];_i(Mi.toLowerCase(),"on"+(Mi[0].toUpperCase()+Mi.slice(1)))}_i(Pi,"onAnimationEnd"),_i(Ri,"onAnimationIteration"),_i(xi,"onAnimationStart"),_i("dblclick","onDoubleClick"),_i("focusin","onFocus"),_i("focusout","onBlur"),_i(Oi,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ai=new Set("cancel close invalid load scroll toggle".split(" ").concat(Li));function Ui(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,a,c,l){if(Je.apply(this,arguments),Ae){if(!Ae)throw Error(s(198));var u=Ue;Ae=!1,Ue=null,je||(je=!0,Fe=u)}}(i,t,void 0,e),e.currentTarget=null}function ji(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;Ui(r,a,l),s=c}else for(o=0;o<i.length;o++){if(c=(a=i[o]).instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;Ui(r,a,l),s=c}}}if(je)throw e=Fe,je=!1,Fe=null,e}function Fi(e,t){var n=t[fr];void 0===n&&(n=t[fr]=new Set);var i=e+"__bubble";n.has(i)||(qi(t,e,2,!1),n.add(i))}function Bi(e,t,n){var i=0;t&&(i|=4),qi(n,e,i,t)}var Ji="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[Ji]){e[Ji]=!0,o.forEach((function(t){"selectionchange"!==t&&(Ai.has(t)||Bi(t,!1,e),Bi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ji]||(t[Ji]=!0,Bi("selectionchange",!1,t))}}function qi(e,t,n,i){switch(Yt(t)){case 1:var r=Wt;break;case 4:r=Kt;break;default:r=Ht}n=r.bind(null,t,n,e),r=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function zi(e,t,n,i,r){var s=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===r||8===c.nodeType&&c.parentNode===r))return;o=o.return}for(;null!==a;){if(null===(o=yr(a)))return;if(5===(c=o.tag)||6===c){i=s=o;continue e}a=a.parentNode}}i=i.return}Ne((function(){var i=s,r=Se(n),o=[];e:{var a=Ii.get(e);if(void 0!==a){var c=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Rn;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=On;break;case Pi:case Ri:case xi:c=vn;break;case Oi:c=In;break;case"scroll":c=hn;break;case"wheel":c=_n;break;case"copy":case"cut":case"paste":c=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=xn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var p,m=i;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=_e(m,h))&&u.push(Wi(m,f,p)))),d)break;m=m.return}0<u.length&&(a=new c(a,l,null,n,r),o.push({event:a,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===ke||!(l=n.relatedTarget||n.fromElement)||!yr(l)&&!l[mr])&&(c||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=i,null!==(l=(l=n.relatedTarget||n.toElement)?yr(l):null)&&(l!==(d=Ve(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=i),c!==l)){if(u=mn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(u=xn,f="onPointerLeave",h="onPointerEnter",m="pointer"),d=null==c?a:kr(c),p=null==l?a:kr(l),(a=new u(f,m+"leave",c,n,r)).target=d,a.relatedTarget=p,f=null,yr(r)===i&&((u=new u(h,m+"enter",l,n,r)).target=p,u.relatedTarget=d,f=u),d=f,c&&l)e:{for(h=l,m=0,p=u=c;p;p=Hi(p))m++;for(p=0,f=h;f;f=Hi(f))p++;for(;0<m-p;)u=Hi(u),m--;for(;0<p-m;)h=Hi(h),p--;for(;m--;){if(u===h||null!==h&&u===h.alternate)break e;u=Hi(u),h=Hi(h)}u=null}else u=null;null!==c&&Gi(o,a,c,u,!1),null!==l&&null!==d&&Gi(o,d,l,u,!0)}if("select"===(c=(a=i?kr(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var g=Yn;else if(zn(a))if($n)g=oi;else{g=ri;var v=ii}else(c=a.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=si);switch(g&&(g=g(e,i))?Wn(o,g,n,r):(v&&v(e,a,i),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&ee(a,"number",a.value)),v=i?kr(i):window,e){case"focusin":(zn(v)||"true"===v.contentEditable)&&(gi=v,vi=i,yi=null);break;case"focusout":yi=vi=gi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,ki(o,n,r);break;case"selectionchange":if(fi)break;case"keydown":case"keyup":ki(o,n,r)}var y;if(Mn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?Bn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Un&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=en()):(Xt="value"in($t=r)?$t.value:$t.textContent,Vn=!0)),0<(v=Ki(i,b)).length&&(b=new kn(b,e,null,n,r),o.push({event:b,listeners:v}),y?b.data=y:null!==(y=Jn(n))&&(b.data=y))),(y=An?function(e,t){switch(e){case"compositionend":return Jn(t);case"keypress":return 32!==t.which?null:(Fn=!0,jn);case"textInput":return(e=t.data)===jn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Mn&&Bn(e,t)?(e=en(),Zt=Xt=$t=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Ki(i,"onBeforeInput")).length&&(r=new kn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=y))}ji(o,t)}))}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ki(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=_e(e,n))&&i.unshift(Wi(e,s,r)),null!=(s=_e(e,t))&&i.push(Wi(e,s,r))),e=e.return}return i}function Hi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Gi(e,t,n,i,r){for(var s=t._reactName,o=[];null!==n&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(null!==c&&c===i)break;5===a.tag&&null!==l&&(a=l,r?null!=(c=_e(n,s))&&o.unshift(Wi(n,c,a)):r||null!=(c=_e(n,s))&&o.push(Wi(n,c,a))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Qi=/\r\n?/g,Yi=/\u0000|\uFFFD/g;function $i(e){return("string"===typeof e?e:""+e).replace(Qi,"\n").replace(Yi,"")}function Xi(e,t,n){if(t=$i(t),$i(e)!==t&&n)throw Error(s(425))}function Zi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(ar)}:ir;function ar(e){setTimeout((function(){throw e}))}function cr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Vt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Vt(t)}function lr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),hr="__reactFiber$"+dr,pr="__reactProps$"+dr,mr="__reactContainer$"+dr,fr="__reactEvents$"+dr,gr="__reactListeners$"+dr,vr="__reactHandles$"+dr;function yr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[hr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function br(e){return!(e=e[hr]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function kr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function Sr(e){return e[pr]||null}var Cr=[],Tr=-1;function wr(e){return{current:e}}function Er(e){0>Tr||(e.current=Cr[Tr],Cr[Tr]=null,Tr--)}function Pr(e,t){Tr++,Cr[Tr]=e.current,e.current=t}var Rr={},xr=wr(Rr),Or=wr(!1),Ir=Rr;function Nr(e,t){var n=e.type.contextTypes;if(!n)return Rr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function _r(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Dr(){Er(Or),Er(xr)}function Mr(e,t,n){if(xr.current!==Rr)throw Error(s(168));Pr(xr,t),Pr(Or,n)}function Lr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(s(108,q(e)||"Unknown",r));return U({},n,i)}function Ar(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Rr,Ir=xr.current,Pr(xr,e),Pr(Or,Or.current),!0}function Ur(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=Lr(e,t,Ir),i.__reactInternalMemoizedMergedChildContext=e,Er(Or),Er(xr),Pr(xr,e)):Er(Or),Pr(Or,n)}var jr=null,Fr=!1,Br=!1;function Jr(e){null===jr?jr=[e]:jr.push(e)}function Vr(){if(!Br&&null!==jr){Br=!0;var e=0,t=bt;try{var n=jr;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}jr=null,Fr=!1}catch(r){throw null!==jr&&(jr=jr.slice(e+1)),He(Ze,Vr),r}finally{bt=t,Br=!1}}return null}var qr=[],zr=0,Wr=null,Kr=0,Hr=[],Gr=0,Qr=null,Yr=1,$r="";function Xr(e,t){qr[zr++]=Kr,qr[zr++]=Wr,Wr=e,Kr=t}function Zr(e,t,n){Hr[Gr++]=Yr,Hr[Gr++]=$r,Hr[Gr++]=Qr,Qr=e;var i=Yr;e=$r;var r=32-ot(i)-1;i&=~(1<<r),n+=1;var s=32-ot(t)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Yr=1<<32-ot(t)+r|n<<r|i,$r=s+e}else Yr=1<<s|n<<r|i,$r=e}function es(e){null!==e.return&&(Xr(e,1),Zr(e,1,0))}function ts(e){for(;e===Wr;)Wr=qr[--zr],qr[zr]=null,Kr=qr[--zr],qr[zr]=null;for(;e===Qr;)Qr=Hr[--Gr],Hr[Gr]=null,$r=Hr[--Gr],Hr[Gr]=null,Yr=Hr[--Gr],Hr[Gr]=null}var ns=null,is=null,rs=!1,ss=null;function os(e,t){var n=_l(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function as(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,is=lr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,is=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qr?{id:Yr,overflow:$r}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=_l(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,is=null,!0);default:return!1}}function cs(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ls(e){if(rs){var t=is;if(t){var n=t;if(!as(e,t)){if(cs(e))throw Error(s(418));t=lr(n.nextSibling);var i=ns;t&&as(e,t)?os(i,n):(e.flags=-4097&e.flags|2,rs=!1,ns=e)}}else{if(cs(e))throw Error(s(418));e.flags=-4097&e.flags|2,rs=!1,ns=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function ds(e){if(e!==ns)return!1;if(!rs)return us(e),rs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=is)){if(cs(e))throw hs(),Error(s(418));for(;t;)os(e,t),t=lr(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){is=lr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}is=null}}else is=ns?lr(e.stateNode.nextSibling):null;return!0}function hs(){for(var e=is;e;)e=lr(e.nextSibling)}function ps(){is=ns=null,rs=!1}function ms(e){null===ss?ss=[e]:ss.push(e)}var fs=k.ReactCurrentBatchConfig;function gs(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var vs=wr(null),ys=null,bs=null,ks=null;function Ss(){ks=bs=ys=null}function Cs(e){var t=vs.current;Er(vs),e._currentValue=t}function Ts(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function ws(e,t){ys=e,ks=bs=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ka=!0),e.firstContext=null)}function Es(e){var t=e._currentValue;if(ks!==e)if(e={context:e,memoizedValue:t,next:null},null===bs){if(null===ys)throw Error(s(308));bs=e,ys.dependencies={lanes:0,firstContext:e}}else bs=bs.next=e;return t}var Ps=null;function Rs(e){null===Ps?Ps=[e]:Ps.push(e)}function xs(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Rs(t)):(n.next=r.next,r.next=n),t.interleaved=n,Os(e,i)}function Os(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Is=!1;function Ns(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _s(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ds(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ms(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Oc)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Os(e,n)}return null===(r=i.interleaved)?(t.next=t,Rs(i)):(t.next=r.next,r.next=t),i.interleaved=t,Os(e,n)}function Ls(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function As(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Us(e,t,n,i){var r=e.updateQueue;Is=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var c=a,l=c.next;c.next=null,null===o?s=l:o.next=l,o=c;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(null!==s){var d=r.baseState;for(o=0,u=l=c=null,a=s;;){var h=a.lane,p=a.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=e,f=a;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){d=m.call(p,d,h);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,d,h):m)||void 0===h)break e;d=U({},d,h);break e;case 2:Is=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(l=u=p,c=d):u=u.next=p,o|=h;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(h=a).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);Uc|=o,e.lanes=o,e.memoizedState=d}}function js(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(s(191,r));r.call(i)}}}var Fs=(new i.Component).refs;function Bs(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Js={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tl(),r=nl(e),s=Ds(i,r);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Ms(e,s,r))&&(il(t,e,r,i),Ls(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tl(),r=nl(e),s=Ds(i,r);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Ms(e,s,r))&&(il(t,e,r,i),Ls(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tl(),i=nl(e),r=Ds(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Ms(e,r,i))&&(il(t,e,i,n),Ls(t,e,i))}};function Vs(e,t,n,i,r,s,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!ci(n,i)||!ci(r,s))}function qs(e,t,n){var i=!1,r=Rr,s=t.contextType;return"object"===typeof s&&null!==s?s=Es(s):(r=_r(t)?Ir:xr.current,s=(i=null!==(i=t.contextTypes)&&void 0!==i)?Nr(e,r):Rr),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Js,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function zs(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Js.enqueueReplaceState(t,t.state,null)}function Ws(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Fs,Ns(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=Es(s):(s=_r(t)?Ir:xr.current,r.context=Nr(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(Bs(e,t,s,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Js.enqueueReplaceState(r,r.state,null),Us(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function Ks(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;t===Fs&&(t=r.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function Hs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Gs(e){return(0,e._init)(e._payload)}function Qs(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Ml(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=jl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var s=n.type;return s===T?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===_&&Gs(s)===t.type)?((i=r(t,n.props)).ref=Ks(e,t,n),i.return=e,i):((i=Ll(n.type,n.key,n.props,null,e.mode,i)).ref=Ks(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,s){return null===t||7!==t.tag?((t=Al(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=jl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case S:return(n=Ll(t.type,t.key,t.props,null,e.mode,n)).ref=Ks(e,null,t),n.return=e,n;case C:return(t=Fl(t,e.mode,n)).return=e,t;case _:return h(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Al(t,e.mode,n,null)).return=e,t;Hs(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case S:return n.key===r?l(e,t,n,i):null;case C:return n.key===r?u(e,t,n,i):null;case _:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||L(n))return null!==r?null:d(e,t,n,i,null);Hs(e,n)}return null}function m(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case S:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case C:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case _:return m(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||L(i))return d(t,e=e.get(n)||null,i,r,null);Hs(t,i)}return null}function f(r,s,a,c){for(var l=null,u=null,d=s,f=s=0,g=null;null!==d&&f<a.length;f++){d.index>f?(g=d,d=null):g=d.sibling;var v=p(r,d,a[f],c);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(r,d),s=o(v,s,f),null===u?l=v:u.sibling=v,u=v,d=g}if(f===a.length)return n(r,d),rs&&Xr(r,f),l;if(null===d){for(;f<a.length;f++)null!==(d=h(r,a[f],c))&&(s=o(d,s,f),null===u?l=d:u.sibling=d,u=d);return rs&&Xr(r,f),l}for(d=i(r,d);f<a.length;f++)null!==(g=m(d,r,f,a[f],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?f:g.key),s=o(g,s,f),null===u?l=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(r,e)})),rs&&Xr(r,f),l}function g(r,a,c,l){var u=L(c);if("function"!==typeof u)throw Error(s(150));if(null==(c=u.call(c)))throw Error(s(151));for(var d=u=null,f=a,g=a=0,v=null,y=c.next();null!==f&&!y.done;g++,y=c.next()){f.index>g?(v=f,f=null):v=f.sibling;var b=p(r,f,y.value,l);if(null===b){null===f&&(f=v);break}e&&f&&null===b.alternate&&t(r,f),a=o(b,a,g),null===d?u=b:d.sibling=b,d=b,f=v}if(y.done)return n(r,f),rs&&Xr(r,g),u;if(null===f){for(;!y.done;g++,y=c.next())null!==(y=h(r,y.value,l))&&(a=o(y,a,g),null===d?u=y:d.sibling=y,d=y);return rs&&Xr(r,g),u}for(f=i(r,f);!y.done;g++,y=c.next())null!==(y=m(f,r,g,y.value,l))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),a=o(y,a,g),null===d?u=y:d.sibling=y,d=y);return e&&f.forEach((function(e){return t(r,e)})),rs&&Xr(r,g),u}return function e(i,s,o,c){if("object"===typeof o&&null!==o&&o.type===T&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case S:e:{for(var l=o.key,u=s;null!==u;){if(u.key===l){if((l=o.type)===T){if(7===u.tag){n(i,u.sibling),(s=r(u,o.props.children)).return=i,i=s;break e}}else if(u.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===_&&Gs(l)===u.type){n(i,u.sibling),(s=r(u,o.props)).ref=Ks(i,u,o),s.return=i,i=s;break e}n(i,u);break}t(i,u),u=u.sibling}o.type===T?((s=Al(o.props.children,i.mode,c,o.key)).return=i,i=s):((c=Ll(o.type,o.key,o.props,null,i.mode,c)).ref=Ks(i,s,o),c.return=i,i=c)}return a(i);case C:e:{for(u=o.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){n(i,s.sibling),(s=r(s,o.children||[])).return=i,i=s;break e}n(i,s);break}t(i,s),s=s.sibling}(s=Fl(o,i.mode,c)).return=i,i=s}return a(i);case _:return e(i,s,(u=o._init)(o._payload),c)}if(te(o))return f(i,s,o,c);if(L(o))return g(i,s,o,c);Hs(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,o)).return=i,i=s):(n(i,s),(s=jl(o,i.mode,c)).return=i,i=s),a(i)):n(i,s)}}var Ys=Qs(!0),$s=Qs(!1),Xs={},Zs=wr(Xs),eo=wr(Xs),to=wr(Xs);function no(e){if(e===Xs)throw Error(s(174));return e}function io(e,t){switch(Pr(to,t),Pr(eo,e),Pr(Zs,Xs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Er(Zs),Pr(Zs,t)}function ro(){Er(Zs),Er(eo),Er(to)}function so(e){no(to.current);var t=no(Zs.current),n=ce(t,e.type);t!==n&&(Pr(eo,e),Pr(Zs,n))}function oo(e){eo.current===e&&(Er(Zs),Er(eo))}var ao=wr(0);function co(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var lo=[];function uo(){for(var e=0;e<lo.length;e++)lo[e]._workInProgressVersionPrimary=null;lo.length=0}var ho=k.ReactCurrentDispatcher,po=k.ReactCurrentBatchConfig,mo=0,fo=null,go=null,vo=null,yo=!1,bo=!1,ko=0,So=0;function Co(){throw Error(s(321))}function To(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ai(e[n],t[n]))return!1;return!0}function wo(e,t,n,i,r,o){if(mo=o,fo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?aa:ca,e=n(i,r),bo){o=0;do{if(bo=!1,ko=0,25<=o)throw Error(s(301));o+=1,vo=go=null,t.updateQueue=null,ho.current=la,e=n(i,r)}while(bo)}if(ho.current=oa,t=null!==go&&null!==go.next,mo=0,vo=go=fo=null,yo=!1,t)throw Error(s(300));return e}function Eo(){var e=0!==ko;return ko=0,e}function Po(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===vo?fo.memoizedState=vo=e:vo=vo.next=e,vo}function Ro(){if(null===go){var e=fo.alternate;e=null!==e?e.memoizedState:null}else e=go.next;var t=null===vo?fo.memoizedState:vo.next;if(null!==t)vo=t,go=e;else{if(null===e)throw Error(s(310));e={memoizedState:(go=e).memoizedState,baseState:go.baseState,baseQueue:go.baseQueue,queue:go.queue,next:null},null===vo?fo.memoizedState=vo=e:vo=vo.next=e}return vo}function xo(e,t){return"function"===typeof t?t(e):t}function Oo(e){var t=Ro(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=go,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var c=a=null,l=null,u=o;do{var d=u.lane;if((mo&d)===d)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=h,a=i):l=l.next=h,fo.lanes|=d,Uc|=d}u=u.next}while(null!==u&&u!==o);null===l?a=i:l.next=c,ai(i,t.memoizedState)||(ka=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,fo.lanes|=o,Uc|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Io(e){var t=Ro(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);ai(o,t.memoizedState)||(ka=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function No(){}function _o(e,t){var n=fo,i=Ro(),r=t(),o=!ai(i.memoizedState,r);if(o&&(i.memoizedState=r,ka=!0),i=i.queue,zo(Lo.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==vo&&1&vo.memoizedState.tag){if(n.flags|=2048,Fo(9,Mo.bind(null,n,i,r,t),void 0,null),null===Ic)throw Error(s(349));0!==(30&mo)||Do(n,t,r)}return r}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=fo.updateQueue)?(t={lastEffect:null,stores:null},fo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Mo(e,t,n,i){t.value=n,t.getSnapshot=i,Ao(t)&&Uo(e)}function Lo(e,t,n){return n((function(){Ao(t)&&Uo(e)}))}function Ao(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ai(e,n)}catch(i){return!0}}function Uo(e){var t=Os(e,1);null!==t&&il(t,e,1,-1)}function jo(e){var t=Po();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xo,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,fo,e),[t.memoizedState,e]}function Fo(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=fo.updateQueue)?(t={lastEffect:null,stores:null},fo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Bo(){return Ro().memoizedState}function Jo(e,t,n,i){var r=Po();fo.flags|=e,r.memoizedState=Fo(1|t,n,void 0,void 0===i?null:i)}function Vo(e,t,n,i){var r=Ro();i=void 0===i?null:i;var s=void 0;if(null!==go){var o=go.memoizedState;if(s=o.destroy,null!==i&&To(i,o.deps))return void(r.memoizedState=Fo(t,n,s,i))}fo.flags|=e,r.memoizedState=Fo(1|t,n,s,i)}function qo(e,t){return Jo(8390656,8,e,t)}function zo(e,t){return Vo(2048,8,e,t)}function Wo(e,t){return Vo(4,2,e,t)}function Ko(e,t){return Vo(4,4,e,t)}function Ho(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Go(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Vo(4,4,Ho.bind(null,t,e),n)}function Qo(){}function Yo(e,t){var n=Ro();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&To(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function $o(e,t){var n=Ro();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&To(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Xo(e,t,n){return 0===(21&mo)?(e.baseState&&(e.baseState=!1,ka=!0),e.memoizedState=n):(ai(n,t)||(n=ft(),fo.lanes|=n,Uc|=n,e.baseState=!0),t)}function Zo(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=po.transition;po.transition={};try{e(!1),t()}finally{bt=n,po.transition=i}}function ea(){return Ro().memoizedState}function ta(e,t,n){var i=nl(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ia(e))ra(t,n);else if(null!==(n=xs(e,t,n,i))){il(n,e,i,tl()),sa(n,t,i)}}function na(e,t,n){var i=nl(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ia(e))ra(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,ai(a,o)){var c=t.interleaved;return null===c?(r.next=r,Rs(t)):(r.next=c.next,c.next=r),void(t.interleaved=r)}}catch(l){}null!==(n=xs(e,t,r,i))&&(il(n,e,i,r=tl()),sa(n,t,i))}}function ia(e){var t=e.alternate;return e===fo||null!==t&&t===fo}function ra(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function sa(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var oa={readContext:Es,useCallback:Co,useContext:Co,useEffect:Co,useImperativeHandle:Co,useInsertionEffect:Co,useLayoutEffect:Co,useMemo:Co,useReducer:Co,useRef:Co,useState:Co,useDebugValue:Co,useDeferredValue:Co,useTransition:Co,useMutableSource:Co,useSyncExternalStore:Co,useId:Co,unstable_isNewReconciler:!1},aa={readContext:Es,useCallback:function(e,t){return Po().memoizedState=[e,void 0===t?null:t],e},useContext:Es,useEffect:qo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Jo(4194308,4,Ho.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Jo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Jo(4,2,e,t)},useMemo:function(e,t){var n=Po();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Po();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ta.bind(null,fo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Po().memoizedState=e},useState:jo,useDebugValue:Qo,useDeferredValue:function(e){return Po().memoizedState=e},useTransition:function(){var e=jo(!1),t=e[0];return e=Zo.bind(null,e[1]),Po().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=fo,r=Po();if(rs){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Ic)throw Error(s(349));0!==(30&mo)||Do(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,qo(Lo.bind(null,i,o,e),[e]),i.flags|=2048,Fo(9,Mo.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=Po(),t=Ic.identifierPrefix;if(rs){var n=$r;t=":"+t+"R"+(n=(Yr&~(1<<32-ot(Yr)-1)).toString(32)+n),0<(n=ko++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=So++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ca={readContext:Es,useCallback:Yo,useContext:Es,useEffect:zo,useImperativeHandle:Go,useInsertionEffect:Wo,useLayoutEffect:Ko,useMemo:$o,useReducer:Oo,useRef:Bo,useState:function(){return Oo(xo)},useDebugValue:Qo,useDeferredValue:function(e){return Xo(Ro(),go.memoizedState,e)},useTransition:function(){return[Oo(xo)[0],Ro().memoizedState]},useMutableSource:No,useSyncExternalStore:_o,useId:ea,unstable_isNewReconciler:!1},la={readContext:Es,useCallback:Yo,useContext:Es,useEffect:zo,useImperativeHandle:Go,useInsertionEffect:Wo,useLayoutEffect:Ko,useMemo:$o,useReducer:Io,useRef:Bo,useState:function(){return Io(xo)},useDebugValue:Qo,useDeferredValue:function(e){var t=Ro();return null===go?t.memoizedState=e:Xo(t,go.memoizedState,e)},useTransition:function(){return[Io(xo)[0],Ro().memoizedState]},useMutableSource:No,useSyncExternalStore:_o,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",i=t;do{n+=J(i),i=i.return}while(i);var r=n}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r,digest:null}}function da(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ha(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var pa="function"===typeof WeakMap?WeakMap:Map;function ma(e,t,n){(n=Ds(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Wc||(Wc=!0,Kc=i),ha(0,t)},n}function fa(e,t,n){(n=Ds(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){ha(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){ha(0,t),"function"!==typeof i&&(null===Hc?Hc=new Set([this]):Hc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new pa;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Pl.bind(null,e,t,n),t.then(e,e))}function va(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ya(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ds(-1,1)).tag=2,Ms(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var ba=k.ReactCurrentOwner,ka=!1;function Sa(e,t,n,i){t.child=null===e?$s(t,null,n,i):Ys(t,e.child,n,i)}function Ca(e,t,n,i,r){n=n.render;var s=t.ref;return ws(t,r),i=wo(e,t,n,i,s,r),n=Eo(),null===e||ka?(rs&&n&&es(t),t.flags|=1,Sa(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wa(e,t,r))}function Ta(e,t,n,i,r){if(null===e){var s=n.type;return"function"!==typeof s||Dl(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ll(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,wa(e,t,s,i,r))}if(s=e.child,0===(e.lanes&r)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:ci)(o,i)&&e.ref===t.ref)return Wa(e,t,r)}return t.flags|=1,(e=Ml(s,i)).ref=t.ref,e.return=t,t.child=e}function wa(e,t,n,i,r){if(null!==e){var s=e.memoizedProps;if(ci(s,i)&&e.ref===t.ref){if(ka=!1,t.pendingProps=i=s,0===(e.lanes&r))return t.lanes=e.lanes,Wa(e,t,r);0!==(131072&e.flags)&&(ka=!0)}}return Ra(e,t,n,i,r)}function Ea(e,t,n){var i=t.pendingProps,r=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Pr(Mc,Dc),Dc|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Pr(Mc,Dc),Dc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:n,Pr(Mc,Dc),Dc|=i}else null!==s?(i=s.baseLanes|n,t.memoizedState=null):i=n,Pr(Mc,Dc),Dc|=i;return Sa(e,t,r,n),t.child}function Pa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ra(e,t,n,i,r){var s=_r(n)?Ir:xr.current;return s=Nr(t,s),ws(t,r),n=wo(e,t,n,i,s,r),i=Eo(),null===e||ka?(rs&&i&&es(t),t.flags|=1,Sa(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wa(e,t,r))}function xa(e,t,n,i,r){if(_r(n)){var s=!0;Ar(t)}else s=!1;if(ws(t,r),null===t.stateNode)za(e,t),qs(t,n,i),Ws(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var c=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Es(l):l=Nr(t,l=_r(n)?Ir:xr.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==i||c!==l)&&zs(t,o,i,l),Is=!1;var h=t.memoizedState;o.state=h,Us(t,i,o,r),c=t.memoizedState,a!==i||h!==c||Or.current||Is?("function"===typeof u&&(Bs(t,n,u,i),c=t.memoizedState),(a=Is||Vs(t,n,a,i,h,c,l))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,_s(e,t),a=t.memoizedProps,l=t.type===t.elementType?a:gs(t.type,a),o.props=l,d=t.pendingProps,h=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=Es(c):c=Nr(t,c=_r(n)?Ir:xr.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==d||h!==c)&&zs(t,o,i,c),Is=!1,h=t.memoizedState,o.state=h,Us(t,i,o,r);var m=t.memoizedState;a!==d||h!==m||Or.current||Is?("function"===typeof p&&(Bs(t,n,p,i),m=t.memoizedState),(l=Is||Vs(t,n,l,i,h,m,c)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,m,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,m,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=m),o.props=i,o.state=m,o.context=c,i=l):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Oa(e,t,n,i,s,r)}function Oa(e,t,n,i,r,s){Pa(e,t);var o=0!==(128&t.flags);if(!i&&!o)return r&&Ur(t,n,!1),Wa(e,t,s);i=t.stateNode,ba.current=t;var a=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Ys(t,e.child,null,s),t.child=Ys(t,null,a,s)):Sa(e,t,a,s),t.memoizedState=i.state,r&&Ur(t,n,!0),t.child}function Ia(e){var t=e.stateNode;t.pendingContext?Mr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Mr(0,t.context,!1),io(e,t.containerInfo)}function Na(e,t,n,i,r){return ps(),ms(r),t.flags|=256,Sa(e,t,n,i),t.child}var _a,Da,Ma,La,Aa={dehydrated:null,treeContext:null,retryLane:0};function Ua(e){return{baseLanes:e,cachePool:null,transitions:null}}function ja(e,t,n){var i,r=t.pendingProps,o=ao.current,a=!1,c=0!==(128&t.flags);if((i=c)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Pr(ao,1&o),null===e)return ls(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=r.children,e=r.fallback,a?(r=t.mode,a=t.child,c={mode:"hidden",children:c},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=c):a=Ul(c,r,0,null),e=Al(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ua(n),t.memoizedState=Aa,e):Fa(t,c));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,r,o,a){if(n)return 256&t.flags?(t.flags&=-257,Ba(e,t,a,i=da(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=Ul({mode:"visible",children:i.children},r,0,null),(o=Al(o,r,a,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&Ys(t,e.child,null,a),t.child.memoizedState=Ua(a),t.memoizedState=Aa,o);if(0===(1&t.mode))return Ba(e,t,a,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var c=i.dgst;return i=c,Ba(e,t,a,i=da(o=Error(s(419)),i,void 0))}if(c=0!==(a&e.childLanes),ka||c){if(null!==(i=Ic)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|a))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Os(e,r),il(i,e,r,-1))}return gl(),Ba(e,t,a,i=da(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=xl.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,is=lr(r.nextSibling),ns=t,rs=!0,ss=null,null!==e&&(Hr[Gr++]=Yr,Hr[Gr++]=$r,Hr[Gr++]=Qr,Yr=e.id,$r=e.overflow,Qr=t),t=Fa(t,i.children),t.flags|=4096,t)}(e,t,c,r,i,o,n);if(a){a=r.fallback,c=t.mode,i=(o=e.child).sibling;var l={mode:"hidden",children:r.children};return 0===(1&c)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null):(r=Ml(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==i?a=Ml(i,a):(a=Al(a,c,n,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,c=null===(c=e.child.memoizedState)?Ua(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},a.memoizedState=c,a.childLanes=e.childLanes&~n,t.memoizedState=Aa,r}return e=(a=e.child).sibling,r=Ml(a,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Fa(e,t){return(t=Ul({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ba(e,t,n,i){return null!==i&&ms(i),Ys(t,e.child,null,n),(e=Fa(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ja(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Ts(e.return,t,n)}function Va(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function qa(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(Sa(e,t,i.children,n),0!==(2&(i=ao.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ja(e,n,t);else if(19===e.tag)Ja(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Pr(ao,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===co(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Va(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===co(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Va(t,!0,n,null,s);break;case"together":Va(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function za(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Uc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Ml(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ml(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ka(e,t){if(!rs)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ha(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ga(e,t,n){var i=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ha(t),null;case 1:case 17:return _r(t.type)&&Dr(),Ha(t),null;case 3:return i=t.stateNode,ro(),Er(Or),Er(xr),uo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ds(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(al(ss),ss=null))),Da(e,t),Ha(t),null;case 5:oo(t);var r=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ma(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(s(166));return Ha(t),null}if(e=no(Zs.current),ds(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[hr]=t,i[pr]=o,e=0!==(1&t.mode),n){case"dialog":Fi("cancel",i),Fi("close",i);break;case"iframe":case"object":case"embed":Fi("load",i);break;case"video":case"audio":for(r=0;r<Li.length;r++)Fi(Li[r],i);break;case"source":Fi("error",i);break;case"img":case"image":case"link":Fi("error",i),Fi("load",i);break;case"details":Fi("toggle",i);break;case"input":Y(i,o),Fi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Fi("invalid",i);break;case"textarea":re(i,o),Fi("invalid",i)}for(var c in ye(n,o),r=null,o)if(o.hasOwnProperty(c)){var l=o[c];"children"===c?"string"===typeof l?i.textContent!==l&&(!0!==o.suppressHydrationWarning&&Xi(i.textContent,l,e),r=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&Xi(i.textContent,l,e),r=["children",""+l]):a.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Fi("scroll",i)}switch(n){case"input":K(i),Z(i,o,!0);break;case"textarea":K(i),oe(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Zi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{c=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[hr]=t,e[pr]=i,_a(e,t,!1,!1),t.stateNode=e;e:{switch(c=be(n,i),n){case"dialog":Fi("cancel",e),Fi("close",e),r=i;break;case"iframe":case"object":case"embed":Fi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Li.length;r++)Fi(Li[r],e);r=i;break;case"source":Fi("error",e),r=i;break;case"img":case"image":case"link":Fi("error",e),Fi("load",e),r=i;break;case"details":Fi("toggle",e),r=i;break;case"input":Y(e,i),r=Q(e,i),Fi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=U({},i,{value:void 0}),Fi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Fi("invalid",e)}for(o in ye(n,r),l=r)if(l.hasOwnProperty(o)){var u=l[o];"style"===o?ge(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Fi("scroll",e):null!=u&&b(e,o,u,c))}switch(n){case"input":K(e),Z(e,i,!1);break;case"textarea":K(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+z(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ne(e,!!i.multiple,o,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Zi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ha(t),null;case 6:if(e&&null!=t.stateNode)La(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(n=no(to.current),no(Zs.current),ds(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(o=i.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Xi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xi(i.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return Ha(t),null;case 13:if(Er(ao),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rs&&null!==is&&0!==(1&t.mode)&&0===(128&t.flags))hs(),ps(),t.flags|=98560,o=!1;else if(o=ds(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[hr]=t}else ps(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ha(t),o=!1}else null!==ss&&(al(ss),ss=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ao.current)?0===Lc&&(Lc=3):gl())),null!==t.updateQueue&&(t.flags|=4),Ha(t),null);case 4:return ro(),Da(e,t),null===e&&Vi(t.stateNode.containerInfo),Ha(t),null;case 10:return Cs(t.type._context),Ha(t),null;case 19:if(Er(ao),null===(o=t.memoizedState))return Ha(t),null;if(i=0!==(128&t.flags),null===(c=o.rendering))if(i)Ka(o,!1);else{if(0!==Lc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=co(e))){for(t.flags|=128,Ka(o,!1),null!==(i=c.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Pr(ao,1&ao.current|2),t.child}e=e.sibling}null!==o.tail&&$e()>qc&&(t.flags|=128,i=!0,Ka(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=co(c))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ka(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!rs)return Ha(t),null}else 2*$e()-o.renderingStartTime>qc&&1073741824!==n&&(t.flags|=128,i=!0,Ka(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=$e(),t.sibling=null,n=ao.current,Pr(ao,i?1&n|2:1&n),t):(Ha(t),null);case 22:case 23:return hl(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Dc)&&(Ha(t),6&t.subtreeFlags&&(t.flags|=8192)):Ha(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Qa(e,t){switch(ts(t),t.tag){case 1:return _r(t.type)&&Dr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ro(),Er(Or),Er(xr),uo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Er(ao),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Er(ao),null;case 4:return ro(),null;case 10:return Cs(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}_a=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Da=function(){},Ma=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,no(Zs.current);var s,o=null;switch(n){case"input":r=Q(e,r),i=Q(e,i),o=[];break;case"select":r=U({},r,{value:void 0}),i=U({},i,{value:void 0}),o=[];break;case"textarea":r=ie(e,r),i=ie(e,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=Zi)}for(u in ye(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var c=r[u];for(s in c)c.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var l=i[u];if(c=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(s in c)!c.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in l)l.hasOwnProperty(s)&&c[s]!==l[s]&&(n||(n={}),n[s]=l[s])}else n||(o||(o=[]),o.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(o=o||[]).push(u,l)):"children"===u?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Fi("scroll",e),o||c===l||(o=[])):(o=o||[]).push(u,l))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},La=function(e,t,n,i){n!==i&&(t.flags|=4)};var Ya=!1,$a=!1,Xa="function"===typeof WeakSet?WeakSet:Set,Za=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){El(e,t,i)}else n.current=null}function tc(e,t,n){try{n()}catch(i){El(e,t,i)}}var nc=!1;function ic(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&tc(t,n,s)}r=r.next}while(r!==i)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function sc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function oc(e){var t=e.alternate;null!==t&&(e.alternate=null,oc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[fr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ac(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ac(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zi));else if(4!==i&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}function uc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}var dc=null,hc=!1;function pc(e,t,n){for(n=n.child;null!==n;)mc(e,t,n),n=n.sibling}function mc(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,n)}catch(a){}switch(n.tag){case 5:$a||ec(n,t);case 6:var i=dc,r=hc;dc=null,pc(e,t,n),hc=r,null!==(dc=i)&&(hc?(e=dc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dc.removeChild(n.stateNode));break;case 18:null!==dc&&(hc?(e=dc,n=n.stateNode,8===e.nodeType?cr(e.parentNode,n):1===e.nodeType&&cr(e,n),Vt(e)):cr(dc,n.stateNode));break;case 4:i=dc,r=hc,dc=n.stateNode.containerInfo,hc=!0,pc(e,t,n),dc=i,hc=r;break;case 0:case 11:case 14:case 15:if(!$a&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,void 0!==o&&(0!==(2&s)||0!==(4&s))&&tc(n,t,o),r=r.next}while(r!==i)}pc(e,t,n);break;case 1:if(!$a&&(ec(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){El(n,t,a)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?($a=(i=$a)||null!==n.memoizedState,pc(e,t,n),$a=i):pc(e,t,n);break;default:pc(e,t,n)}}function fc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xa),t.forEach((function(t){var i=Ol.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function gc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,a=t,c=a;e:for(;null!==c;){switch(c.tag){case 5:dc=c.stateNode,hc=!1;break e;case 3:case 4:dc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===dc)throw Error(s(160));mc(o,a,r),dc=null,hc=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(u){El(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vc(t,e),t=t.sibling}function vc(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gc(t,e),yc(e),4&i){try{ic(3,e,e.return),rc(3,e)}catch(g){El(e,e.return,g)}try{ic(5,e,e.return)}catch(g){El(e,e.return,g)}}break;case 1:gc(t,e),yc(e),512&i&&null!==n&&ec(n,n.return);break;case 5:if(gc(t,e),yc(e),512&i&&null!==n&&ec(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){El(e,e.return,g)}}if(4&i&&null!=(r=e.stateNode)){var o=e.memoizedProps,a=null!==n?n.memoizedProps:o,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===o.type&&null!=o.name&&$(r,o),be(c,a);var u=be(c,o);for(a=0;a<l.length;a+=2){var d=l[a],h=l[a+1];"style"===d?ge(r,h):"dangerouslySetInnerHTML"===d?de(r,h):"children"===d?he(r,h):b(r,d,h,u)}switch(c){case"input":X(r,o);break;case"textarea":se(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var m=o.value;null!=m?ne(r,!!o.multiple,m,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(r,!!o.multiple,o.defaultValue,!0):ne(r,!!o.multiple,o.multiple?[]:"",!1))}r[pr]=o}catch(g){El(e,e.return,g)}}break;case 6:if(gc(t,e),yc(e),4&i){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(g){El(e,e.return,g)}}break;case 3:if(gc(t,e),yc(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){El(e,e.return,g)}break;case 4:default:gc(t,e),yc(e);break;case 13:gc(t,e),yc(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(Vc=$e())),4&i&&fc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?($a=(u=$a)||d,gc(t,e),$a=u):gc(t,e),yc(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Za=e,d=e.child;null!==d;){for(h=Za=d;null!==Za;){switch(m=(p=Za).child,p.tag){case 0:case 11:case 14:case 15:ic(4,p,p.return);break;case 1:ec(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){i=p,n=p.return;try{t=i,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){El(i,n,g)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){Cc(h);continue}}null!==m?(m.return=p,Za=m):Cc(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,u?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=h.stateNode,a=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=fe("display",a))}catch(g){El(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){El(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gc(t,e),yc(e),4&i&&fc(e);case 21:}}function yc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ac(n)){var i=n;break e}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),uc(e,cc(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;lc(e,cc(e),o);break;default:throw Error(s(161))}}catch(a){El(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bc(e,t,n){Za=e,kc(e,t,n)}function kc(e,t,n){for(var i=0!==(1&e.mode);null!==Za;){var r=Za,s=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Ya;if(!o){var a=r.alternate,c=null!==a&&null!==a.memoizedState||$a;a=Ya;var l=$a;if(Ya=o,($a=c)&&!l)for(Za=r;null!==Za;)c=(o=Za).child,22===o.tag&&null!==o.memoizedState?Tc(r):null!==c?(c.return=o,Za=c):Tc(r);for(;null!==s;)Za=s,kc(s,t,n),s=s.sibling;Za=r,Ya=a,$a=l}Sc(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,Za=s):Sc(e)}}function Sc(e){for(;null!==Za;){var t=Za;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$a||rc(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!$a)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:gs(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&js(t,o,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}js(t,a,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(s(163))}$a||512&t.flags&&sc(t)}catch(p){El(t,t.return,p)}}if(t===e){Za=null;break}if(null!==(n=t.sibling)){n.return=t.return,Za=n;break}Za=t.return}}function Cc(e){for(;null!==Za;){var t=Za;if(t===e){Za=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Za=n;break}Za=t.return}}function Tc(e){for(;null!==Za;){var t=Za;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(c){El(t,n,c)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(c){El(t,r,c)}}var s=t.return;try{sc(t)}catch(c){El(t,s,c)}break;case 5:var o=t.return;try{sc(t)}catch(c){El(t,o,c)}}}catch(c){El(t,t.return,c)}if(t===e){Za=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Za=a;break}Za=t.return}}var wc,Ec=Math.ceil,Pc=k.ReactCurrentDispatcher,Rc=k.ReactCurrentOwner,xc=k.ReactCurrentBatchConfig,Oc=0,Ic=null,Nc=null,_c=0,Dc=0,Mc=wr(0),Lc=0,Ac=null,Uc=0,jc=0,Fc=0,Bc=null,Jc=null,Vc=0,qc=1/0,zc=null,Wc=!1,Kc=null,Hc=null,Gc=!1,Qc=null,Yc=0,$c=0,Xc=null,Zc=-1,el=0;function tl(){return 0!==(6&Oc)?$e():-1!==Zc?Zc:Zc=$e()}function nl(e){return 0===(1&e.mode)?1:0!==(2&Oc)&&0!==_c?_c&-_c:null!==fs.transition?(0===el&&(el=ft()),el):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function il(e,t,n,i){if(50<$c)throw $c=0,Xc=null,Error(s(185));vt(e,n,i),0!==(2&Oc)&&e===Ic||(e===Ic&&(0===(2&Oc)&&(jc|=n),4===Lc&&cl(e,_c)),rl(e,i),1===n&&0===Oc&&0===(1&t.mode)&&(qc=$e()+500,Fr&&Vr()))}function rl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-ot(s),a=1<<o,c=r[o];-1===c?0!==(a&n)&&0===(a&i)||(r[o]=pt(a,t)):c<=t&&(e.expiredLanes|=a),s&=~a}}(e,t);var i=ht(e,e===Ic?_c:0);if(0===i)null!==n&&Ge(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ge(n),1===t)0===e.tag?function(e){Fr=!0,Jr(e)}(ll.bind(null,e)):Jr(ll.bind(null,e)),or((function(){0===(6&Oc)&&Vr()})),n=null;else{switch(kt(i)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Il(n,sl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sl(e,t){if(Zc=-1,el=0,0!==(6&Oc))throw Error(s(327));var n=e.callbackNode;if(Tl()&&e.callbackNode!==n)return null;var i=ht(e,e===Ic?_c:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=vl(e,i);else{t=i;var r=Oc;Oc|=2;var o=fl();for(Ic===e&&_c===t||(zc=null,qc=$e()+500,pl(e,t));;)try{bl();break}catch(c){ml(e,c)}Ss(),Pc.current=o,Oc=r,null!==Nc?t=0:(Ic=null,_c=0,t=Lc)}if(0!==t){if(2===t&&(0!==(r=mt(e))&&(i=r,t=ol(e,r))),1===t)throw n=Ac,pl(e,0),cl(e,i),rl(e,$e()),n;if(6===t)cl(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!ai(s(),r))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=vl(e,i))&&(0!==(o=mt(e))&&(i=o,t=ol(e,o))),1===t))throw n=Ac,pl(e,0),cl(e,i),rl(e,$e()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(s(345));case 2:case 5:Cl(e,Jc,zc);break;case 3:if(cl(e,i),(130023424&i)===i&&10<(t=Vc+500-$e())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tl(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(Cl.bind(null,e,Jc,zc),t);break}Cl(e,Jc,zc);break;case 4:if(cl(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var a=31-ot(i);o=1<<a,(a=t[a])>r&&(r=a),i&=~o}if(i=r,10<(i=(120>(i=$e()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ec(i/1960))-i)){e.timeoutHandle=ir(Cl.bind(null,e,Jc,zc),i);break}Cl(e,Jc,zc);break;default:throw Error(s(329))}}}return rl(e,$e()),e.callbackNode===n?sl.bind(null,e):null}function ol(e,t){var n=Bc;return e.current.memoizedState.isDehydrated&&(pl(e,t).flags|=256),2!==(e=vl(e,t))&&(t=Jc,Jc=n,null!==t&&al(t)),e}function al(e){null===Jc?Jc=e:Jc.push.apply(Jc,e)}function cl(e,t){for(t&=~Fc,t&=~jc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),i=1<<n;e[n]=-1,t&=~i}}function ll(e){if(0!==(6&Oc))throw Error(s(327));Tl();var t=ht(e,0);if(0===(1&t))return rl(e,$e()),null;var n=vl(e,t);if(0!==e.tag&&2===n){var i=mt(e);0!==i&&(t=i,n=ol(e,i))}if(1===n)throw n=Ac,pl(e,0),cl(e,t),rl(e,$e()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Cl(e,Jc,zc),rl(e,$e()),null}function ul(e,t){var n=Oc;Oc|=1;try{return e(t)}finally{0===(Oc=n)&&(qc=$e()+500,Fr&&Vr())}}function dl(e){null!==Qc&&0===Qc.tag&&0===(6&Oc)&&Tl();var t=Oc;Oc|=1;var n=xc.transition,i=bt;try{if(xc.transition=null,bt=1,e)return e()}finally{bt=i,xc.transition=n,0===(6&(Oc=t))&&Vr()}}function hl(){Dc=Mc.current,Er(Mc)}function pl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Nc)for(n=Nc.return;null!==n;){var i=n;switch(ts(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Dr();break;case 3:ro(),Er(Or),Er(xr),uo();break;case 5:oo(i);break;case 4:ro();break;case 13:case 19:Er(ao);break;case 10:Cs(i.type._context);break;case 22:case 23:hl()}n=n.return}if(Ic=e,Nc=e=Ml(e.current,null),_c=Dc=t,Lc=0,Ac=null,Fc=jc=Uc=0,Jc=Bc=null,null!==Ps){for(t=0;t<Ps.length;t++)if(null!==(i=(n=Ps[t]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var o=s.next;s.next=r,i.next=o}n.pending=i}Ps=null}return e}function ml(e,t){for(;;){var n=Nc;try{if(Ss(),ho.current=oa,yo){for(var i=fo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}yo=!1}if(mo=0,vo=go=fo=null,bo=!1,ko=0,Rc.current=null,null===n||null===n.return){Lc=1,Ac=t,Nc=null;break}e:{var o=e,a=n.return,c=n,l=t;if(t=_c,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,d=c,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var m=va(a);if(null!==m){m.flags&=-257,ya(m,a,c,0,t),1&m.mode&&ga(o,u,t),l=u;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}if(0===(1&t)){ga(o,u,t),gl();break e}l=Error(s(426))}else if(rs&&1&c.mode){var v=va(a);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),ya(v,a,c,0,t),ms(ua(l,c));break e}}o=l=ua(l,c),4!==Lc&&(Lc=2),null===Bc?Bc=[o]:Bc.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,As(o,ma(0,l,t));break e;case 1:c=l;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Hc||!Hc.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,As(o,fa(o,c,t));break e}}o=o.return}while(null!==o)}Sl(n)}catch(k){t=k,Nc===n&&null!==n&&(Nc=n=n.return);continue}break}}function fl(){var e=Pc.current;return Pc.current=oa,null===e?oa:e}function gl(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===Ic||0===(268435455&Uc)&&0===(268435455&jc)||cl(Ic,_c)}function vl(e,t){var n=Oc;Oc|=2;var i=fl();for(Ic===e&&_c===t||(zc=null,pl(e,t));;)try{yl();break}catch(r){ml(e,r)}if(Ss(),Oc=n,Pc.current=i,null!==Nc)throw Error(s(261));return Ic=null,_c=0,Lc}function yl(){for(;null!==Nc;)kl(Nc)}function bl(){for(;null!==Nc&&!Qe();)kl(Nc)}function kl(e){var t=wc(e.alternate,e,Dc);e.memoizedProps=e.pendingProps,null===t?Sl(e):Nc=t,Rc.current=null}function Sl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ga(n,t,Dc)))return void(Nc=n)}else{if(null!==(n=Qa(n,t)))return n.flags&=32767,void(Nc=n);if(null===e)return Lc=6,void(Nc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nc=t);Nc=t=e}while(null!==t);0===Lc&&(Lc=5)}function Cl(e,t,n){var i=bt,r=xc.transition;try{xc.transition=null,bt=1,function(e,t,n,i){do{Tl()}while(null!==Qc);if(0!==(6&Oc))throw Error(s(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-ot(n),s=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~s}}(e,o),e===Ic&&(Nc=Ic=null,_c=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Gc||(Gc=!0,Il(tt,(function(){return Tl(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=xc.transition,xc.transition=null;var a=bt;bt=1;var c=Oc;Oc|=4,Rc.current=null,function(e,t){if(er=zt,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(S){n=null;break e}var a=0,c=-1,l=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==r&&3!==h.nodeType||(c=a+r),h!==o||0!==i&&3!==h.nodeType||(l=a+i),3===h.nodeType&&(a+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++u===r&&(c=a),p===o&&++d===i&&(l=a),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},zt=!1,Za=t;null!==Za;)if(e=(t=Za).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Za=e;else for(;null!==Za;){t=Za;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,v=f.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:gs(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var k=t.stateNode.containerInfo;1===k.nodeType?k.textContent="":9===k.nodeType&&k.documentElement&&k.removeChild(k.documentElement);break;default:throw Error(s(163))}}catch(S){El(t,t.return,S)}if(null!==(e=t.sibling)){e.return=t.return,Za=e;break}Za=t.return}f=nc,nc=!1}(e,n),vc(n,e),mi(tr),zt=!!er,tr=er=null,e.current=n,bc(n,e,r),Ye(),Oc=c,bt=a,xc.transition=o}else e.current=n;if(Gc&&(Gc=!1,Qc=e,Yc=r),o=e.pendingLanes,0===o&&(Hc=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rl(e,$e()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Wc)throw Wc=!1,e=Kc,Kc=null,e;0!==(1&Yc)&&0!==e.tag&&Tl(),o=e.pendingLanes,0!==(1&o)?e===Xc?$c++:($c=0,Xc=e):$c=0,Vr()}(e,t,n,i)}finally{xc.transition=r,bt=i}return null}function Tl(){if(null!==Qc){var e=kt(Yc),t=xc.transition,n=bt;try{if(xc.transition=null,bt=16>e?16:e,null===Qc)var i=!1;else{if(e=Qc,Qc=null,Yc=0,0!==(6&Oc))throw Error(s(331));var r=Oc;for(Oc|=4,Za=e.current;null!==Za;){var o=Za,a=o.child;if(0!==(16&Za.flags)){var c=o.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for(Za=u;null!==Za;){var d=Za;switch(d.tag){case 0:case 11:case 15:ic(8,d,o)}var h=d.child;if(null!==h)h.return=d,Za=h;else for(;null!==Za;){var p=(d=Za).sibling,m=d.return;if(oc(d),d===u){Za=null;break}if(null!==p){p.return=m,Za=p;break}Za=m}}}var f=o.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Za=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,Za=a;else e:for(;null!==Za;){if(0!==(2048&(o=Za).flags))switch(o.tag){case 0:case 11:case 15:ic(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Za=y;break e}Za=o.return}}var b=e.current;for(Za=b;null!==Za;){var k=(a=Za).child;if(0!==(2064&a.subtreeFlags)&&null!==k)k.return=a,Za=k;else e:for(a=b;null!==Za;){if(0!==(2048&(c=Za).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(C){El(c,c.return,C)}if(c===a){Za=null;break e}var S=c.sibling;if(null!==S){S.return=c.return,Za=S;break e}Za=c.return}}if(Oc=r,Vr(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(C){}i=!0}return i}finally{bt=n,xc.transition=t}}return!1}function wl(e,t,n){e=Ms(e,t=ma(0,t=ua(n,t),1),1),t=tl(),null!==e&&(vt(e,1,t),rl(e,t))}function El(e,t,n){if(3===e.tag)wl(e,e,n);else for(;null!==t;){if(3===t.tag){wl(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Hc||!Hc.has(i))){t=Ms(t,e=fa(t,e=ua(n,e),1),1),e=tl(),null!==t&&(vt(t,1,e),rl(t,e));break}}t=t.return}}function Pl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&n,Ic===e&&(_c&n)===n&&(4===Lc||3===Lc&&(130023424&_c)===_c&&500>$e()-Vc?pl(e,0):Fc|=n),rl(e,t)}function Rl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=tl();null!==(e=Os(e,t))&&(vt(e,t,n),rl(e,n))}function xl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Rl(e,n)}function Ol(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(t),Rl(e,n)}function Il(e,t){return He(e,t)}function Nl(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _l(e,t,n,i){return new Nl(e,t,n,i)}function Dl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ml(e,t){var n=e.alternate;return null===n?((n=_l(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ll(e,t,n,i,r,o){var a=2;if(i=e,"function"===typeof e)Dl(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case T:return Al(n.children,r,o,t);case w:a=8,r|=8;break;case E:return(e=_l(12,n,t,2|r)).elementType=E,e.lanes=o,e;case O:return(e=_l(13,n,t,r)).elementType=O,e.lanes=o,e;case I:return(e=_l(19,n,t,r)).elementType=I,e.lanes=o,e;case D:return Ul(n,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case P:a=10;break e;case R:a=9;break e;case x:a=11;break e;case N:a=14;break e;case _:a=16,i=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=_l(a,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Al(e,t,n,i){return(e=_l(7,e,i,t)).lanes=n,e}function Ul(e,t,n,i){return(e=_l(22,e,i,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function jl(e,t,n){return(e=_l(6,e,null,t)).lanes=n,e}function Fl(e,t,n){return(t=_l(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bl(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Jl(e,t,n,i,r,s,o,a,c){return e=new Bl(e,t,n,a,c),1===t?(t=1,!0===s&&(t|=8)):t=0,s=_l(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ns(s),e}function Vl(e){if(!e)return Rr;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(_r(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(_r(n))return Lr(e,n,t)}return t}function ql(e,t,n,i,r,s,o,a,c){return(e=Jl(n,i,!0,e,0,s,0,a,c)).context=Vl(null),n=e.current,(s=Ds(i=tl(),r=nl(n))).callback=void 0!==t&&null!==t?t:null,Ms(n,s,r),e.current.lanes=r,vt(e,r,i),rl(e,i),e}function zl(e,t,n,i){var r=t.current,s=tl(),o=nl(r);return n=Vl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ds(s,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Ms(r,t,o))&&(il(e,r,o,s),Ls(e,r,o)),o}function Wl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Kl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hl(e,t){Kl(e,t),(e=e.alternate)&&Kl(e,t)}wc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Or.current)ka=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ka=!1,function(e,t,n){switch(t.tag){case 3:Ia(t),ps();break;case 5:so(t);break;case 1:_r(t.type)&&Ar(t);break;case 4:io(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Pr(vs,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Pr(ao,1&ao.current),t.flags|=128,null):0!==(n&t.child.childLanes)?ja(e,t,n):(Pr(ao,1&ao.current),null!==(e=Wa(e,t,n))?e.sibling:null);Pr(ao,1&ao.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return qa(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Pr(ao,ao.current),i)break;return null;case 22:case 23:return t.lanes=0,Ea(e,t,n)}return Wa(e,t,n)}(e,t,n);ka=0!==(131072&e.flags)}else ka=!1,rs&&0!==(1048576&t.flags)&&Zr(t,Kr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;za(e,t),e=t.pendingProps;var r=Nr(t,xr.current);ws(t,n),r=wo(null,t,i,e,r,n);var o=Eo();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,_r(i)?(o=!0,Ar(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ns(t),r.updater=Js,t.stateNode=r,r._reactInternals=t,Ws(t,i,e,n),t=Oa(null,t,i,!0,o,n)):(t.tag=0,rs&&o&&es(t),Sa(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(za(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Dl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===x)return 11;if(e===N)return 14}return 2}(i),e=gs(i,e),r){case 0:t=Ra(null,t,i,e,n);break e;case 1:t=xa(null,t,i,e,n);break e;case 11:t=Ca(null,t,i,e,n);break e;case 14:t=Ta(null,t,i,gs(i.type,e),n);break e}throw Error(s(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ra(e,t,i,r=t.elementType===i?r:gs(i,r),n);case 1:return i=t.type,r=t.pendingProps,xa(e,t,i,r=t.elementType===i?r:gs(i,r),n);case 3:e:{if(Ia(t),null===e)throw Error(s(387));i=t.pendingProps,r=(o=t.memoizedState).element,_s(e,t),Us(t,i,null,n);var a=t.memoizedState;if(i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Na(e,t,i,n,r=ua(Error(s(423)),t));break e}if(i!==r){t=Na(e,t,i,n,r=ua(Error(s(424)),t));break e}for(is=lr(t.stateNode.containerInfo.firstChild),ns=t,rs=!0,ss=null,n=$s(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ps(),i===r){t=Wa(e,t,n);break e}Sa(e,t,i,n)}t=t.child}return t;case 5:return so(t),null===e&&ls(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,a=r.children,nr(i,r)?a=null:null!==o&&nr(i,o)&&(t.flags|=32),Pa(e,t),Sa(e,t,a,n),t.child;case 6:return null===e&&ls(t),null;case 13:return ja(e,t,n);case 4:return io(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Ys(t,null,i,n):Sa(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Ca(e,t,i,r=t.elementType===i?r:gs(i,r),n);case 7:return Sa(e,t,t.pendingProps,n),t.child;case 8:case 12:return Sa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,a=r.value,Pr(vs,i._currentValue),i._currentValue=a,null!==o)if(ai(o.value,a)){if(o.children===r.children&&!Or.current){t=Wa(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){a=o.child;for(var l=c.firstContext;null!==l;){if(l.context===i){if(1===o.tag){(l=Ds(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ts(o.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Ts(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}Sa(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,ws(t,n),i=i(r=Es(r)),t.flags|=1,Sa(e,t,i,n),t.child;case 14:return r=gs(i=t.type,t.pendingProps),Ta(e,t,i,r=gs(i.type,r),n);case 15:return wa(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:gs(i,r),za(e,t),t.tag=1,_r(i)?(e=!0,Ar(t)):e=!1,ws(t,n),qs(t,i,r),Ws(t,i,r,n),Oa(null,t,i,!0,e,n);case 19:return qa(e,t,n);case 22:return Ea(e,t,n)}throw Error(s(156,t.tag))};var Gl="function"===typeof reportError?reportError:function(e){console.error(e)};function Ql(e){this._internalRoot=e}function Yl(e){this._internalRoot=e}function $l(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zl(){}function eu(e,t,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if("function"===typeof r){var a=r;r=function(){var e=Wl(o);a.call(e)}}zl(t,o,e,r)}else o=function(e,t,n,i,r){if(r){if("function"===typeof i){var s=i;i=function(){var e=Wl(o);s.call(e)}}var o=ql(t,i,e,0,null,!1,0,"",Zl);return e._reactRootContainer=o,e[mr]=o.current,Vi(8===e.nodeType?e.parentNode:e),dl(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var a=i;i=function(){var e=Wl(c);a.call(e)}}var c=Jl(e,0,!1,null,0,!1,0,"",Zl);return e._reactRootContainer=c,e[mr]=c.current,Vi(8===e.nodeType?e.parentNode:e),dl((function(){zl(t,c,n,i)})),c}(n,t,e,r,i);return Wl(o)}Yl.prototype.render=Ql.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));zl(e,t,null,null)},Yl.prototype.unmount=Ql.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dl((function(){zl(null,e,null,null)})),t[mr]=null}},Yl.prototype.unstable_scheduleHydration=function(e){if(e){var t=wt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ut(e)}},St=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),rl(t,$e()),0===(6&Oc)&&(qc=$e()+500,Vr()))}break;case 13:dl((function(){var t=Os(e,1);if(null!==t){var n=tl();il(t,e,1,n)}})),Hl(e,1)}},Ct=function(e){if(13===e.tag){var t=Os(e,134217728);if(null!==t)il(t,e,134217728,tl());Hl(e,134217728)}},Tt=function(e){if(13===e.tag){var t=nl(e),n=Os(e,t);if(null!==n)il(n,e,t,tl());Hl(e,t)}},wt=function(){return bt},Et=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Ce=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=Sr(i);if(!r)throw Error(s(90));H(i),X(i,r)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},xe=ul,Oe=dl;var tu={usingClientEntryPoint:!1,Events:[br,kr,Sr,Pe,Re,ul]},nu={findFiberByHostInstance:yr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(iu),st=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$l(t))throw Error(s(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:C,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!$l(e))throw Error(s(299));var n=!1,i="",r=Gl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Jl(e,1,!1,null,0,n,0,i,r),e[mr]=t.current,Vi(8===e.nodeType?e.parentNode:e),new Ql(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return dl(e)},t.hydrate=function(e,t,n){if(!Xl(t))throw Error(s(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$l(e))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",a=Gl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=ql(t,null,e,1,null!=n?n:null,r,0,o,a),e[mr]=t.current,Vi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Yl(t)},t.render=function(e,t,n){if(!Xl(t))throw Error(s(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xl(e))throw Error(s(40));return!!e._reactRootContainer&&(dl((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[mr]=null}))})),!0)},t.unstable_batchedUpdates=ul,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Xl(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return eu(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},391:(e,t,n)=>{"use strict";var i=n(950);t.H=i.createRoot,i.hydrateRoot},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},153:(e,t,n)=>{"use strict";var i=n(43),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,s={},l=null,u=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!c.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:r,type:e,key:l,ref:u,props:s,_owner:a.current}}t.Fragment=s,t.jsx=l,t.jsxs=l},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var k=b.prototype=new y;k.constructor=b,f(k,v.prototype),k.isPureReactComponent=!0;var S=Array.isArray,C=Object.prototype.hasOwnProperty,T={current:null},w={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,i){var r,s={},o=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)C.call(t,r)&&!w.hasOwnProperty(r)&&(s[r]=t[r]);var c=arguments.length-2;if(1===c)s.children=i;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===s[r]&&(s[r]=c[r]);return{$$typeof:n,type:e,key:o,ref:a,props:s,_owner:T.current}}function P(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function x(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,r,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case i:c=!0}}if(c)return o=o(c=e),e=""===s?"."+x(c,0):s,S(o)?(r="",null!=e&&(r=e.replace(R,"$&/")+"/"),O(o,t,r,"",(function(e){return e}))):null!=o&&(P(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(R,"$&/")+"/")+e)),t.push(o)),1;if(c=0,s=""===s?".":s+":",S(e))for(var l=0;l<e.length;l++){var u=s+x(a=e[l],l);c+=O(a,t,r,u,o)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),l=0;!(a=e.next()).done;)c+=O(a=a.value,t,r,u=s+x(a,l++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function I(e,t,n){if(null==e)return e;var i=[],r=0;return O(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function N(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var _={current:null},D={transition:null},M={ReactCurrentDispatcher:_,ReactCurrentBatchConfig:D,ReactCurrentOwner:T};t.Children={map:I,forEach:function(e,t,n){I(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!P(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=o,t.PureComponent=b,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=f({},e.props),s=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=T.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)C.call(t,l)&&!w.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:n,type:e.type,key:s,ref:o,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=P,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return _.current.useCallback(e,t)},t.useContext=function(e){return _.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return _.current.useDeferredValue(e)},t.useEffect=function(e,t){return _.current.useEffect(e,t)},t.useId=function(){return _.current.useId()},t.useImperativeHandle=function(e,t,n){return _.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return _.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return _.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return _.current.useMemo(e,t)},t.useReducer=function(e,t,n){return _.current.useReducer(e,t,n)},t.useRef=function(e){return _.current.useRef(e)},t.useState=function(e){return _.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return _.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return _.current.useTransition()},t.version="18.2.0"},43:(e,t,n)=>{"use strict";e.exports=n(202)},579:(e,t,n)=>{"use strict";e.exports=n(153)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var a=2*(i+1)-1,c=e[a],l=a+1,u=e[l];if(0>s(c,n))l<r&&0>s(u,c)?(e[i]=u,e[l]=n,i=l):(e[i]=c,e[a]=n,i=a);else{if(!(l<r&&0>s(u,n)))break e;e[i]=u,e[l]=n,i=l}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var l=[],u=[],d=1,h=null,p=3,m=!1,f=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function k(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(l,t)}t=i(u)}}function S(e){if(g=!1,k(e),!f)if(null!==i(l))f=!0,D(C);else{var t=i(u);null!==t&&M(S,t.startTime-e)}}function C(e,n){f=!1,g&&(g=!1,y(P),P=-1),m=!0;var s=p;try{for(k(n),h=i(l);null!==h&&(!(h.expirationTime>n)||e&&!O());){var o=h.callback;if("function"===typeof o){h.callback=null,p=h.priorityLevel;var a=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===i(l)&&r(l),k(n)}else r(l);h=i(l)}if(null!==h)var c=!0;else{var d=i(u);null!==d&&M(S,d.startTime-n),c=!1}return c}finally{h=null,p=s,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,w=!1,E=null,P=-1,R=5,x=-1;function O(){return!(t.unstable_now()-x<R)}function I(){if(null!==E){var e=t.unstable_now();x=e;var n=!0;try{n=E(!0,e)}finally{n?T():(w=!1,E=null)}}else w=!1}if("function"===typeof b)T=function(){b(I)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,_=N.port2;N.port1.onmessage=I,T=function(){_.postMessage(null)}}else T=function(){v(I,0)};function D(e){E=e,w||(w=!0,T())}function M(e,n){P=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,D(C))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,s){var o=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(e.sortIndex=s,n(u,e),null===i(l)&&e===i(u)&&(g?(y(P),P=-1):g=!0,M(S,s-o))):(e.sortIndex=a,n(l,e),f||m||(f=!0,D(C))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},853:(e,t,n)=>{"use strict";e.exports=n(234)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),(()=>{"use strict";var e=n(43),t=n(391),i=n(278);const r=t=>{const n=e.useRef(t);return e.useEffect((()=>{n.current=t})),n};function s(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=s(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}const o=function(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=s(e))&&(i&&(i+=" "),i+=t);return i};function a(e,t){return t.forEach((function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u,d={exports:{}};u=d,function(e,t){u.exports?u.exports=t():e.log=t()}(c,(function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(t,n){for(var r=0;r<i.length;r++){var s=i[r];this[s]=r<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function a(e,n,i){return function(){typeof console!==t&&(o.call(this,n,i),this[e].apply(this,arguments))}}function c(i,o,c){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}(i)||a.apply(this,arguments)}function l(e,n,r){var s,a=this;n=null==n?"WARN":n;var l="loglevel";function u(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(r){}if(typeof e===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(l)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(r){}return void 0===a.levels[e]&&(e=void 0),e}}"string"===typeof e?l+=":"+e:"symbol"===typeof e&&(l=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=r||c,a.getLevel=function(){return s},a.setLevel=function(n,r){if("string"===typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"===typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==r&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(l)+"="+n+";"}catch(r){}}}(n),o.call(a,n,e),typeof console===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){n=e,u()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(n,!1),function(){if(typeof window!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var d=u();null==d&&(d=n),a.setLevel(d,!1)}var u=new l,d={};u.getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new l(e,u.getLevel(),u.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=h),u},u.getLoggers=function(){return d},u.default=u,u}));var h,p,m=d.exports;!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(h||(h={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(p||(p={}));let f=m.getLogger("livekit");function g(e){const t=m.getLogger(e);return t.setDefaultLevel(f.getLevel()),t}function v(e,t){if(!e)throw new Error(t)}f.setDefaultLevel(h.info),m.getLogger("lk-e2ee");const y=34028234663852886e22,b=-34028234663852886e22,k=4294967295,S=2147483647,C=-2147483648;function T(e){if("number"!==typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>S||e<C)throw new Error("invalid int 32: "+e)}function w(e){if("number"!==typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>k||e<0)throw new Error("invalid uint 32: "+e)}function E(e){if("number"!==typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>y||e<b))throw new Error("invalid float 32: "+e)}const P=Symbol("@bufbuild/protobuf/enum-type");function R(e){const t=e[P];return v(t,"missing enum type on enum object"),t}function x(e,t,n,i){e[P]=O(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function O(e,t,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of t){const e=N(o);s.push(e),i[o.name]=e,r[o.no]=e}return{typeName:e,values:s,findName:e=>i[e],findNumber:e=>r[e]}}function I(e,t,n){const i={};for(const r of t){const e=N(r);i[e.localName]=e.no,i[e.no]=e.localName}return x(i,e,t),i}function N(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class _{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null===e||void 0===e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}var D,M;function L(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function A(e,t,n){for(let s=0;s<28;s+=7){const i=e>>>s,r=!(i>>>7==0&&0==t),o=255&(r?128|i:i);if(n.push(o),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),s=255&(r?128|i:i);if(n.push(s),!r)return}n.push(t>>>31&1)}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(D||(D={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(M||(M={}));const U=4294967296;function j(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function s(t,s){const o=Number(e.slice(t,s));r*=n,i=i*n+o,i>=U&&(r+=i/U|0,i%=U)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),t?J(i,r):B(i,r)}function F(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(U*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,s=n+8147497*i,o=2*i;const a=1e7;return r>=a&&(s+=Math.floor(r/a),r%=a),s>=a&&(o+=Math.floor(s/a),s%=a),o.toString()+V(s)+V(r)}function B(e,t){return{lo:0|e,hi:0|t}}function J(e,t){return t=~t,e?e=1+~e:t+=1,B(e,t)}const V=e=>{const t=String(e);return"0000000".slice(t.length)+t};function q(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function z(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!==(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const W=function(){const e=new DataView(new ArrayBuffer(8));if("function"===typeof BigInt&&"function"===typeof e.getBigInt64&&"function"===typeof e.getBigUint64&&"function"===typeof e.setBigInt64&&"function"===typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>v(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>v(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),j(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),j(e)),dec:(e,t)=>function(e,t){let n=B(e,t);const i=2147483648&n.hi;i&&(n=J(n.lo,n.hi));const r=F(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>F(e,t)}}();var K;!function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(K||(K={}));class H{constructor(e){this.stack=[],this.textEncoder=null!==e&&void 0!==e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(w(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return T(e),q(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){E(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){w(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){T(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return T(e),q(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=W.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=W.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=W.enc(e);return A(t.lo,t.hi,this.buf),this}sint64(e){let t=W.enc(e),n=t.hi>>31;return A(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=W.uEnc(e);return A(t.lo,t.hi,this.buf),this}}class G{constructor(e,t){this.varint64=L,this.uint32=z,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!==t&&void 0!==t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e){let t=this.pos;switch(e){case K.Varint:for(;128&this.buf[this.pos++];);break;case K.Bit64:this.pos+=4;case K.Bit32:this.pos+=4;break;case K.LengthDelimited:let t=this.uint32();this.pos+=t;break;case K.StartGroup:let n;for(;(n=this.tag()[1])!==K.EndGroup;)this.skip(n);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return W.dec(...this.varint64())}uint64(){return W.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,W.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return W.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return W.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function Q(e,t){return t instanceof _||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}function Y(e,t,n){if(t===n)return!0;if(e==D.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return t==n}return!1}function $(e,t){switch(e){case D.BOOL:return!1;case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return 0==t?W.zero:"0";case D.DOUBLE:case D.FLOAT:return 0;case D.BYTES:return new Uint8Array(0);case D.STRING:return"";default:return 0}}function X(e,t){const n=void 0===t;let i=K.Varint,r=0===t;switch(e){case D.STRING:r=n||!t.length,i=K.LengthDelimited;break;case D.BOOL:r=!1===t;break;case D.DOUBLE:i=K.Bit64;break;case D.FLOAT:i=K.Bit32;break;case D.INT64:case D.UINT64:r=n||0==t;break;case D.FIXED64:r=n||0==t,i=K.Bit64;break;case D.BYTES:r=n||!t.byteLength,i=K.LengthDelimited;break;case D.FIXED32:case D.SFIXED32:i=K.Bit32;break;case D.SFIXED64:r=n||0==t,i=K.Bit64;break;case D.SINT64:r=n||0==t}return[i,D[e].toLowerCase(),n||r]}D.DOUBLE,D.FLOAT,D.INT64,D.UINT64,D.INT32,D.UINT32,D.BOOL,D.STRING,D.BYTES;const Z=Symbol("@bufbuild/protobuf/unknown-fields"),ee={readUnknownFields:!0,readerFactory:e=>new G(e)},te={writeUnknownFields:!0,writerFactory:()=>new H};function ne(e){return e?Object.assign(Object.assign({},ee),e):ee}function ie(e){return e?Object.assign(Object.assign({},te),e):te}function re(e,t,n){return t.getType().runtime.bin.readMessage(t,e,e.uint32(),n),t}function se(e,t,n){const i=t.uint32(),r=t.pos+i;let s,o;for(;t.pos<r;){let[i]=t.tag();switch(i){case 1:s=ae(t,e.K);break;case 2:switch(e.V.kind){case"scalar":o=ae(t,e.V.T);break;case"enum":o=t.int32();break;case"message":o=re(t,new e.V.T,n)}}}if(void 0===s){let t=$(e.K,M.BIGINT);s=e.K==D.BOOL?t.toString():t}if("string"!=typeof s&&"number"!=typeof s&&(s=s.toString()),void 0===o)switch(e.V.kind){case"scalar":o=$(e.V.T,M.BIGINT);break;case"enum":o=0;break;case"message":o=new e.V.T}return[s,o]}function oe(e,t){const n=ae(e,t);return"bigint"==typeof n?n.toString():n}function ae(e,t){switch(t){case D.STRING:return e.string();case D.BOOL:return e.bool();case D.DOUBLE:return e.double();case D.FLOAT:return e.float();case D.INT32:return e.int32();case D.INT64:return e.int64();case D.UINT64:return e.uint64();case D.FIXED64:return e.fixed64();case D.BYTES:return e.bytes();case D.FIXED32:return e.fixed32();case D.SFIXED32:return e.sfixed32();case D.SFIXED64:return e.sfixed64();case D.SINT64:return e.sint64();case D.UINT32:return e.uint32();case D.SINT32:return e.sint32()}}function ce(e,t,n,i,r){e.tag(n.no,K.LengthDelimited),e.fork();let s=i;switch(n.K){case D.INT32:case D.FIXED32:case D.UINT32:case D.SFIXED32:case D.SINT32:s=Number.parseInt(i);break;case D.BOOL:v("true"==i||"false"==i),s="true"==i}switch(ue(e,n.K,1,s,!0),n.V.kind){case"scalar":ue(e,n.V.T,2,r,!0);break;case"enum":ue(e,D.INT32,2,r,!0);break;case"message":le(e,t,n.V.T,2,r)}e.join()}function le(e,t,n,i,r){if(void 0!==r){const s=Q(n,r);e.tag(i,K.LengthDelimited).bytes(s.toBinary(t))}}function ue(e,t,n,i,r){let[s,o,a]=X(t,i);a&&!r||e.tag(n,s)[o](i)}function de(e,t,n,i){if(!i.length)return;e.tag(n,K.LengthDelimited).fork();let[,r]=X(t);for(let s=0;s<i.length;s++)e[r](i[s]);e.join()}let he="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),pe=[];for(let n=0;n<he.length;n++)pe[he[n].charCodeAt(0)]=n;pe["-".charCodeAt(0)]=he.indexOf("+"),pe["_".charCodeAt(0)]=he.indexOf("/");const me={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,s=0,o=0;for(let a=0;a<e.length;a++){if(n=pe[e.charCodeAt(a)],void 0===n)switch(e[a]){case"=":s=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=n,s=1;break;case 1:i[r++]=o<<2|(48&n)>>4,o=n,s=2;break;case 2:i[r++]=(15&o)<<4|(60&n)>>2,o=n,s=3;break;case 3:i[r++]=(3&o)<<6|n,s=0}}if(1==s)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let s=0;s<e.length;s++)switch(t=e[s],i){case 0:n+=he[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=he[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=he[r|t>>6],n+=he[63&t],i=0}return i&&(n+=he[r],n+="=",1==i&&(n+="=")),n}},fe={ignoreUnknownFields:!1},ge={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function ve(e){return e?Object.assign(Object.assign({},fe),e):fe}function ye(e){return e?Object.assign(Object.assign({},ge),e):ge}function be(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function ke(e,t,n){switch(e){case D.DOUBLE:case D.FLOAT:if(null===t)return 0;if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const r=Number(t);if(Number.isNaN(r))break;if(!Number.isFinite(r))break;return e==D.FLOAT&&E(r),r;case D.INT32:case D.FIXED32:case D.SFIXED32:case D.SINT32:case D.UINT32:if(null===t)return 0;let s;if("number"==typeof t?s=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(s=Number(t)),void 0===s)break;return e==D.UINT32?w(s):T(s),s;case D.INT64:case D.SFIXED64:case D.SINT64:if(null===t)return W.zero;if("number"!=typeof t&&"string"!=typeof t)break;const o=W.parse(t);return n?o.toString():o;case D.FIXED64:case D.UINT64:if(null===t)return W.zero;if("number"!=typeof t&&"string"!=typeof t)break;const a=W.uParse(t);return n?a.toString():a;case D.BOOL:if(null===t)return!1;if("boolean"!==typeof t)break;return t;case D.STRING:if(null===t)return"";if("string"!==typeof t)break;try{encodeURIComponent(t)}catch(i){throw new Error("invalid UTF8")}return t;case D.BYTES:if(null===t||""===t)return new Uint8Array(0);if("string"!==typeof t)break;return me.dec(t)}throw new Error}function Se(e,t,n){if(null===t)return 0;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(i||n)return null===i||void 0===i?void 0:i.no}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(be(t)))}function Ce(e,t,n,i){var r;if(void 0===t)return t;if(0===t&&!n)return;if(i)return t;if("google.protobuf.NullValue"==e.typeName)return null;const s=e.findNumber(t);return null!==(r=null===s||void 0===s?void 0:s.name)&&void 0!==r?r:t}function Te(e,t,n){if(void 0!==t)switch(e){case D.INT32:case D.SFIXED32:case D.SINT32:case D.FIXED32:case D.UINT32:return v("number"==typeof t),0!=t||n?t:void 0;case D.FLOAT:case D.DOUBLE:return v("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":0!==t||n?t:void 0;case D.STRING:return v("string"==typeof t),t.length>0||n?t:void 0;case D.BOOL:return v("boolean"==typeof t),t||n?t:void 0;case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return v("bigint"==typeof t||"string"==typeof t||"number"==typeof t),n||0!=t?t.toString(10):void 0;case D.BYTES:return v(t instanceof Uint8Array),n||t.byteLength>0?me.enc(t):void 0}}function we(e){if(void 0===e)return e;if(e instanceof _)return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Ee(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class Pe{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function Re(e,t){const n=Oe(e);return t?n:Me(De(n))}const xe=Oe;function Oe(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const Ie=new Set(["constructor","toString","toJSON","valueOf"]),Ne=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),_e=e=>"".concat(e,"$"),De=e=>Ne.has(e)?_e(e):e,Me=e=>Ie.has(e)?_e(e):e;class Le{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Re(e,!1)}addField(e){v(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const Ae=(Ue="proto3",je=function(e){const t=e(Ce,Te);return{makeReadOptions:ve,makeWriteOptions:ye,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(this.debug(t)));i=null!==i&&void 0!==i?i:new e;const r={};for(const[o,a]of Object.entries(t)){const t=e.fields.findJsonName(o);if(!t){if(!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(o,'" is unknown'));continue}let c=t.localName,l=i;if(t.oneof){if(null===a&&"scalar"==t.kind)continue;const n=r[t.oneof.localName];if(n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(o,'"'));r[t.oneof.localName]=o,l=l[t.oneof.localName]={case:c},c="value"}if(t.repeated){if(null===a)continue;if(!Array.isArray(a))throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(a)));const i=l[c];for(const r of a){if(null===r)throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(r)));let o;switch(t.kind){case"message":o=t.T.fromJson(r,n);break;case"enum":if(o=Se(t.T,r,n.ignoreUnknownFields),void 0===o)continue;break;case"scalar":try{o=ke(t.T,r,t.L)}catch(s){let n="cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(r));throw s instanceof Error&&s.message.length>0&&(n+=": ".concat(s.message)),new Error(n)}}i.push(o)}}else if("map"==t.kind){if(null===a)continue;if(Array.isArray(a)||"object"!=typeof a)throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(a)));const i=l[c];for(const[r,o]of Object.entries(a)){if(null===o)throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: map value null"));let c;switch(t.V.kind){case"message":c=t.V.T.fromJson(o,n);break;case"enum":if(c=Se(t.V.T,o,n.ignoreUnknownFields),void 0===c)continue;break;case"scalar":try{c=ke(t.V.T,o,M.BIGINT)}catch(s){let n="cannot decode map value for field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(a));throw s instanceof Error&&s.message.length>0&&(n+=": ".concat(s.message)),new Error(n)}}try{i[ke(t.K,t.K==D.BOOL?"true"==r||"false"!=r&&r:r,M.BIGINT).toString()]=c}catch(s){let n="cannot decode map key for field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(a));throw s instanceof Error&&s.message.length>0&&(n+=": ".concat(s.message)),new Error(n)}}}else switch(t.kind){case"message":const i=t.T;if(null===a&&"google.protobuf.Value"!=i.typeName){if(t.oneof)throw new Error("cannot decode field ".concat(e.typeName,".").concat(t.name,' from JSON: null is invalid for oneof field "').concat(o,'"'));continue}l[c]instanceof _?l[c].fromJson(a,n):(l[c]=i.fromJson(a,n),i.fieldWrapper&&!t.oneof&&(l[c]=i.fieldWrapper.unwrapField(l[c])));break;case"enum":const r=Se(t.T,a,n.ignoreUnknownFields);void 0!==r&&(l[c]=r);break;case"scalar":try{l[c]=ke(t.T,a,t.L)}catch(s){let n="cannot decode field ".concat(e.typeName,".").concat(t.name," from JSON: ").concat(this.debug(a));throw s instanceof Error&&s.message.length>0&&(n+=": ".concat(s.message)),new Error(n)}}}return i},writeMessage(e,n){const i=e.getType(),r={};let s;try{for(const o of i.fields.byMember()){let i;if("oneof"==o.kind){const r=e[o.localName];if(void 0===r.value)continue;if(s=o.findField(r.case),!s)throw"oneof case not found: "+r.case;i=t(s,r.value,n)}else s=o,i=t(s,e[s.localName],n);void 0!==i&&(r[n.useProtoFieldName?s.name:s.jsonName]=i)}}catch(o){const e=s?"cannot encode field ".concat(i.typeName,".").concat(s.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),t=o instanceof Error?o.message:String(o);throw new Error(e+(t.length>0?": ".concat(t):""))}return r},readScalar:ke,writeScalar:Te,debug:be}}(((e,t)=>function(n,i,r){if("map"==n.kind){const s={};switch(n.V.kind){case"scalar":for(const[e,r]of Object.entries(i)){const i=t(n.V.T,r,!0);v(void 0!==i),s[e.toString()]=i}break;case"message":for(const[e,t]of Object.entries(i))s[e.toString()]=t.toJson(r);break;case"enum":const o=n.V.T;for(const[t,n]of Object.entries(i)){v(void 0===n||"number"==typeof n);const i=e(o,n,!0,r.enumAsInteger);v(void 0!==i),s[t.toString()]=i}}return r.emitDefaultValues||Object.keys(s).length>0?s:void 0}if(n.repeated){const s=[];switch(n.kind){case"scalar":for(let e=0;e<i.length;e++)s.push(t(n.T,i[e],!0));break;case"enum":for(let t=0;t<i.length;t++)s.push(e(n.T,i[t],!0,r.enumAsInteger));break;case"message":for(let e=0;e<i.length;e++)s.push(Q(n.T,i[e]).toJson(r))}return r.emitDefaultValues||s.length>0?s:void 0}switch(n.kind){case"scalar":return t(n.T,i,!!n.oneof||n.opt||r.emitDefaultValues);case"enum":return e(n.T,i,!!n.oneof||n.opt||r.emitDefaultValues,r.enumAsInteger);case"message":return void 0!==i?Q(n.T,i).toJson(r):void 0}})),Fe=Object.assign(Object.assign({},{makeReadOptions:ne,makeWriteOptions:ie,listUnknownFields(e){var t;return null!==(t=e[Z])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[Z]},writeUnknownFields(e,t){const n=e[Z];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[Z])||(r[Z]=[]),r[Z].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i){const r=e.getType(),s=void 0===n?t.len:t.pos+n;for(;t.pos<s;){const[n,s]=t.tag(),o=r.fields.find(n);if(!o){const r=t.skip(s);i.readUnknownFields&&this.onUnknownField(e,n,s,r);continue}let a=e,c=o.repeated,l=o.localName;switch(o.oneof&&(a=a[o.oneof.localName],a.case!=l&&delete a.value,a.case=l,l="value"),o.kind){case"scalar":case"enum":const e="enum"==o.kind?D.INT32:o.T;let n=ae;if("scalar"==o.kind&&o.L>0&&(n=oe),c){let i=a[l];if(s==K.LengthDelimited&&e!=D.STRING&&e!=D.BYTES){let r=t.uint32()+t.pos;for(;t.pos<r;)i.push(n(t,e))}else i.push(n(t,e))}else a[l]=n(t,e);break;case"message":const r=o.T;c?a[l].push(re(t,new r,i)):a[l]instanceof _?re(t,a[l],i):(a[l]=re(t,new r,i),!r.fieldWrapper||o.oneof||o.repeated||(a[l]=r.fieldWrapper.unwrapField(a[l])));break;case"map":let[u,d]=se(o,t,i);a[l][u]=d}}}}),{writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber()){let i,s=r.repeated,o=r.localName;if(r.oneof){const t=e[r.oneof.localName];if(t.case!==o)continue;i=t.value}else i=e[o];switch(r.kind){case"scalar":case"enum":let e="enum"==r.kind?D.INT32:r.T;if(s)if(r.packed)de(t,e,r.no,i);else for(const n of i)ue(t,e,r.no,n,!0);else void 0!==i&&ue(t,e,r.no,i,!!r.oneof||r.opt);break;case"message":if(s)for(const s of i)le(t,n,r.T,r.no,s);else le(t,n,r.T,r.no,i);break;case"map":for(const[s,o]of Object.entries(i))ce(t,n,r,s,o)}}return n.writeUnknownFields&&this.writeUnknownFields(e,t),t}}),Be=Object.assign(Object.assign({},{setEnumType:x,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,s=e;if(void 0!==s[n])switch(i.kind){case"oneof":const e=s[n].case;if(void 0===e)continue;const t=i.findField(e);let o=s[n].value;!t||"message"!=t.kind||o instanceof t.T?t&&"scalar"===t.kind&&t.T===D.BYTES&&(o=Ee(o)):o=new t.T(o),r[n]={case:e,value:o};break;case"scalar":case"enum":let a=s[n];i.T===D.BYTES&&(a=i.repeated?a.map(Ee):Ee(a)),r[n]=a;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===D.BYTES)for(const[t,i]of Object.entries(s[n]))r[n][t]=Ee(i);else Object.assign(r[n],s[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(s[n])){let i=s[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=s[n].map((e=>e instanceof c?e:new c(e)));else if(void 0!==s[n]){const e=s[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=Ee(e):r[n]=e:r[n]=e instanceof c?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every(((t,n)=>e.T.equals(t,r[n])));case"scalar":return i.every(((t,n)=>Y(e.T,t,r[n])));case"enum":return i.every(((e,t)=>Y(D.INT32,e,r[t])))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(i,r);case"enum":return Y(D.INT32,i,r);case"scalar":return Y(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const t=e.findField(i.case);if(void 0===t)return!0;switch(t.kind){case"message":return t.T.equals(i.value,r.value);case"enum":return Y(D.INT32,i.value,r.value);case"scalar":return Y(t.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(t.kind));case"map":const n=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return n.every((e=>t.equals(i[e],r[e])));case"enum":return n.every((e=>Y(D.INT32,i[e],r[e])));case"scalar":const s=e.V.T;return n.every((e=>Y(s,i[e],r[e])))}}})),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(we);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=we(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:we(t.value)}:{case:void 0}:we(t);i[r.localName]=n}return n}}),{newFieldList:e=>new Pe(e,Xe),initFields(e){for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=$(t.T,t.L)}}}}),{syntax:Ue,json:je,bin:Fe,util:Be,makeMessageType(e,t,n){return function(e,t,n,i){var r;const s=null!==(r=null===i||void 0===i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),o={[s]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[s];return Object.setPrototypeOf(o.prototype,new _),Object.assign(o,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new o).fromBinary(e,t),fromJson:(e,t)=>(new o).fromJson(e,t),fromJsonString:(e,t)=>(new o).fromJsonString(e,t),equals:(t,n)=>e.util.equals(o,t,n)}),o}(this,e,t,n)},makeEnum:I,makeEnumType:O,getEnumType:R});var Ue,je,Fe,Be,Je,Ve,qe,ze,We,Ke,He,Ge,Qe,Ye,$e;function Xe(e){var t,n,i,r;const s=[];let o;for(const a of"function"==typeof e?e():e){const e=a;if(e.localName=Re(a.name,void 0!==a.oneof),e.jsonName=null!==(t=a.jsonName)&&void 0!==t?t:xe(a.name),e.repeated=null!==(n=a.repeated)&&void 0!==n&&n,"scalar"==a.kind&&(e.L=null!==(i=a.L)&&void 0!==i?i:M.BIGINT),e.packed=null!==(r=a.packed)&&void 0!==r?r:"enum"==a.kind||"scalar"==a.kind&&a.T!=D.BYTES&&a.T!=D.STRING,void 0!==a.oneof){const t="string"==typeof a.oneof?a.oneof:a.oneof.name;o&&o.name==t||(o=new Le(t)),e.oneof=o,o.addField(e)}s.push(e)}return s}class Ze extends _{constructor(e){super(),this.seconds=W.zero,this.nanos=0,Ae.util.initPartial(e,this)}fromJson(e,t){if("string"!==typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(Ae.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=W.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return Ze.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Ze({seconds:W.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new Ze).fromBinary(e,t)}static fromJson(e,t){return(new Ze).fromJson(e,t)}static fromJsonString(e,t){return(new Ze).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Ze,e,t)}}Ze.runtime=Ae,Ze.typeName="google.protobuf.Timestamp",Ze.fields=Ae.util.newFieldList((()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}])),function(e){e[e.DEFAULT_AC=0]="DEFAULT_AC",e[e.OPUS=1]="OPUS",e[e.AAC=2]="AAC"}(Je||(Je={})),Ae.util.setEnumType(Je,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),function(e){e[e.DEFAULT_VC=0]="DEFAULT_VC",e[e.H264_BASELINE=1]="H264_BASELINE",e[e.H264_MAIN=2]="H264_MAIN",e[e.H264_HIGH=3]="H264_HIGH",e[e.VP8=4]="VP8"}(Ve||(Ve={})),Ae.util.setEnumType(Ve,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),function(e){e[e.IC_DEFAULT=0]="IC_DEFAULT",e[e.IC_JPEG=1]="IC_JPEG"}(qe||(qe={})),Ae.util.setEnumType(qe,"livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.DATA=2]="DATA"}(ze||(ze={})),Ae.util.setEnumType(ze,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CAMERA=1]="CAMERA",e[e.MICROPHONE=2]="MICROPHONE",e[e.SCREEN_SHARE=3]="SCREEN_SHARE",e[e.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"}(We||(We={})),Ae.util.setEnumType(We,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.OFF=3]="OFF"}(Ke||(Ke={})),Ae.util.setEnumType(Ke,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),function(e){e[e.POOR=0]="POOR",e[e.GOOD=1]="GOOD",e[e.EXCELLENT=2]="EXCELLENT",e[e.LOST=3]="LOST"}(He||(He={})),Ae.util.setEnumType(He,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),function(e){e[e.UNSET=0]="UNSET",e[e.DISABLED=1]="DISABLED",e[e.ENABLED=2]="ENABLED"}(Ge||(Ge={})),Ae.util.setEnumType(Ge,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),function(e){e[e.UNKNOWN_REASON=0]="UNKNOWN_REASON",e[e.CLIENT_INITIATED=1]="CLIENT_INITIATED",e[e.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",e[e.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",e[e.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",e[e.ROOM_DELETED=5]="ROOM_DELETED",e[e.STATE_MISMATCH=6]="STATE_MISMATCH",e[e.JOIN_FAILURE=7]="JOIN_FAILURE"}(Qe||(Qe={})),Ae.util.setEnumType(Qe,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"}]),function(e){e[e.RR_UNKNOWN=0]="RR_UNKNOWN",e[e.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",e[e.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",e[e.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",e[e.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"}(Ye||(Ye={})),Ae.util.setEnumType(Ye,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),function(e){e[e.SE_UNKNOWN=0]="SE_UNKNOWN",e[e.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",e[e.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND"}($e||($e={})),Ae.util.setEnumType($e,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]);let et=class e extends _{constructor(e){super(),this.sid="",this.name="",this.emptyTimeout=0,this.maxParticipants=0,this.creationTime=W.zero,this.turnPassword="",this.enabledCodecs=[],this.metadata="",this.numParticipants=0,this.numPublishers=0,this.activeRecording=!1,Ae.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return Ae.util.equals(e,t,n)}};et.runtime=Ae,et.typeName="livekit.Room",et.fields=Ae.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:tt,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8}]));class tt extends _{constructor(e){super(),this.mime="",this.fmtpLine="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new tt).fromBinary(e,t)}static fromJson(e,t){return(new tt).fromJson(e,t)}static fromJsonString(e,t){return(new tt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(tt,e,t)}}tt.runtime=Ae,tt.typeName="livekit.Codec",tt.fields=Ae.util.newFieldList((()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]));class nt extends _{constructor(e){super(),this.enabled=!1,this.min=0,this.max=0,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new nt).fromBinary(e,t)}static fromJson(e,t){return(new nt).fromJson(e,t)}static fromJsonString(e,t){return(new nt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(nt,e,t)}}nt.runtime=Ae,nt.typeName="livekit.PlayoutDelay",nt.fields=Ae.util.newFieldList((()=>[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]));class it extends _{constructor(e){super(),this.canSubscribe=!1,this.canPublish=!1,this.canPublishData=!1,this.canPublishSources=[],this.hidden=!1,this.recorder=!1,this.canUpdateMetadata=!1,this.agent=!1,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new it).fromBinary(e,t)}static fromJson(e,t){return(new it).fromJson(e,t)}static fromJsonString(e,t){return(new it).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(it,e,t)}}it.runtime=Ae,it.typeName="livekit.ParticipantPermission",it.fields=Ae.util.newFieldList((()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:Ae.getEnumType(We),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8}]));class rt extends _{constructor(e){super(),this.sid="",this.identity="",this.state=st.JOINING,this.tracks=[],this.metadata="",this.joinedAt=W.zero,this.name="",this.version=0,this.region="",this.isPublisher=!1,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new rt).fromBinary(e,t)}static fromJson(e,t){return(new rt).fromJson(e,t)}static fromJsonString(e,t){return(new rt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(rt,e,t)}}var st,ot,at,ct,lt;rt.runtime=Ae,rt.typeName="livekit.ParticipantInfo",rt.fields=Ae.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Ae.getEnumType(st)},{no:4,name:"tracks",kind:"message",T:ht,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:it},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8}])),function(e){e[e.JOINING=0]="JOINING",e[e.JOINED=1]="JOINED",e[e.ACTIVE=2]="ACTIVE",e[e.DISCONNECTED=3]="DISCONNECTED"}(st||(st={})),Ae.util.setEnumType(st,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]);class ut extends _{constructor(e){super(),Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new ut).fromBinary(e,t)}static fromJson(e,t){return(new ut).fromJson(e,t)}static fromJsonString(e,t){return(new ut).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(ut,e,t)}}ut.runtime=Ae,ut.typeName="livekit.Encryption",ut.fields=Ae.util.newFieldList((()=>[])),function(e){e[e.NONE=0]="NONE",e[e.GCM=1]="GCM",e[e.CUSTOM=2]="CUSTOM"}(ot||(ot={})),Ae.util.setEnumType(ot,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);class dt extends _{constructor(e){super(),this.mimeType="",this.mid="",this.cid="",this.layers=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new dt).fromBinary(e,t)}static fromJson(e,t){return(new dt).fromJson(e,t)}static fromJsonString(e,t){return(new dt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(dt,e,t)}}dt.runtime=Ae,dt.typeName="livekit.SimulcastCodecInfo",dt.fields=Ae.util.newFieldList((()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:pt,repeated:!0}]));class ht extends _{constructor(e){super(),this.sid="",this.type=ze.AUDIO,this.name="",this.muted=!1,this.width=0,this.height=0,this.simulcast=!1,this.disableDtx=!1,this.source=We.UNKNOWN,this.layers=[],this.mimeType="",this.mid="",this.codecs=[],this.stereo=!1,this.disableRed=!1,this.encryption=ot.NONE,this.stream="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new ht).fromBinary(e,t)}static fromJson(e,t){return(new ht).fromJson(e,t)}static fromJsonString(e,t){return(new ht).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(ht,e,t)}}ht.runtime=Ae,ht.typeName="livekit.TrackInfo",ht.fields=Ae.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:Ae.getEnumType(ze)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:Ae.getEnumType(We)},{no:10,name:"layers",kind:"message",T:pt,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:dt,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:Ae.getEnumType(ot)},{no:17,name:"stream",kind:"scalar",T:9}]));class pt extends _{constructor(e){super(),this.quality=Ke.LOW,this.width=0,this.height=0,this.bitrate=0,this.ssrc=0,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new pt).fromBinary(e,t)}static fromJson(e,t){return(new pt).fromJson(e,t)}static fromJsonString(e,t){return(new pt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(pt,e,t)}}pt.runtime=Ae,pt.typeName="livekit.VideoLayer",pt.fields=Ae.util.newFieldList((()=>[{no:1,name:"quality",kind:"enum",T:Ae.getEnumType(Ke)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]));class mt extends _{constructor(e){super(),this.kind=at.RELIABLE,this.value={case:void 0},Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new mt).fromBinary(e,t)}static fromJson(e,t){return(new mt).fromJson(e,t)}static fromJsonString(e,t){return(new mt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(mt,e,t)}}mt.runtime=Ae,mt.typeName="livekit.DataPacket",mt.fields=Ae.util.newFieldList((()=>[{no:1,name:"kind",kind:"enum",T:Ae.getEnumType(at)},{no:2,name:"user",kind:"message",T:vt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ft,oneof:"value"}])),function(e){e[e.RELIABLE=0]="RELIABLE",e[e.LOSSY=1]="LOSSY"}(at||(at={})),Ae.util.setEnumType(at,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);class ft extends _{constructor(e){super(),this.speakers=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new ft).fromBinary(e,t)}static fromJson(e,t){return(new ft).fromJson(e,t)}static fromJsonString(e,t){return(new ft).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(ft,e,t)}}ft.runtime=Ae,ft.typeName="livekit.ActiveSpeakerUpdate",ft.fields=Ae.util.newFieldList((()=>[{no:1,name:"speakers",kind:"message",T:gt,repeated:!0}]));class gt extends _{constructor(e){super(),this.sid="",this.level=0,this.active=!1,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new gt).fromBinary(e,t)}static fromJson(e,t){return(new gt).fromJson(e,t)}static fromJsonString(e,t){return(new gt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(gt,e,t)}}gt.runtime=Ae,gt.typeName="livekit.SpeakerInfo",gt.fields=Ae.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]));class vt extends _{constructor(e){super(),this.participantSid="",this.participantIdentity="",this.payload=new Uint8Array(0),this.destinationSids=[],this.destinationIdentities=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new vt).fromBinary(e,t)}static fromJson(e,t){return(new vt).fromJson(e,t)}static fromJsonString(e,t){return(new vt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(vt,e,t)}}vt.runtime=Ae,vt.typeName="livekit.UserPacket",vt.fields=Ae.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0}]));class yt extends _{constructor(e){super(),this.participantSid="",this.trackSids=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new yt).fromBinary(e,t)}static fromJson(e,t){return(new yt).fromJson(e,t)}static fromJsonString(e,t){return(new yt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(yt,e,t)}}yt.runtime=Ae,yt.typeName="livekit.ParticipantTracks",yt.fields=Ae.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]));class bt extends _{constructor(e){super(),this.edition=ct.Standard,this.version="",this.protocol=0,this.region="",this.nodeId="",this.debugInfo="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new bt).fromBinary(e,t)}static fromJson(e,t){return(new bt).fromJson(e,t)}static fromJsonString(e,t){return(new bt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(bt,e,t)}}bt.runtime=Ae,bt.typeName="livekit.ServerInfo",bt.fields=Ae.util.newFieldList((()=>[{no:1,name:"edition",kind:"enum",T:Ae.getEnumType(ct)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9}])),function(e){e[e.Standard=0]="Standard",e[e.Cloud=1]="Cloud"}(ct||(ct={})),Ae.util.setEnumType(ct,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);class kt extends _{constructor(e){super(),this.sdk=lt.UNKNOWN,this.version="",this.protocol=0,this.os="",this.osVersion="",this.deviceModel="",this.browser="",this.browserVersion="",this.address="",this.network="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new kt).fromBinary(e,t)}static fromJson(e,t){return(new kt).fromJson(e,t)}static fromJsonString(e,t){return(new kt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(kt,e,t)}}kt.runtime=Ae,kt.typeName="livekit.ClientInfo",kt.fields=Ae.util.newFieldList((()=>[{no:1,name:"sdk",kind:"enum",T:Ae.getEnumType(lt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}])),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JS=1]="JS",e[e.SWIFT=2]="SWIFT",e[e.ANDROID=3]="ANDROID",e[e.FLUTTER=4]="FLUTTER",e[e.GO=5]="GO",e[e.UNITY=6]="UNITY",e[e.REACT_NATIVE=7]="REACT_NATIVE",e[e.RUST=8]="RUST",e[e.PYTHON=9]="PYTHON",e[e.CPP=10]="CPP"}(lt||(lt={})),Ae.util.setEnumType(lt,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"}]);class St extends _{constructor(e){super(),this.resumeConnection=Ge.UNSET,this.forceRelay=Ge.UNSET,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new St).fromBinary(e,t)}static fromJson(e,t){return(new St).fromJson(e,t)}static fromJsonString(e,t){return(new St).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(St,e,t)}}St.runtime=Ae,St.typeName="livekit.ClientConfiguration",St.fields=Ae.util.newFieldList((()=>[{no:1,name:"video",kind:"message",T:Ct},{no:2,name:"screen",kind:"message",T:Ct},{no:3,name:"resume_connection",kind:"enum",T:Ae.getEnumType(Ge)},{no:4,name:"disabled_codecs",kind:"message",T:Tt},{no:5,name:"force_relay",kind:"enum",T:Ae.getEnumType(Ge)}]));class Ct extends _{constructor(e){super(),this.hardwareEncoder=Ge.UNSET,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Ct).fromBinary(e,t)}static fromJson(e,t){return(new Ct).fromJson(e,t)}static fromJsonString(e,t){return(new Ct).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Ct,e,t)}}Ct.runtime=Ae,Ct.typeName="livekit.VideoConfiguration",Ct.fields=Ae.util.newFieldList((()=>[{no:1,name:"hardware_encoder",kind:"enum",T:Ae.getEnumType(Ge)}]));class Tt extends _{constructor(e){super(),this.codecs=[],this.publish=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Tt).fromBinary(e,t)}static fromJson(e,t){return(new Tt).fromJson(e,t)}static fromJsonString(e,t){return(new Tt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Tt,e,t)}}Tt.runtime=Ae,Tt.typeName="livekit.DisabledCodecs",Tt.fields=Ae.util.newFieldList((()=>[{no:1,name:"codecs",kind:"message",T:tt,repeated:!0},{no:2,name:"publish",kind:"message",T:tt,repeated:!0}]));class wt extends _{constructor(e){super(),this.duration=0,this.startTimestamp=W.zero,this.endTimestamp=W.zero,this.rtpClockTicks=W.zero,this.driftSamples=W.zero,this.driftMs=0,this.clockRate=0,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new wt).fromBinary(e,t)}static fromJson(e,t){return(new wt).fromJson(e,t)}static fromJsonString(e,t){return(new wt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(wt,e,t)}}wt.runtime=Ae,wt.typeName="livekit.RTPDrift",wt.fields=Ae.util.newFieldList((()=>[{no:1,name:"start_time",kind:"message",T:Ze},{no:2,name:"end_time",kind:"message",T:Ze},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"start_timestamp",kind:"scalar",T:4},{no:5,name:"end_timestamp",kind:"scalar",T:4},{no:6,name:"rtp_clock_ticks",kind:"scalar",T:4},{no:7,name:"drift_samples",kind:"scalar",T:3},{no:8,name:"drift_ms",kind:"scalar",T:1},{no:9,name:"clock_rate",kind:"scalar",T:1}]));class Et extends _{constructor(e){super(),this.duration=0,this.packets=0,this.packetRate=0,this.bytes=W.zero,this.headerBytes=W.zero,this.bitrate=0,this.packetsLost=0,this.packetLossRate=0,this.packetLossPercentage=0,this.packetsDuplicate=0,this.packetDuplicateRate=0,this.bytesDuplicate=W.zero,this.headerBytesDuplicate=W.zero,this.bitrateDuplicate=0,this.packetsPadding=0,this.packetPaddingRate=0,this.bytesPadding=W.zero,this.headerBytesPadding=W.zero,this.bitratePadding=0,this.packetsOutOfOrder=0,this.frames=0,this.frameRate=0,this.jitterCurrent=0,this.jitterMax=0,this.gapHistogram={},this.nacks=0,this.nackAcks=0,this.nackMisses=0,this.nackRepeated=0,this.plis=0,this.firs=0,this.rttCurrent=0,this.rttMax=0,this.keyFrames=0,this.layerLockPlis=0,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Et).fromBinary(e,t)}static fromJson(e,t){return(new Et).fromJson(e,t)}static fromJsonString(e,t){return(new Et).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Et,e,t)}}Et.runtime=Ae,Et.typeName="livekit.RTPStats",Et.fields=Ae.util.newFieldList((()=>[{no:1,name:"start_time",kind:"message",T:Ze},{no:2,name:"end_time",kind:"message",T:Ze},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:Ze},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:Ze},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:Ze},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:Ze},{no:44,name:"packet_drift",kind:"message",T:wt},{no:45,name:"report_drift",kind:"message",T:wt}]));class Pt extends _{constructor(e){super(),this.unixMicro=W.zero,this.ticks=0,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Pt).fromBinary(e,t)}static fromJson(e,t){return(new Pt).fromJson(e,t)}static fromJsonString(e,t){return(new Pt).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Pt,e,t)}}Pt.runtime=Ae,Pt.typeName="livekit.TimedVersion",Pt.fields=Ae.util.newFieldList((()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]));const Rt=7e3,xt=[0,300,1200,2700,4800,Rt,Rt,Rt,Rt,Rt];function Ot(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function It(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nt(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=It(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,r,(t=e[n](t)).done,t.value)}))}}}"function"===typeof SuppressedError&&SuppressedError;var _t,Dt={exports:{}},Mt="object"===typeof Reflect?Reflect:null,Lt=Mt&&"function"===typeof Mt.apply?Mt.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};_t=Mt&&"function"===typeof Mt.ownKeys?Mt.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var At=Number.isNaN||function(e){return e!==e};function Ut(){Ut.init.call(this)}Dt.exports=Ut,Dt.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,s),i(n)}function s(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}Ht(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&Ht(e,"error",t,n)}(e,r,{once:!0})}))},Ut.EventEmitter=Ut,Ut.prototype._events=void 0,Ut.prototype._eventsCount=0,Ut.prototype._maxListeners=void 0;var jt=10;function Ft(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function Bt(e){return void 0===e._maxListeners?Ut.defaultMaxListeners:e._maxListeners}function Jt(e,t,n,i){var r,s,o,a;if(Ft(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"===typeof o?o=s[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=Bt(e))>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function Vt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qt(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=Vt.bind(i);return r.listener=n,i.wrapFn=r,r}function zt(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):Kt(r,r.length)}function Wt(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function Kt(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function Ht(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){i.once&&e.removeEventListener(t,r),n(s)}))}}Object.defineProperty(Ut,"defaultMaxListeners",{enumerable:!0,get:function(){return jt},set:function(e){if("number"!==typeof e||e<0||At(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");jt=e}}),Ut.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ut.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||At(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},Ut.prototype.getMaxListeners=function(){return Bt(this)},Ut.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=r[e];if(void 0===a)return!1;if("function"===typeof a)Lt(a,this,t);else{var c=a.length,l=Kt(a,c);for(n=0;n<c;++n)Lt(l[n],this,t)}return!0},Ut.prototype.addListener=function(e,t){return Jt(this,e,t,!1)},Ut.prototype.on=Ut.prototype.addListener,Ut.prototype.prependListener=function(e,t){return Jt(this,e,t,!0)},Ut.prototype.once=function(e,t){return Ft(t),this.on(e,qt(this,e,t)),this},Ut.prototype.prependOnceListener=function(e,t){return Ft(t),this.prependListener(e,qt(this,e,t)),this},Ut.prototype.removeListener=function(e,t){var n,i,r,s,o;if(Ft(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},Ut.prototype.off=Ut.prototype.removeListener,Ut.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},Ut.prototype.listeners=function(e){return zt(this,e,!0)},Ut.prototype.rawListeners=function(e){return zt(this,e,!1)},Ut.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):Wt.call(e,t)},Ut.prototype.listenerCount=Wt,Ut.prototype.eventNames=function(){return this._eventsCount>0?_t(this._events):[]};var Gt=Dt.exports;let Qt=!0,Yt=!0;function $t(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function Xt(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const s=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,s),r.apply(this,[e,s])};const s=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(n))return s.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Zt(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Qt=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function en(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Yt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function tn(){if("object"===typeof window){if(Qt)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function nn(e,t){Yt&&console.warn(e+" is deprecated, please use "+t+" instead.")}function rn(e){return"[object Object]"===Object.prototype.toString.call(e)}function sn(e){return rn(e)?Object.keys(e).reduce((function(t,n){const i=rn(e[n]),r=i?sn(e[n]):e[n],s=i&&!Object.keys(r).length;return void 0===r||s?t:Object.assign(t,{[n]:r})}),{}):e}function on(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?on(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{on(e,e.get(t),n)}))})))}function an(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&on(e,n,r)}))})),r}const cn=tn;function ln(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"===typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"===typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"===typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!==typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===typeof e.video){let s=e.video.facingMode;s=s&&("object"===typeof s?s:{ideal:s});const o=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let o=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!o&&n.length&&t.includes("back")&&(o=n[n.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=i(e.video),cn("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return cn("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(s(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function un(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function dn(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Xt(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function hn(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function pn(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"===typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!==typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){n(s(r(e)))};return t.apply(this,[i,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(s(r(t)))},n])})).then(n,i)}}function mn(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>an(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Xt(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>an(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function fn(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function gn(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return fn(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"===typeof arguments[0]?n.apply(this,[t=>{const n=s(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function vn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function yn(e,t){Xt(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var bn=Object.freeze({__proto__:null,fixNegotiationNeeded:yn,shimAddTrackRemoveTrack:gn,shimAddTrackRemoveTrackWithNative:fn,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"===typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:hn,shimGetStats:pn,shimGetUserMedia:ln,shimMediaStream:un,shimOnTrack:dn,shimPeerConnection:vn,shimSenderReceiverGetStats:mn});function kn(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){nn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"===typeof n&&"object"===typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"===typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function Sn(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cn(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,s]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(i){if("TypeError"!==i.name)throw i;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,s)}}function Tn(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function wn(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Xt(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function En(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){nn("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function Pn(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Rn(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function xn(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function On(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function In(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Nn=Object.freeze({__proto__:null,shimAddTransceiver:Rn,shimCreateAnswer:In,shimCreateOffer:On,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:xn,shimGetUserMedia:kn,shimOnTrack:Sn,shimPeerConnection:Cn,shimRTCDataChannel:Pn,shimReceiverGetStats:wn,shimRemoveStream:En,shimSenderGetStats:Tn});function _n(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Dn(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Mn(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let a=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=a,a=function(e,t,n){const i=s.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=a,a=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=a}function Ln(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(An(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function An(e){return e&&void 0!==e.video?Object.assign({},e,{video:sn(e.video)}):e}function Un(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(nn("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function jn(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Fn(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Bn(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Jn=Object.freeze({__proto__:null,shimAudioContext:Bn,shimCallbacksAPI:Mn,shimConstraints:An,shimCreateOfferLegacy:Fn,shimGetUserMedia:Ln,shimLocalStreamsAPI:_n,shimRTCIceServerUrls:Un,shimRemoteStreamsAPI:Dn,shimTrackEventTransceiver:jn}),Vn={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<i.length;r++)n=i[r].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let s=3;s<i.length;s++){const r=i[s],o=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){const i=t.parseRtpMap(o),s=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=s.length?t.parseFmtp(s[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{r.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=o.length>0&&o[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(c=l[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const s=t.matchPrefix(e,"a=rtcp-mux");return n.mux=s.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const s=void 0!==n?n:2;r=e||t.generateSessionId();return"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Vn);var qn=Vn.exports,zn=l(qn),Wn=a({__proto__:null,default:zn},[qn]);function Kn(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=zn.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Xt(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Hn(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Xt(e,"icecandidate",(e=>{if(e.candidate){const t=zn.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Gn(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=zn.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=zn.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!==n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=zn.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>r}),this._sctp=s}return n.apply(this,arguments)}}function Qn(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Xt(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Yn(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function $n(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Xn(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Zn(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var ei=Object.freeze({__proto__:null,removeExtmapAllowMixed:$n,shimAddIceCandidateNullOrEmpty:Xn,shimConnectionState:Yn,shimMaxMessageSize:Gn,shimParameterlessSetLocalDescription:Zn,shimRTCIceCandidate:Kn,shimRTCIceCandidateRelayProtocol:Hn,shimSendThrowTypeError:Qn});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=tn,i=function(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=$t(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=$t(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=$t(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:i,commonShim:ei,extractVersion:$t,disableLog:Zt,disableWarnings:en,sdp:Wn};switch(i.browser){case"chrome":if(!bn||!vn||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=bn,Xn(e,i),Zn(e),ln(e,i),un(e),vn(e,i),dn(e),gn(e,i),hn(e),pn(e),mn(e),yn(e,i),Kn(e),Hn(e),Yn(e),Gn(e,i),Qn(e),$n(e,i);break;case"firefox":if(!Nn||!Cn||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Nn,Xn(e,i),Zn(e),kn(e,i),Cn(e,i),Sn(e),En(e),Tn(e),wn(e),Pn(e),Rn(e),xn(e),On(e),In(e),Kn(e),Yn(e),Gn(e,i),Qn(e);break;case"safari":if(!Jn||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Jn,Xn(e,i),Zn(e),Un(e),Fn(e),Mn(e),_n(e),Dn(e),jn(e),Ln(e),Bn(e),Kn(e),Hn(e),Gn(e,i),Qn(e),$n(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"===typeof window?void 0:window});const ti="lk_e2ee";var ni,ii,ri,si;function oi(){return"undefined"!==typeof window.RTCRtpSender&&"undefined"!==typeof window.RTCRtpSender.prototype.createEncodedStreams||ai()}function ai(){return"undefined"!==typeof window.RTCRtpScriptTransform}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(ni||(ni={})),function(e){e.KeyRatcheted="keyRatcheted"}(ii||(ii={})),function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(ri||(ri={})),function(e){e.Error="cryptorError"}(si||(si={}));Gt.EventEmitter;class ci extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}class li extends ci{constructor(e,t,n){super(1,e),this.status=n,this.reason=t}}class ui extends ci{constructor(e){super(21,null!==e&&void 0!==e?e:"device is unsupported")}}class di extends ci{constructor(e){super(20,null!==e&&void 0!==e?e:"track is invalid")}}class hi extends ci{constructor(e){super(10,null!==e&&void 0!==e?e:"unsupported server")}}class pi extends ci{constructor(e){super(12,null!==e&&void 0!==e?e:"unexpected connection state")}}class mi extends ci{constructor(e){super(13,null!==e&&void 0!==e?e:"unable to negotiate")}}var fi,gi,vi,yi,bi;function ki(e,t,n){var i,r,s;void 0===t&&(t=50),void 0===n&&(n={});var o=null!=(i=n.isImmediate)&&i,a=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise((function(i,r){var c=o&&void 0===s;if(void 0!==s&&clearTimeout(s),s=setTimeout((function(){if(s=void 0,l=Date.now(),!o){var i=e.apply(n,t);a&&a(i),u.forEach((function(e){return(0,e.resolve)(i)})),u=[]}}),d()),c){var h=e.apply(n,t);return a&&a(h),i(h)}u.push({resolve:i,reject:r})}))};return h.cancel=function(e){void 0!==s&&clearTimeout(s),u.forEach((function(t){return(0,t.reject)(e)})),u=[]},h}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(fi||(fi={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(fi||(fi={})),function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.StateChanged="connectionStateChanged",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged"}(gi||(gi={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded"}(vi||(vi={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished"}(yi||(yi={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed"}(bi||(bi={}));const Si=/version\/(\d+(\.?_?\d+)+)/i;let Ci;function Ti(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("undefined"===typeof e&&"undefined"===typeof navigator)return;const n=(null!==e&&void 0!==e?e:navigator.userAgent).toLowerCase();if(void 0===Ci||t){const e=wi.find((e=>{let{test:t}=e;return t.test(n)}));Ci=null===e||void 0===e?void 0:e.describe(n)}return Ci}const wi=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:Ei(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:Ei(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:Ei(Si,e),os:e.includes("mobile/")?"iOS":"macOS"})}];function Ei(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}class Pi{}Pi.setTimeout=function(){return setTimeout(...arguments)},Pi.setInterval=function(){return setInterval(...arguments)},Pi.clearTimeout=function(){return clearTimeout(...arguments)},Pi.clearInterval=function(){return clearInterval(...arguments)};class Ri{constructor(e,t,n,i,r){this.width=e,this.height=t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}const xi=["vp8","h264"],Oi=["vp8","h264","vp9","av1"];function Ii(e){return!!xi.find((t=>t===e))}var Ni;!function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:2e4},e.music={maxBitrate:32e3},e.musicStereo={maxBitrate:48e3},e.musicHighQuality={maxBitrate:64e3},e.musicHighQualityStereo={maxBitrate:96e3}}(Ni||(Ni={}));const _i={h90:new Ri(160,90,9e4,20),h180:new Ri(320,180,16e4,20),h216:new Ri(384,216,18e4,20),h360:new Ri(640,360,45e4,20),h540:new Ri(960,540,8e5,25),h720:new Ri(1280,720,17e5,30),h1080:new Ri(1920,1080,3e6,30),h1440:new Ri(2560,1440,5e6,30),h2160:new Ri(3840,2160,8e6,30)},Di={h120:new Ri(160,120,7e4,20),h180:new Ri(240,180,125e3,20),h240:new Ri(320,240,14e4,20),h360:new Ri(480,360,33e4,20),h480:new Ri(640,480,5e5,20),h540:new Ri(720,540,6e5,25),h720:new Ri(960,720,13e5,30),h1080:new Ri(1440,1080,23e5,30),h1440:new Ri(1920,1440,38e5,30)},Mi={h360fps3:new Ri(640,360,2e5,3,"medium"),h360fps15:new Ri(640,360,4e5,15,"medium"),h720fps5:new Ri(1280,720,8e5,5,"medium"),h720fps15:new Ri(1280,720,15e5,15,"medium"),h720fps30:new Ri(1280,720,2e6,30,"medium"),h1080fps15:new Ri(1920,1080,25e5,15,"medium"),h1080fps30:new Ri(1920,1080,5e6,30,"medium"),original:new Ri(0,0,7e6,30,"medium")};var Li,Ai,Ui;!function(e){e[e.PUBLISHER=0]="PUBLISHER",e[e.SUBSCRIBER=1]="SUBSCRIBER"}(Li||(Li={})),Ae.util.setEnumType(Li,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),function(e){e[e.ACTIVE=0]="ACTIVE",e[e.PAUSED=1]="PAUSED"}(Ai||(Ai={})),Ae.util.setEnumType(Ai,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.TLS=2]="TLS"}(Ui||(Ui={})),Ae.util.setEnumType(Ui,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]);class ji extends _{constructor(e){super(),this.message={case:void 0},Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new ji).fromBinary(e,t)}static fromJson(e,t){return(new ji).fromJson(e,t)}static fromJsonString(e,t){return(new ji).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(ji,e,t)}}ji.runtime=Ae,ji.typeName="livekit.SignalRequest",ji.fields=Ae.util.newFieldList((()=>[{no:1,name:"offer",kind:"message",T:Gi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Gi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Vi,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Ji,oneof:"message"},{no:5,name:"mute",kind:"message",T:qi,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Yi,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:$i,oneof:"message"},{no:8,name:"leave",kind:"message",T:Xi,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Zi,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:hr,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:mr,oneof:"message"},{no:13,name:"simulate",kind:"message",T:gr,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:er,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:vr,oneof:"message"}]));class Fi extends _{constructor(e){super(),this.message={case:void 0},Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Fi).fromBinary(e,t)}static fromJson(e,t){return(new Fi).fromJson(e,t)}static fromJsonString(e,t){return(new Fi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Fi,e,t)}}Fi.runtime=Ae,Fi.typeName="livekit.SignalResponse",Fi.fields=Ae.util.newFieldList((()=>[{no:1,name:"join",kind:"message",T:zi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Gi,oneof:"message"},{no:3,name:"offer",kind:"message",T:Gi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Vi,oneof:"message"},{no:5,name:"update",kind:"message",T:Qi,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Ki,oneof:"message"},{no:8,name:"leave",kind:"message",T:Xi,oneof:"message"},{no:9,name:"mute",kind:"message",T:qi,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:nr,oneof:"message"},{no:11,name:"room_update",kind:"message",T:ir,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:sr,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:ar,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:ur,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:pr,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Hi,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Wi,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:yr,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Sr,oneof:"message"}]));class Bi extends _{constructor(e){super(),this.codec="",this.cid="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Bi).fromBinary(e,t)}static fromJson(e,t){return(new Bi).fromJson(e,t)}static fromJsonString(e,t){return(new Bi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Bi,e,t)}}Bi.runtime=Ae,Bi.typeName="livekit.SimulcastCodec",Bi.fields=Ae.util.newFieldList((()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]));class Ji extends _{constructor(e){super(),this.cid="",this.name="",this.type=ze.AUDIO,this.width=0,this.height=0,this.muted=!1,this.disableDtx=!1,this.source=We.UNKNOWN,this.layers=[],this.simulcastCodecs=[],this.sid="",this.stereo=!1,this.disableRed=!1,this.encryption=ot.NONE,this.stream="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Ji).fromBinary(e,t)}static fromJson(e,t){return(new Ji).fromJson(e,t)}static fromJsonString(e,t){return(new Ji).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Ji,e,t)}}Ji.runtime=Ae,Ji.typeName="livekit.AddTrackRequest",Ji.fields=Ae.util.newFieldList((()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:Ae.getEnumType(ze)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:Ae.getEnumType(We)},{no:9,name:"layers",kind:"message",T:pt,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Bi,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:Ae.getEnumType(ot)},{no:15,name:"stream",kind:"scalar",T:9}]));class Vi extends _{constructor(e){super(),this.candidateInit="",this.target=Li.PUBLISHER,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Vi).fromBinary(e,t)}static fromJson(e,t){return(new Vi).fromJson(e,t)}static fromJsonString(e,t){return(new Vi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Vi,e,t)}}Vi.runtime=Ae,Vi.typeName="livekit.TrickleRequest",Vi.fields=Ae.util.newFieldList((()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:Ae.getEnumType(Li)}]));class qi extends _{constructor(e){super(),this.sid="",this.muted=!1,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new qi).fromBinary(e,t)}static fromJson(e,t){return(new qi).fromJson(e,t)}static fromJsonString(e,t){return(new qi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(qi,e,t)}}qi.runtime=Ae,qi.typeName="livekit.MuteTrackRequest",qi.fields=Ae.util.newFieldList((()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]));class zi extends _{constructor(e){super(),this.otherParticipants=[],this.serverVersion="",this.iceServers=[],this.subscriberPrimary=!1,this.alternativeUrl="",this.serverRegion="",this.pingTimeout=0,this.pingInterval=0,this.sifTrailer=new Uint8Array(0),Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new zi).fromBinary(e,t)}static fromJson(e,t){return(new zi).fromJson(e,t)}static fromJsonString(e,t){return(new zi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(zi,e,t)}}zi.runtime=Ae,zi.typeName="livekit.JoinResponse",zi.fields=Ae.util.newFieldList((()=>[{no:1,name:"room",kind:"message",T:et},{no:2,name:"participant",kind:"message",T:rt},{no:3,name:"other_participants",kind:"message",T:rt,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:tr,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:St},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:bt},{no:13,name:"sif_trailer",kind:"scalar",T:12}]));class Wi extends _{constructor(e){super(),this.iceServers=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Wi).fromBinary(e,t)}static fromJson(e,t){return(new Wi).fromJson(e,t)}static fromJsonString(e,t){return(new Wi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Wi,e,t)}}Wi.runtime=Ae,Wi.typeName="livekit.ReconnectResponse",Wi.fields=Ae.util.newFieldList((()=>[{no:1,name:"ice_servers",kind:"message",T:tr,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:St}]));class Ki extends _{constructor(e){super(),this.cid="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Ki).fromBinary(e,t)}static fromJson(e,t){return(new Ki).fromJson(e,t)}static fromJsonString(e,t){return(new Ki).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Ki,e,t)}}Ki.runtime=Ae,Ki.typeName="livekit.TrackPublishedResponse",Ki.fields=Ae.util.newFieldList((()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ht}]));class Hi extends _{constructor(e){super(),this.trackSid="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Hi).fromBinary(e,t)}static fromJson(e,t){return(new Hi).fromJson(e,t)}static fromJsonString(e,t){return(new Hi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Hi,e,t)}}Hi.runtime=Ae,Hi.typeName="livekit.TrackUnpublishedResponse",Hi.fields=Ae.util.newFieldList((()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]));class Gi extends _{constructor(e){super(),this.type="",this.sdp="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Gi).fromBinary(e,t)}static fromJson(e,t){return(new Gi).fromJson(e,t)}static fromJsonString(e,t){return(new Gi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Gi,e,t)}}Gi.runtime=Ae,Gi.typeName="livekit.SessionDescription",Gi.fields=Ae.util.newFieldList((()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]));class Qi extends _{constructor(e){super(),this.participants=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Qi).fromBinary(e,t)}static fromJson(e,t){return(new Qi).fromJson(e,t)}static fromJsonString(e,t){return(new Qi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Qi,e,t)}}Qi.runtime=Ae,Qi.typeName="livekit.ParticipantUpdate",Qi.fields=Ae.util.newFieldList((()=>[{no:1,name:"participants",kind:"message",T:rt,repeated:!0}]));class Yi extends _{constructor(e){super(),this.trackSids=[],this.subscribe=!1,this.participantTracks=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Yi).fromBinary(e,t)}static fromJson(e,t){return(new Yi).fromJson(e,t)}static fromJsonString(e,t){return(new Yi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Yi,e,t)}}Yi.runtime=Ae,Yi.typeName="livekit.UpdateSubscription",Yi.fields=Ae.util.newFieldList((()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:yt,repeated:!0}]));class $i extends _{constructor(e){super(),this.trackSids=[],this.disabled=!1,this.quality=Ke.LOW,this.width=0,this.height=0,this.fps=0,this.priority=0,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new $i).fromBinary(e,t)}static fromJson(e,t){return(new $i).fromJson(e,t)}static fromJsonString(e,t){return(new $i).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals($i,e,t)}}$i.runtime=Ae,$i.typeName="livekit.UpdateTrackSettings",$i.fields=Ae.util.newFieldList((()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:Ae.getEnumType(Ke)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]));class Xi extends _{constructor(e){super(),this.canReconnect=!1,this.reason=Qe.UNKNOWN_REASON,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Xi).fromBinary(e,t)}static fromJson(e,t){return(new Xi).fromJson(e,t)}static fromJsonString(e,t){return(new Xi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Xi,e,t)}}Xi.runtime=Ae,Xi.typeName="livekit.LeaveRequest",Xi.fields=Ae.util.newFieldList((()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:Ae.getEnumType(Qe)}]));class Zi extends _{constructor(e){super(),this.trackSid="",this.layers=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Zi).fromBinary(e,t)}static fromJson(e,t){return(new Zi).fromJson(e,t)}static fromJsonString(e,t){return(new Zi).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Zi,e,t)}}Zi.runtime=Ae,Zi.typeName="livekit.UpdateVideoLayers",Zi.fields=Ae.util.newFieldList((()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:pt,repeated:!0}]));class er extends _{constructor(e){super(),this.metadata="",this.name="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new er).fromBinary(e,t)}static fromJson(e,t){return(new er).fromJson(e,t)}static fromJsonString(e,t){return(new er).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(er,e,t)}}er.runtime=Ae,er.typeName="livekit.UpdateParticipantMetadata",er.fields=Ae.util.newFieldList((()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}]));class tr extends _{constructor(e){super(),this.urls=[],this.username="",this.credential="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new tr).fromBinary(e,t)}static fromJson(e,t){return(new tr).fromJson(e,t)}static fromJsonString(e,t){return(new tr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(tr,e,t)}}tr.runtime=Ae,tr.typeName="livekit.ICEServer",tr.fields=Ae.util.newFieldList((()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]));class nr extends _{constructor(e){super(),this.speakers=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new nr).fromBinary(e,t)}static fromJson(e,t){return(new nr).fromJson(e,t)}static fromJsonString(e,t){return(new nr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(nr,e,t)}}nr.runtime=Ae,nr.typeName="livekit.SpeakersChanged",nr.fields=Ae.util.newFieldList((()=>[{no:1,name:"speakers",kind:"message",T:gt,repeated:!0}]));class ir extends _{constructor(e){super(),Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new ir).fromBinary(e,t)}static fromJson(e,t){return(new ir).fromJson(e,t)}static fromJsonString(e,t){return(new ir).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(ir,e,t)}}ir.runtime=Ae,ir.typeName="livekit.RoomUpdate",ir.fields=Ae.util.newFieldList((()=>[{no:1,name:"room",kind:"message",T:et}]));class rr extends _{constructor(e){super(),this.participantSid="",this.quality=He.POOR,this.score=0,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new rr).fromBinary(e,t)}static fromJson(e,t){return(new rr).fromJson(e,t)}static fromJsonString(e,t){return(new rr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(rr,e,t)}}rr.runtime=Ae,rr.typeName="livekit.ConnectionQualityInfo",rr.fields=Ae.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:Ae.getEnumType(He)},{no:3,name:"score",kind:"scalar",T:2}]));class sr extends _{constructor(e){super(),this.updates=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new sr).fromBinary(e,t)}static fromJson(e,t){return(new sr).fromJson(e,t)}static fromJsonString(e,t){return(new sr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(sr,e,t)}}sr.runtime=Ae,sr.typeName="livekit.ConnectionQualityUpdate",sr.fields=Ae.util.newFieldList((()=>[{no:1,name:"updates",kind:"message",T:rr,repeated:!0}]));class or extends _{constructor(e){super(),this.participantSid="",this.trackSid="",this.state=Ai.ACTIVE,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new or).fromBinary(e,t)}static fromJson(e,t){return(new or).fromJson(e,t)}static fromJsonString(e,t){return(new or).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(or,e,t)}}or.runtime=Ae,or.typeName="livekit.StreamStateInfo",or.fields=Ae.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Ae.getEnumType(Ai)}]));class ar extends _{constructor(e){super(),this.streamStates=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new ar).fromBinary(e,t)}static fromJson(e,t){return(new ar).fromJson(e,t)}static fromJsonString(e,t){return(new ar).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(ar,e,t)}}ar.runtime=Ae,ar.typeName="livekit.StreamStateUpdate",ar.fields=Ae.util.newFieldList((()=>[{no:1,name:"stream_states",kind:"message",T:or,repeated:!0}]));class cr extends _{constructor(e){super(),this.quality=Ke.LOW,this.enabled=!1,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new cr).fromBinary(e,t)}static fromJson(e,t){return(new cr).fromJson(e,t)}static fromJsonString(e,t){return(new cr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(cr,e,t)}}cr.runtime=Ae,cr.typeName="livekit.SubscribedQuality",cr.fields=Ae.util.newFieldList((()=>[{no:1,name:"quality",kind:"enum",T:Ae.getEnumType(Ke)},{no:2,name:"enabled",kind:"scalar",T:8}]));class lr extends _{constructor(e){super(),this.codec="",this.qualities=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new lr).fromBinary(e,t)}static fromJson(e,t){return(new lr).fromJson(e,t)}static fromJsonString(e,t){return(new lr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(lr,e,t)}}lr.runtime=Ae,lr.typeName="livekit.SubscribedCodec",lr.fields=Ae.util.newFieldList((()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:cr,repeated:!0}]));class ur extends _{constructor(e){super(),this.trackSid="",this.subscribedQualities=[],this.subscribedCodecs=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new ur).fromBinary(e,t)}static fromJson(e,t){return(new ur).fromJson(e,t)}static fromJsonString(e,t){return(new ur).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(ur,e,t)}}ur.runtime=Ae,ur.typeName="livekit.SubscribedQualityUpdate",ur.fields=Ae.util.newFieldList((()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:cr,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:lr,repeated:!0}]));class dr extends _{constructor(e){super(),this.participantSid="",this.allTracks=!1,this.trackSids=[],this.participantIdentity="",Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new dr).fromBinary(e,t)}static fromJson(e,t){return(new dr).fromJson(e,t)}static fromJsonString(e,t){return(new dr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(dr,e,t)}}dr.runtime=Ae,dr.typeName="livekit.TrackPermission",dr.fields=Ae.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]));class hr extends _{constructor(e){super(),this.allParticipants=!1,this.trackPermissions=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new hr).fromBinary(e,t)}static fromJson(e,t){return(new hr).fromJson(e,t)}static fromJsonString(e,t){return(new hr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(hr,e,t)}}hr.runtime=Ae,hr.typeName="livekit.SubscriptionPermission",hr.fields=Ae.util.newFieldList((()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:dr,repeated:!0}]));class pr extends _{constructor(e){super(),this.participantSid="",this.trackSid="",this.allowed=!1,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new pr).fromBinary(e,t)}static fromJson(e,t){return(new pr).fromJson(e,t)}static fromJsonString(e,t){return(new pr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(pr,e,t)}}pr.runtime=Ae,pr.typeName="livekit.SubscriptionPermissionUpdate",pr.fields=Ae.util.newFieldList((()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]));class mr extends _{constructor(e){super(),this.publishTracks=[],this.dataChannels=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new mr).fromBinary(e,t)}static fromJson(e,t){return(new mr).fromJson(e,t)}static fromJsonString(e,t){return(new mr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(mr,e,t)}}mr.runtime=Ae,mr.typeName="livekit.SyncState",mr.fields=Ae.util.newFieldList((()=>[{no:1,name:"answer",kind:"message",T:Gi},{no:2,name:"subscription",kind:"message",T:Yi},{no:3,name:"publish_tracks",kind:"message",T:Ki,repeated:!0},{no:4,name:"data_channels",kind:"message",T:fr,repeated:!0},{no:5,name:"offer",kind:"message",T:Gi}]));class fr extends _{constructor(e){super(),this.label="",this.id=0,this.target=Li.PUBLISHER,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new fr).fromBinary(e,t)}static fromJson(e,t){return(new fr).fromJson(e,t)}static fromJsonString(e,t){return(new fr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(fr,e,t)}}fr.runtime=Ae,fr.typeName="livekit.DataChannelInfo",fr.fields=Ae.util.newFieldList((()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:Ae.getEnumType(Li)}]));class gr extends _{constructor(e){super(),this.scenario={case:void 0},Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new gr).fromBinary(e,t)}static fromJson(e,t){return(new gr).fromJson(e,t)}static fromJsonString(e,t){return(new gr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(gr,e,t)}}gr.runtime=Ae,gr.typeName="livekit.SimulateScenario",gr.fields=Ae.util.newFieldList((()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:Ae.getEnumType(Ui),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"}]));class vr extends _{constructor(e){super(),this.timestamp=W.zero,this.rtt=W.zero,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new vr).fromBinary(e,t)}static fromJson(e,t){return(new vr).fromJson(e,t)}static fromJsonString(e,t){return(new vr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(vr,e,t)}}vr.runtime=Ae,vr.typeName="livekit.Ping",vr.fields=Ae.util.newFieldList((()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]));class yr extends _{constructor(e){super(),this.lastPingTimestamp=W.zero,this.timestamp=W.zero,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new yr).fromBinary(e,t)}static fromJson(e,t){return(new yr).fromJson(e,t)}static fromJsonString(e,t){return(new yr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(yr,e,t)}}yr.runtime=Ae,yr.typeName="livekit.Pong",yr.fields=Ae.util.newFieldList((()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]));class br extends _{constructor(e){super(),this.regions=[],Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new br).fromBinary(e,t)}static fromJson(e,t){return(new br).fromJson(e,t)}static fromJsonString(e,t){return(new br).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(br,e,t)}}br.runtime=Ae,br.typeName="livekit.RegionSettings",br.fields=Ae.util.newFieldList((()=>[{no:1,name:"regions",kind:"message",T:kr,repeated:!0}]));class kr extends _{constructor(e){super(),this.region="",this.url="",this.distance=W.zero,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new kr).fromBinary(e,t)}static fromJson(e,t){return(new kr).fromJson(e,t)}static fromJsonString(e,t){return(new kr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(kr,e,t)}}kr.runtime=Ae,kr.typeName="livekit.RegionInfo",kr.fields=Ae.util.newFieldList((()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]));class Sr extends _{constructor(e){super(),this.trackSid="",this.err=$e.SE_UNKNOWN,Ae.util.initPartial(e,this)}static fromBinary(e,t){return(new Sr).fromBinary(e,t)}static fromJson(e,t){return(new Sr).fromJson(e,t)}static fromJsonString(e,t){return(new Sr).fromJsonString(e,t)}static equals(e,t){return Ae.util.equals(Sr,e,t)}}Sr.runtime=Ae,Sr.typeName="livekit.SubscriptionResponse",Sr.fields=Ae.util.newFieldList((()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:Ae.getEnumType($e)}]));const Cr=[];class Tr extends Gt.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Tr.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=f,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout((()=>this.handleAppVisibilityChanged()),5e3):this.handleAppVisibilityChanged()},this.log=g(null!==(i=n.loggerName)&&void 0!==i?i:p.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Tr.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Dr(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===Tr.Kind.Video&&(t="video"),0===this.attachedElements.length&&Tr.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(Cr.forEach((t=>{null!==t.parentElement||e||(e=t)})),e&&Cr.splice(Cr.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),wr(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some((e=>"audio"===e.kind));return e.play().then((()=>{this.emit(i?bi.AudioPlaybackStarted:bi.VideoPlaybackStarted)})).catch((t=>{"NotAllowedError"===t.name?this.emit(i?bi.AudioPlaybackFailed:bi.VideoPlaybackFailed,t):"AbortError"===t.name?f.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):f.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some((e=>"video"===e.kind))&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch((()=>{})))})),this.emit(bi.ElementAttached,e),e}detach(e){try{if(e){Er(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(bi.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach((e=>{Er(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(bi.ElementDetached,e)})),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval)}updateLoggerOptions(e){e.loggerName&&(this.log=g(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Cr.forEach((e=>{e.parentElement||(t=!1)})),t&&Cr.push(e)}}handleAppVisibilityChanged(){return Ot(this,void 0,void 0,(function*(){this.isInBackground="hidden"===document.visibilityState}))}addAppVisibilityListener(){Wr()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Wr()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function wr(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach((e=>{n.removeTrack(e)})),n.addTrack(e)),Vr()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(Vr()||Jr())&&t instanceof HTMLVideoElement&&setTimeout((()=>{t.srcObject=n,t.play().catch((()=>{}))}),0))}function Er(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}function Pr(e,t,n){var i;const r=null!==(i=function(e){if("undefined"!==typeof e)return"function"===typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(e))&&void 0!==i?i:{};return!0===r.audio&&(r.audio={}),!0===r.video&&(r.video={}),r.audio&&Rr(r.audio,t),r.video&&Rr(r.video,n),r}function Rr(e,t){return Object.keys(t).forEach((n=>{void 0===e[n]&&(e[n]=t[n])})),e}function xr(e){const t={};if(e.video)if("object"===typeof e.video){const n={},i=n,r=e.video;Object.keys(r).forEach((e=>{if("resolution"===e)Rr(i,r.resolution);else i[e]=r[e]})),t.video=n}else t.video=e.video;else t.video=!1;return e.audio?"object"===typeof e.audio?t.audio=e.audio:t.audio=!0:t.audio=!1,t}function Or(){const e="undefined"!==typeof window&&(window.AudioContext||window.webkitAudioContext);if(e)return new e({latencyHint:"interactive"})}function Ir(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"===typeof i?{}:i,i=Vr()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio}}function Nr(e){const t=e.split("/")[1].toLowerCase();if(!Oi.includes(t))throw Error("Video codec not supported: ".concat(t));return t}function _r(e){const t=[];return e.forEach((e=>{void 0!==e.track&&t.push(new Ki({cid:e.track.mediaStreamID,track:e.trackInfo}))})),t}function Dr(e){return e instanceof Tr?{trackSid:e.sid,trackSource:e.source,trackMuted:e.isMuted,trackEnabled:e.mediaStreamTrack.enabled,trackKind:e.kind}:{trackSid:e.trackSid,trackName:e.trackName,track:e.track?Dr(e.track):void 0,trackEnabled:e.isEnabled,trackEncrypted:e.isEncrypted,trackMimeType:e.mimeType}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return ze.AUDIO;case t.Video:return ze.VIDEO;default:return ze.DATA}},e.kindFromProto=function(e){switch(e){case ze.AUDIO:return t.Audio;case ze.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return We.CAMERA;case n.Microphone:return We.MICROPHONE;case n.ScreenShare:return We.SCREEN_SHARE;case n.ScreenShareAudio:return We.SCREEN_SHARE_AUDIO;default:return We.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case We.CAMERA:return n.Camera;case We.MICROPHONE:return n.Microphone;case We.SCREEN_SHARE:return n.ScreenShare;case We.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case Ai.ACTIVE:return i.Active;case Ai.PAUSED:return i.Paused;default:return i.Unknown}}}(Tr||(Tr={}));const Mr="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Lr(e){return Ot(this,void 0,void 0,(function*(){return new Promise((t=>Pi.setTimeout(t,e)))}))}function Ar(){return"addTransceiver"in RTCPeerConnection.prototype}function Ur(){return"addTrack"in RTCPeerConnection.prototype}function jr(e){return"av1"===e||"vp9"===e}function Fr(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}const Br={Chrome:"100",Safari:"15",Firefox:"100"};function Jr(){var e;return"Firefox"===(null===(e=Ti())||void 0===e?void 0:e.name)}function Vr(){var e;return"Safari"===(null===(e=Ti())||void 0===e?void 0:e.name)}function qr(){const e=Ti();return"Safari"===(null===e||void 0===e?void 0:e.name)&&e.version.startsWith("17.")}function zr(){return!!Wr()&&/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent)}function Wr(){return"undefined"!==typeof document}function Kr(){return"ReactNative"==navigator.product}function Hr(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function Gr(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Qr(){if(!Kr())return;let e=Gr();return e?e.platform:void 0}function Yr(){if(Wr())return window.devicePixelRatio;if(Kr()){let e=Gr();if(e)return e.devicePixelRatio}return 1}function $r(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const e=parseInt(n[s],10),t=parseInt(i[s],10);if(e>t)return 1;if(e<t)return-1;if(s===r-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function Xr(e){for(const t of e)t.target.handleResize(t)}function Zr(e){for(const t of e)t.target.handleVisibilityChanged(t)}let es=null;const ts=()=>(es||(es=new ResizeObserver(Xr)),es);let ns=null;const is=()=>(ns||(ns=new IntersectionObserver(Zr,{root:null,rootMargin:"0px"})),ns);let rs;function ss(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const s=r.getContext("2d");null===s||void 0===s||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(e/2,t/2,50,0,2*Math.PI,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}function os(){if(!rs){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[rs]=i.stream.getAudioTracks(),!rs)throw Error("Could not get empty media stream audio track");rs.enabled=!1}return rs.clone()}class as{constructor(e,t){this.onFinally=t,this.promise=new Promise(((t,n)=>Ot(this,void 0,void 0,(function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})))).finally((()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)}))}}class cs{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise((t=>e=()=>{this._locks-=1,t()})),n=this._locking.then((()=>e));return this._locking=this._locking.then((()=>t)),n}}function ls(e){if("string"===typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function us(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}const ds="default";class hs{static getInstance(){return void 0===this.instance&&(this.instance=new hs),this.instance}getDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var n;return Ot(this,void 0,void 0,(function*(){if((null===(n=hs.userMediaPromiseMap)||void 0===n?void 0:n.size)>0){f.debug("awaiting getUserMedia promise");try{e?yield hs.userMediaPromiseMap.get(e):yield Promise.all(hs.userMediaPromiseMap.values())}catch(r){f.warn("error waiting for media permissons")}}let i=yield navigator.mediaDevices.enumerateDevices();if(t&&(!Vr()||!this.hasDeviceInUse(e))){if(0===i.length||i.some((t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i}))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e},n=yield navigator.mediaDevices.getUserMedia(t);i=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach((e=>{e.stop()}))}}return e&&(i=i.filter((t=>t.kind===e))),i}))}normalizeDeviceId(e,t,n){return Ot(this,void 0,void 0,(function*(){if(t!==ds)return t;const i=(yield this.getDevices(e)).find((e=>e.groupId===n&&e.deviceId!==ds));return null===i||void 0===i?void 0:i.deviceId}))}hasDeviceInUse(e){return e?hs.userMediaPromiseMap.has(e):hs.userMediaPromiseMap.size>0}}hs.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],hs.userMediaPromiseMap=new Map;class ps extends Tr{get constraints(){return this._constraints}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch((()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext))),this.debouncedTrackMuteHandler=ki((()=>Ot(this,void 0,void 0,(function*(){yield this.pauseUpstream()}))),5e3),this.handleTrackUnmuteEvent=()=>Ot(this,void 0,void 0,(function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()})),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(bi.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new cs,this.pauseUpstreamLock=new cs,this.processorLock=new cs,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Tr.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}setMediaStreamTrack(e,t){return Ot(this,void 0,void 0,(function*(){if(e===this._mediaStreamTrack&&!t)return;let n;if(this._mediaStreamTrack&&(this.attachedElements.forEach((e=>{Er(this._mediaStreamTrack,e)})),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e&&this.processorElement){if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");wr(e,this.processorElement),this.processorElement.muted=!0,yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),n=this.processor.processedTrack}this.sender&&(yield this.sender.replaceTrack(null!==n&&void 0!==n?n:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach((t=>{wr(null!==n&&void 0!==n?n:e,t)})))}))}waitForDimensions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;var t;return Ot(this,void 0,void 0,(function*(){if(this.kind===Tr.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(t=Ti())||void 0===t?void 0:t.os)&&(yield Lr(10));const n=Date.now();for(;Date.now()-n<e;){const e=this.dimensions;if(e)return e;yield Lr(50)}throw new di("unable to get track dimensions after timeout")}))}getDeviceId(){return Ot(this,void 0,void 0,(function*(){if(this.source===Tr.Source.ScreenShare)return;const{deviceId:e,groupId:t}=this._mediaStreamTrack.getSettings(),n=this.kind===Tr.Kind.Audio?"audioinput":"videoinput";return hs.getInstance().normalizeDeviceId(n,e,t)}))}mute(){return Ot(this,void 0,void 0,(function*(){return this.setTrackMuted(!0),this}))}unmute(){return Ot(this,void 0,void 0,(function*(){return this.setTrackMuted(!1),this}))}replaceTrack(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ot(this,void 0,void 0,(function*(){if(!this.sender)throw new di("unable to replace an unpublished track");return this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),this.providedByUser=t,this.processor&&(yield this.stopProcessor()),this}))}restart(e){return Ot(this,void 0,void 0,(function*(){e||(e=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const t={audio:!1,video:!1};this.kind===Tr.Kind.Video?t.video=e:t.audio=e,this.attachedElements.forEach((e=>{Er(this.mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const n=(yield navigator.mediaDevices.getUserMedia(t)).getTracks()[0];return n.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(n),this._constraints=e,this.emit(bi.Restarted,this),this}))}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),this.isMuted===e&&this._mediaStreamTrack.enabled!==e||(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?bi.Muted:bi.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Ot(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),zr()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))}))}stop(){var e;super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return Ot(this,void 0,void 0,(function*(){const e=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(bi.UpstreamPaused,this);const e=Ti();if("Safari"===(null===e||void 0===e?void 0:e.name)&&$r(e.version,"12.0")<0)throw new ui("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{e()}}))}resumeUpstream(){return Ot(this,void 0,void 0,(function*(){const e=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(bi.UpstreamResumed,this),yield this.sender.replaceTrack(this._mediaStreamTrack)}finally{e()}}))}getRTCStatsReport(){var e;return Ot(this,void 0,void 0,(function*(){if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;return yield this.sender.getStats()}))}setProcessor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var n,i;return Ot(this,void 0,void 0,(function*(){const r=yield this.processorLock.lock();try{if(this.log.debug("setting up processor",this.logContext),this.processor&&(yield this.stopProcessor()),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement=null!==(n=this.processorElement)&&void 0!==n?n:document.createElement(this.kind),wr(this._mediaStreamTrack,this.processorElement),this.processorElement.muted=!0,this.processorElement.play().catch((e=>this.log.error("failed to play processor element",Object.assign(Object.assign({},this.logContext),{error:e}))));const r={kind:this.kind,track:this._mediaStreamTrack,element:this.processorElement};if(yield e.init(r),this.processor=e,this.processor.processedTrack){for(const e of this.attachedElements)e!==this.processorElement&&t&&(Er(this._mediaStreamTrack,e),wr(this.processor.processedTrack,e));yield null===(i=this.sender)||void 0===i?void 0:i.replaceTrack(this.processor.processedTrack)}}finally{r()}}))}getProcessor(){return this.processor}stopProcessor(){var e,t;return Ot(this,void 0,void 0,(function*(){this.processor&&(this.log.debug("stopping processor",this.logContext),null===(e=this.processor.processedTrack)||void 0===e||e.stop(),yield this.processor.destroy(),this.processor=void 0,null===(t=this.processorElement)||void 0===t||t.remove(),this.processorElement=void 0,yield this.restart())}))}}class ms extends Gt.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:i,data:r}=e.data;switch(i){case"error":f.error(r.error.message),this.emit(ri.EncryptionError,r.error);break;case"initAck":r.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"enable":if(this.encryptionEnabled!==r.enabled&&r.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(ri.ParticipantEncryptionStatusChanged,r.enabled,this.room.localParticipant),this.encryptionEnabled=r.enabled;else if(r.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(r.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(r.participantIdentity));this.emit(ri.ParticipantEncryptionStatusChanged,r.enabled,e)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"ratchetKey":this.keyProvider.emit(ni.KeyRatcheted,r.material,r.keyIndex)}},this.onWorkerError=e=>{f.error("e2ee worker encountered an error:",{error:e.error}),this.emit(ri.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!oi())throw new ui("tried to setup end-to-end encryption on an unsupported browser");if(f.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions()}};this.worker&&(f.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){f.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):f.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(yi.RTPVideoMapUpdate,(e=>{this.postRTPMap(e)}))}setupEventListeners(e,t){e.on(gi.TrackPublished,((e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==ot.NONE,t.identity))),e.on(gi.ConnectionStateChanged,(t=>{t===No.Connected&&e.participants.forEach((e=>{e.tracks.forEach((t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==ot.NONE,e.identity)}))}))})).on(gi.TrackUnsubscribed,((e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)})).on(gi.TrackSubscribed,((e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)})).on(gi.SignalConnected,(()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),t.getKeys().forEach((e=>{this.postKey(e)}))})),e.localParticipant.on(vi.LocalTrackPublished,(e=>Ot(this,void 0,void 0,(function*(){this.setupE2EESender(e.track,e.track.sender)})))),t.on(ni.SetKey,(e=>this.postKey(e))).on(ni.RatchetRequest,((e,t)=>this.postRatchetRequest(e,t)))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const s={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(s)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null===n||void 0===n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?Nr(n.mimeType):void 0)}}setupE2EESender(e,t){e instanceof ps&&t?this.handleSender(t,e.mediaStreamID,void 0):t||f.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return Ot(this,void 0,void 0,(function*(){if(this.worker){if(ai()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(ti in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,s=e.readableStream;if(!r||!s){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,s=t.readable}const o={kind:"decode",data:{readableStream:s,writableStream:r,trackId:t,codec:i,participantIdentity:n}};this.worker.postMessage(o,[s,r])}e[ti]=!0}}))}handleSender(e,t,n){var i;if(!(ti in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(ai()){f.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{f.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r,[i.readable,i.writable])}e[ti]=!0}}}var fs;!function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(fs||(fs={}));class gs{constructor(){this.pendingTasks=new Map,this.taskMutex=new cs,this.nextTaskIndex=0}run(e){return Ot(this,void 0,void 0,(function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:fs.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=fs.RUNNING,yield e()}finally{t.status=fs.COMPLETED,this.pendingTasks.delete(t.id),n()}}))}flush(){return Ot(this,void 0,void 0,(function*(){return this.run((()=>Ot(this,void 0,void 0,(function*(){}))))}))}snapshot(){return Array.from(this.pendingTasks.values())}}const vs=["syncState","trickle","offer","answer","simulate","leave"];var ys;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(ys||(ys={}));class bs{get currentState(){return this.state}get isDisconnected(){return this.state===ys.DISCONNECTING||this.state===ys.DISCONNECTED}get isEstablishingConnection(){return this.state===ys.CONNECTING||this.state===ys.RECONNECTING}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=ys.DISCONNECTED,this.log=f,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=g(null!==(n=t.loggerName)&&void 0!==n?n:p.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new gs,this.queuedRequests=[],this.closingLock=new cs,this.connectionLock=new cs,this.state=ys.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return Ot(this,void 0,void 0,(function*(){this.state=ys.CONNECTING,this.options=n;return yield this.connect(e,t,n,i)}))}reconnect(e,t,n,i){return Ot(this,void 0,void 0,(function*(){if(!this.options)return void this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);this.state=ys.RECONNECTING,this.clearPingInterval();return yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}))}))}connect(e,t,n,i){this.connectOptions=n,e=(e=function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e)).replace(/\/$/,""),e+="/rtc";const r=function(e,t,n){var i;const r=new URLSearchParams;r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid));r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Kr()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel);t.os&&r.set("os",t.os);t.osVersion&&r.set("os_version",t.osVersion);t.browser&&r.set("browser",t.browser);t.browserVersion&&r.set("browser_version",t.browserVersion);void 0!==n.publishOnly&&r.set("publish",n.publishOnly);n.adaptiveStream&&r.set("adaptive_stream","1");n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString());(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type);return"?".concat(r.toString())}(t,function(){var e;const t=new kt({sdk:lt.JS,protocol:11,version:"1.15.12"});return Kr()&&(t.os=null!==(e=Qr())&&void 0!==e?e:""),t}(),n);return new Promise(((t,s)=>Ot(this,void 0,void 0,(function*(){const o=yield this.connectionLock.lock();try{const o=()=>Ot(this,void 0,void 0,(function*(){this.close(),clearTimeout(a),s(new li("room connection has been cancelled (signal)"))})),a=setTimeout((()=>{this.close(),s(new li("room connection has timed out (signal)"))}),n.websocketTimeout);(null===i||void 0===i?void 0:i.aborted)&&o(),null===i||void 0===i||i.addEventListener("abort",o),this.log.debug("connecting to ".concat(e+r),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(e+r),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(a)},this.ws.onerror=t=>Ot(this,void 0,void 0,(function*(){if(this.state===ys.CONNECTED)this.handleWSError(t);else{clearTimeout(a);try{const t=yield fetch("http".concat(e.substring(2),"/validate").concat(r));if(t.status.toFixed(0).startsWith("4")){const e=yield t.text();s(new li(e,0,t.status))}else s(new li("Internal error",2,t.status))}catch(n){s(new li("server was not reachable",1))}}})),this.ws.onmessage=e=>Ot(this,void 0,void 0,(function*(){var r,a,c,l;let u;if("string"===typeof e.data){const t=JSON.parse(e.data);u=Fi.fromJson(t)}else{if(!(e.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof e.data),this.logContext);u=Fi.fromBinary(new Uint8Array(e.data))}if(this.state!==ys.CONNECTED){let e=!1;if("join"===(null===(r=u.message)||void 0===r?void 0:r.case)?(this.state=ys.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",o),this.pingTimeoutDuration=u.message.value.pingTimeout,this.pingIntervalDuration=u.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),t(u.message.value)):this.state===ys.RECONNECTING&&"leave"!==u.message.case?(this.state=ys.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",o),this.startPingInterval(),"reconnect"===(null===(a=u.message)||void 0===a?void 0:a.case)?t(null===(c=u.message)||void 0===c?void 0:c.value):(t(),e=!0)):this.isEstablishingConnection&&"leave"===u.message.case?s(new li("Received leave request while trying to (re)connect",4)):n.reconnect||s(new li("did not receive join response, got ".concat(null===(l=u.message)||void 0===l?void 0:l.case," instead"))),!e)return}this.signalLatency&&(yield Lr(this.signalLatency)),this.handleSignalResponse(u)})),this.ws.onclose=e=>{this.isEstablishingConnection&&s(new li("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,state:this.state})),this.handleOnClose(e.reason)}}finally{o()}}))))}close(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Ot(this,void 0,void 0,(function*(){const t=yield this.closingLock.lock();try{if(e&&(this.state=ys.DISCONNECTING),this.ws){this.ws.onmessage=null,this.ws.onopen=null,this.ws.onclose=null;const e=new Promise((e=>{this.ws?this.ws.onclose=()=>{e()}:e()}));this.ws.readyState<this.ws.CLOSING&&(this.ws.close(),yield Promise.race([e,Lr(250)])),this.ws=void 0}}finally{e&&(this.state=ys.DISCONNECTED),this.clearPingInterval(),t()}}))}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Ss(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Ss(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Vi({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new qi({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return this.sendRequest({case:"updateMetadata",value:new er({metadata:e,name:t})})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new Zi({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new hr({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:W.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new vr({timestamp:W.parse(Date.now()),rtt:W.parse(this.rtt)})})])}sendLeave(){return this.sendRequest({case:"leave",value:new Xi({canReconnect:!1,reason:Qe.CLIENT_INITIATED})})}sendRequest(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ot(this,void 0,void 0,(function*(){const n=!t&&!function(e){const t=vs.indexOf(e.case)>=0;return f.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(n&&this.state===ys.RECONNECTING)return void this.queuedRequests.push((()=>Ot(this,void 0,void 0,(function*(){yield this.sendRequest(e,!0)}))));if(t||(yield this.requestQueue.flush()),this.signalLatency&&(yield Lr(this.signalLatency)),!this.ws||this.ws.readyState!==this.ws.OPEN)return void this.log.error("cannot send signal request before connected, type: ".concat(null===e||void 0===e?void 0:e.case),this.logContext);const i=new ji({message:e});try{this.useJSON?this.ws.send(i.toJsonString()):this.ws.send(i.toBinary())}catch(r){this.log.error("error sending signal message",Object.assign(Object.assign({},this.logContext),{error:r}))}}))}handleSignalResponse(e){var t,n;const i=e.message;if(void 0==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=ks(i.value);this.onAnswer&&this.onAnswer(e)}else if("offer"===i.case){const e=ks(i.value);this.onOffer&&this.onOffer(e)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return Ot(this,void 0,void 0,(function*(){if(this.state===ys.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)}))}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Pi.setTimeout((()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")}),1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Pi.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Pi.setInterval((()=>{this.sendPing()}),1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Pi.clearInterval(this.pingInterval)}}function ks(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function Ss(e){return new Gi({sdp:e.sdp,type:e.type})}var Cs={},Ts={exports:{}},ws=Ts.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(ws).forEach((function(e){ws[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}));var Es=Ts.exports;!function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var s=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var s=0;s<i.length;s+=1)null!=e[s+1]&&(n[i[s]]=t(e[s+1]))}(i.match(e.reg),s,e.names,e.name),e.push&&n[e.push].push(s)},i=Es,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},s=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(s.push({rtp:[],fmtp:[]}),o=s[s.length-1]);for(var a=0;a<(i[t]||[]).length;a+=1){var c=i[t][a];if(c.reg.test(r))return n(c,o,r)}})),t.media=s,t};var s=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(Cs);var Ps=Es,Rs=/%[sdv%]/g,xs=function(e){var t=1,n=arguments,i=n.length;return e.replace(Rs,(function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},Os=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var s=t.names[r];t.name?i.push(n[t.name][s]):i.push(n[t.names[r]])}else i.push(n[t.name]);return xs.apply(null,i)},Is=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Ns=["i","c","b","a"],_s=Cs,Ds=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||Is,i=t.innerOrder||Ns,r=[];return n.forEach((function(t){Ps[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(Os(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(Os(t,n,e))}))}))})),e.media.forEach((function(e){r.push(Os("m",Ps.m[0],e)),i.forEach((function(t){Ps[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(Os(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(Os(t,n,e))}))}))}))})),r.join("\r\n")+"\r\n"},Ms=Ds,Ls=_s.parse;const As="negotiationStarted",Us="negotiationComplete",js="rtpVideoPayloadTypes";class Fs extends Gt.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.log=f,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=ki((e=>Ot(this,void 0,void 0,(function*(){this.emit(As);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}))),100),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=g(null!==(i=n.loggerName)&&void 0!==i?i:p.PCTransport),this.loggerOptions=n,this.config=e,this.mediaConstraints=t,this._pc=this.createPC()}createPC(){const e=function(){var e;return"Chrome"===(null===(e=Ti())||void 0===e?void 0:e.name)}()?new RTCPeerConnection(this.config,this.mediaConstraints):new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return Ot(this,void 0,void 0,(function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)}))}setRemoteDescription(e){var t;return Ot(this,void 0,void 0,(function*(){let n;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=Ls(null!==(t=e.sdp)&&void 0!==t?t:"");let s=0;return r.media.forEach((e=>{var t;"audio"===e.type&&(e.rtp.some((e=>"opus"===e.codec&&(s=e.payload,!0))),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some((e=>e.payload===s&&"nack"===e.type)))&&i.push(e.mid),e.fmtp.some((t=>t.payload===s&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0))))})),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const i=Ls(null!==(t=e.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type&&this.trackBitrates.some((t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter((e=>!e.includes("maxaveragebitrate"))).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0}))})),n=Ms(i)}if(yield this.setMungedSDP(e,n,!0),this.pendingCandidates.forEach((e=>{this.pc.addIceCandidate(e)})),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate)this.renegotiate=!1,yield this.createAndSendOffer();else if("answer"===e.type&&(this.emit(Us),e.sdp)){Ls(e.sdp).media.forEach((e=>{"video"===e.type&&this.emit(js,e.rtp)}))}}))}createAndSendOffer(e){var t;return Ot(this,void 0,void 0,(function*(){if(void 0===this.onOffer)return;if((null===e||void 0===e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null===e||void 0===e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=yield this.pc.createOffer(e),i=Ls(null!==(t=n.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type?Bs(e,[],[]):"video"===e.type&&(!function(e){var t,n,i,r;const s=null===(n=null===(t=e.rtp[0])||void 0===t?void 0:t.codec)||void 0===n?void 0:n.toLowerCase();if(!jr(s))return;let o=0;const a=null===(i=e.ext)||void 0===i?void 0:i.some((e=>e.uri===Mr||(e.value>o&&(o=e.value),!1)));a||null===(r=e.ext)||void 0===r||r.push({value:o+1,uri:Mr})}(e),this.trackBitrates.some((t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config.includes("x-google-start-bitrate")||(r.config+=";x-google-start-bitrate=".concat(Math.round(.7*t.maxbr))),r.config.includes("x-google-max-bitrate")||(r.config+=";x-google-max-bitrate=".concat(t.maxbr)),i=!0;break}return i||e.fmtp.push({payload:n,config:"x-google-start-bitrate=".concat(Math.round(.7*t.maxbr),";x-google-max-bitrate=").concat(t.maxbr)}),!0})))})),yield this.setMungedSDP(n,Ms(i)),this.onOffer(n)}))}createAndSetAnswer(){var e;return Ot(this,void 0,void 0,(function*(){const t=yield this.pc.createAnswer(),n=Ls(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach((e=>{"audio"===e.type&&Bs(e,this.remoteStereoMids,this.remoteNackMids)})),yield this.setMungedSDP(t,Ms(n)),t}))}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new pi("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new pi("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){var e;return Ot(this,void 0,void 0,(function*(){if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach((e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}})),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0}))}setMungedSDP(e,t,n){return Ot(this,void 0,void 0,(function*(){if(t){const r=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(i){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:i,sdp:t})),e.sdp=r}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let t="unknown error";i instanceof Error?t=i.message:"string"===typeof i&&(t=i);const r={error:t,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(r.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:r})),new mi(t)}}))}}function Bs(e,t,n){let i=0;e.rtp.some((e=>"opus"===e.codec&&(i=e.payload,!0))),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some((e=>e.payload===i&&"nack"===e.type))&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some((e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0))))}const Js="vp8",Vs={audioBitrate:Ni.music.maxBitrate,audioPreset:Ni.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Mi.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Js,backupCodec:!0},qs={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},zs={resolution:_i.h720.resolution},Ws={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new class{constructor(e){this._retryDelays=void 0!==e?[...e]:xt}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}},disconnectOnPageLeave:!0,expWebAudioMix:!1},Ks={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Hs;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Hs||(Hs={}));class Gs{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=Ks.peerConnectionTimeout,this.log=f,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map((e=>e.getConnectionState()));n.every((e=>"connected"===e))?this.state=Hs.CONNECTED:n.some((e=>"failed"===e))?this.state=Hs.FAILED:n.some((e=>"connecting"===e))?this.state=Hs.CONNECTING:n.every((e=>"closed"===e))?this.state=Hs.CLOSED:n.some((e=>"closed"===e))?this.state=Hs.CLOSING:n.every((e=>"new"===e))&&(this.state=Hs.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Hs[t]," to ").concat(Hs[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=g(null!==(i=n.loggerName)&&void 0!==i?i:p.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t;this.publisher=new Fs(e,{optional:[{googDscp:!0}]},n),this.subscriber=new Fs(e,void 0,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Li.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Li.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=e=>{var t;null===(t=this.onPublisherOffer)||void 0===t||t.call(this,e)},this.state=Hs.NEW,this.connectionLock=new cs}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return Ot(this,void 0,void 0,(function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const t=this.publisher;for(const n of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(n)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()}))}triggerIceRestart(){return Ot(this,void 0,void 0,(function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))}))}addIceCandidate(e,t){return Ot(this,void 0,void 0,(function*(){t===Li.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)}))}createSubscriberAnswerFromOffer(e){return Ot(this,void 0,void 0,(function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()})),yield this.subscriber.setRemoteDescription(e);return yield this.subscriber.createAndSetAnswer()}))}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){var n;return Ot(this,void 0,void 0,(function*(){const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map((n=>this.ensureTransportConnected(n,e,t))))}finally{i()}}))}negotiate(e){return Ot(this,void 0,void 0,(function*(){return new Promise(((t,n)=>Ot(this,void 0,void 0,(function*(){const i=setTimeout((()=>{n("negotiation timed out")}),this.peerConnectionTimeout);e.signal.addEventListener("abort",(()=>{clearTimeout(i),n("negotiation aborted")})),this.publisher.once(As,(()=>{e.signal.aborted||this.publisher.once(Us,(()=>{clearTimeout(i),t()}))})),yield this.publisher.negotiate((e=>{clearTimeout(i),n(e)}))}))))}))}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Li.PUBLISHER||e===Li.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return Ot(this,void 0,void 0,(function*(){if("connected"!==e.getConnectionState())return new Promise(((e,i)=>Ot(this,void 0,void 0,(function*(){const r=()=>{this.log.warn("abort transport connection",this.logContext),Pi.clearTimeout(s),i(new li("room connection has been cancelled",3))};(null===t||void 0===t?void 0:t.signal.aborted)&&r(),null===t||void 0===t||t.signal.addEventListener("abort",r);const s=Pi.setTimeout((()=>{null===t||void 0===t||t.signal.removeEventListener("abort",r),i(new li("could not establish pc connection"))}),n);for(;this.state!==Hs.CONNECTED;)if(yield Lr(50),null===t||void 0===t?void 0:t.signal.aborted)return void i(new li("room connection has been cancelled",3));Pi.clearTimeout(s),null===t||void 0===t||t.signal.removeEventListener("abort",r),e()}))))}))}}const Qs="_lossy",Ys="_reliable",$s="leave-reconnect";var Xs;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Xs||(Xs={}));class Zs extends Gt.EventEmitter{get isClosed(){return this._isClosed}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Ks.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=Xs.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=f,this.handleDataChannel=e=>{let{channel:t}=e;return Ot(this,void 0,void 0,(function*(){if(t){if(t.label===Ys)this.reliableDCSub=t;else{if(t.label!==Qs)return;this.lossyDCSub=t}this.log.debug("on data channel ".concat(t.id,", ").concat(t.label),this.logContext),t.onmessage=this.handleDataMessage}}))},this.handleDataMessage=e=>Ot(this,void 0,void 0,(function*(){var t,n;const i=yield this.dataProcessLock.lock();try{let i;if(e.data instanceof ArrayBuffer)i=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));i=yield e.data.arrayBuffer()}const r=mt.fromBinary(new Uint8Array(i));"speaker"===(null===(t=r.value)||void 0===t?void 0:t.case)?this.emit(yi.ActiveSpeakersUpdate,r.value.value.speakers):"user"===(null===(n=r.value)||void 0===n?void 0:n.case)&&this.emit(yi.DataPacketReceived,r.value.value,r.kind)}finally{i()}})),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?at.LOSSY:at.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(yi.Disconnected),this.close()},i=Date.now()-this.reconnectStart;let r=this.getNextRetryDelay({elapsedMs:i,retryCount:this.reconnectAttempts});null!==r?(e===$s&&(r=0),this.log.debug("reconnecting in ".concat(r,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Pi.setTimeout((()=>this.attemptReconnect(t)),r)):n(i)},this.waitForRestarted=()=>new Promise(((e,t)=>{this.pcState===Xs.Connected&&e();const n=()=>{this.off(yi.Disconnected,i),e()},i=()=>{this.off(yi.Restarted,n),t()};this.once(yi.Restarted,n),this.once(yi.Disconnected,i)})),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);"undefined"!==typeof t&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(yi.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===ys.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Ye.RR_SIGNAL_DISCONNECTED))},this.log=g(null!==(t=e.loggerName)&&void 0!==t?t:p.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new bs(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new cs,this.dataProcessLock=new cs,this.dcBufferStatus=new Map([[at.LOSSY,!0],[at.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(yi.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(yi.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(yi.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(yi.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(yi.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(yi.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(yi.StreamStateChanged,e)}get logContext(){var e,t,n,i,r,s;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomSid:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,identity:null===(s=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===s?void 0:s.identity}}join(e,t,n,i){return Ot(this,void 0,void 0,(function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=r.clientConfiguration,r}catch(r){if(r instanceof li&&1===r.reason&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw r}}))}close(){return Ot(this,void 0,void 0,(function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.emit(yi.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}}))}cleanupPeerConnections(){var e;return Ot(this,void 0,void 0,(function*(){yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0}))}cleanupClient(){return Ot(this,void 0,void 0,(function*(){yield this.client.close(),this.client.resetCallbacks()}))}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new di("a track with the same ID has already been published");return new Promise(((t,n)=>{const i=setTimeout((()=>{delete this.pendingTrackResolvers[e.cid],n(new li("publication of local track timed out, no response from server"))}),1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)}))}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){var e;return Ot(this,void 0,void 0,(function*(){return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()}))}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){var t;return Ot(this,void 0,void 0,(function*(){if(this.pcManager&&this.pcManager.currentState!==Hs.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const n=this.makeRTCConfiguration(e);this.pcManager=new Gs(n,e.subscriberPrimary,this.loggerOptions),this.emit(yi.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=e=>{this.client.sendOffer(e)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,i)=>Ot(this,void 0,void 0,(function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),t===Hs.CONNECTED){const t=this.pcState===Xs.New;this.pcState=Xs.Connected,t&&this.emit(yi.Connected,e)}else t===Hs.FAILED&&this.pcState===Xs.Connected&&(this.pcState=Xs.Disconnected,this.handleDisconnect("peerconnection failed","failed"===i?Ye.RR_SUBSCRIBER_FAILED:Ye.RR_PUBLISHER_FAILED))})),this.pcManager.onTrack=e=>{this.emit(yi.MediaTrackAdded,e.track,e.streams[0],e.receiver)},this.createDataChannels()}))}setupSignalClientCallbacks(){this.client.onAnswer=e=>Ot(this,void 0,void 0,(function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))})),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>Ot(this,void 0,void 0,(function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)})),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(yi.LocalTrackUnpublished,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(yi.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(yi.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Ye.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{(null===e||void 0===e?void 0:e.canReconnect)?(this.fullReconnectOnNext=!0,this.handleDisconnect($s)):(this.emit(yi.Disconnected,null===e||void 0===e?void 0:e.reason),this.close()),this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null===e||void 0===e?void 0:e.reason}))}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach((e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)})),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Ge.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Qs,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Ys,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}setPreferredCodec(e,t,n){if(!("getCapabilities"in RTCRtpSender))return;const i=RTCRtpSender.getCapabilities(t);if(!i)return;this.log.debug("get sender capabilities",Object.assign(Object.assign({},this.logContext),{cap:i}));const r=[],s=[],o=[];i.codecs.forEach((e=>{const t=e.mimeType.toLowerCase();if("audio/opus"===t)return void r.push(e);t==="video/".concat(n)?"h264"!==n||e.sdpFmtpLine&&e.sdpFmtpLine.includes("profile-level-id=42e01f")?r.push(e):s.push(e):o.push(e)})),function(e){if(!Wr())return!1;if(!("setCodecPreferences"in e))return!1;const t=Ti();if(!(null===t||void 0===t?void 0:t.name)||!t.version)return!1;const n=Br[t.name];return!!n&&$r(t.version,n)>=0}(e)&&e.setCodecPreferences(r.concat(s,o))}createSender(e,t,n){return Ot(this,void 0,void 0,(function*(){if(Ar()){return yield this.createTransceiverRTCRtpSender(e,t,n)}if(Ur()){this.log.warn("using add-track fallback",this.logContext);return yield this.createRTCRtpSender(e.mediaStreamTrack)}throw new pi("Required webRTC APIs not supported on this device")}))}createSimulcastSender(e,t,n,i){return Ot(this,void 0,void 0,(function*(){if(Ar())return this.createSimulcastTransceiverSender(e,t,n,i);if(Ur())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new pi("Cannot stream on this device")}))}createTransceiverRTCRtpSender(e,t,n){return Ot(this,void 0,void 0,(function*(){if(!this.pcManager)throw new pi("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream);const r={direction:"sendonly",streams:i};n&&(r.sendEncodings=n);const s=yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r);return e.kind===Tr.Kind.Video&&t.videoCodec&&(this.setPreferredCodec(s,e.kind,t.videoCodec),e.codec=t.videoCodec),s.sender}))}createSimulcastTransceiverSender(e,t,n,i){return Ot(this,void 0,void 0,(function*(){if(!this.pcManager)throw new pi("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const s=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return this.setPreferredCodec(s,e.kind,n.videoCodec),e.setSimulcastTrackSender(n.videoCodec,s.sender),s.sender}))}createRTCRtpSender(e){return Ot(this,void 0,void 0,(function*(){if(!this.pcManager)throw new pi("publisher is closed");return this.pcManager.addPublisherTrack(e)}))}attemptReconnect(e){var t,n,i;return Ot(this,void 0,void 0,(function*(){if(!this._isClosed)if(this.attemptingReconnect)f.warn("already attempting reconnect, returning early",this.logContext);else{(null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)!==Ge.DISABLED&&(null!==(i=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==i?i:Hs.NEW)!==Hs.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(r){this.reconnectAttempts+=1;let e=!0;r instanceof pi?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:r})),e=!1):r instanceof eo||(this.fullReconnectOnNext=!0),e?this.handleDisconnect("reconnect",Ye.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(yi.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}}))}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){var t,n,i;return Ot(this,void 0,void 0,(function*(){try{if(!this.url||!this.token)throw new pi("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(yi.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new eo;n=yield this.join(null!==e&&void 0!==e?e:this.url,this.token,this.signalOpts)}catch(r){if(r instanceof li&&0===r.reason)throw new pi("could not reconnect, token might be expired");throw new eo}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(yi.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==ys.CONNECTED)throw new eo("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(yi.Restarted)}catch(s){const e=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(e)return void(yield this.restartConnection(e));throw null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),s}}))}resumeConnection(e){var t;return Ot(this,void 0,void 0,(function*(){if(!this.url||!this.token)throw new pi("could not reconnect, url or token not saved");if(!this.pcManager)throw new pi("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(yi.Resuming);try{this.setupSignalClientCallbacks();const t=yield this.client.reconnect(this.url,this.token,this.participantSid,e);if(t){const e=this.makeRTCConfiguration(t);this.pcManager.updateConfiguration(e)}}catch(n){let e="";if(n instanceof Error&&(e=n.message,this.log.error(n.message,Object.assign(Object.assign({},this.logContext),{error:n}))),n instanceof li&&0===n.reason)throw new pi("could not reconnect, token might be expired");if(n instanceof li&&4===n.reason)throw n;throw new eo(e)}if(this.emit(yi.SignalResumed),this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==ys.CONNECTED)throw new eo("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),this.emit(yi.Resumed)}))}waitForPCInitialConnection(e,t){return Ot(this,void 0,void 0,(function*(){if(!this.pcManager)throw new pi("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)}))}waitForPCReconnected(){return Ot(this,void 0,void 0,(function*(){this.pcState=Xs.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Lr(2e3),!this.pcManager)throw new pi("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Xs.Connected}catch(e){throw this.pcState=Xs.Disconnected,new li("could not establish PC connection, ".concat(e.message))}}))}sendDataPacket(e,t){return Ot(this,void 0,void 0,(function*(){const n=e.toBinary();yield this.ensurePublisherConnected(t);const i=this.dataChannelForKind(t);i&&i.send(n),this.updateAndEmitDCBufferStatus(t)}))}ensureDataTransportConnected(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;var n;return Ot(this,void 0,void 0,(function*(){if(!this.pcManager)throw new pi("PC manager is closed");const i=t?this.pcManager.subscriber:this.pcManager.publisher,r=t?"Subscriber":"Publisher";if(!i)throw new li("".concat(r," connection not set"));t||this.pcManager.publisher.isICEConnected||"checking"===this.pcManager.publisher.getICEConnectionState()||this.negotiate();const s=this.dataChannelForKind(e,t);if("open"===(null===s||void 0===s?void 0:s.readyState))return;const o=(new Date).getTime()+this.peerConnectionTimeout;for(;(new Date).getTime()<o;){if(i.isICEConnected&&"open"===(null===(n=this.dataChannelForKind(e,t))||void 0===n?void 0:n.readyState))return;yield Lr(50)}throw new li("could not establish ".concat(r," connection, state: ").concat(i.getICEConnectionState()))}))}ensurePublisherConnected(e){return Ot(this,void 0,void 0,(function*(){yield this.ensureDataTransportConnected(e,!1)}))}verifyTransport(){return!!this.pcManager&&(this.pcManager.currentState===Hs.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED))}negotiate(){return Ot(this,void 0,void 0,(function*(){return new Promise(((e,t)=>Ot(this,void 0,void 0,(function*(){if(!this.pcManager)return void t(new mi("PC manager is closed"));this.pcManager.requirePublisher();const n=new AbortController,i=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(yi.Closing,i),this.pcManager.publisher.once(js,(e=>{const t=new Map;e.forEach((e=>{const n=e.codec.toLowerCase();var i;i=n,Oi.includes(i)&&t.set(e.payload,n)})),this.emit(yi.RTPVideoMapUpdate,t)}));try{yield this.pcManager.negotiate(n),e()}catch(r){r instanceof mi&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Ye.RR_UNKNOWN),t(r)}finally{this.off(yi.Closing,i)}}))))}))}dataChannelForKind(e,t){if(t){if(e===at.LOSSY)return this.lossyDCSub;if(e===at.RELIABLE)return this.reliableDCSub}else{if(e===at.LOSSY)return this.lossyDC;if(e===at.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),s=this.pcManager.subscriber.getRemoteDescription(),o=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,a=new Array;e.forEach((e=>{e.isDesired!==o&&a.push(e.trackSid)})),this.client.sendSyncState(new mr({answer:r?Ss({sdp:r.sdp,type:r.type}):void 0,offer:s?Ss({sdp:s.sdp,type:s.type}):void 0,subscription:new Yi({trackSids:a,subscribe:!o,participantTracks:[]}),publishTracks:_r(t),dataChannels:this.dataChannelsInfo()}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null===t||void 0===t?void 0:t.id)&&null!==t.id&&e.push(new fr({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(at.LOSSY),Li.PUBLISHER),t(this.dataChannelForKind(at.RELIABLE),Li.PUBLISHER),t(this.dataChannelForKind(at.LOSSY,!0),Li.SUBSCRIBER),t(this.dataChannelForKind(at.RELIABLE,!0),Li.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Pi.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Wr()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Wr()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class eo extends Error{}class to{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Hr(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return Ot(this,void 0,void 0,(function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter((e=>!this.attemptedRegions.find((t=>t.url===e.url))));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),f.debug("next region: ".concat(e.region)),e.url}return null}))}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return Ot(this,void 0,void 0,(function*(){const t=yield fetch("".concat((n=this.serverUrl,"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});var n;if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new li("Could not fetch region settings: ".concat(t.statusText),401===t.status?0:void 0,t.status)}))}}const no=2e3;function io(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}class ro extends ps{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,Tr.Kind.Audio,t,n,r),this.stopOnMute=!1,this.monitorSender=()=>Ot(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(t){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:t}))}e&&this.prevStats&&(this._currentBitrate=io(e,this.prevStats)),this.prevStats=e})),this.audioContext=i,this.checkForSilence()}setDeviceId(e){return Ot(this,void 0,void 0,(function*(){return this._constraints.deviceId===e||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||ls(e)===this.mediaStreamTrack.getSettings().deviceId)}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Ot(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.source===Tr.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Ot(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ls(this._constraints.deviceId);return this.source!==Tr.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}restartTrack(e){return Ot(this,void 0,void 0,(function*(){let t;if(e){const n=xr({audio:e});"boolean"!==typeof n.audio&&(t=n.audio)}yield this.restart(t)}))}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return Ot(this,void 0,void 0,(function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n}))}startMonitor(){Wr()&&(this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),no)))}setProcessor(e){var t;return Ot(this,void 0,void 0,(function*(){const n=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");if(this.processor&&(yield this.stopProcessor()),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack))}finally{n()}}))}setAudioContext(e){this.audioContext=e}getSenderStats(){var e;return Ot(this,void 0,void 0,(function*(){if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach((e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})})),t}))}checkForSilence(){return Ot(this,void 0,void 0,(function*(){const e=yield function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return Ot(this,void 0,void 0,(function*(){const n=Or();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,s=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield Lr(t),i.getByteTimeDomainData(s);const o=s.some((e=>128!==e&&0!==e));return n.close(),!o}return!1}))}(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(bi.AudioSilenceDetected)),e}))}}function so(e,t,n){switch(e.kind){case"audio":return new ro(e,t,!1,void 0,n);case"video":return new bo(e,t,!1,n);default:throw new di("unsupported track type: ".concat(e.kind))}}const oo=Object.values(_i),ao=Object.values(Di),co=Object.values(Mi),lo=[_i.h180,_i.h360],uo=[Di.h180,Di.h360],ho=e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map((t=>{var n,i;return new Ri(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(n=e.encoding.maxFramerate)&&void 0!==n?n:30)/(null!==(i=t.fps)&&void 0!==i?i:30))))),t.fps,e.encoding.priority)})),po=["q","h","f"];function mo(e,t,n,i){var r,s;let o=null===i||void 0===i?void 0:i.videoEncoding;e&&(o=null===i||void 0===i?void 0:i.screenShareEncoding);const a=null===i||void 0===i?void 0:i.simulcast,c=null===i||void 0===i?void 0:i.scalabilityMode,l=null===i||void 0===i?void 0:i.videoCodec;if(!o&&!a&&!c||!t||!n)return[{}];o||(o=function(e,t,n,i){const r=function(e,t,n){if(e)return co;const i=t>n?t/n:n/t;if(Math.abs(i-16/9)<Math.abs(i-4/3))return oo;return ao}(e,t,n);let{encoding:s}=r[0];const o=Math.max(t,n);for(let a=0;a<r.length;a+=1){const e=r[a];if(s=e.encoding,e.width>=o)break}if(i)switch(i){case"av1":s=Object.assign({},s),s.maxBitrate=.7*s.maxBitrate;break;case"vp9":s=Object.assign({},s),s.maxBitrate=.85*s.maxBitrate}return s}(e,t,n,l),f.debug("using video encoding",o));const u=new Ri(t,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&jr(l)){f.debug("using svc with scalabilityMode ".concat(c));const e=new yo(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));for(let n=0;n<e.spatial;n+=1)t.push({rid:po[2-n],maxBitrate:o.maxBitrate/Math.pow(3,n),maxFramerate:u.encoding.maxFramerate});return t[0].scalabilityMode=c,f.debug("encodings",t),t}if(!a)return[o];let d,h=[];if(h=e?null!==(r=vo(null===i||void 0===i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:fo(e,u):null!==(s=vo(null===i||void 0===i?void 0:i.videoSimulcastLayers))&&void 0!==s?s:fo(e,u),h.length>0){const e=h[0];h.length>1&&([,d]=h);const i=Math.max(t,n);if(i>=960&&d)return go(t,n,[e,d,u]);if(i>=480)return go(t,n,[e,u])}return go(t,n,[u])}function fo(e,t){if(e)return ho(t);const{width:n,height:i}=t,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?lo:uo}function go(e,t,n){const i=[];if(n.forEach(((n,r)=>{if(r>=po.length)return;const s=Math.min(e,t),o={rid:po[r],scaleResolutionDownBy:Math.max(1,s/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(o.maxFramerate=n.encoding.maxFramerate);const a=Jr()||0===r;n.encoding.priority&&a&&(o.priority=n.encoding.priority,o.networkPriority=n.encoding.priority),i.push(o)})),Kr()&&"ios"===Qr()){let e;i.forEach((t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate}));let t=!0;i.forEach((n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,f.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),f.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)}))}return i}function vo(e){if(e)return e.sort(((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0}))}class yo{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class bo extends ps{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,Tr.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.monitorSender=()=>Ot(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(n){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:n}))}const t=new Map(e.map((e=>[e.rid,e])));if(this.prevStats){let e=0;t.forEach(((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=io(t,r)})),this._currentBitrate=e}this.prevStats=t})),this.senderLock=new cs}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Wr())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),no))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach((e=>{e.mediaStreamTrack.stop()})),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});var t,n,i,r,s;return Ot(this,void 0,void 0,(function*(){yield e.pauseUpstream.call(this);try{for(var o,a=!0,c=Nt(this.simulcastCodecs.values());o=yield c.next(),!(t=o.done);a=!0){r=o.value,a=!1;const e=r;yield null===(s=e.sender)||void 0===s?void 0:s.replaceTrack(null)}}catch(l){n={error:l}}finally{try{a||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});var t,n,i,r,s;return Ot(this,void 0,void 0,(function*(){yield e.resumeUpstream.call(this);try{for(var o,a=!0,c=Nt(this.simulcastCodecs.values());o=yield c.next(),!(t=o.done);a=!0){r=o.value,a=!1;const e=r;yield null===(s=e.sender)||void 0===s?void 0:s.replaceTrack(e.mediaStreamTrack)}}catch(l){n={error:l}}finally{try{a||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Ot(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.source!==Tr.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Ot(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.source!==Tr.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){var e;return Ot(this,void 0,void 0,(function*(){if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach((e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,framesSent:e.framesSent,timestamp:e.timestamp,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges},s=n.get(e.remoteId);s&&(r.jitter=s.jitter,r.packetsLost=s.packetsLost,r.roundTripTime=s.roundTripTime),t.push(r)}})),t}))}setPublishingQuality(e){const t=[];for(let n=Ke.LOW;n<=Ke.HIGH;n+=1)t.push(new cr({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(t)}setDeviceId(e){return Ot(this,void 0,void 0,(function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ls(e)||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||ls(e)===this._mediaStreamTrack.getSettings().deviceId)}))}restartTrack(e){var t,n,i,r;return Ot(this,void 0,void 0,(function*(){let s;if(e){const t=xr({video:e});"boolean"!==typeof t.video&&(s=t.video)}yield this.restart(s);try{for(var o,a=!0,c=Nt(this.simulcastCodecs.values());o=yield c.next(),!(t=o.done);a=!0){r=o.value,a=!1;const e=r;e.sender&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(l){n={error:l}}finally{try{a||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}setProcessor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});var i,r,s,o,a,c;return Ot(this,void 0,void 0,(function*(){if(yield n.setProcessor.call(this,e,t),null===(a=this.processor)||void 0===a?void 0:a.processedTrack)try{for(var l,u=!0,d=Nt(this.simulcastCodecs.values());l=yield d.next(),!(i=l.done);u=!0){o=l.value,u=!1;const e=o;yield null===(c=e.sender)||void 0===c?void 0:c.replaceTrack(this.processor.processedTrack)}}catch(h){r={error:h}}finally{try{u||i||!(s=d.return)||(yield s.call(d))}finally{if(r)throw r.error}}}))}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))throw new Error("".concat(e," already added"));const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout((()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)}),5e3))}setPublishingCodecs(e){var t,n,i,r,s,o,a;return Ot(this,void 0,void 0,(function*(){if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=Nt(e);i=yield n.next(),!(r=i.done);t=!0){a=i.value,t=!1;const e=a;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield ko(t.sender,t.encodings,e.qualities,this.senderLock,this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(e.qualities)}}catch(l){s={error:l}}finally{try{t||r||!(o=n.return)||(yield o.call(n))}finally{if(s)throw s.error}}return c}))}setPublishingLayers(e){return Ot(this,void 0,void 0,(function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),this.sender&&this.encodings&&(yield ko(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))}))}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Ot(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),zr()&&this.isInBackground&&this.source===Tr.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}))}}function ko(e,t,n,i,r,s){return Ot(this,void 0,void 0,(function*(){const o=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:o}=i;if(!o)return;if(o.length!==t.length)return void r.warn("cannot set publishing layers, encodings mismatch");let a=!1;!1&&o[0].scalabilityMode||o.forEach(((e,i)=>{var o;let c=null!==(o=e.rid)&&void 0!==o?o:"";""===c&&(c="q");const l=So(c),u=n.find((e=>e.quality===l));u&&e.active!==u.enabled&&(a=!0,e.active=u.enabled,r.debug("setting layer ".concat(u.quality," to ").concat(e.active?"enabled":"disabled"),s),Jr()&&(u.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})),a&&(i.encodings=o,r.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:i.encodings})),yield e.setParameters(i))}finally{o()}}))}function So(e){switch(e){case"f":default:return Ke.HIGH;case"h":return Ke.MEDIUM;case"q":return Ke.LOW}}function Co(e,t,n,i){if(!n)return[new pt({quality:Ke.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const i=n[0].scalabilityMode,r=new yo(i),s=[];for(let o=0;o<r.spatial;o+=1)s.push(new pt({quality:Ke.HIGH-o,width:Math.ceil(e/Math.pow(2,o)),height:Math.ceil(t/Math.pow(2,o)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(3,o)):0,ssrc:0}));return s}return n.map((n=>{var i,r,s;const o=null!==(i=n.scaleResolutionDownBy)&&void 0!==i?i:1;let a=So(null!==(r=n.rid)&&void 0!==r?r:"");return new pt({quality:a,width:Math.ceil(e/o),height:Math.ceil(t/o),bitrate:null!==(s=n.maxBitrate)&&void 0!==s?s:0,ssrc:0})}))}class To extends Tr{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?bi.Muted:bi.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver=void 0,this._currentBitrate=0,this.emit(bi.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){var e;return Ot(this,void 0,void 0,(function*(){if(!(null===(e=this.receiver)||void 0===e?void 0:e.getStats))return;return yield this.receiver.getStats()}))}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval((()=>this.monitorReceiver()),no))}}class wo extends To{constructor(e,t,n,i,r,s){super(e,t,Tr.Kind.Audio,n,s),this.monitorReceiver=()=>Ot(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=io(e,this.prevStats)),this.prevStats=e})),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;Kr()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Kr())return 1;let e=0;return this.attachedElements.forEach((t=>{t.volume>e&&(e=t.volume)})),e}setSinkId(e){return Ot(this,void 0,void 0,(function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map((t=>{if(Fr(t))return t.setSinkId(e)})))}))}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&Fr(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach((e=>{n.connect(e),n=e})),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then((()=>{"running"!==e.state&&this.emit(bi.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))})).catch((e=>{this.emit(bi.AudioPlaybackFailed,e)}))}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return Ot(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach((t=>{"inbound-rtp"===t.type&&(e={type:"audio",timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})})),e}))}}class Eo extends To{constructor(e,t,n,i,r){super(e,t,Tr.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>Ot(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=io(e,this.prevStats)),this.prevStats=e})),this.debouncedHandleResize=ki((()=>{this.updateDimensions()}),100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach((t=>{e?Er(this._mediaStreamTrack,t):wr(this._mediaStreamTrack,t)}))}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t.element===e))){const t=new Po(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t===e))?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter((t=>t===e));for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter((t=>t!==e)),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return Ot(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach((e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)})),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t}))}stopObservingElement(e){const t=this.elementInfos.filter((t=>t.element===e));for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Ot(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()}))}updateVisibility(){var e,t;const n=this.elementInfos.reduce(((e,t)=>Math.max(e,t.visibilityChangedAt||0)),0),i=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,r=this.elementInfos.some((e=>e.pictureInPicture)),s=this.elementInfos.some((e=>e.visible))&&!i||r;this.lastVisible!==s&&(!s&&Date.now()-n<100?Pi.setTimeout((()=>{this.updateVisibility()}),100):(this.lastVisible=s,this.emit(bi.VisibilityChanged,s,this)))}updateDimensions(){var e,t;let n=0,i=0;const r=this.getPixelDensity();for(const s of this.elementInfos){const e=s.width()*r,t=s.height()*r;e+t>n+i&&(n=e,i=t)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===i||(this.lastDimensions={width:n,height:i},this.emit(bi.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;if("screen"===t)return Yr();if(!t){return Yr()>2?2:1}return t}}class Po{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e;this.isPiP=!0,null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=!1,null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!==t&&void 0!==t?t:Ro(e),this.isPiP=Wr()&&document.pictureInPictureElement===e,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=Ro(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,is().observe(this.element),ts().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var e,t;null===(e=is())||void 0===e||e.unobserve(this.element),null===(t=ts())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function Ro(e){let t=e.offsetTop,n=e.offsetLeft;const i=e.offsetWidth,r=e.offsetHeight,{hidden:s}=e,{opacity:o,display:a}=getComputedStyle(e);for(;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,n+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&n<window.pageXOffset+window.innerWidth&&t+r>window.pageYOffset&&n+i>window.pageXOffset&&!s&&(""===o||parseFloat(o)>0)&&"none"!==a}class xo extends Gt.EventEmitter{constructor(e,t,n,i){var r;super(),this.metadataMuted=!1,this.encryption=ot.NONE,this.log=f,this.handleMuted=()=>{this.emit(bi.Muted)},this.handleUnmuted=()=>{this.emit(bi.Unmuted)},this.log=g(null!==(r=null===i||void 0===i?void 0:i.loggerName)&&void 0!==r?r:p.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=Tr.Source.Unknown}setTrack(e){this.track&&(this.track.off(bi.Muted,this.handleMuted),this.track.off(bi.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(bi.Muted,this.handleMuted),e.on(bi.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Dr(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==ot.NONE}get audioTrack(){if(this.track instanceof ro||this.track instanceof wo)return this.track}get videoTrack(){if(this.track instanceof bo||this.track instanceof Eo)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Tr.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Tr.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(xo||(xo={}));class Oo extends xo{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(bi.Ended)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&this.track.off(bi.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(bi.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){var e;return Ot(this,void 0,void 0,(function*(){return null===(e=this.track)||void 0===e?void 0:e.mute()}))}unmute(){var e;return Ot(this,void 0,void 0,(function*(){return null===(e=this.track)||void 0===e?void 0:e.unmute()}))}pauseUpstream(){var e;return Ot(this,void 0,void 0,(function*(){yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()}))}resumeUpstream(){var e;return Ot(this,void 0,void 0,(function*(){yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()}))}}var Io,No;!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(Io||(Io={}));class _o extends Gt.EventEmitter{get logContext(){var e,t;return Object.assign(Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e)),{participantSid:this.sid,participantId:this.identity})}get isEncrypted(){return this.tracks.size>0&&Array.from(this.tracks.values()).every((e=>e.isEncrypted))}get isAgent(){var e,t;return null!==(t=null===(e=this.permissions)||void 0===e?void 0:e.agent)&&void 0!==t&&t}constructor(e,t,n,i,r){var s;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Io.Unknown,this.log=f,this.log=g(null!==(s=null===r||void 0===r?void 0:r.loggerName)&&void 0!==s?s:p.Participant),this.loggerOptions=r,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=i,this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map}getTracks(){return Array.from(this.tracks.values())}getTrack(e){for(const[,t]of this.tracks)if(t.source===e)return t}getTrackByName(e){for(const[,t]of this.tracks)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrack(Tr.Source.Camera);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrack(Tr.Source.Microphone);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrack(Tr.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(vi.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(vi.ParticipantNameChanged,e)}setPermissions(e){var t,n,i,r,s;const o=this.permissions,a=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(i=this.permissions)||void 0===i?void 0:i.canPublishData)||e.hidden!==(null===(r=this.permissions)||void 0===r?void 0:r.hidden)||e.recorder!==(null===(s=this.permissions)||void 0===s?void 0:s.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some(((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])}));return this.permissions=e,a&&this.emit(vi.ParticipantPermissionsChanged,o),a}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(vi.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=function(e){switch(e){case He.EXCELLENT:return Io.Excellent;case He.GOOD:return Io.Good;case He.POOR:return Io.Poor;case He.LOST:return Io.Lost;default:return Io.Unknown}}(e),t!==this._connectionQuality&&this.emit(vi.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTracks.forEach((t=>(t.track instanceof wo||t.track instanceof ro)&&t.track.setAudioContext(e)))}addTrackPublication(e){e.on(bi.Muted,(()=>{this.emit(vi.TrackMuted,e)})),e.on(bi.Unmuted,(()=>{this.emit(vi.TrackUnmuted,e)}));const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.tracks.set(e.trackSid,e),e.kind){case Tr.Kind.Audio:this.audioTracks.set(e.trackSid,e);break;case Tr.Kind.Video:this.videoTracks.set(e.trackSid,e)}}}class Do extends xo{constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=Ke.HIGH,this.handleEnded=e=>{this.setTrack(void 0),this.emit(bi.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.disabled=!e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensions=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new Yi({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new yt({participantSid:"",trackSids:[this.trackSid]})]});this.emit(bi.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?xo.SubscriptionStatus.Unsubscribed:super.isSubscribed?xo.SubscriptionStatus.Subscribed:xo.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?xo.PermissionStatus.Allowed:xo.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return!this.disabled}setEnabled(e){this.isManualOperationAllowed()&&this.disabled!==!e&&(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.currentVideoQuality!==e&&(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(this.track instanceof Eo&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof Eo&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(bi.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(bi.VisibilityChanged,this.handleVisibilityChange),i.off(bi.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(bi.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(bi.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(bi.VisibilityChanged,this.handleVisibilityChange),e.on(bi.Ended,this.handleEnded),this.emit(bi.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(bi.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?bi.Muted:bi.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(bi.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(bi.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===Tr.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof Eo&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new $i({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):void 0!==this.currentVideoQuality?e.quality=this.currentVideoQuality:e.quality=Ke.HIGH,this.emit(bi.UpdateSettings,e)}}class Mo extends _o{static fromParticipantInfo(e,t){return new Mo(e,t.sid,t.identity,t.name,t.metadata)}constructor(e,t,n,i,r,s){super(t,n||"",i,r,s),this.signalClient=e,this.tracks=new Map,this.audioTracks=new Map,this.videoTracks=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(bi.UpdateSettings,(t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),Dr(e))),this.signalClient.sendUpdateTrackSettings(t)})),e.on(bi.UpdateSubscription,(e=>{e.participantTracks.forEach((e=>{e.participantSid=this.sid})),this.signalClient.sendUpdateSubscription(e)})),e.on(bi.SubscriptionPermissionChanged,(t=>{this.emit(vi.TrackSubscriptionPermissionChanged,e,t)})),e.on(bi.SubscriptionStatusChanged,(t=>{this.emit(vi.TrackSubscriptionStatusChanged,e,t)})),e.on(bi.Subscribed,(t=>{this.emit(vi.TrackSubscribed,t,e)})),e.on(bi.Unsubscribed,(t=>{this.emit(vi.TrackUnsubscribed,t,e)})),e.on(bi.SubscriptionFailed,(t=>{this.emit(vi.TrackSubscriptionFailed,e.trackSid,t)}))}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tr.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrack(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tr.Source.Microphone;const t=this.getTrack(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,i,r,s){let o=this.getTrackPublication(t);if(o||t.startsWith("TR")||this.tracks.forEach((t=>{o||e.kind!==t.kind.toString()||(o=t)})),!o)return 0===s?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(vi.TrackSubscriptionFailed,t)):(void 0===s&&(s=20),void setTimeout((()=>{this.addSubscribedMediaTrack(e,t,n,i,r,s-1)}),150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Dr(o))),void this.emit(vi.TrackSubscriptionFailed,t);let a;return a="video"===e.kind?new Eo(e,t,i,r):new wo(e,t,i,this.audioContext,this.audioOutput),a.source=o.source,a.isMuted=o.isMuted,a.setMediaStream(n),a.start(),o.setTrack(a),this.volumeMap.has(o.source)&&a instanceof wo&&a.setVolume(this.volumeMap.get(o.source)),o}get hasMetadata(){return!!this.participantInfo}getTrackPublication(e){return this.tracks.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach((e=>{var i,r;let s=this.getTrackPublication(e.sid);if(s)s.updateInfo(e);else{const t=Tr.kindFromProto(e.type);if(!t)return;s=new Do(t,e,null===(i=this.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),s.updateInfo(e),n.set(e.sid,s);const o=Array.from(this.tracks.values()).find((e=>e.source===(null===s||void 0===s?void 0:s.source)));o&&s.source!==Tr.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(s.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Dr(o),newTrack:Dr(s)})),this.addTrackPublication(s)}t.set(e.sid,s)})),this.tracks.forEach((e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Dr(e))),this.unpublishTrack(e.trackSid,!0))})),n.forEach((e=>{this.emit(vi.TrackPublished,e)})),!0}unpublishTrack(e,t){const n=this.tracks.get(e);if(!n)return;const{track:i}=n;switch(i&&(i.stop(),n.setTrack(void 0)),this.tracks.delete(e),n.kind){case Tr.Kind.Audio:this.audioTracks.delete(e);break;case Tr.Kind.Video:this.videoTracks.delete(e)}t&&this.emit(vi.TrackUnpublished,n)}setAudioOutput(e){return Ot(this,void 0,void 0,(function*(){this.audioOutput=e;const t=[];this.audioTracks.forEach((n=>{var i;n.track instanceof wo&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))})),yield Promise.all(t)}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}class Lo extends _o{constructor(e,t,n,i){super(e,t,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ot.NONE,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new as)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t;this.reconnectFuture&&(this.reconnectFuture.promise.catch((e=>this.log.warn(e.message,this.logContext))),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map((e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new dr({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e))))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Dr(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Dr(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Dr(e))),this.onTrackMuted(e,e.isMuted)},this.handleSubscribedQualityUpdate=e=>Ot(this,void 0,void 0,(function*(){var t,n,i,r,s,o;if(!(null===(s=this.roomOptions)||void 0===s?void 0:s.dynacast))return;const a=this.videoTracks.get(e.trackSid);if(a)if(e.subscribedCodecs.length>0){if(!a.videoTrack)return;const s=yield a.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,u=Nt(s);!(t=(c=yield u.next()).done);l=!0){r=c.value,l=!1;const e=r;Ii(e)&&(this.log.debug("publish ".concat(e," for ").concat(a.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Dr(a))),yield this.publishAdditionalCodecForTrack(a.videoTrack,e,a.options))}}catch(d){n={error:d}}finally{try{l||t||!(i=u.return)||(yield i.call(u))}finally{if(n)throw n.error}}}else e.subscribedQualities.length>0&&(yield null===(o=a.videoTrack)||void 0===o?void 0:o.setPublishingLayers(e.subscribedQualities));else this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))})),this.handleLocalTrackUnpublished=e=>{const t=this.tracks.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>Ot(this,void 0,void 0,(function*(){if(e.source===Tr.Source.ScreenShare||e.source===Tr.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Dr(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(e instanceof ro||e instanceof bo)try{if(Wr())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===Tr.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),Dr(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(t){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Dr(e))),yield e.restartTrack())}catch(t){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Dr(e))),yield e.mute()}})),this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ot.NONE}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(yi.RemoteMute,((e,t)=>{const n=this.tracks.get(e);n&&n.track&&(t?n.mute():n.unmute())})),this.engine.on(yi.Connected,this.handleReconnected).on(yi.SignalRestarted,this.handleReconnected).on(yi.SignalResumed,this.handleReconnected).on(yi.Restarting,this.handleReconnecting).on(yi.Resuming,this.handleReconnecting).on(yi.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(yi.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(yi.Disconnected,this.handleDisconnected)}setMetadata(e){var t;this.engine.client.sendUpdateLocalMetadata(e,null!==(t=this.name)&&void 0!==t?t:"")}setName(e){var t;this.engine.client.sendUpdateLocalMetadata(null!==(t=this.metadata)&&void 0!==t?t:"",e)}setCameraEnabled(e,t,n){return this.setTrackEnabled(Tr.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(Tr.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(Tr.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(vi.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return Ot(this,void 0,void 0,(function*(){this.encryptionType=e?ot.GCM:ot.NONE,yield this.republishAllTracks(void 0,!1)}))}setTrackEnabled(e,t,n,i){var r,s;return Ot(this,void 0,void 0,(function*(){this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t}));let o=this.getTrack(e);if(t)if(o)yield o.unmute();else{let t;if(this.pendingPublishing.has(e))return void this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:e}));this.pendingPublishing.add(e);try{switch(e){case Tr.Source.Camera:t=yield this.createTracks({video:null===(r=n)||void 0===r||r});break;case Tr.Source.Microphone:t=yield this.createTracks({audio:null===(s=n)||void 0===s||s});break;case Tr.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new di(e)}const a=[];for(const e of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Dr(e))),a.push(this.publishTrack(e,i));const c=yield Promise.all(a);[o]=c}catch(a){throw null===t||void 0===t||t.forEach((e=>{e.stop()})),a instanceof Error&&!(a instanceof di)&&this.emit(vi.MediaDevicesError,a),a}finally{this.pendingPublishing.delete(e)}}else if(o&&o.track)if(e===Tr.Source.ScreenShare){o=yield this.unpublishTrack(o.track);const e=this.getTrack(Tr.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield o.mute();return o}))}enableCameraAndMicrophone(){return Ot(this,void 0,void 0,(function*(){if(!this.pendingPublishing.has(Tr.Source.Camera)&&!this.pendingPublishing.has(Tr.Source.Microphone)){this.pendingPublishing.add(Tr.Source.Camera),this.pendingPublishing.add(Tr.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map((e=>this.publishTrack(e))))}finally{this.pendingPublishing.delete(Tr.Source.Camera),this.pendingPublishing.delete(Tr.Source.Microphone)}}}))}createTracks(e){var t,n;return Ot(this,void 0,void 0,(function*(){const i=xr(Pr(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults));let r;try{r=yield navigator.mediaDevices.getUserMedia(i)}catch(s){throw s instanceof Error&&(i.audio&&(this.microphoneError=s),i.video&&(this.cameraError=s)),s}return i.audio&&(this.microphoneError=void 0,this.emit(vi.AudioStreamAcquired)),i.video&&(this.cameraError=void 0),r.getTracks().map((t=>{const n="audio"===t.kind;let s;n?e.audio:e.video;const o=n?i.audio:i.video;"boolean"!==typeof o&&(s=o);const a=so(t,s,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return a.kind===Tr.Kind.Video?a.source=Tr.Source.Camera:a.kind===Tr.Kind.Audio&&(a.source=Tr.Source.Microphone),a.mediaStream=r,a}))}))}createScreenTracks(e){return Ot(this,void 0,void 0,(function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new ui("getDisplayMedia not supported");void 0!==e.resolution||qr()||(e.resolution=Mi.h1080fps30.resolution);const t=Ir(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new di("no video track found");const r=new bo(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=Tr.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const s=[r];if(n.getAudioTracks().length>0){this.emit(vi.AudioStreamAcquired);const e=new ro(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=Tr.Source.ScreenShareAudio,s.push(e)}return s}))}publishTrack(e,t){var n,i,r,s;return Ot(this,void 0,void 0,(function*(){let o,a;if(yield null===(n=this.reconnectFuture)||void 0===n?void 0:n.promise,e instanceof ps&&this.pendingPublishPromises.has(e)&&(yield this.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)o=e.getConstraints();else{let t;switch(o=e.constraints,e.source){case Tr.Source.Microphone:t="audioinput";break;case Tr.Source.Camera:t="videoinput"}t&&this.activeDeviceMap.has(t)&&(o=Object.assign(Object.assign({},o),{deviceId:this.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new ro(e,o,!0,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;case"video":e=new bo(e,o,!0,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;default:throw new di("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(e instanceof ro&&e.setAudioContext(this.audioContext),this.tracks.forEach((t=>{t.track&&t.track===e&&(a=t)})),a)return this.log.warn("track has already been published, skipping",Object.assign(Object.assign({},this.logContext),Dr(a))),a;const c="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,l=null!==(i=null===t||void 0===t?void 0:t.forceStereo)&&void 0!==i?i:c;l&&(t||(t={}),void 0===t.dtx&&this.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},this.logContext),Dr(e))),void 0===t.red&&this.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(r=t.dtx)&&void 0!==r||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),t);Vr()&&this.roomOptions.e2ee&&(this.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari",Object.assign({},this.logContext)),u.simulcast=!1),u.source&&(e.source=u.source);const d=this.publish(e,u,l);this.pendingPublishPromises.set(e,d);try{return yield d}catch(h){throw h}finally{this.pendingPublishPromises.delete(e)}}))}publish(e,t,n){var i,r,s,o,a,c,l,u,d,h,p,m,f;return Ot(this,void 0,void 0,(function*(){Array.from(this.tracks.values()).find((t=>e instanceof ps&&t.source===e.source))&&e.source!==Tr.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Dr(e))),t.stopMicTrackOnMute&&e instanceof ro&&(e.stopOnMute=!0),e.source===Tr.Source.ScreenShare&&Jr()&&(t.simulcast=!1),"av1"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(Vr())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),"vp9"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(Jr())return!1;if(Vr()){const e=Ti();if((null===e||void 0===e?void 0:e.version)&&$r(e.version,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=Js);const g=t.videoCodec;e.on(bi.Muted,this.onTrackMuted),e.on(bi.Unmuted,this.onTrackUnmuted),e.on(bi.Ended,this.handleTrackEnded),e.on(bi.UpstreamPaused,this.onTrackUpstreamPaused),e.on(bi.UpstreamResumed,this.onTrackUpstreamResumed);const v=new Ji({cid:e.mediaStreamTrack.id,name:t.name,type:Tr.kindToProto(e.kind),muted:e.isMuted,source:Tr.sourceToProto(e.source),disableDtx:!(null===(i=t.dtx)||void 0===i||i),encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(r=t.red)||void 0===r||r),stream:null===t||void 0===t?void 0:t.stream});let y;if(e.kind===Tr.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch(C){const t=null!==(o=null===(s=this.roomOptions.videoCaptureDefaults)||void 0===s?void 0:s.resolution)&&void 0!==o?o:_i.h720.resolution;n={width:t.width,height:t.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Dr(e)),{dims:n}))}v.width=n.width,v.height=n.height,e instanceof bo&&(jr(g)&&(e.source===Tr.Source.ScreenShare&&"vp9"===g&&(t.scalabilityMode="L1T3"),t.scalabilityMode=null!==(a=t.scalabilityMode)&&void 0!==a?a:"L3T3_KEY"),v.simulcastCodecs=[new Bi({codec:g,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:Js}),t.backupCodec&&g!==t.backupCodec.codec&&v.encryption===ot.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),v.simulcastCodecs.push(new Bi({codec:t.backupCodec.codec,cid:""})))),y=mo(e.source===Tr.Source.ScreenShare,v.width,v.height,t),v.layers=Co(v.width,v.height,y,jr(t.videoCodec))}else e.kind===Tr.Kind.Audio&&(y=[{maxBitrate:null!==(l=null===(c=t.audioPreset)||void 0===c?void 0:c.maxBitrate)&&void 0!==l?l:t.audioBitrate,priority:null!==(d=null===(u=t.audioPreset)||void 0===u?void 0:u.priority)&&void 0!==d?d:"high",networkPriority:null!==(p=null===(h=t.audioPreset)||void 0===h?void 0:h.priority)&&void 0!==p?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new pi("cannot publish track when not connected");const b=yield this.engine.addTrack(v);let k;if(b.codecs.forEach((e=>{void 0===k&&(k=e.mimeType)})),k&&e.kind===Tr.Kind.Video){const n=Nr(k);n!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Dr(e)),{codec:n})),t.videoCodec=n,y=mo(e.source===Tr.Source.ScreenShare,v.width,v.height,t))}const S=new Oo(e.kind,b,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(S.options=t,e.sid=b.sid,!this.engine.pcManager)throw new pi("pcManager is not ready");if(this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:b})),e.sender=yield this.engine.createSender(e,t,y),y)if(Jr()&&e.kind===Tr.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:(null===(m=y[0])||void 0===m?void 0:m.maxBitrate)?y[0].maxBitrate/1e3:0})}else e.codec&&jr(e.codec)&&(null===(f=y[0])||void 0===f?void 0:f.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:v.cid,codec:e.codec,maxbr:y[0].maxBitrate/1e3});return yield this.engine.negotiate(),e instanceof bo?e.startMonitor(this.engine.client):e instanceof ro&&e.startMonitor(),this.addTrackPublication(S),this.emit(vi.LocalTrackPublished,S),S}))}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){var i;return Ot(this,void 0,void 0,(function*(){if(this.encryptionType!==ot.NONE)return;let r;if(this.tracks.forEach((t=>{t.track&&t.track===e&&(r=t)})),!r)throw new di("track is not published");if(!(e instanceof bo))throw new di("track is not a video track");const s=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),o=function(e,t,n){var i,r,s,o;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&f.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const a=e.mediaStreamTrack.getSettings(),c=null!==(i=a.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(s=a.height)&&void 0!==s?s:null===(o=e.dimensions)||void 0===o?void 0:o.height;return mo(e.source===Tr.Source.ScreenShare,c,l,n)}(e,t,s);if(!o)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Dr(e)));const a=e.addSimulcastTrack(t,o),c=new Ji({cid:a.mediaStreamTrack.id,type:Tr.kindToProto(e.kind),muted:e.isMuted,source:Tr.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:s.videoCodec,cid:a.mediaStreamTrack.id}]});if(c.layers=Co(c.width,c.height,o),!this.engine||this.engine.isClosed)throw new pi("cannot publish track when not connected");const l=yield this.engine.addTrack(c);yield this.engine.createSimulcastSender(e,a,s,o),yield this.engine.negotiate(),this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:o,trackInfo:l}))}))}unpublishTrack(e,t){var n,i;return Ot(this,void 0,void 0,(function*(){const r=this.getPublicationForTrack(e),s=r?Dr(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),s)),!r||!r.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),s));(e=r.track).off(bi.Muted,this.onTrackMuted),e.off(bi.Unmuted,this.onTrackUnmuted),e.off(bi.Ended,this.handleTrackEnded),e.off(bi.UpstreamPaused,this.onTrackUpstreamPaused),e.off(bi.UpstreamResumed,this.onTrackUpstreamResumed),void 0===t&&(t=null===(i=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===i||i),t&&e.stop();let o=!1;const a=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Hs.FAILED&&a)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===a&&(e.direction="inactive",o=!0);if(this.engine.removeTrack(a)&&(o=!0),e instanceof bo){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(o=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),s),{error:c}))}switch(this.tracks.delete(r.trackSid),r.kind){case Tr.Kind.Audio:this.audioTracks.delete(r.trackSid);break;case Tr.Kind.Video:this.videoTracks.delete(r.trackSid)}return this.emit(vi.LocalTrackUnpublished,r),r.setTrack(void 0),o&&(yield this.engine.negotiate()),r}))}unpublishTracks(e){return Ot(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>this.unpublishTrack(e))))).filter((e=>e instanceof Oo))}))}republishAllTracks(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ot(this,void 0,void 0,(function*(){const n=[];this.tracks.forEach((t=>{t.track&&(e&&(t.options=Object.assign(Object.assign({},t.options),e)),n.push(t))})),yield Promise.all(n.map((e=>Ot(this,void 0,void 0,(function*(){const n=e.track;yield this.unpublishTrack(n,!1),t&&!n.isMuted&&n.source!==Tr.Source.ScreenShare&&n.source!==Tr.Source.ScreenShareAudio&&(n instanceof ro||n instanceof bo)&&!n.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield n.restartTrack()),yield this.publishTrack(n,e.options)})))))}))}publishData(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Ot(this,void 0,void 0,(function*(){const i=Array.isArray(n)?n:null===n||void 0===n?void 0:n.destination,r=[],s=Array.isArray(n)?void 0:n.topic;void 0!==i&&i.forEach((e=>{e instanceof Mo?r.push(e.sid):r.push(e)}));const o=new mt({kind:t,value:{case:"user",value:new vt({participantSid:this.sid,payload:e,destinationSids:r,topic:s})}});yield this.engine.sendDataPacket(o,t)}))}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}updateInfo(e){return e.sid===this.sid&&(!!super.updateInfo(e)&&(e.tracks.forEach((e=>{var t,n;const i=this.tracks.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Dr(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}})),!0))}getPublicationForTrack(e){let t;return this.tracks.forEach((n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(i instanceof ro||i instanceof bo)&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))})),t}}!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting"}(No||(No={}));class Ao extends Gt.EventEmitter{constructor(e){var t,n,i;super(),t=this,this.state=No.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=f,this.bufferedEvents=[],this.connect=(e,t,n)=>Ot(this,void 0,void 0,(function*(){var i;const r=yield this.disconnectLock.lock();if(this.state===No.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),r(),Promise.resolve();if(this.connectFuture)return r(),this.connectFuture.promise;this.setAndEmitConnectionState(No.Connecting),(null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Hr(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new to(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().catch((e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))})));const s=(i,o,a)=>Ot(this,void 0,void 0,(function*(){var c;this.abortController&&this.abortController.abort();const l=new AbortController;this.abortController=l,null===r||void 0===r||r();try{yield this.attemptConnection(null!==a&&void 0!==a?a:e,t,n,l),this.abortController=void 0,i()}catch(u){if(this.regionUrlProvider&&u instanceof li&&3!==u.reason&&0!==u.reason){let e=null;try{e=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(d){if(d instanceof li&&(401===d.status||3===d.reason))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void o(d)}e?(this.log.info("Initial connection failed with ConnectionError: ".concat(u.message,". Retrying with another region: ").concat(e),this.logContext),yield s(i,o,e)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),o(u))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),o(u)}})),o=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new as(((e,t)=>{s(e,t,o)}),(()=>{this.clearConnectionFutures()})),this.connectFuture.promise})),this.connectSignal=(e,t,n,i,r,s)=>Ot(this,void 0,void 0,(function*(){var o,a,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,publishOnly:i.publishOnly,adaptiveStream:"object"===typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},s.signal);let u=l.serverInfo;if(u||(u={version:l.serverVersion,region:l.serverRegion}),this.log.debug("connected to Livekit Server ".concat(Object.entries(u).map((e=>{let[t,n]=e;return"".concat(t,": ").concat(n)})).join(", ")),{room:null===(o=l.room)||void 0===o?void 0:o.name,roomSid:null===(a=l.room)||void 0===a?void 0:a.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!l.serverVersion)throw new hi("unknown server version");return"0.15.1"===l.serverVersion&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l})),this.applyJoinResponse=e=>{const t=e.participant;this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room),this.options.e2ee&&this.e2eeManager&&this.e2eeManager.setSifTrailer(e.sifTrailer)},this.attemptConnection=(e,t,n,i)=>Ot(this,void 0,void 0,(function*(){var r,s;this.state===No.Reconnecting?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(r=this.regionUrlProvider)||void 0===r?void 0:r.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Ks),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,i);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(gi.SignalConnected)}catch(o){yield this.engine.close(),this.recreateEngine();const e=new li("could not establish signal connection");throw o instanceof Error&&(e.message="".concat(e.message,": ").concat(o.message)),o instanceof li&&(e.reason=o.reason,e.status=o.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:o})),e}if(i.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new li("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,i)}catch(a){throw yield this.engine.close(),this.recreateEngine(),a}Wr()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Wr()&&(document.addEventListener("freeze",this.onPageLeave),null===(s=navigator.mediaDevices)||void 0===s||s.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(No.Connected),this.emit(gi.Connected),this.registerConnectionReconcile()})),this.disconnect=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Ot(t,void 0,void 0,(function*(){var t,n,i,r;const s=yield this.disconnectLock.lock();try{if(this.state===No.Disconnected)return void this.log.debug("already disconnected",this.logContext);this.log.info("disconnect from room",Object.assign({},this.logContext)),this.state!==No.Connecting&&this.state!==No.Reconnecting||(this.log.warn("abort connection attempt",this.logContext),null===(t=this.abortController)||void 0===t||t.abort(),null===(i=null===(n=this.connectFuture)||void 0===n?void 0:n.reject)||void 0===i||i.call(n,new li("Client initiated disconnect")),this.connectFuture=void 0),(null===(r=this.engine)||void 0===r?void 0:r.client.isDisconnected)||(yield this.engine.client.sendLeave()),this.engine&&(yield this.engine.close()),this.handleDisconnect(e,Qe.CLIENT_INITIATED),this.engine=void 0}finally{s()}}))},this.onPageLeave=()=>Ot(this,void 0,void 0,(function*(){yield this.disconnect()})),this.startAudio=()=>Ot(this,void 0,void 0,(function*(){const e=[],t=Ti();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=os();e.enabled=!0;const i=new MediaStream([e]);n.srcObject=i,document.addEventListener("visibilitychange",(()=>{n&&(n.srcObject=document.hidden?null:i,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))})),document.body.append(n),this.once(gi.Disconnected,(()=>{null===n||void 0===n||n.remove(),n=null}))}e.push(n)}this.participants.forEach((t=>{t.audioTracks.forEach((t=>{t.track&&t.track.attachedElements.forEach((t=>{e.push(t)}))}))}));try{yield Promise.all([this.acquireAudioContext(),...e.map((e=>(e.muted=!1,e.play())))]),this.handleAudioPlaybackStarted()}catch(n){throw this.handleAudioPlaybackFailed(n),n}})),this.startVideo=()=>Ot(this,void 0,void 0,(function*(){const e=[];for(const t of this.participants.values())t.videoTracks.forEach((t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach((t=>{e.includes(t)||e.push(t)}))}));yield Promise.all(e.map((e=>e.play()))).then((()=>{this.handleVideoPlaybackStarted()})).catch((e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)}))})),this.handleRestarting=()=>{this.clearConnectionReconcile();for(const e of this.participants.values())this.handleParticipantDisconnected(e.sid,e);this.setAndEmitConnectionState(No.Reconnecting)&&this.emit(gi.Reconnecting)},this.handleSignalRestarted=e=>Ot(this,void 0,void 0,(function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(t){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:t}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch(n){return}this.setAndEmitConnectionState(No.Connected),this.emit(gi.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()})),this.handleParticipantUpdates=e=>{e.forEach((e=>{if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);const t=this.identityToSid.get(e.identity);t&&t!==e.sid&&this.handleParticipantDisconnected(t,this.participants.get(t));let n=this.participants.get(e.sid);const i=!n;e.state===st.DISCONNECTED?this.handleParticipantDisconnected(e.sid,n):(n=this.getOrCreateParticipant(e.sid,e),i||n.updateInfo(e))}))},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach((e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.participants.get(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}})),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.participants.forEach((e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))})),this.activeSpeakers=t,this.emitWhenConnected(gi.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach((e=>{t.set(e.sid,e)})),e.forEach((e=>{let n=this.participants.get(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))}));const n=Array.from(t.values());n.sort(((e,t)=>t.audioLevel-e.audioLevel)),this.activeSpeakers=n,this.emitWhenConnected(gi.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach((e=>{const t=this.participants.get(e.participantSid);if(!t)return;const n=t.getTrackPublication(e.trackSid);n&&n.track&&(n.track.streamState=Tr.streamStateFromProto(e.state),t.emit(vi.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(gi.TrackStreamStateChanged,n,n.track.streamState,t))}))},this.handleSubscriptionPermissionUpdate=e=>{const t=this.participants.get(e.participantSid);if(!t)return;const n=t.getTrackPublication(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.participants.values()).find((t=>t.tracks.has(e.trackSid)));if(!t)return;const n=t.getTrackPublication(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=(e,t)=>{const n=this.participants.get(e.participantSid);this.emit(gi.DataReceived,e.payload,n,t,e.topic),null===n||void 0===n||n.emit(vi.DataReceived,e.payload,t)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(gi.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(gi.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(gi.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(gi.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>Ot(this,void 0,void 0,(function*(){this.emit(gi.MediaDevicesChanged)})),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(gi.RoomMetadataChanged,e.metadata),(null===t||void 0===t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(gi.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach((e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.participants.get(e.participantSid);t&&t.setConnectionQuality(e.quality)}))},this.onLocalParticipantMetadataChanged=e=>{this.emit(gi.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(gi.ParticipantNameChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(gi.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(gi.TrackUnmuted,e,this.localParticipant)},this.onLocalTrackPublished=e=>Ot(this,void 0,void 0,(function*(){var t;if(this.emit(gi.LocalTrackPublished,e,this.localParticipant),e.track instanceof ro){(yield e.track.checkForSilence())&&this.emit(gi.LocalAudioSilenceDetected,e)}const n=yield null===(t=e.track)||void 0===t?void 0:t.getDeviceId(),i=(r=e.source)===Tr.Source.Microphone?"audioinput":r===Tr.Source.Camera?"videoinput":void 0;var r;i&&n&&n!==this.localParticipant.activeDeviceMap.get(i)&&(this.localParticipant.activeDeviceMap.set(i,n),this.emit(gi.ActiveDeviceChanged,i,n))})),this.onLocalTrackUnpublished=e=>{this.emit(gi.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalConnectionQualityChanged=e=>{this.emit(gi.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=e=>{this.emit(gi.MediaDevicesError,e)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(gi.ParticipantPermissionsChanged,e,this.localParticipant)},this.setMaxListeners(100),this.participants=new Map,this.identityToSid=new Map,this.options=Object.assign(Object.assign({},Ws),e),this.log=g(null!==(n=this.options.loggerName)&&void 0!==n?n:p.Room),this.options.audioCaptureDefaults=Object.assign(Object.assign({},qs),null===e||void 0===e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},zs),null===e||void 0===e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Vs),null===e||void 0===e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new cs,this.localParticipant=new Lo("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ls(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ls(this.options.audioCaptureDefaults.deviceId)),(null===(i=this.options.audioOutput)||void 0===i?void 0:i.deviceId)&&this.switchActiveDevice("audiooutput",ls(this.options.audioOutput.deviceId)).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return Ot(this,void 0,void 0,(function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)}))}setupE2EE(){var e;this.options.e2ee&&(this.e2eeManager=new ms(this.options.e2ee),this.e2eeManager.on(ri.ParticipantEncryptionStatusChanged,((e,t)=>{t instanceof Lo&&(this.isE2EEEnabled=e),this.emit(gi.ParticipantEncryptionStatusChanged,e,t)})),this.e2eeManager.on(ri.EncryptionError,(e=>this.emit(gi.EncryptionError,e))),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){return{room:this.name,roomSid:this.sid,identity:this.localParticipant.identity}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}get sid(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.sid)&&void 0!==t?t:""}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Zs(this.options),this.engine.on(yi.ParticipantUpdate,this.handleParticipantUpdates).on(yi.RoomUpdate,this.handleRoomUpdate).on(yi.SpeakersChanged,this.handleSpeakersChanged).on(yi.StreamStateChanged,this.handleStreamStateUpdate).on(yi.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(yi.SubscriptionError,this.handleSubscriptionError).on(yi.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(yi.MediaTrackAdded,((e,t,n)=>{this.onTrackAdded(e,t,n)})).on(yi.Disconnected,(e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)})).on(yi.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(yi.DataPacketReceived,this.handleDataPacket).on(yi.Resuming,(()=>{this.clearConnectionReconcile(),this.setAndEmitConnectionState(No.Reconnecting)&&this.emit(gi.Reconnecting)})).on(yi.Resumed,(()=>{this.setAndEmitConnectionState(No.Connected),this.emit(gi.Reconnected),this.registerConnectionReconcile(),this.updateSubscriptions(),this.emitBufferedEvents()})).on(yi.SignalResumed,(()=>{this.bufferedEvents=[],this.state===No.Reconnecting&&this.sendSyncState()})).on(yi.Restarting,this.handleRestarting).on(yi.SignalRestarted,this.handleSignalRestarted).on(yi.DCBufferStatusChanged,((e,t)=>{this.emit(gi.DCBufferStatusChanged,e,t)})),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return hs.getInstance().getDevices(e,t)}prepareConnection(e,t){return Ot(this,void 0,void 0,(function*(){if(this.state===No.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Hr(new URL(e))&&t){this.regionUrlProvider=new to(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===No.Disconnected&&(this.regionUrl=n,yield fetch(us(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(us(e),{method:"HEAD"})}catch(n){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:n}))}}}))}getParticipantByIdentity(e){if(this.localParticipant.identity===e)return this.localParticipant;const t=this.identityToSid.get(e);return t?this.participants.get(t):void 0}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return Ot(this,void 0,void 0,(function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new gr({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new gr({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new gr({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new gr({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>Ot(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new gr({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>Ot(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new gr({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new gr({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>Ot(this,void 0,void 0,(function*(){const e=this.engine.client.onLeave;e&&e(new Xi({reason:Qe.CLIENT_INITIATED,canReconnect:!0}))}));break;case"subscriber-bandwidth":if(void 0===t||"number"!==typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new gr({scenario:{case:"subscriberBandwidth",value:BigInt(t)}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())}))}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveAudioOutputDevice(){var e,t;return null!==(t=null===(e=this.options.audioOutput)||void 0===e?void 0:e.deviceId)&&void 0!==t?t:""}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i,r,s;return Ot(this,void 0,void 0,(function*(){let o=!1,a=!0;const c=n?{exact:t}:t;if("audioinput"===e){const e=this.options.audioCaptureDefaults.deviceId;this.options.audioCaptureDefaults.deviceId=c,o=e!==c;const t=Array.from(this.localParticipant.audioTracks.values()).filter((e=>e.source===Tr.Source.Microphone));try{a=(yield Promise.all(t.map((e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(c)})))).every((e=>!0===e))}catch(l){throw this.options.audioCaptureDefaults.deviceId=e,l}}else if("videoinput"===e){const e=this.options.videoCaptureDefaults.deviceId;this.options.videoCaptureDefaults.deviceId=c,o=e!==c;const t=Array.from(this.localParticipant.videoTracks.values()).filter((e=>e.source===Tr.Source.Camera));try{a=(yield Promise.all(t.map((e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(c)})))).every((e=>!0===e))}catch(l){throw this.options.videoCaptureDefaults.deviceId=e,l}}else if("audiooutput"===e){if(!Fr()&&!this.options.expWebAudioMix||this.options.expWebAudioMix&&this.audioContext&&!("setSinkId"in this.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");null!==(i=(s=this.options).audioOutput)&&void 0!==i||(s.audioOutput={});const e=this.options.audioOutput.deviceId;this.options.audioOutput.deviceId=t,o=e!==c;try{this.options.expWebAudioMix?null===(r=this.audioContext)||void 0===r||r.setSinkId(t):yield Promise.all(Array.from(this.participants.values()).map((e=>e.setAudioOutput({deviceId:t}))))}catch(l){throw this.options.audioOutput.deviceId=e,l}}return o&&a&&(this.localParticipant.activeDeviceMap.set(e,t),this.emit(gi.ActiveDeviceChanged,e,t)),a}))}setupLocalParticipantEvents(){this.localParticipant.on(vi.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(vi.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(vi.TrackMuted,this.onLocalTrackMuted).on(vi.TrackUnmuted,this.onLocalTrackUnmuted).on(vi.LocalTrackPublished,this.onLocalTrackPublished).on(vi.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(vi.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(vi.MediaDevicesError,this.onMediaDevicesError).on(vi.AudioStreamAcquired,this.startAudio).on(vi.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.participants.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===No.Connecting||this.state===No.Reconnecting){const i=()=>{this.onTrackAdded(e,t,n),r()},r=()=>{this.off(gi.Reconnected,i),this.off(gi.Connected,i),this.off(gi.Disconnected,r)};return this.once(gi.Reconnected,i),this.once(gi.Connected,i),void this.once(gi.Disconnected,r)}if(this.state===No.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);const i=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(t.id),r=i[0];let s=i[1],o=e.id;if(s&&s.startsWith("TR")&&(o=s),r===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const a=this.participants.get(r);if(!a)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);let c;this.options.adaptiveStream&&(c="object"===typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),a.addSubscribedMediaTrack(e,o,t,n,c)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.bufferedEvents=[],this.state!==No.Disconnected){this.regionUrl=void 0;try{this.participants.forEach((e=>{e.tracks.forEach((t=>{e.unpublishTrack(t.trackSid)}))})),this.localParticipant.tracks.forEach((t=>{var n,i;t.track&&this.localParticipant.unpublishTrack(t.track,e),e&&(null===(n=t.track)||void 0===n||n.detach(),null===(i=t.track)||void 0===i||i.stop())})),this.localParticipant.off(vi.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(vi.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(vi.TrackMuted,this.onLocalTrackMuted).off(vi.TrackUnmuted,this.onLocalTrackUnmuted).off(vi.LocalTrackPublished,this.onLocalTrackPublished).off(vi.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(vi.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(vi.MediaDevicesError,this.onMediaDevicesError).off(vi.AudioStreamAcquired,this.startAudio).off(vi.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"===typeof this.options.expWebAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Wr()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(No.Disconnected),this.emit(gi.Disconnected,t)}}}handleParticipantDisconnected(e,t){this.participants.delete(e),t&&(this.identityToSid.delete(t.identity),t.tracks.forEach((e=>{t.unpublishTrack(e.trackSid,!0)})),this.emit(gi.ParticipantDisconnected,t))}acquireAudioContext(){var e,t;return Ot(this,void 0,void 0,(function*(){if("boolean"!==typeof this.options.expWebAudioMix&&this.options.expWebAudioMix.audioContext?this.audioContext=this.options.expWebAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(e=Or())&&void 0!==e?e:void 0),this.audioContext&&"suspended"===this.audioContext.state)try{yield this.audioContext.resume()}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}this.options.expWebAudioMix&&this.participants.forEach((e=>e.setAudioContext(this.audioContext))),this.localParticipant.setAudioContext(this.audioContext);const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(gi.AudioPlaybackStatusChanged,n))}))}createParticipant(e,t){var n;let i;return i=t?Mo.fromParticipantInfo(this.engine.client,t):new Mo(this.engine.client,e,"",void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.expWebAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),i}getOrCreateParticipant(e,t){if(this.participants.has(e))return this.participants.get(e);const n=this.createParticipant(e,t);return this.participants.set(e,n),this.identityToSid.set(t.identity,t.sid),this.emitWhenConnected(gi.ParticipantConnected,n),n.on(vi.TrackPublished,(e=>{this.emitWhenConnected(gi.TrackPublished,e,n)})).on(vi.TrackSubscribed,((e,t)=>{e.kind===Tr.Kind.Audio?(e.on(bi.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(bi.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===Tr.Kind.Video&&(e.on(bi.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(bi.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(gi.TrackSubscribed,e,t,n)})).on(vi.TrackUnpublished,(e=>{this.emit(gi.TrackUnpublished,e,n)})).on(vi.TrackUnsubscribed,((e,t)=>{this.emit(gi.TrackUnsubscribed,e,t,n)})).on(vi.TrackSubscriptionFailed,(e=>{this.emit(gi.TrackSubscriptionFailed,e,n)})).on(vi.TrackMuted,(e=>{this.emitWhenConnected(gi.TrackMuted,e,n)})).on(vi.TrackUnmuted,(e=>{this.emitWhenConnected(gi.TrackUnmuted,e,n)})).on(vi.ParticipantMetadataChanged,(e=>{this.emitWhenConnected(gi.ParticipantMetadataChanged,e,n)})).on(vi.ParticipantNameChanged,(e=>{this.emitWhenConnected(gi.ParticipantNameChanged,e,n)})).on(vi.ConnectionQualityChanged,(e=>{this.emitWhenConnected(gi.ConnectionQualityChanged,e,n)})).on(vi.ParticipantPermissionsChanged,(e=>{this.emitWhenConnected(gi.ParticipantPermissionsChanged,e,n)})).on(vi.TrackSubscriptionStatusChanged,((e,t)=>{this.emitWhenConnected(gi.TrackSubscriptionStatusChanged,e,t,n)})).on(vi.TrackSubscriptionFailed,((e,t)=>{this.emit(gi.TrackSubscriptionFailed,e,n,t)})).on(vi.TrackSubscriptionPermissionChanged,((e,t)=>{this.emitWhenConnected(gi.TrackSubscriptionPermissionChanged,e,t,n)})),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.participants.values()).reduce(((e,t)=>(e.push(...t.getTracks()),e)),[]),t=this.localParticipant.getTracks();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.participants.values())for(const t of e.videoTracks.values())t.isSubscribed&&t instanceof Do&&t.emitTrackUpdate()}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Pi.setInterval((()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Qe.STATE_MISMATCH)))}),2e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Pi.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(gi.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach((e=>{let[t,n]=e;this.emit(t,...n)})),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.state===No.Connected?this.emit(e,...n):(this.state===No.Reconnecting&&this.bufferedEvents.push([e,n]),!1)}simulateParticipants(e){var t,n;return Ot(this,void 0,void 0,(function*(){const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),r=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new et({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:W.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new rt({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(gi.SignalConnected),this.emit(gi.Connected),this.setAndEmitConnectionState(No.Connected),i.video){const e=new Oo(Tr.Kind.Video,new ht({source:We.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:ze.AUDIO,name:"video-dummy"}),new bo(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:ss(160*(null!==(t=r.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(vi.LocalTrackPublished,e)}if(i.audio){const e=new Oo(Tr.Kind.Audio,new ht({source:We.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:ze.AUDIO}),new ro(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:os(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(vi.LocalTrackPublished,e)}for(let e=0;e<r.count-1;e+=1){let t=new rt({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:st.ACTIVE,tracks:[],joinedAt:W.parse(Date.now())});const i=this.getOrCreateParticipant(t.identity,t);if(r.video){const s=ss(160*(null!==(n=r.aspectRatios[e%r.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),o=new ht({source:We.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:ze.AUDIO});i.addSubscribedMediaTrack(s,o.sid,new MediaStream([s])),t.tracks=[...t.tracks,o]}if(r.audio){const e=os(),n=new ht({source:We.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:ze.AUDIO});i.addSubscribedMediaTrack(e,n.sid,new MediaStream([e])),t.tracks=[...t.tracks,n]}i.updateInfo(t)}}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e!==gi.ActiveSpeakersChanged){const t=Uo(n).filter((e=>void 0!==e));this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function Uo(e){return e.map((e=>{if(e)return Array.isArray(e)?Uo(e):"object"===typeof e?"logContext"in e&&e.logContext:e}))}var jo;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(jo||(jo={}));Gt.EventEmitter;Gt.EventEmitter;function Fo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const i=e instanceof ps?e.mediaStreamTrack:e,r=i.getSettings();let s={facingMode:null!==(n=t.defaultFacingMode)&&void 0!==n?n:"user",confidence:"low"};if("facingMode"in r){const e=r.facingMode;f.debug("rawFacingMode",{rawFacingMode:e}),e&&"string"===typeof e&&function(e){const t=["user","environment","left","right"];return void 0===e||t.includes(e)}(e)&&(s={facingMode:e,confidence:"high"})}if(["low","medium"].includes(s.confidence)){f.debug("Try to get facing mode from device label: (".concat(i.label,")"));const e=function(e){var t;const n=e.trim().toLowerCase();if(""===n)return;if(Bo.has(n))return Bo.get(n);return null===(t=Array.from(Jo.entries()).find((e=>{let[t]=e;return n.includes(t)})))||void 0===t?void 0:t[1]}(i.label);void 0!==e&&(s=e)}return s}const Bo=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),Jo=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);var Vo=n(318),qo=function(e,t){return qo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},qo(e,t)};function zo(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}qo(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Wo(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function Ko(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function Ho(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Go(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function Qo(e,t,n){if(n||2===arguments.length)for(var i,r=0,s=t.length;r<s;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function Yo(e){return this instanceof Yo?(this.v=e,this):new Yo(e)}function $o(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){r[e]&&(i[e]=function(t){return new Promise((function(n,i){s.push([e,t,n,i])>1||a(e,t)}))})}function a(e,t){try{!function(e){e.value instanceof Yo?Promise.resolve(e.value.v).then(c,l):u(s[0][2],e)}(r[e](t))}catch(n){u(s[0][3],n)}}function c(e){a("next",e)}function l(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Xo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Ho(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,r,(t=e[n](t)).done,t.value)}))}}}Object.create;"function"===typeof SuppressedError&&SuppressedError;function Zo(e){return"function"===typeof e}function ea(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ta=ea((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function na(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var ia=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,i,r;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=Ho(s),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(p){e={error:p}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else s.remove(this);var c=this.initialTeardown;if(Zo(c))try{c()}catch(m){r=m instanceof ta?m.errors:[m]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=Ho(l),d=u.next();!d.done;d=u.next()){var h=d.value;try{sa(h)}catch(f){r=null!==r&&void 0!==r?r:[],f instanceof ta?r=Qo(Qo([],Go(r)),Go(f.errors)):r.push(f)}}}catch(g){n={error:g}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}if(r)throw new ta(r)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)sa(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&na(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&na(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();ia.EMPTY;function ra(e){return e instanceof ia||e&&"closed"in e&&Zo(e.remove)&&Zo(e.add)&&Zo(e.unsubscribe)}function sa(e){Zo(e)?e():e.unsubscribe()}var oa={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},aa={setTimeout:function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r=aa.delegate;return(null===r||void 0===r?void 0:r.setTimeout)?r.setTimeout.apply(r,Qo([e,t],Go(n))):setTimeout.apply(void 0,Qo([e,t],Go(n)))},clearTimeout:function(e){var t=aa.delegate;return((null===t||void 0===t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ca(e){aa.setTimeout((function(){var t=oa.onUnhandledError;if(!t)throw e;t(e)}))}function la(){}var ua=da("C",void 0,void 0);function da(e,t,n){return{kind:e,value:t,error:n}}var ha=null;var pa=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,ra(t)&&t.add(n)):n.destination=ka,n}return zo(t,e),t.create=function(e,t,n){return new va(e,t,n)},t.prototype.next=function(e){this.isStopped?ba(function(e){return da("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?ba(da("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?ba(ua,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(ia),ma=Function.prototype.bind;function fa(e,t){return ma.call(e,t)}var ga=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){ya(n)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){ya(n)}else ya(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){ya(t)}},e}(),va=function(e){function t(t,n,i){var r,s,o=e.call(this)||this;Zo(t)||!t?r={next:null!==t&&void 0!==t?t:void 0,error:null!==n&&void 0!==n?n:void 0,complete:null!==i&&void 0!==i?i:void 0}:o&&oa.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},r={next:t.next&&fa(t.next,s),error:t.error&&fa(t.error,s),complete:t.complete&&fa(t.complete,s)}):r=t;return o.destination=new ga(r),o}return zo(t,e),t}(pa);function ya(e){var t;oa.useDeprecatedSynchronousErrorHandling?(t=e,oa.useDeprecatedSynchronousErrorHandling&&ha&&(ha.errorThrown=!0,ha.error=t)):ca(e)}function ba(e,t){var n=oa.onStoppedNotification;n&&aa.setTimeout((function(){return n(e,t)}))}var ka={closed:!0,next:la,error:function(e){throw e},complete:la},Sa="function"===typeof Symbol&&Symbol.observable||"@@observable";function Ca(e){return e}function Ta(e){return 0===e.length?Ca:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var wa=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i,r=this,s=(i=e)&&i instanceof pa||function(e){return e&&Zo(e.next)&&Zo(e.error)&&Zo(e.complete)}(i)&&ra(i)?e:new va(e,t,n);return function(e){if(oa.useDeprecatedSynchronousErrorHandling){var t=!ha;if(t&&(ha={errorThrown:!1,error:null}),e(),t){var n=ha,i=n.errorThrown,r=n.error;if(ha=null,i)throw r}}else e()}((function(){var e=r,t=e.operator,n=e.source;s.add(t?t.call(s,n):n?r._subscribe(s):r._trySubscribe(s))})),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Ea(t))((function(t,i){var r=new va({next:function(t){try{e(t)}catch(n){i(n),r.unsubscribe()}},error:i,complete:t});n.subscribe(r)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Sa]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ta(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Ea(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function Ea(e){var t;return null!==(t=null!==e&&void 0!==e?e:oa.Promise)&&void 0!==t?t:Promise}function Pa(e){return function(t){if(function(e){return Zo(null===e||void 0===e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(n){this.error(n)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Ra(e,t,n,i,r){return new xa(e,t,n,i,r)}var xa=function(e){function t(t,n,i,r,s,o){var a=e.call(this,t)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=n?function(e){try{n(e)}catch(i){t.error(i)}}:e.prototype._next,a._error=r?function(e){try{r(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return zo(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(pa);function Oa(e,t){return Pa((function(n,i){var r=0;n.subscribe(Ra(i,(function(n){i.next(e.call(t,n,r++))})))}))}var Ia=function(e){return e&&"number"===typeof e.length&&"function"!==typeof e};function Na(e){return Zo(null===e||void 0===e?void 0:e.then)}function _a(e){return Zo(e[Sa])}function Da(e){return Symbol.asyncIterator&&Zo(null===e||void 0===e?void 0:e[Symbol.asyncIterator])}function Ma(e){return new TypeError("You provided "+(null!==e&&"object"===typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var La="function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Aa(e){return Zo(null===e||void 0===e?void 0:e[La])}function Ua(e){return $o(this,arguments,(function(){var t,n,i;return Ko(this,(function(r){switch(r.label){case 0:t=e.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,Yo(t.read())];case 3:return n=r.sent(),i=n.value,n.done?[4,Yo(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,Yo(i)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function ja(e){return Zo(null===e||void 0===e?void 0:e.getReader)}function Fa(e){if(e instanceof wa)return e;if(null!=e){if(_a(e))return r=e,new wa((function(e){var t=r[Sa]();if(Zo(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ia(e))return i=e,new wa((function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()}));if(Na(e))return n=e,new wa((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,ca)}));if(Da(e))return Ba(e);if(Aa(e))return t=e,new wa((function(e){var n,i;try{for(var r=Ho(t),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()}));if(ja(e))return Ba(Ua(e))}var t,n,i,r;throw Ma(e)}function Ba(e){return new wa((function(t){(function(e,t){var n,i,r,s;return Wo(this,void 0,void 0,(function(){var o,a;return Ko(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Xo(e),c.label=1;case 1:return[4,n.next()];case 2:if((i=c.sent()).done)return[3,4];if(o=i.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),r={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Ja(e,t,n,i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var s=t.schedule((function(){n(),r?e.add(this.schedule(null,i)):this.unsubscribe()}),i);if(e.add(s),!r)return s}function Va(e,t,n){return void 0===n&&(n=1/0),Zo(t)?Va((function(n,i){return Oa((function(e,r){return t(n,e,i,r)}))(Fa(e(n,i)))}),n):("number"===typeof t&&(n=t),Pa((function(t,i){return function(e,t,n,i,r,s,o,a){var c=[],l=0,u=0,d=!1,h=function(){!d||c.length||l||t.complete()},p=function(e){return l<i?m(e):c.push(e)},m=function(e){s&&t.next(e),l++;var a=!1;Fa(n(e,u++)).subscribe(Ra(t,(function(e){null===r||void 0===r||r(e),s?p(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{l--;for(var e=function(){var e=c.shift();o?Ja(t,o,(function(){return m(e)})):m(e)};c.length&&l<i;)e();h()}catch(n){t.error(n)}})))};return e.subscribe(Ra(t,p,(function(){d=!0,h()}))),function(){null===a||void 0===a||a()}}(t,i,e,n)})))}function qa(){return void 0===(e=1)&&(e=1/0),Va(Ca,e);var e}function za(e){return e[e.length-1]}function Wa(e){return(t=za(e))&&Zo(t.schedule)?e.pop():void 0;var t}function Ka(e,t){return void 0===t&&(t=0),Pa((function(n,i){n.subscribe(Ra(i,(function(n){return Ja(i,e,(function(){return i.next(n)}),t)}),(function(){return Ja(i,e,(function(){return i.complete()}),t)}),(function(n){return Ja(i,e,(function(){return i.error(n)}),t)})))}))}function Ha(e,t){return void 0===t&&(t=0),Pa((function(n,i){i.add(e.schedule((function(){return n.subscribe(i)}),t))}))}function Ga(e,t){if(!e)throw new Error("Iterable cannot be null");return new wa((function(n){Ja(n,t,(function(){var i=e[Symbol.asyncIterator]();Ja(n,t,(function(){i.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Qa(e,t){if(null!=e){if(_a(e))return function(e,t){return Fa(e).pipe(Ha(t),Ka(t))}(e,t);if(Ia(e))return function(e,t){return new wa((function(n){var i=0;return t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())}))}))}(e,t);if(Na(e))return function(e,t){return Fa(e).pipe(Ha(t),Ka(t))}(e,t);if(Da(e))return Ga(e,t);if(Aa(e))return function(e,t){return new wa((function(n){var i;return Ja(n,t,(function(){i=e[La](),Ja(n,t,(function(){var e,t,r;try{t=(e=i.next()).value,r=e.done}catch(s){return void n.error(s)}r?n.complete():n.next(t)}),0,!0)})),function(){return Zo(null===i||void 0===i?void 0:i.return)&&i.return()}}))}(e,t);if(ja(e))return function(e,t){return Ga(Ua(e),t)}(e,t)}throw Ma(e)}function Ya(e,t){return t?Qa(e,t):Fa(e)}function $a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return qa()(Ya(e,Wa(e)))}function Xa(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Wa(e);return Pa((function(t,i){(n?$a(e,t,n):$a(e,t)).subscribe(i)}))}function Za(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ya(e,Wa(e))}var ec=Array.isArray;function tc(e){return Oa((function(t){return function(e,t){return ec(t)?e.apply(void 0,Qo([],Go(t))):e(t)}(e,t)}))}var nc=["addListener","removeListener"],ic=["addEventListener","removeEventListener"],rc=["on","off"];function sc(e,t,n,i){if(Zo(n)&&(i=n,n=void 0),i)return sc(e,t,n).pipe(tc(i));var r=Go(function(e){return Zo(e.addEventListener)&&Zo(e.removeEventListener)}(e)?ic.map((function(i){return function(r){return e[i](t,r,n)}})):function(e){return Zo(e.addListener)&&Zo(e.removeListener)}(e)?nc.map(oc(e,t)):function(e){return Zo(e.on)&&Zo(e.off)}(e)?rc.map(oc(e,t)):[],2),s=r[0],o=r[1];if(!s&&Ia(e))return Va((function(e){return sc(e,t,n)}))(Fa(e));if(!s)throw new TypeError("Invalid event target");return new wa((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return s(t),function(){return o(t)}}))}function oc(e,t){return function(n){return function(i){return e[n](t,i)}}}var ac=function(e){function t(t,n){return e.call(this)||this}return zo(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(ia),cc={setInterval:function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r=cc.delegate;return(null===r||void 0===r?void 0:r.setInterval)?r.setInterval.apply(r,Qo([e,t],Go(n))):setInterval.apply(void 0,Qo([e,t],Go(n)))},clearInterval:function(e){var t=cc.delegate;return((null===t||void 0===t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},lc=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return zo(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),cc.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&cc.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,i=!1;try{this.work(e)}catch(r){i=!0,n=r||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,na(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(ac),uc={now:function(){return(uc.delegate||Date).now()},delegate:void 0},dc=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=uc.now,e}(),hc=new(function(e){function t(t,n){void 0===n&&(n=dc.now);var i=e.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return zo(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(dc))(lc);var pc=ea((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function mc(e,t){var n,i=(n=e)instanceof Date&&!isNaN(n)?{first:e}:"number"===typeof e?{each:e}:e,r=i.first,s=i.each,o=i.with,a=void 0===o?fc:o,c=i.scheduler,l=void 0===c?null!==t&&void 0!==t?t:hc:c,u=i.meta,d=void 0===u?null:u;if(null==r&&null==s)throw new TypeError("No timeout provided.");return Pa((function(e,t){var n,i,o=null,c=0,u=function(e){i=Ja(t,l,(function(){try{n.unsubscribe(),Fa(a({meta:d,lastValue:o,seen:c})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe(Ra(t,(function(e){null===i||void 0===i||i.unsubscribe(),c++,t.next(o=e),s>0&&u(s)}),void 0,void 0,(function(){(null===i||void 0===i?void 0:i.closed)||null===i||void 0===i||i.unsubscribe(),o=null}))),!c&&u(null!=r?"number"===typeof r?r:+r-l.now():s)}))}function fc(e){throw new pc(e)}function gc(e,t){return e===t}Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;var vc="lk";function yc(e){return"undefined"!==typeof e&&(function(e){var t;if(!e)return!1;return e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&"undefined"!==typeof(null==(t=e.publication)?void 0:t.track)}(e)||function(e){if(!e)return!1;return e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&"undefined"!==typeof e.publication}(e))}function bc(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&"undefined"===typeof e.publication)}function kc(e){if("string"===typeof e||"number"===typeof e)return"".concat(e);if(bc(e))return"".concat(e.participant.identity,"_").concat(e.source,"_placeholder");if(yc(e))return"".concat(e.participant.identity,"_").concat(e.publication.source,"_").concat(e.publication.trackSid);throw new Error("Can't generate a id for the given track reference: ".concat(e))}function Sc(e,t){return"undefined"!==typeof t&&(yc(e)?t.some((t=>t.participant.identity===e.participant.identity&&yc(t)&&t.publication.trackSid===e.publication.trackSid)):!!bc(e)&&t.some((t=>t.participant.identity===e.participant.identity&&bc(t)&&t.source===e.source)))}function Cc(e){return e instanceof Lo}var Tc=[...[gi.ConnectionStateChanged,gi.RoomMetadataChanged,gi.ActiveSpeakersChanged,gi.ConnectionQualityChanged,gi.ParticipantConnected,gi.ParticipantDisconnected,gi.ParticipantPermissionsChanged,gi.ParticipantMetadataChanged,gi.TrackMuted,gi.TrackUnmuted,gi.TrackPublished,gi.TrackUnpublished,gi.TrackStreamStateChanged,gi.TrackSubscriptionFailed,gi.TrackSubscriptionPermissionChanged,gi.TrackSubscriptionStatusChanged],gi.LocalTrackPublished,gi.LocalTrackUnpublished],wc=(vi.ConnectionQualityChanged,vi.IsSpeakingChanged,vi.ParticipantMetadataChanged,vi.ParticipantPermissionsChanged,vi.TrackMuted,vi.TrackUnmuted,vi.TrackPublished,vi.TrackUnpublished,vi.TrackStreamStateChanged,vi.TrackSubscriptionFailed,vi.TrackSubscriptionPermissionChanged,vi.TrackSubscriptionStatusChanged,vi.LocalTrackPublished,vi.LocalTrackUnpublished,Vo.getLogger("lk-components-js"));wc.setDefaultLevel("WARN");var Ec=[{columns:1,rows:1,name:"1x1",minTiles:1,maxTiles:1,minWidth:0,minHeight:0},{columns:1,rows:2,name:"1x2",minTiles:2,maxTiles:2,minWidth:0,minHeight:0},{columns:2,rows:1,name:"2x1",minTiles:2,maxTiles:2,minWidth:900,minHeight:0},{columns:2,rows:2,name:"2x2",minTiles:3,maxTiles:4,minWidth:560,minHeight:0},{columns:3,rows:3,name:"3x3",minTiles:5,maxTiles:9,minWidth:700,minHeight:0},{columns:4,rows:4,name:"4x4",minTiles:10,maxTiles:16,minWidth:960,minHeight:0},{columns:5,rows:5,name:"5x5",minTiles:17,maxTiles:25,minWidth:1100,minHeight:0}];function Pc(e,t,n,i){let r=0,s=e.find(((e,n,i)=>{r=n;const s=-1!==i.findIndex(((t,i)=>{const r=i>n,s=t.maxTiles===e.maxTiles;return r&&s}));return e.maxTiles>=t&&!s}));if(void 0===s){if(s=e[e.length-1],!s)throw new Error("No layout or fallback layout found.");wc.warn("No layout found for: participantCount: ".concat(t,", width/height: ").concat(n,"/").concat(i," fallback to biggest available layout (").concat(s.name,")."))}if((n<s.minWidth||i<s.minHeight)&&r>0){const t=e[r-1];s=Pc(e.slice(0,r),t.maxTiles,n,i)}return s}function Rc(e){return"object"===typeof e}function xc(e){return Array.isArray(e)&&e.filter(Rc).length>0}function Oc(e,t){return t.audioLevel-e.audioLevel}function Ic(e,t){return e.isSpeaking===t.isSpeaking?0:e.isSpeaking?-1:1}function Nc(e,t){var n,i,r,s;return void 0!==e.lastSpokeAt||void 0!==t.lastSpokeAt?(null!=(i=null==(n=t.lastSpokeAt)?void 0:n.getTime())?i:0)-(null!=(s=null==(r=e.lastSpokeAt)?void 0:r.getTime())?s:0):0}function _c(e,t){var n,i,r,s;return(null!=(i=null==(n=e.joinedAt)?void 0:n.getTime())?i:0)-(null!=(s=null==(r=t.joinedAt)?void 0:r.getTime())?s:0)}function Dc(e){const t=[],n=[],i=[],r=[];e.forEach((e=>{e.participant.isLocal&&e.source===Tr.Source.Camera?t.push(e):e.source===Tr.Source.ScreenShare?n.push(e):e.source===Tr.Source.Camera?i.push(e):r.push(e)}));const s=function(e){const t=[],n=[];e.forEach((e=>{e.participant.isLocal?t.push(e):n.push(e)})),t.sort(((e,t)=>_c(e.participant,t.participant))),n.sort(((e,t)=>_c(e.participant,t.participant)));return[...n,...t]}(n),o=function(e){const t=[],n=[];return e.forEach((e=>{e.participant.isLocal?t.push(e):n.push(e)})),n.sort(((e,t)=>e.participant.isSpeaking&&t.participant.isSpeaking?Oc(e.participant,t.participant):e.participant.isSpeaking!==t.participant.isSpeaking?Ic(e.participant,t.participant):e.participant.lastSpokeAt!==t.participant.lastSpokeAt?Nc(e.participant,t.participant):yc(e)!==yc(t)?function(e,t){return yc(e)?yc(t)?0:-1:yc(t)?1:0}(e,t):e.participant.isCameraEnabled!==t.participant.isCameraEnabled?function(e,t){const n=e.participant.isCameraEnabled;return n!==t.participant.isCameraEnabled?n?-1:1:0}(e,t):_c(e.participant,t.participant))),[...t,...n]}(i);return[...t,...s,...o,...r]}function Mc(e,t){const n=Math.max(e.length,t.length);return new Array(n).fill([]).map(((n,i)=>[e[i],t[i]]))}function Lc(e,t,n){return e.filter((e=>!t.map((e=>n(e))).includes(n(e))))}function Ac(e){return e.map((e=>"string"===typeof e||"number"===typeof e?"".concat(e):kc(e)))}function Uc(e,t){const n=t.findIndex((t=>kc(t)===kc(e)));if(-1===n)throw new Error("Element not part of the array: ".concat(kc(e)," not in ").concat(Ac(t)));return n}function jc(e,t){var n;return n=t,e.reduce(((e,t,i)=>i%n===0?[...e,[t]]:[...e.slice(0,-1),[...e.slice(-1)[0],t]]),[])}function Fc(e,t,n){let i=function(e,t){return e.map((e=>{const n=t.find((t=>{return kc(e)===kc(t)||"number"!==typeof e&&bc(e)&&yc(t)&&(i=t,bc(n=e)&&yc(i)&&i.participant.identity===n.participant.identity&&i.source===n.source);var n,i}));return null!=n?n:e}))}(e,t);if(i.length<t.length){const e=Lc(t,i,kc);i=[...i,...e]}if(Mc(jc(i,n),jc(t,n)).forEach(((e,t)=>{let[r,s]=e;if(r&&s){const e=jc(i,n)[t],c={dropped:Lc(o=e,a=s,kc),added:Lc(a,o,kc)};(function(e){return 0!==e.added.length||0!==e.dropped.length})(c)&&(wc.debug("Detected visual changes on page: ".concat(t,", current: ").concat(Ac(r),", next: ").concat(Ac(s)),{changes:c}),c.added.length===c.dropped.length&&Mc(c.added,c.dropped).forEach((e=>{let[t,n]=e;if(!t||!n)throw new Error("For a swap action we need a addition and a removal one is missing: ".concat(t,", ").concat(n));i=function(e,t,n){const i=Uc(e,n),r=Uc(t,n);return n.splice(i,1,t),n.splice(r,1,e),n}(t,n,i)})),0===c.added.length&&c.dropped.length>0&&c.dropped.forEach((e=>{i=function(e,t){const n=Uc(e,t);return t.splice(n,1),t}(e,i)})),c.added.length>0&&0===c.dropped.length&&c.added.forEach((e=>{var t,n;t=e,n=i,i=[...n,t]})))}var o,a})),i.length>t.length){const e=Lc(i,t,kc);i=i.filter((t=>!e.map(kc).includes(kc(t))))}return i}function Bc(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new wa((t=>{const i=()=>{t.next(e)};n.forEach((t=>{e.on(t,i)}));return()=>{n.forEach((t=>{e.off(t,i)}))}})).pipe(Xa(e))}function Jc(e,t){const n=new wa((n=>{const i=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.next(t)};e.on(t,i);return()=>{e.off(t,i)}}));return n}function Vc(e,t){return Jc(e,gi.ParticipantEncryptionStatusChanged).pipe((n=n=>{let[,i]=n;return t.identity===(null==i?void 0:i.identity)||!i&&t.identity===e.localParticipant.identity},Pa((function(e,t){var r=0;e.subscribe(Ra(t,(function(e){return n.call(i,e,r++)&&t.next(e)})))}))),Oa((e=>{let[t]=e;return t})),Xa(t instanceof Lo?t.isE2EEEnabled:t.isEncrypted));var n,i}function qc(e){return"".concat(vc,"-").concat(e)}function zc(e){if(yc(e))return e.publication;{const{source:t,name:n,participant:i}=e;if(t&&n)return i.getTracks().find((e=>e.source===t&&e.trackName===n));if(n)return i.getTrackByName(n);if(t)return i.getTrack(t);throw new Error("At least one of source and name needs to be defined")}}function Wc(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new wa((t=>{const i=()=>{t.next(e)};n.forEach((t=>{e.on(t,i)}));return()=>{n.forEach((t=>{e.off(t,i)}))}})).pipe(Xa(e))}function Kc(e){return Wc(e,vi.TrackMuted,vi.TrackUnmuted,vi.ParticipantPermissionsChanged,vi.TrackPublished,vi.TrackUnpublished,vi.LocalTrackPublished,vi.LocalTrackUnpublished,vi.MediaDevicesError,vi.TrackSubscriptionStatusChanged).pipe(Oa((e=>{const{isMicrophoneEnabled:t,isCameraEnabled:n,isScreenShareEnabled:i}=e,r=e.getTrack(Tr.Source.Microphone);return{isCameraEnabled:n,isMicrophoneEnabled:t,isScreenShareEnabled:i,cameraTrack:e.getTrack(Tr.Source.Camera),microphoneTrack:r,participant:e}})))}function Hc(e,t){const n=new wa((n=>{const i=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.next(t)};e.on(t,i);return()=>{e.off(t,i)}}));return n}function Gc(e){var t,n,i,r;return Wc(e.participant,vi.TrackMuted,vi.TrackUnmuted,vi.TrackSubscribed,vi.TrackUnsubscribed,vi.LocalTrackPublished,vi.LocalTrackUnpublished).pipe(Oa((t=>{var n,i;const r=null!=(n=e.publication)?n:t.getTrack(e.source);return null==(i=null==r?void 0:r.isMuted)||i})),Xa(null==(r=null!=(i=null==(t=e.publication)?void 0:t.isMuted)?i:null==(n=e.participant.getTrack(e.source))?void 0:n.isMuted)||r))}function Qc(e){const t=qc("connection-quality"),n=function(e){return Hc(e,vi.ConnectionQualityChanged).pipe(Oa((e=>{let[t]=e;return t})),Xa(e.connectionQuality))}(e);return{className:t,connectionQualityObserver:n}}function Yc(e){const t=function(e){const t=Wc(e,vi.ParticipantMetadataChanged).pipe(Oa((e=>{let{name:t,identity:n,metadata:i}=e;return{name:t,identity:n,metadata:i}})),Xa({name:e.name,identity:e.identity,metadata:e.metadata}));return t}(e);return{className:"lk-participant-name",infoObserver:t}}new TextEncoder,new TextDecoder;function $c(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=[e.localParticipant,...Array.from(e.participants.values())],r=[];return i.forEach((e=>{t.forEach((t=>{const i=Array.from(e.tracks.values()).filter((e=>e.source===t&&(!n||e.track))).map((t=>({participant:e,publication:t,source:t.source})));r.push(...i)}))})),{trackReferences:r,participants:i}}function Xc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(null===e)return Za(!1);const n=sc(e,"mousemove",{passive:!0}).pipe(Oa((()=>!0))),i=n.pipe(mc({each:t,with:()=>{return $a(Za(!1),i.pipe((e=n,Pa((function(t,n){var i=!1,r=Ra(n,(function(){null===r||void 0===r||r.unsubscribe(),i=!0}),la);Fa(e).subscribe(r),t.subscribe(Ra(n,(function(e){return i&&n.next(e)})))})))));var e}}),(void 0===s&&(s=Ca),r=null!==r&&void 0!==r?r:gc,Pa((function(e,t){var n,i=!0;e.subscribe(Ra(t,(function(e){var o=s(e);!i&&r(n,o)||(i=!1,n=o,t.next(e))})))}))));var r,s;return i}var Zc,el="".concat(vc,"-user-choices"),{load:tl,save:nl}=(Zc=el,{load:()=>function(e){if("undefined"!==typeof localStorage)try{const t=localStorage.getItem(e);return t?JSON.parse(t):void wc.warn("Item with key ".concat(e," does not exist in local storage."))}catch(t){return void wc.error("Error getting item from local storage: ".concat(t))}else wc.error("Local storage is not available.")}(Zc),save:e=>function(e,t){if("undefined"!==typeof localStorage)try{localStorage.setItem(e,JSON.stringify(t))}catch(n){wc.error("Error setting item to local storage: ".concat(n))}else wc.error("Local storage is not available.")}(Zc,e)});const il=function(t,n){const[i,r]=(0,e.useState)(t);return(0,e.useEffect)((()=>{const e=setTimeout((()=>r(t)),n||500);return()=>{clearTimeout(e)}}),[t,n]),i};const rl=function(t,n){let{threshold:i=0,root:r=null,rootMargin:s="0%",freezeOnceVisible:o=!1}=n;const[a,c]=(0,e.useState)(),l=(null===a||void 0===a?void 0:a.isIntersecting)&&o,u=e=>{let[t]=e;c(t)};return(0,e.useEffect)((()=>{const e=null===t||void 0===t?void 0:t.current;if(!!!window.IntersectionObserver||l||!e)return;const n=new IntersectionObserver(u,{threshold:i,root:r,rootMargin:s});return n.observe(e),()=>n.disconnect()}),[null===t||void 0===t?void 0:t.current,JSON.stringify(i),r,s,l]),a};"undefined"!==typeof window?e.useLayoutEffect:e.useEffect;var sl,ol=Object.defineProperty,al=Object.defineProperties,cl=Object.getOwnPropertyDescriptors,ll=Object.getOwnPropertySymbols,ul=Object.prototype.hasOwnProperty,dl=Object.prototype.propertyIsEnumerable,hl=(e,t,n)=>t in e?ol(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,pl=(e,t)=>{for(var n in t||(t={}))ul.call(t,n)&&hl(e,n,t[n]);if(ll)for(var n of ll(t))dl.call(t,n)&&hl(e,n,t[n]);return e},ml=(e,t)=>al(e,cl(t)),fl=(e,t)=>{var n={};for(var i in e)ul.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&ll)for(var i of ll(e))t.indexOf(i)<0&&dl.call(e,i)&&(n[i]=e[i]);return n};var gl=()=>sl||(sl=function(){let e=!1,t=[];const n=new Map;if("undefined"===typeof window)return;const i=new ResizeObserver(((i,r)=>{t=t.concat(i),e||window.requestAnimationFrame((()=>{const i=new Set;for(let e=0;e<t.length;e++){if(i.has(t[e].target))continue;i.add(t[e].target);const s=n.get(t[e].target);null==s||s.forEach((n=>n(t[e],r)))}t=[],e=!1})),e=!0}));return{observer:i,subscribe(e,t){var r;i.observe(e);const s=null!=(r=n.get(e))?r:[];s.push(t),n.set(e,s)},unsubscribe(e,t){var r;const s=null!=(r=n.get(e))?r:[];if(1===s.length)return i.unobserve(e),void n.delete(e);const o=s.indexOf(t);-1!==o&&s.splice(o,1),n.set(e,s)}}}()),vl=t=>{const[n,i]=e.useState({width:0,height:0});e.useLayoutEffect((()=>{if(t.current){const{width:e,height:n}=t.current.getBoundingClientRect();i({width:e,height:n})}}),[t.current]);const s=e.useCallback((e=>i(e.contentRect)),[]);return function(t,n){const i=gl(),s=r(n);e.useLayoutEffect((()=>{let e=!1;const n=t.current;if(n)return null==i||i.subscribe(n,r),()=>{e=!0,null==i||i.unsubscribe(n,r)};function r(t,n){e||s.current(t,n)}}),[t.current,i,s]),null==i||i.observer}(t,s),n};function yl(t,n){const[i,r]=e.useState(n);return e.useEffect((()=>{if("undefined"===typeof window||!t)return;const e=t.subscribe(r);return()=>e.unsubscribe()}),[t]),i}var bl=e.createContext(void 0);function kl(){return e.useContext(bl)}var Sl=e.createContext(void 0);function Cl(){return e.useContext(Sl)}var Tl=e.createContext(void 0);function wl(){return e.useContext(Tl)}function El(e){var t;const n=wl(),i=Cl(),r=null!=(t=null!=e?e:n)?t:null==i?void 0:i.participant;if(!r)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return r}var Pl=e.createContext(void 0);function Rl(){const t=e.useContext(Pl);if(!t)throw Error("tried to access room context outside of livekit room component");return t}function xl(){return e.useContext(Pl)}function Ol(e){const t=xl(),n=null!=e?e:t;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}var Il=e.createContext(void 0);function Nl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(const e of t)"function"===typeof e&&e(...arguments)}}function _l(){const e=pl({},arguments.length<=0?void 0:arguments[0]);for(let t=1;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];for(const t in n){const i=e[t],r=n[t];"function"===typeof i&&"function"===typeof r&&"o"===t[0]&&"n"===t[1]&&t.charCodeAt(2)>=65&&t.charCodeAt(2)<=90?e[t]=Nl(i,r):e[t]="className"!==t&&"UNSAFE_className"!==t||"string"!==typeof i||"string"!==typeof r?void 0!==r?r:i:o(i,r)}}return e}function Dl(t){let{trackRef:n,trackSource:i,participant:r,props:s}=t;const o=El(r);if(!n&&!i)throw new Error("trackRef or trackSource must be defined.");const a=kl(),{className:c}=e.useMemo((()=>({className:[qc("button"),qc("focus-toggle-button")].join(" ")})),[]),l=e.useMemo((()=>{if(n)return Sc(n,null==a?void 0:a.pin.state);if(i){const e=o.getTrack(i);return!(!(null==a?void 0:a.pin.state)||!e)&&Sc({participant:o,source:i,publication:e},a.pin.state)}throw new Error("trackRef or trackSource and participant must be defined.")}),[n,null==a?void 0:a.pin.state,o,i]);return{mergedProps:e.useMemo((()=>_l(s,{className:c,onClick:e=>{var t,r,c,u,d;if(null==(t=s.onClick)||t.call(s,e),n)l?null==(c=null==a?void 0:(r=a.pin).dispatch)||c.call(r,{msg:"clear_pin"}):null==(d=null==a?void 0:(u=a.pin).dispatch)||d.call(u,{msg:"set_pin",trackReference:n});else if(i){const e=o.getTrack(i);(null==a?void 0:a.pin.dispatch)&&e&&(l?a.pin.dispatch({msg:"clear_pin"}):a.pin.dispatch({msg:"set_pin",trackReference:{participant:o,publication:e,source:e.source}}))}}})),[s,c,n,i,l,null==a?void 0:a.pin,o]),inFocus:l}}function Ml(t,n){const{width:i,height:r}=vl(t),s=i>0&&r>0?Pc(Ec,n,i,r):Ec[0];return e.useEffect((()=>{t.current&&s&&(t.current.style.setProperty("--lk-col-count",null==s?void 0:s.columns.toString()),t.current.style.setProperty("--lk-row-count",null==s?void 0:s.rows.toString()))}),[t,s]),{layout:s}}function Ll(t){var n,i;const r=El("string"===typeof t?(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).participant:t.participant),s="string"===typeof t?{participant:r,source:t}:t,[o,a]=e.useState(!(!(null==(n=s.publication)?void 0:n.isMuted)&&!(null==(i=r.getTrack(s.source))?void 0:i.isMuted)));return e.useEffect((()=>{const e=Gc(s).subscribe(a);return()=>e.unsubscribe()}),[kc(s)]),o}function Al(t){const n=El(t),i=e.useMemo((()=>function(e){return Hc(e,vi.IsSpeakingChanged).pipe(Oa((e=>{let[t]=e;return t})))}(n)),[n]);return yl(i,n.isSpeaking)}var Ul={connect:!0,audio:!1,video:!1};function jl(e){return void 0!==e}function Fl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return _l(...t.filter(jl))}function Bl(t,n,i){return e.Children.map(t,(r=>e.isValidElement(r)&&e.Children.only(t)?e.cloneElement(r,ml(pl({},n),{key:i})):r))}function Jl(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;const[r,s]=e.useState(zc(t)),[o,a]=e.useState(null==r?void 0:r.isMuted),[c,l]=e.useState(null==r?void 0:r.isSubscribed),[u,d]=e.useState(null==r?void 0:r.track),[h,p]=e.useState("landscape"),m=e.useRef(),{className:f,trackObserver:g}=e.useMemo((()=>function(e){const t=zc(e),n=Kc(e.participant).pipe(Oa((()=>zc(e))),Xa(t));return{className:qc(e.source===Tr.Source.Camera||e.source===Tr.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}(t)),[null!=(i=t.participant.sid)?i:t.participant.identity,t.source,yc(t)&&t.publication.trackSid]);return e.useEffect((()=>{const e=g.subscribe((e=>{wc.debug("update track",e),s(e),a(null==e?void 0:e.isMuted),l(null==e?void 0:e.isSubscribed),d(null==e?void 0:e.track)}));return()=>null==e?void 0:e.unsubscribe()}),[g]),e.useEffect((()=>{var e,i;return u&&(m.current&&u.detach(m.current),!(null==(e=n.element)?void 0:e.current)||Cc(t.participant)&&"audio"===(null==u?void 0:u.kind)||u.attach(n.element.current)),m.current=null==(i=n.element)?void 0:i.current,()=>{m.current&&(null==u||u.detach(m.current))}}),[u,n.element]),e.useEffect((()=>{var e,t;if("number"===typeof(null==(e=null==r?void 0:r.dimensions)?void 0:e.width)&&"number"===typeof(null==(t=null==r?void 0:r.dimensions)?void 0:t.height)){const e=r.dimensions.width>r.dimensions.height?"landscape":"portrait";p(e)}}),[r]),{publication:r,isMuted:o,isSubscribed:c,track:u,elementProps:Fl(n.props,pl({className:f,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":null==r?void 0:r.source},"video"===(null==r?void 0:r.kind)&&{"data-lk-orientation":h}))}}function Vl(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e.useRef([]),s=e.useRef(-1),o=n!==s.current,a="function"===typeof i.customSortFunction?i.customSortFunction(t):Dc(t);let c=[...a];if(!1===o)try{c=Fc(r.current,a,n)}catch(l){wc.error("Error while running updatePages(): ",l)}return r.current=o?a:c,s.current=n,c}function ql(t){let{trackRef:n,participant:i,source:r,publication:s,onParticipantClick:o,disableSpeakingIndicator:a,htmlProps:c}=t;const l=Cl(),u=El(i),d=e.useMemo((()=>{var e,t,i,o,a,c;const d=null!=(t=null!=(e=null==n?void 0:n.source)?e:null==l?void 0:l.source)?t:r;if(void 0===d)throw new Error("Missing track `source`, provided it via `trackRef`, `source` property or via `TrackRefContext`.");return{participant:null!=(o=null!=(i=null==n?void 0:n.participant)?i:null==l?void 0:l.participant)?o:u,publication:null!=(c=null!=(a=null==n?void 0:n.publication)?a:null==l?void 0:l.publication)?c:s,source:d}}),[null==n?void 0:n.participant,null==n?void 0:n.source,null==n?void 0:n.publication,null==l?void 0:l.participant,null==l?void 0:l.source,null==l?void 0:l.publication,u,r,s]),h=e.useMemo((()=>{const{className:e}={className:qc("participant-tile")};return _l(c,{className:e,onClick:e=>{var t,n;if(null==(t=c.onClick)||t.call(c,e),"function"===typeof o){const e=null!=(n=d.publication)?n:d.participant.getTrack(d.source);o({participant:d.participant,track:e})}}})}),[c,o,d.publication,d.source,d.participant]),p=Ll(Tr.Source.Camera,{participant:d.participant}),m=Ll(Tr.Source.Microphone,{participant:d.participant}),f=Al(d.participant),g=function(e){if(e.publication instanceof Oo){const t=e.publication.track;if(t){const{facingMode:e}=Fo(t);return e}}return"undefined"}(d);return{elementProps:pl({"data-lk-audio-muted":m,"data-lk-video-muted":p,"data-lk-speaking":!0!==a&&f,"data-lk-local-participant":d.participant.isLocal,"data-lk-source":d.source,"data-lk-facing-mode":g},h)}}function zl(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,r,s,o;let a=Cl();const c=null!=(r=null!=(i=wl())?i:n.participant)?r:null==a?void 0:a.participant;if("string"===typeof t){if(!c)throw Error("Participant missing, either provide it via context or pass it in directly");a={participant:c,source:t}}else{if(!t)throw Error("No track reference found, either provide it via context or pass it in directly");a=t}const{className:l,mediaMutedObserver:u}=e.useMemo((()=>function(e){let t="track-muted-indicator-camera";switch(e.source){case Tr.Source.Camera:t="track-muted-indicator-camera";break;case Tr.Source.Microphone:t="track-muted-indicator-microphone"}return{className:qc(t),mediaMutedObserver:Gc(e)}}(a)),[kc(a)]);return{isMuted:yl(u,!(!(null==(s=a.publication)?void 0:s.isMuted)&&!(null==(o=a.participant.getTrack(a.source))?void 0:o.isMuted))),className:l}}function Wl(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[Tr.Source.Camera,Tr.Source.Microphone,Tr.Source.ScreenShare,Tr.Source.ScreenShareAudio,Tr.Source.Unknown],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Ol(n.room),[r,s]=e.useState([]),[o,a]=e.useState([]),c=e.useMemo((()=>t.map((e=>Rc(e)?e.source:e))),[JSON.stringify(t)]);e.useEffect((()=>{const e=function(e,t,n){var i,r;const s=null!=(i=n.additionalRoomEvents)?i:Tc,o=null==(r=n.onlySubscribed)||r;return Bc(e,...Array.from(new Set([gi.ParticipantConnected,gi.ParticipantDisconnected,gi.ConnectionStateChanged,gi.LocalTrackPublished,gi.LocalTrackUnpublished,gi.TrackPublished,gi.TrackUnpublished,gi.TrackSubscriptionStatusChanged,...s]).values())).pipe(Oa((e=>{const n=$c(e,t,o);return wc.debug("TrackReference[] was updated. (length ".concat(n.trackReferences.length,")"),n),n})),Xa($c(e,t,o)))}(i,c,{additionalRoomEvents:n.updateOnlyOn,onlySubscribed:n.onlySubscribed}).subscribe((e=>{let{trackReferences:t,participants:n}=e;wc.debug("setting track bundles",t,n),s(t),a(n)}));return()=>e.unsubscribe()}),[i,JSON.stringify(n.updateOnlyOn),JSON.stringify(t)]);const l=e.useMemo((()=>{if(xc(t)){const e=function(e,t){const n=new Map;if(xc(e)){const i=e.filter((e=>e.withPlaceholder)).map((e=>e.source));t.forEach((e=>{const t=e.getTracks().map((e=>{var t;return null==(t=e.track)?void 0:t.source})).filter((e=>void 0!==e)),r=Array.from(function(e,t){const n=new Set(e);for(const i of t)n.delete(i);return n}(new Set(i),new Set(t)));r.length>0&&n.set(e.identity,r)}))}return n}(t,o),n=Array.from(r);return o.forEach((t=>{var i;if(e.has(t.identity)){(null!=(i=e.get(t.identity))?i:[]).forEach((e=>{if(r.find((n=>{let{participant:i,publication:r}=n;return t.identity===i.identity&&r.source===e})))return;wc.debug("Add ".concat(e," placeholder for participant ").concat(t.identity,"."));const i={participant:t,source:e};n.push(i)}))}})),n}return r}),[r,o,t]);return l}var Kl=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),e.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),Hl=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),Gl=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M5.293 2.293a1 1 0 0 1 1.414 0l4.823 4.823a1.25 1.25 0 0 1 0 1.768l-4.823 4.823a1 1 0 0 1-1.414-1.414L9.586 8 5.293 3.707a1 1 0 0 1 0-1.414z",clipRule:"evenodd"})),Ql=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},e.createElement("path",{d:"M10 1.75h4.25m0 0V6m0-4.25L9 7M6 14.25H1.75m0 0V10m0 4.25L7 9"}))),Yl=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M4 6.104V4a4 4 0 1 1 8 0v2.104c1.154.326 2 1.387 2 2.646v4.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-4.5c0-1.259.846-2.32 2-2.646ZM5.5 4a2.5 2.5 0 0 1 5 0v2h-5V4Z",clipRule:"evenodd"})),$l=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),e.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),Xl=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),e.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),Zl=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"})),eu=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),tu=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),nu=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}))),iu=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},t),e.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),e.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),ru=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},t),e.createElement("g",{fill:"currentColor"},e.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),e.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),su=t=>e.createElement("svg",pl({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},e.createElement("path",{d:"M13.25 7H9m0 0V2.75M9 7l5.25-5.25M2.75 9H7m0 0v4.25M7 9l-5.25 5.25"})));function ou(t){var n=t,{trackRef:i,trackSource:r,participant:s}=n,o=fl(n,["trackRef","trackSource","participant"]);const a=Cl(),{mergedProps:c,inFocus:l}=Dl({trackRef:null!=i?i:a,trackSource:r,participant:s,props:o});return e.createElement(bl.Consumer,null,(t=>void 0!==t&&e.createElement("button",pl({},c),o.children?o.children:l?e.createElement(su,null):e.createElement(Ql,null))))}function au(t,n){switch(t){case Tr.Source.Microphone:return n?e.createElement(Xl,null):e.createElement($l,null);case Tr.Source.Camera:return n?e.createElement(Hl,null):e.createElement(Kl,null);case Tr.Source.ScreenShare:return n?e.createElement(ru,null):e.createElement(iu,null);default:return}}function cu(t){var n;const{className:i,quality:r}=function(){const t=El((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).participant),{className:n,connectionQualityObserver:i}=e.useMemo((()=>Qc(t)),[t]);return{className:n,quality:yl(i,Io.Unknown)}}(t),s=e.useMemo((()=>ml(pl({},Fl(t,{className:i})),{"data-lk-quality":r})),[r,t,i]);return e.createElement("div",pl({},s),null!=(n=t.children)?n:function(t){switch(t){case Io.Excellent:return e.createElement(Zl,null);case Io.Good:return e.createElement(eu,null);case Io.Poor:return e.createElement(tu,null);default:return e.createElement(nu,null)}}(r))}function lu(t){var n=t,{participant:i}=n,r=fl(n,["participant"]);const s=El(i),{className:o,infoObserver:a}=e.useMemo((()=>Yc(s)),[s]),{identity:c,name:l}=yl(a,{name:s.name,identity:s.identity,metadata:s.metadata}),u=e.useMemo((()=>Fl(r,{className:o,"data-lk-participant-name":l})),[r,o,l]);return e.createElement("span",pl({},u),""!==l?l:c,r.children)}function uu(t){var n,i,r=t,{source:s,participant:o,trackRef:a,show:c="always"}=r,l=fl(r,["source","participant","trackRef","show"]);const{className:u,isMuted:d}=zl(null!=a?a:s,{participant:o}),h="always"===c||"muted"===c&&d||"unmuted"===c&&!d,p=e.useMemo((()=>Fl(l,{className:u})),[u,l]);return h?e.createElement("div",ml(pl({},p),{"data-lk-muted":d}),null!=(i=l.children)?i:au(null!=(n=null==a?void 0:a.source)?n:s,!d)):null}var du=t=>e.createElement("svg",pl({width:320,height:320,viewBox:"0 0 320 320",preserveAspectRatio:"xMidYMid meet",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("path",{d:"M160 180C204.182 180 240 144.183 240 100C240 55.8172 204.182 20 160 20C115.817 20 79.9997 55.8172 79.9997 100C79.9997 144.183 115.817 180 160 180Z",fill:"white",fillOpacity:.25}),e.createElement("path",{d:"M97.6542 194.614C103.267 191.818 109.841 192.481 115.519 195.141C129.025 201.466 144.1 205 159.999 205C175.899 205 190.973 201.466 204.48 195.141C210.158 192.481 216.732 191.818 222.345 194.614C262.703 214.719 291.985 253.736 298.591 300.062C300.15 310.997 291.045 320 280 320H39.9997C28.954 320 19.8495 310.997 21.4087 300.062C28.014 253.736 57.2966 214.72 97.6542 194.614Z",fill:"white",fillOpacity:.25}));function hu(t){var n,i,r,s,o,a,c,l,u,d,h=t,{onTrackClick:p,onClick:m,onSubscriptionStatusChanged:f,trackRef:g,name:v,publication:y,source:b,participant:k,manageSubscription:S}=h,C=fl(h,["onTrackClick","onClick","onSubscriptionStatusChanged","trackRef","name","publication","source","participant","manageSubscription"]);const T=Cl(),w=null!=(s=null!=(r=null==(n=null==g?void 0:g.publication)?void 0:n.trackName)?r:null==(i=null==T?void 0:T.publication)?void 0:i.trackName)?s:v,E=null!=(a=null!=(o=null==g?void 0:g.source)?o:null==T?void 0:T.source)?a:b,P=null!=(l=null!=(c=null==g?void 0:g.publication)?c:null==T?void 0:T.publication)?l:y,R=null!=(d=null!=(u=null==g?void 0:g.participant)?u:null==T?void 0:T.participant)?d:k;if(void 0===E)throw new Error("VideoTrack: You must provide a trackRef or source property.");const x=El(R),O=e.useRef(null),I=rl(O,{}),N=il(I,3e3);e.useEffect((()=>{S&&P instanceof Do&&!1===(null==N?void 0:N.isIntersecting)&&!1===(null==I?void 0:I.isIntersecting)&&P.setSubscribed(!1)}),[N,P,S]),e.useEffect((()=>{S&&P instanceof Do&&!0===(null==I?void 0:I.isIntersecting)&&P.setSubscribed(!0)}),[I,P,S]);const{elementProps:_,publication:D,isSubscribed:M}=Jl({participant:x,name:w,source:E,publication:P},{element:O,props:C});e.useEffect((()=>{null==f||f(!!M)}),[M,f]);return e.createElement("video",ml(pl({ref:O},_),{muted:!0,onClick:e=>{null==m||m(e),null==p||p({participant:x,track:D})}}))}function pu(t){var n,i,r,s,o,a,c,l,u,d,h=t,{trackRef:p,onSubscriptionStatusChanged:m,volume:f,source:g,name:v,publication:y,participant:b}=h,k=fl(h,["trackRef","onSubscriptionStatusChanged","volume","source","name","publication","participant"]);const S=Cl(),C=null!=(s=null!=(r=null==(n=null==p?void 0:p.publication)?void 0:n.trackName)?r:null==(i=null==S?void 0:S.publication)?void 0:i.trackName)?s:v,T=null!=(a=null!=(o=null==p?void 0:p.source)?o:null==S?void 0:S.source)?a:g,w=null!=(l=null!=(c=null==p?void 0:p.publication)?c:null==S?void 0:S.publication)?l:y,E=null!=(d=null!=(u=null==p?void 0:p.participant)?u:null==S?void 0:S.participant)?d:b;if(void 0===T)throw new Error("The AudioTrack component expects a trackRef or source property.");const P=e.useRef(null),R=El(E),{elementProps:x,isSubscribed:O,track:I,publication:N}=Jl({source:T,name:C,participant:R,publication:w},{element:P,props:k});return e.useEffect((()=>{null==m||m(!!O)}),[O,m]),e.useEffect((()=>{void 0!==I&&void 0!==f&&(I instanceof wo?I.setVolume(f):wc.warn("Volume can only be set on remote audio tracks."))}),[f,I]),e.useEffect((()=>{void 0!==N&&void 0!==k.muted&&(N instanceof Do?N.setEnabled(!k.muted):wc.warn("Can only call setEnabled on remote track publications."))}),[k.muted,N,I]),e.createElement("audio",pl({ref:P},x))}function mu(t){const n=!!wl();return t.participant&&!n?e.createElement(Tl.Provider,{value:t.participant},t.children):e.createElement(e.Fragment,null,t.children)}function fu(t){const n=!!Cl();return t.trackRef&&!n?e.createElement(Sl.Provider,{value:t.trackRef},t.children):e.createElement(e.Fragment,null,t.children)}function gu(t){var n,i,r=t,{trackRef:s,participant:o,children:a,source:c=Tr.Source.Camera,onParticipantClick:l,publication:u,disableSpeakingIndicator:d}=r,h=fl(r,["trackRef","participant","children","source","onParticipantClick","publication","disableSpeakingIndicator"]);const p=Cl(),m=El(o),f=e.useMemo((()=>{var e,t,n,i,r,o;return{participant:null!=(t=null!=(e=null==s?void 0:s.participant)?e:null==p?void 0:p.participant)?t:m,source:null!=(i=null!=(n=null==s?void 0:s.source)?n:null==p?void 0:p.source)?i:c,publication:null!=(o=null!=(r=null==s?void 0:s.publication)?r:null==p?void 0:p.publication)?o:u}}),[p,m,u,c,s]),{elementProps:g}=ql({participant:f.participant,htmlProps:h,source:f.source,publication:f.publication,disableSpeakingIndicator:d,onParticipantClick:l}),v=function(t){const n=El(t),i=Ol();return yl(e.useMemo((()=>Vc(i,n)),[i,n]),n instanceof Lo?n.isE2EEEnabled:n.isEncrypted)}(m),y=kl(),b=null==(n=function(t){const n=e.useContext(Il);if(!0===t){if(n)return n;throw Error("tried to access feature context, but none is present")}return n}())?void 0:n.autoSubscription,k=e.useCallback((e=>{f.source&&!e&&y&&y.pin.dispatch&&Sc(f,y.pin.state)&&y.pin.dispatch({msg:"clear_pin"})}),[f,y]);return e.createElement("div",pl({style:{position:"relative"}},g),e.createElement(fu,{trackRef:f},e.createElement(mu,{participant:f.participant},null!=a?a:e.createElement(e.Fragment,null,!yc(f)||"video"!==(null==(i=f.publication)?void 0:i.kind)&&f.source!==Tr.Source.Camera&&f.source!==Tr.Source.ScreenShare?yc(f)&&e.createElement(pu,{trackRef:f,onSubscriptionStatusChanged:k}):e.createElement(hu,{trackRef:f,onSubscriptionStatusChanged:k,manageSubscription:b}),e.createElement("div",{className:"lk-participant-placeholder"},e.createElement(du,null)),e.createElement("div",{className:"lk-participant-metadata"},e.createElement("div",{className:"lk-participant-metadata-item"},f.source===Tr.Source.Camera?e.createElement(e.Fragment,null,v&&e.createElement(Yl,{style:{marginRight:"0.25rem"}}),e.createElement(uu,{source:Tr.Source.Microphone,show:"muted"}),e.createElement(lu,null)):e.createElement(e.Fragment,null,e.createElement(iu,{style:{marginRight:"0.25rem"}}),e.createElement(lu,null,"'s screen"))),e.createElement(cu,{className:"lk-participant-metadata-item"}))),e.createElement(ou,{trackRef:f}))))}function vu(t){var n=t,{trackRef:i,track:r}=n,s=fl(n,["trackRef","track"]);const o=null!=i?i:r;return e.createElement(gu,pl(pl({},o),s))}function yu(t){var n=t,{tracks:i}=n,r=fl(n,["tracks"]);return e.createElement(e.Fragment,null,i.map((t=>e.createElement(Sl.Provider,{value:t,key:kc(t)},Bl(r.children)))))}function bu(t){let{totalPageCount:n,nextPage:i,prevPage:r,currentPage:s,pagesContainer:o}=t;const[a,c]=e.useState(!1);return e.useEffect((()=>{let e;return o&&(e=Xc(o.current,2e3).subscribe(c)),()=>{e&&e.unsubscribe()}}),[o]),e.createElement("div",{className:"lk-pagination-control","data-lk-user-interaction":a},e.createElement("button",{className:"lk-button",onClick:r},e.createElement(Gl,null)),e.createElement("span",{className:"lk-pagination-count"},"".concat(s," of ").concat(n)),e.createElement("button",{className:"lk-button",onClick:i},e.createElement(Gl,null)))}function ku(t){let{totalPageCount:n,currentPage:i}=t;const r=new Array(n).fill("").map(((t,n)=>n+1===i?e.createElement("span",{"data-lk-active":!0,key:n}):e.createElement("span",{key:n})));return e.createElement("div",{className:"lk-pagination-indicator"},r)}function Su(t){var n=t,{tracks:i}=n,r=fl(n,["tracks"]);const s=e.createRef(),o=e.useMemo((()=>Fl(r,{className:"lk-grid-layout"})),[r]),{layout:a}=Ml(s,i.length),c=function(t,n){const[i,r]=e.useState(1),s=Math.max(Math.ceil(n.length/t),1);i>s&&r(s);const o=i*t,a=o-t,c=e=>{r((t=>"next"===e?t===s?t:t+1:1===t?t:t-1))},l=Vl(n,t).slice(a,o);return{totalPageCount:s,nextPage:()=>c("next"),prevPage:()=>c("previous"),setPage:e=>{r(e>s?s:e<1?1:e)},firstItemIndex:a,lastItemIndex:o,tracks:l,currentPage:i}}(a.maxTiles,i);return function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;const r=e.useRef(null),s=e.useRef(null),o=null!=(i=n.minSwipeDistance)?i:50,a=e=>{s.current=null,r.current=e.targetTouches[0].clientX},c=e=>{s.current=e.targetTouches[0].clientX},l=e.useCallback((()=>{if(!r.current||!s.current)return;const e=r.current-s.current,t=e<-o;e>o&&n.onLeftSwipe&&n.onLeftSwipe(),t&&n.onRightSwipe&&n.onRightSwipe()}),[o,n]);e.useEffect((()=>{const e=t.current;return e&&(e.addEventListener("touchstart",a,{passive:!0}),e.addEventListener("touchmove",c,{passive:!0}),e.addEventListener("touchend",l,{passive:!0})),()=>{e&&(e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",c),e.removeEventListener("touchend",l))}}),[t,l])}(s,{onLeftSwipe:c.nextPage,onRightSwipe:c.prevPage}),e.createElement("div",pl({ref:s,"data-lk-pagination":c.totalPageCount>1},o),e.createElement(yu,{tracks:c.tracks},r.children),i.length>a.maxTiles&&e.createElement(e.Fragment,null,e.createElement(ku,{totalPageCount:c.totalPageCount,currentPage:c.currentPage}),e.createElement(bu,pl({pagesContainer:s},c))))}var Cu=130,Tu=140,wu=1,Eu=1.6,Pu=-1*(1-Eu),Ru=xu;function xu(t){var n=t,{tracks:i,orientation:r}=n,s=fl(n,["tracks","orientation"]);const o=e.useRef(null),[a,c]=e.useState(0),{width:l,height:u}=vl(o),d=r||(u>=l?"vertical":"horizontal"),h="vertical"===d?Math.max(l*Pu,Cu):Math.max(u*Eu,Tu),p=function(){const e=document.createElement("p");e.style.width="100%",e.style.height="200px";const t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);const n=e.offsetWidth;t.style.overflow="scroll";let i=e.offsetWidth;return n===i&&(i=t.clientWidth),document.body.removeChild(t),n-i}(),m="vertical"===d?Math.max((u-p)/h,wu):Math.max((l-p)/h,wu);let f=Math.round(m);Math.abs(m-a)<.5?f=Math.round(a):a!==m&&c(m);const g=Vl(i,f);return e.useLayoutEffect((()=>{o.current&&(o.current.dataset.lkOrientation=d,o.current.style.setProperty("--lk-max-visible-tiles",f.toString()))}),[f,d]),e.createElement("aside",pl({key:d,className:"lk-carousel",ref:o},s),e.createElement(yu,{tracks:g},s.children))}function Ou(t){const{room:n,htmlProps:i}=function(t){const n=pl(pl({},Ul),t),{token:i,serverUrl:r,options:s,room:o,connectOptions:a,connect:c,audio:l,video:u,screen:d,onConnected:h,onDisconnected:p,onError:m,onMediaDeviceFailure:f,onEncryptionError:g,simulateParticipants:v}=n,y=fl(n,["token","serverUrl","options","room","connectOptions","connect","audio","video","screen","onConnected","onDisconnected","onError","onMediaDeviceFailure","onEncryptionError","simulateParticipants"]);s&&o&&wc.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[b,k]=e.useState();e.useEffect((()=>{k(null!=o?o:new Ao(s))}),[o]);const S=e.useMemo((()=>{const{className:e}={className:"lk-room-container"};return _l(y,{className:e})}),[y]);return e.useEffect((()=>{if(!b)return;const e=()=>{const e=b.localParticipant;wc.debug("trying to publish local tracks"),Promise.all([e.setMicrophoneEnabled(!!l,"boolean"!==typeof l?l:void 0),e.setCameraEnabled(!!u,"boolean"!==typeof u?u:void 0),e.setScreenShareEnabled(!!d,"boolean"!==typeof d?d:void 0)]).catch((e=>{wc.warn(e),null==m||m(e)}))},t=e=>{const t=fi.getFailure(e);null==f||f(t)},n=e=>{null==g||g(e)};return b.on(gi.SignalConnected,e).on(gi.MediaDevicesError,t).on(gi.EncryptionError,n),()=>{b.off(gi.SignalConnected,e).off(gi.MediaDevicesError,t).off(gi.EncryptionError,n)}}),[b,l,u,d,m,g,f]),e.useEffect((()=>{if(b)if(v)b.simulateParticipants({participants:{count:v},publish:{audio:!0,useRealTracks:!0}});else{if(i)return r?void(c?(wc.debug("connecting"),b.connect(r,i,a).catch((e=>{wc.warn(e),null==m||m(e)}))):(wc.debug("disconnecting because connect is false"),b.disconnect())):(wc.warn("no livekit url provided"),void(null==m||m(Error("no livekit url provided"))));wc.debug("no token yet")}}),[c,i,JSON.stringify(a),b,m,r,v]),e.useEffect((()=>{if(!b)return;const e=e=>{switch(e){case No.Disconnected:p&&p();break;case No.Connected:h&&h()}};return b.on(gi.ConnectionStateChanged,e),()=>{b.off(gi.ConnectionStateChanged,e)}}),[i,h,p,b]),e.useEffect((()=>{if(b)return()=>{wc.info("disconnecting on onmount"),b.disconnect()}}),[b]),{room:b,htmlProps:S}}(t);return e.createElement("div",pl({},i),n&&e.createElement(Pl.Provider,{value:n},e.createElement(Il.Provider,{value:t.featureFlags},t.children)))}function Iu(t){let{volume:n,muted:i}=t;const r=Wl([Tr.Source.Microphone,Tr.Source.ScreenShareAudio,Tr.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!1}).filter((e=>!Cc(e.participant)&&e.publication.kind===Tr.Kind.Audio));return e.useEffect((()=>{for(const e of r)e.publication.setSubscribed(!0)}),[r]),e.createElement("div",{style:{display:"none"}},r.map((t=>e.createElement(pu,{key:kc(t),trackRef:t,volume:n,muted:i}))))}var Nu=n(579);const _u=e=>{let{tracks:t}=e;const n=Vl(t,1);return 0===n.length?null:(0,Nu.jsx)(hu,{...n[0]})},Du=e=>{let{tracks:t}=e;const n=Vl(t,1),i=n.shift(),r=Vl(n,3);if(!i)return(0,Nu.jsx)(Nu.Fragment,{});if(0===r.length){const e=i;return(0,Nu.jsx)(hu,{...e})}return(0,Nu.jsxs)("div",{className:"lk-focus-layout",children:[(0,Nu.jsx)(Ru,{tracks:r,children:(0,Nu.jsx)(gu,{})}),(0,Nu.jsx)(vu,{track:i})]})};function Mu(t){let{url:n,token:i,layout:r}=t;const[s,o]=(0,e.useState)();return n&&i?(0,Nu.jsx)(Ou,{serverUrl:n,token:i,onError:o,children:s?(0,Nu.jsx)("div",{className:"error",children:s.message}):(0,Nu.jsx)(Lu,{layout:r})}):(0,Nu.jsx)("div",{className:"error",children:"missing required params url and token"})}function Lu(t){let{layout:n}=t;const r=Rl(),[s,o]=(0,e.useState)(n),[a,c]=(0,e.useState)(!1),l=Wl([Tr.Source.ScreenShare],{onlySubscribed:!0});(0,e.useEffect)((()=>{if(r){i.A.setRoom(r),i.A.onLayoutChanged((e=>{o(e)}));let e=!1;for(const t of Array.from(r.participants.values()))if(t.tracks.size>0){e=!0;break}e?i.A.startRecording():r.once(gi.TrackSubscribed,(()=>i.A.startRecording()))}}),[r]),(0,e.useEffect)((()=>{l.length>0&&l[0].publication?c(!0):c(!1)}),[l]);const u=Wl([Tr.Source.Camera,Tr.Source.ScreenShare,Tr.Source.Unknown],{onlySubscribed:!0}).filter((e=>e.publication.kind===Tr.Kind.Video&&e.participant.identity!==r.localParticipant.identity));let d="dark";s.endsWith("-light")&&(d="light");let h="roomContainer";d&&(h+=" ".concat(d));let p=(0,Nu.jsx)(Nu.Fragment,{}),m=s;return a&&s.startsWith("grid")&&(m=s.replace("grid","speaker")),r.state!==No.Disconnected&&(p=m.startsWith("speaker")?(0,Nu.jsx)(Du,{tracks:u}):m.startsWith("single-speaker")?(0,Nu.jsx)(_u,{tracks:u}):(0,Nu.jsx)(Su,{tracks:u,children:(0,Nu.jsx)(gu,{})})),(0,Nu.jsxs)("div",{className:h,children:[p,(0,Nu.jsx)(Iu,{})]})}const Au=function(){return(0,Nu.jsx)("div",{className:"container",children:(0,Nu.jsx)(Mu,{url:i.A.getLiveKitURL(),token:i.A.getAccessToken(),layout:i.A.getLayout()})})},Uu=document.getElementById("root");if(!Uu)throw new Error("Failed to find the root element");(0,t.H)(Uu).render((0,Nu.jsx)(e.StrictMode,{children:(0,Nu.jsx)(Au,{})}))})()})();
//# sourceMappingURL=main.468e2d22.js.map